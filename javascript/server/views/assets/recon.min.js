/*!
  * SWIM Library - RECON
  * Version: 0.7.2
  * Copyright Â© 2015-2018 SWIM Inc. All Rights Reserved
  * Website: https://www.swim.ai
  * Date: Thu Aug 23 2018 13:16:49 GMT-0700 (DST)
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.recon={})}(this,function(t){"use strict";var e=new ArrayBuffer(8),i=new Float64Array(e),o=new Int32Array(e),h={hash:function(t){if(null===t)return 0;if("string"==typeof t){for(var e=0,r=0,n=t.length;r<n;r+=1)e=h.mix(e,t.charCodeAt(r));return e=h.mash(e)}if("number"==typeof t)return~~t===t?~~t:(i[0]=t,o[0]^o[1]);throw new TypeError(""+t)},mix:function(t,e){return e=r(e*=3432918353,15),t=5*(t=r(t^=e*=461845907,13))+3864292196},mash:function(t){return t^=t>>>16,t*=2246822507,t^=t>>>13,t*=3266489909,t^=t>>>16}};function r(t,e){return t<<e|t>>>32-e}var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};function c(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var s=function(){function t(){}return t.prototype.set=function(t){throw new Error("immutable")},t.prototype.delete=function(){throw new Error("immutable")},t.Empty=void 0,t}(),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.isEmpty=function(){return!0},e.prototype.head=function(){throw new Error("empty head")},e.prototype.step=function(){throw new Error("empty step")},e.prototype.skip=function(t){},e.prototype.hasNext=function(){return!1},e.prototype.nextIndex=function(){return 0},e.prototype.next=function(){return{done:!0}},e.prototype.hasPrevious=function(){return!1},e.prototype.previousIndex=function(){return-1},e.prototype.previous=function(){return{done:!0}},e}(s);s.Empty=new u;var a=function(r){function t(t){var e=r.call(this)||this;return e._value=t,e._index=0,e}return c(t,r),t.prototype.isEmpty=function(){return 0!==this._index},t.prototype.head=function(){if(0===this._index)return this._value;throw new Error("empty head")},t.prototype.step=function(){if(0!==this._index)throw new Error("empty step");this._index=1},t.prototype.skip=function(t){this._index=Math.min(Math.max(0,this._index+t),1)},t.prototype.hasNext=function(){return 0===this._index},t.prototype.nextIndex=function(){return this._index},t.prototype.next=function(){return 0===this._index?(this._index=1,{value:this._value,done:!0}):{done:!0}},t.prototype.hasPrevious=function(){return 1===this._index},t.prototype.previousIndex=function(){return this._index-1},t.prototype.previous=function(){return 1===this._index?(this._index=0,{value:this._value,done:!0}):{done:!0}},t}(s),p=function(r){function t(t){var e=r.call(this)||this;return e.cursor=t,e}return c(t,r),t.prototype.isEmpty=function(){return this.cursor.isEmpty()},t.prototype.head=function(){return this.cursor.head()[0]},t.prototype.step=function(){this.cursor.step()},t.prototype.skip=function(t){this.cursor.skip(t)},t.prototype.hasNext=function(){return this.cursor.hasNext()},t.prototype.nextIndex=function(){return this.cursor.nextIndex()},t.prototype.next=function(){var t=this.cursor.next(),e=t.value,r=t.done;return{value:e&&e[0],done:r}},t.prototype.hasPrevious=function(){return this.cursor.hasPrevious()},t.prototype.previousIndex=function(){return this.cursor.previousIndex()},t.prototype.previous=function(){var t=this.cursor.next(),e=t.value,r=t.done;return{value:e&&e[0],done:r}},t.prototype.delete=function(){this.cursor.delete()},t}(s),f=function(r){function t(t){var e=r.call(this)||this;return e.cursor=t,e}return c(t,r),t.prototype.isEmpty=function(){return this.cursor.isEmpty()},t.prototype.head=function(){return this.cursor.head()[1]},t.prototype.step=function(){this.cursor.step()},t.prototype.skip=function(t){this.cursor.skip(t)},t.prototype.hasNext=function(){return this.cursor.hasNext()},t.prototype.nextIndex=function(){return this.cursor.nextIndex()},t.prototype.next=function(){var t=this.cursor.next(),e=t.value,r=t.done;return{value:e&&e[1],done:r}},t.prototype.hasPrevious=function(){return this.cursor.hasPrevious()},t.prototype.previousIndex=function(){return this.cursor.previousIndex()},t.prototype.previous=function(){var t=this.cursor.next(),e=t.value,r=t.done;return{value:e&&e[1],done:r}},t.prototype.delete=function(){this.cursor.delete()},t}(s),l=function(n){function t(t,e){void 0===e&&(e=0);var r=n.call(this)||this;return r._array=t,r._index=e,r}return c(t,n),t.prototype.isEmpty=function(){return this._index>=this._array.length},t.prototype.head=function(){if(this._index<this._array.length)return this._array[this._index];throw new Error("empty head")},t.prototype.step=function(){if(!(this._index<this._array.length))throw new Error("empty step");this._index=1},t.prototype.skip=function(t){this._index=Math.min(this._index+t,this._array.length)},t.prototype.hasNext=function(){return this._index<this._array.length},t.prototype.nextIndex=function(){return this._index},t.prototype.next=function(){var t=this._index;return t<this._array.length?(this._index=t+1,{value:this._array[t],done:this._index===this._array.length}):(this._index=this._array.length,{done:!0})},t.prototype.hasPrevious=function(){return 0<this._index},t.prototype.previousIndex=function(){return this._index-1},t.prototype.previous=function(){var t=this._index-1;return 0<=t?(this._index=t,{value:this._array[t],done:0===t}):{done:!(this._index=0)}},t}(s),d=function(o){function t(t,e,r,n){void 0===e&&(e=0),void 0===r&&(r=0);var i=o.call(this)||this;return i.pages=t,i._index=e,i._pageIndex=r,i._subCursor=n,i}return c(t,o),t.prototype.isEmpty=function(){for(;;)if(this._subCursor){if(!this._subCursor.isEmpty())return!1;this._subCursor=void 0}else{if(!(this._pageIndex<this.pages.length))return this._pageIndex=this.pages.length,!0;this._subCursor=this.pageCursor(this.pages[this._pageIndex]),this._pageIndex+=1}},t.prototype.head=function(){for(;;)if(this._subCursor){if(!this._subCursor.isEmpty())return this._subCursor.head();this._subCursor=void 0}else{if(!(this._pageIndex<this.pages.length))throw this._pageIndex=this.pages.length,new Error("empty head");this._subCursor=this.pageCursor(this.pages[this._pageIndex]),this._pageIndex+=1}},t.prototype.step=function(){for(;;)if(this._subCursor){if(!this._subCursor.isEmpty())return void(this._index+=1);this._subCursor=void 0}else{if(!(this._pageIndex<this.pages.length))throw this._pageIndex=this.pages.length,new Error("empty step");this._subCursor=this.pageCursor(this.pages[this._pageIndex]),this._pageIndex+=1}},t.prototype.skip=function(t){for(;0<t;)if(this._subCursor)this._subCursor.hasNext()?(this._index+=1,t-=1,this._subCursor.next()):this._subCursor=void 0;else{if(!(this._pageIndex<this.pages.length))break;var e=this.pages[this._pageIndex],r=this.pageSize(e);if(this._pageIndex+=1,r<t){this._subCursor=this.pageCursor(e),0<t&&(this._index+=t,this._subCursor.skip(t),t=0);break}this._index+=r,t-=r}},t.prototype.hasNext=function(){for(;;)if(this._subCursor){if(this._subCursor.hasNext())return!0;this._subCursor=void 0}else{if(!(this._pageIndex<this.pages.length))return this._pageIndex=this.pages.length,!1;this._subCursor=this.pageCursor(this.pages[this._pageIndex]),this._pageIndex+=1}},t.prototype.nextIndex=function(){return this._index},t.prototype.next=function(){for(;;)if(this._subCursor){if(this._subCursor.hasNext())return this._index+=1,this._subCursor.next();this._subCursor=void 0}else{if(!(this._pageIndex<this.pages.length))return this._pageIndex=this.pages.length,{done:!0};this._subCursor=this.pageCursor(this.pages[this._pageIndex]),this._pageIndex+=1}},t.prototype.hasPrevious=function(){for(;;)if(this._subCursor){if(this._subCursor.hasPrevious())return!0;this._subCursor=void 0}else{if(!(0<this._pageIndex))return this._pageIndex=0,!1;this._subCursor=this.reversePageCursor(this.pages[this._pageIndex-1]),this._pageIndex-=1}},t.prototype.previousIndex=function(){return this._index-1},t.prototype.previous=function(){for(;;)if(this._subCursor){if(this._subCursor.hasPrevious())return this._index-=1,this._subCursor.previous();this._subCursor=void 0}else{if(!(0<this._pageIndex))return{done:!(this._pageIndex=0)};this._subCursor=this.reversePageCursor(this.pages[this._pageIndex-1]),this._pageIndex-=1}},t.prototype.set=function(t){this._subCursor.set(t)},t.prototype.delete=function(){this._subCursor.delete()},t}(s),y=function(){function t(){}return t.done=function(){return new v("")},t}(),v=function(i){function t(t,e,r){void 0===e&&(e=0),void 0===r&&(r=!1);var n=i.call(this)||this;return n.buffer=t,n.index=e,n.more=r,n}return c(t,i),t.prototype.isDone=function(){return this.isEmpty()&&!this.more},t.prototype.isEmpty=function(){return this.index>=this.buffer.length},t.prototype.head=function(){var t=this.buffer.charCodeAt(this.index);if(t<=55295||57344<=t)return t;if(t<=56319&&this.index+1<this.buffer.length){var e=this.buffer.charCodeAt(this.index+1);return 56320<=e&&e<=57343?65536+((1023&t)<<10|1023&e):65533}return 65533},t.prototype.step=function(){var t=this.buffer.charCodeAt(this.index);if(t<=55295||57344<=t)this.index+=1;else if(t<=56319&&this.index+1<this.buffer.length){var e=this.buffer.charCodeAt(this.index+1);this.index+=56320<=e&&e<=57343?2:1}else this.index+=1},t.prototype.clone=function(){return new t(this.buffer,this.index,this.more)},t}(y),m=function(){function t(t){void 0===t&&(t=""),this.buffer=t}return t.prototype.isDone=function(){return!1},t.prototype.isFull=function(){return!1},t.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=0,n=t.length;r<n;r+=1){var i=t[r];if("number"==typeof i)if(0<=i&&i<=55295||57344<=i&&i<=65535)this.buffer+=String.fromCharCode(i);else if(65536<=i&&i<=1114111){var o=i-65536;this.buffer+=String.fromCharCode(55296|o>>>10,56320|1023&o)}else this.buffer+=String.fromCharCode(65533);else if("string"==typeof i)for(var s=new v(i);!s.isEmpty();)this.push(s.head()),s.step()}},t.prototype.bind=function(){return this.buffer},t}(),g=function(){function o(){}return o.prototype.isDefined=function(){return!0},o.prototype.isDistinct=function(){return!0},o.prototype.isEmpty=function(){return!1},o.prototype.stringValue=function(t){return t},o.prototype.numberValue=function(t){return t},o.prototype.booleanValue=function(t){return t},o.prototype.concat=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=o.empty();r.push(this);for(var n=0,i=t.length;n<i;n+=1){o.fromAny(t[n]).forEach(function(t){r.push(t)})}return r},o.prototype.withField=function(t,e){var r=o.empty(2);return r.push(this),r.withField(t,e)},o.prototype.withAttr=function(t,e){var r=o.empty(2);return r.push(this),r.withAttr(t,e)},o.prototype.withSlot=function(t,e){var r=o.empty(2);return r.push(this),r.withSlot(t,e)},o.prototype.withItem=function(t){var e=o.empty(2);return e.push(this),e.withItem(t)},o.prototype.withItems=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=o.empty(1+arguments.length);return r.push(this),r.withItems.apply(r,arguments)},o.prototype.forEach=function(t,e){return t.call(e,this,0)},o.prototype.iterator=function(){return new a(this)},o.prototype.lt=function(t){return t=o.of(t),this.compare(t)<0?o.True:o.Absent},o.prototype.le=function(t){return t=o.of(t),this.compare(t)<=0?o.True:o.Absent},o.prototype.eq=function(t){return t=o.of(t),this.equals(t)?o.True:o.Absent},o.prototype.ne=function(t){return t=o.of(t),this.equals(t)?o.Absent:o.True},o.prototype.ge=function(t){return t=o.of(t),0<=this.compare(t)?o.True:o.Absent},o.prototype.gt=function(t){return t=o.of(t),0<this.compare(t)?o.True:o.Absent},o.prototype.filter=function(t){var e=o.Selector.literal(this);return e.filter.apply(e,arguments)},o.prototype.max=function(t){return 0<=this.compare(t)?this:t},o.prototype.min=function(t){return this.compare(t)<=0?this:t},o.prototype.evaluate=function(t){return this},o.prototype.substitute=function(t){return this},Object.defineProperty(o.prototype,"precedence",{get:function(){return 11},enumerable:!0,configurable:!0}),o.prototype.writeReconBlock=function(t){return this.writeRecon(t)},o.prototype.toRecon=function(){var t=new m;return this.writeRecon(t),t.bind()},o.prototype.toReconBlock=function(){var t=new m;return this.writeReconBlock(t),t.bind()},o.prototype.writeString=function(t){t.push(this.toString())},o.Recon=void 0,o.Field=void 0,o.Attr=void 0,o.Slot=void 0,o.Value=void 0,o.Record=void 0,o.Data=void 0,o.Text=void 0,o.Num=void 0,o.Bool=void 0,o.DynamicValue=void 0,o.Selector=void 0,o.IdentitySelector=void 0,o.LiteralSelector=void 0,o.GetSelector=void 0,o.GetAttrSelector=void 0,o.GetItemSelector=void 0,o.KeysSelector=void 0,o.ChildrenSelector=void 0,o.DescendantsSelector=void 0,o.FilterSelector=void 0,o.Func=void 0,o.Expr=void 0,o.CondExpr=void 0,o.LorExpr=void 0,o.LandExpr=void 0,o.BorExpr=void 0,o.BxorExpr=void 0,o.BandExpr=void 0,o.LtExpr=void 0,o.LeExpr=void 0,o.EqExpr=void 0,o.NeExpr=void 0,o.GeExpr=void 0,o.GtExpr=void 0,o.AddExpr=void 0,o.SubExpr=void 0,o.MulExpr=void 0,o.DivExpr=void 0,o.ModExpr=void 0,o.LnotExpr=void 0,o.BnotExpr=void 0,o.NegExpr=void 0,o.PosExpr=void 0,o.InvokeExpr=void 0,o.Empty=void 0,o.True=void 0,o.False=void 0,o.Extant=void 0,o.Absent=void 0,o.GlobalScope=void 0,o.empty=void 0,o.of=void 0,o.fromAny=void 0,o}(),_=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return c(r,e),Object.defineProperty(r.prototype,"key",{get:function(){return r.Absent},enumerable:!0,configurable:!0}),r.prototype.toValue=function(){return this},Object.defineProperty(r.prototype,"length",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"tag",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"target",{get:function(){return this},enumerable:!0,configurable:!0}),r.prototype.flattened=function(){return this},r.prototype.header=function(t){return r.Absent},r.prototype.headers=function(t){},r.prototype.head=function(){return r.Absent},r.prototype.tail=function(){return r.Empty},r.prototype.body=function(){return this},r.prototype.get=function(t){return r.Absent},r.prototype.getAttr=function(t){return r.Absent},r.prototype.getItem=function(t){return r.Absent},r.prototype.withoutKey=function(t){return this},r.prototype.cond=function(t,e){return t=g.of(t)},r.prototype.or=function(t){return this},r.prototype.and=function(t){return t=g.of(t)},r.prototype.bor=function(t){if((t=g.of(t))instanceof g.DynamicValue)return new g.BorExpr(this,t);if(t instanceof g.Attr){if((e=this.bor(t.value)).isDefined())return new g.Attr(t.key,e)}else if(t instanceof g.Slot){var e;if((e=this.bor(t.value)).isDefined())return new g.Slot(t.key,e)}return r.Absent},r.prototype.bxor=function(t){if((t=g.of(t))instanceof g.DynamicValue)return new g.BxorExpr(this,t);if(t instanceof g.Attr){if((e=this.bxor(t.value)).isDefined())return new g.Attr(t.key,e)}else if(t instanceof g.Slot){var e;if((e=this.bxor(t.value)).isDefined())return new g.Slot(t.key,e)}return r.Absent},r.prototype.band=function(t){if((t=g.of(t))instanceof g.DynamicValue)return new g.BandExpr(this,t);if(t instanceof g.Attr){if((e=this.band(t.value)).isDefined())return new g.Attr(t.key,e)}else if(t instanceof g.Slot){var e;if((e=this.band(t.value)).isDefined())return new g.Slot(t.key,e)}return r.Absent},r.prototype.lt=function(t){return(t=g.of(t))instanceof g.DynamicValue?new g.LtExpr(this,t):e.prototype.lt.call(this,t)},r.prototype.le=function(t){return(t=g.of(t))instanceof g.DynamicValue?new g.LeExpr(this,t):e.prototype.le.call(this,t)},r.prototype.eq=function(t){return(t=g.of(t))instanceof g.DynamicValue?new g.EqExpr(this,t):e.prototype.eq.call(this,t)},r.prototype.ne=function(t){return(t=g.of(t))instanceof g.DynamicValue?new g.NeExpr(this,t):e.prototype.ne.call(this,t)},r.prototype.ge=function(t){return(t=g.of(t))instanceof g.DynamicValue?new g.GeExpr(this,t):e.prototype.ge.call(this,t)},r.prototype.gt=function(t){return(t=g.of(t))instanceof g.DynamicValue?new g.GtExpr(this,t):e.prototype.gt.call(this,t)},r.prototype.plus=function(t){if((t=g.of(t))instanceof g.DynamicValue)return new g.AddExpr(this,t);if(t instanceof g.Attr){if((e=this.plus(t.value)).isDefined())return new g.Attr(t.key,e)}else if(t instanceof g.Slot){var e;if((e=this.plus(t.value)).isDefined())return new g.Slot(t.key,e)}return r.Absent},r.prototype.minus=function(t){if((t=g.of(t))instanceof g.DynamicValue)return new g.SubExpr(this,t);if(t instanceof g.Attr){if((e=this.minus(t.value)).isDefined())return new g.Attr(t.key,e)}else if(t instanceof g.Slot){var e;if((e=this.minus(t.value)).isDefined())return new g.Slot(t.key,e)}return r.Absent},r.prototype.times=function(t){if((t=g.of(t))instanceof g.DynamicValue)return new g.MulExpr(this,t);if(t instanceof g.Attr){if((e=this.times(t.value)).isDefined())return new g.Attr(t.key,e)}else if(t instanceof g.Slot){var e;if((e=this.times(t.value)).isDefined())return new g.Slot(t.key,e)}return r.Absent},r.prototype.divide=function(t){if((t=g.of(t))instanceof g.DynamicValue)return new g.DivExpr(this,t);if(t instanceof g.Attr){if((e=this.divide(t.value)).isDefined())return new g.Attr(t.key,e)}else if(t instanceof g.Slot){var e;if((e=this.divide(t.value)).isDefined())return new g.Slot(t.key,e)}return r.Absent},r.prototype.modulo=function(t){if((t=g.of(t))instanceof g.DynamicValue)return new g.ModExpr(this,t);if(t instanceof g.Attr){if((e=this.modulo(t.value)).isDefined())return new g.Attr(t.key,e)}else if(t instanceof g.Slot){var e;if((e=this.modulo(t.value)).isDefined())return new g.Slot(t.key,e)}return r.Absent},r.prototype.not=function(){return r.Absent},r.prototype.bnot=function(){return r.Absent},r.prototype.neg=function(){return r.Absent},r.prototype.pos=function(){return r.Absent},r.prototype.inv=function(){return r.Absent},r.prototype.isAliased=function(){return!1},r.prototype.isMutable=function(){return!1},r.prototype.alias=function(){},r.prototype.branch=function(){return this},r.prototype.clone=function(){return this},r.prototype.commit=function(){return this},r.prototype.cast=function(t,e){var r=t.cast(this);return void 0===r&&(r=e),r},r.prototype.coerce=function(t){var e=t.cast(this);return void 0===e&&(e=t.unit),e},r.of=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?r.Absent:1===t.length?r.fromAny(t[0]):r.Record.fromArray(arguments)},r.fromAny=function(t){if(void 0===t)return r.Absent;if(null===t)return r.Extant;if(t instanceof r)return t;if(t instanceof g)return t.toValue();if(t instanceof Uint8Array)return r.Data.valueOf(t);if("string"==typeof t)return r.Text.valueOf(t);if("number"==typeof t)return r.Num.valueOf(t);if("boolean"==typeof t)return r.Bool.valueOf(t);if(Array.isArray(t))return r.Record.fromArray(t);if("object"==typeof t)return r.Record.fromObject(t);throw new TypeError(""+t)},r.parseRecon=function(t){return r.Recon.Factory.parseRecon(t)},r.Empty=void 0,r.True=void 0,r.False=void 0,r.Extant=void 0,r.Absent=void 0,r.empty=void 0,r}(g);g.Value=_,g.of=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?_.Absent:1===t.length?g.fromAny(t[0]):_.Record.fromArray(arguments)},g.fromAny=function(t){return t instanceof g?t:_.fromAny(t)};var b=function(){function n(){}return n.prototype.isCont=function(){return!0},n.prototype.isDone=function(){return!1},n.prototype.isError=function(){return!1},n.prototype.run=function(t){for(var e=this;e.isCont()&&(!t.isEmpty()||t.isDone());)e=e.feed(t);return e.isCont()&&t.isEmpty()&&!t.isDone()&&(e=e.feed(y.done())),e},n.prototype.parse=function(t){"string"==typeof t&&(t=new v(t));var e=this.run(t);return!t.isEmpty()&&e.isDone()&&(e=n.unexpected(t)),e.bind()},n.prototype.bind=function(){throw this},n.prototype.trap=function(){throw this},n.prototype.asVariant=function(){return this},n.prototype.asError=function(){throw this},n.done=function(t){return new E(t)},n.error=function(t){return new w(t)},n.unexpected=function(t){var e="unexpected ";return t.isEmpty()?e+="end of input":e+=JSON.stringify(String.fromCharCode(t.head())),n.error(e)},n.expected=function(t,e){"number"==typeof t&&(t=String.fromCharCode(t)),1===t.length&&(t=JSON.stringify(t));var r="expected "+t;return e.isEmpty()||(r+=", but found "+JSON.stringify(String.fromCharCode(e.head()))),n.error(r)},n.isSpace=function(t){return 32===t||9===t},n.isNewline=function(t){return 10===t||13===t},n.isWhitespace=function(t){return n.isSpace(t)||n.isNewline(t)},n.isAlpha=function(t){return 65<=t&&t<=90||97<=t&&t<=122},n.toLowerCase=function(t){return 65<=t&&t<=90?t+32:t},n.isDigit=function(t){return 48<=t&&t<=57},n.decodeDigit=function(t){if(48<=t&&t<=57)return t-48;throw t},n.isHexChar=function(t){return 65<=t&&t<=70||97<=t&&t<=102||48<=t&&t<=57},n.decodeHexChar=function(t){if(48<=t&&t<=57)return t-48;if(65<=t&&t<=70)return t-65+10;if(97<=t&&t<=102)return t-97+10;throw t},n.isBase64Char=function(t){return 48<=t&&t<=57||65<=t&&t<=90||97<=t&&t<=122||43===t||45===t||47===t||95===t},n.decodeBase64Digit=function(t){if(65<=t&&t<=90)return t-65;if(97<=t&&t<=122)return t-71;if(48<=t&&t<=57)return t+4;if(43===t||45===t)return 62;if(47===t||95===t)return 63;throw t},n}(),E=function(r){function t(t){var e=r.call(this)||this;return e.value=t,e}return c(t,r),t.prototype.isCont=function(){return!1},t.prototype.isDone=function(){return!0},t.prototype.feed=function(t){return this},t.prototype.bind=function(){return this.value},t}(b),w=function(r){function t(t){var e=r.call(this)||this;return e.cause=t,e}return c(t,r),t.prototype.isCont=function(){return!1},t.prototype.isError=function(){return!0},t.prototype.feed=function(t){return this},t.prototype.bind=function(){throw this.cause},t.prototype.trap=function(){return this.cause},t.prototype.asError=function(){return this},t}(b),x=function(i){function u(t,e,r){var n=i.call(this)||this;return n._array=t,n._size=e,n._flags=r,n}return c(u,i),Object.defineProperty(u.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),u.prototype.isDone=function(){return!1},u.prototype.isFull=function(){return!1},u.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0!=(this._flags&u.IMMUTABLE))throw new Error("immutable");0!=(this._flags&u.ALIASED)?this.pushAliased.apply(this,t):this.pushMutable.apply(this,t)},u.prototype.pushAliased=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t.length,n=this._size,i=this._array,o=new Uint8Array(u.expand(n+r));null!==i&&o.set(i);for(var s=0;s<r;s+=1)o[n+s]=t[s];this._array=o,this._size=n+r,this._flags&=~u.ALIASED},u.prototype.pushMutable=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r,n=t.length,i=this._size,o=this._array;null===o||i+n>o.length?(r=new Uint8Array(u.expand(i+n)),null!==o&&r.set(o),this._array=r):r=o;for(var s=0;s<n;s+=1)r[i+s]=t[s];this._size=i+n},u.prototype.isAliased=function(){return 0!=(this._flags&u.ALIASED)},u.prototype.isMutable=function(){return 0==(this._flags&u.IMMUTABLE)},u.prototype.alias=function(){this._flags|=u.ALIASED},u.prototype.branch=function(){return this._flags|=u.ALIASED,new u(this._array,this._size,u.ALIASED)},u.prototype.clone=function(){return this.branch()},u.prototype.commit=function(){return this._flags|=u.IMMUTABLE,this},u.prototype.bind=function(){return this},u.prototype.toAny=function(){return this.valueOf()},u.prototype.valueOf=function(){var t=this._size,e=this._array;if(0!=(this._flags&(u.ALIASED|u.IMMUTABLE))||t!==e.length){var r=null!==e?e.slice(0,t):new Uint8Array(0);return 0==(this._flags&u.IMMUTABLE)&&(this._array=r,this._size=t,this._flags&=~u.ALIASED),r}return e},u.prototype.writeRecon=function(t){t.push(37),u.writeBase64(this._array,this._size,t)},u.writeBase64=function(t,e,r){for(var n=0;n+2<e;){var i=t[n],o=t[n+1],s=t[n+2];r.push(u.encodeBase64Digit(i>>>2),u.encodeBase64Digit(63&(i<<4|o>>>4)),u.encodeBase64Digit(63&(o<<2|s>>>6)),u.encodeBase64Digit(63&s)),n+=3}if(n+1<e){i=t[n],o=t[n+1];r.push(u.encodeBase64Digit(i>>>2),u.encodeBase64Digit(63&(i<<4|o>>>4)),u.encodeBase64Digit(o<<2&63),61),n+=2}else if(n<e){i=t[n];r.push(u.encodeBase64Digit(i>>>2),u.encodeBase64Digit(i<<4&63),61,61),n+=1}},u.prototype.toBase64=function(){var t=new m;return u.writeBase64(this._array,this._size,t),t.bind()},u.prototype.compare=function(t){if(t instanceof u){for(var e=this._size,r=t._size,n=this._array,i=t._array,o=0,s=0;0===o&&s<e&&s<r;)o=n[s]-i[s],s+=1;return 0<o?1:o<0?-1:r<e?1:e<r?-1:0}return t instanceof g.Field||t instanceof g.Record?1:-1},u.prototype.equals=function(t){if(this===t)return!0;if(t instanceof u){var e=this._size;if(e!==t._size)return!1;for(var r=this._array,n=t._array,i=0;i<e;i+=1)if(r[i]!==n[i])return!1;return!0}return!1},u.prototype.hashCode=function(){for(var t=1375461820,e=this._array,r=0,n=this._size;r<n;r+=1)t=h.mix(t,e[r]);return h.mash(t)},u.prototype.toString=function(){return this.toBase64()},u.empty=function(t){return new u(void 0===t?null:new Uint8Array(t),0,0)},u.valueOf=function(t){return new u(t,t.length,u.ALIASED)},u.of=function(t){if(t instanceof u)return t;if(t instanceof Uint8Array)return u.valueOf(t);throw new TypeError(""+t)},u.base64=function(t){"string"==typeof t&&(t=new v(t));var e=_.Recon.Factory.parseBase64(t);return e.isDone()&&(t.isEmpty()||(e=b.unexpected(t))),e.bind()},u.expand=function(t){return t=Math.max(32,t)-1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1},u.encodeBase64Digit=function(t){if(0<=t&&t<26)return t+65;if(26<=t&&t<52)return t+71;if(52<=t&&t<62)return t-4;if(62===t)return 43;if(63===t)return 47;throw t},u.Empty=new u(null,0,(u.ALIASED=1)|(u.IMMUTABLE=2)),u}(_);g.Data=x;var A="undefined"!=typeof window&&(window.crypto||window.msCrypto);var C={fillBytes:A?function(t){A.getRandomValues(t)}:function(t){if(t instanceof Int8Array)for(var e=0;e<t.length;e+=1)t[e]=128-Math.round(256*Math.random());else if(t instanceof Uint8Array)for(e=0;e<t.length;e+=1)t[e]=Math.round(256*Math.random());else if(t instanceof Int16Array)for(e=0;e<t.length;e+=1)t[e]=32768-Math.round(65536*Math.random());else if(t instanceof Uint16Array)for(e=0;e<t.length;e+=1)t[e]=Math.round(65536*Math.random());else if(t instanceof Int32Array)for(e=0;e<t.length;e+=1)t[e]=2147483648-Math.round(4294967296*Math.random());else{if(!(t instanceof Uint32Array))throw new TypeError(""+t);for(e=0;e<t.length;e+=1)t[e]=Math.round(4294967296*Math.random())}},generateId:function(t){void 0===t&&(t=12);var e=new Uint8Array(t);C.fillBytes(e);var r=new m;return x.writeBase64(e,t,r),r.bind()}};function D(t,e){if(t instanceof Date&&(t=t.getTime()),e instanceof Date&&(e=e.getTime()),t===e)return!0;if(t&&"object"==typeof t&&"function"==typeof t.equals)return t.equals(e);if(Array.isArray(t)){if(Array.isArray(e))return function(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n+=1)if(!D(t[n],e[n]))return!1;return!0}(t,e)}else if(t&&"object"==typeof t&&e&&"object"==typeof e)return function(t,e){var r=Object.keys(t),n=Object.keys(e),i=r.length;if(i!==n.length)return!1;for(var o=0;o<i;o+=1){var s=r[o];if(s!==n[o]||!D(t[s],e[s]))return!1}return!0}(t,e);return!1}function k(t,e){return t instanceof Date&&(t=t.getTime()),e instanceof Date&&(e=e.getTime()),void 0===t?void 0===e?0:1:null===t?void 0===e?-1:null===e?0:1:"number"==typeof t?null==e?-1:"number"==typeof e?t<e?-1:e<t?1:0:1:"string"==typeof t?null==e||"number"==typeof e?-1:"string"==typeof e?t<e?-1:e<t?1:0:1:"object"==typeof t&&"function"==typeof t.compare?t.compare(e):Array.isArray(t)?null==e||"number"==typeof e||"string"==typeof e?-1:Array.isArray(e)?function(t,e){for(var r=t.length,n=e.length,i=0,o=0,s=Math.min(r,n);o<s&&0===i;o+=1)i=k(t[o],e[o]);return 0!==i?i:n<r?1:r<n?-1:0}(t,e):1:null==e||"number"==typeof e||"string"==typeof e||Array.isArray(e)?-1:function(t,e){for(var r=Object.keys(t),n=Object.keys(e),i=r.length,o=n.length,s=Math.min(i,o),u=0,a=0;a<s&&0===u;a+=1){var p=r[a],h=n[a];0===(u=k(p,h))&&(u=k(t[p],e[h]))}return 0!==u?u:o<i?1:i<o?-1:0}(t,e)}var S=function(){function u(t,e,r){void 0===t&&(t=null),void 0===e&&(e=0),void 0===r&&(r=u.Capacity),this._array=t,this._size=e,this._capacity=r}return u.prototype.isEmpty=function(){return 0===this._size},Object.defineProperty(u.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),u.prototype.get=function(t){t=_.fromAny(t);for(var e=_.Absent,r=this._size-1;0<=r&&!(e=this._array[r].get(t)).isDefined();r-=1);return e},u.prototype.peek=function(){var t=this._size;return 0<t?this._array[t-1]:void 0},u.prototype.item=function(){var t=this._size;if(0<t)return this._array[t-1];throw new RangeError},u.prototype.getItem=function(t){if(0<=t&&t<this._size)return this._array[t];throw new RangeError(""+t)},u.prototype.offer=function(t){var e=this._size;if(e<this._capacity){var r=this._array,n=void 0;if(null===r||e+1>r.length){if(n=new Array(u.expand(e+1)),null!==r)for(var i=0;i<e;i+=1)n[i]=r[i];this._array=n}else n=r;return n[e]=t,this._size=e+1,!0}return!1},u.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=this._size,n=arguments.length;if(0===n)return r;if(r+n<this._capacity){var i=this._array,o=void 0;if(null===i||r+n>i.length){if(o=new Array(u.expand(r+n)),null!==i)for(var s=0;s<r;s+=1)o[s]=i[s]}else o=i;for(s=0;s<n;s+=1)o[r]=arguments[s],r+=1;return this._array=o,this._size=r}throw new RangeError(""+(r+n))},u.prototype.replace=function(t){var e=this._size;if(0<e){var r=this._array,n=r[e-1];return r[e-1]=t,n}throw new RangeError},u.prototype.poll=function(){var t=this._size;if(0<t){var e=this._array,r=e[t-1];return e[t-1]=void 0,this._size=t-1,r}},u.prototype.pop=function(){var t=this._size;if(0<t){var e=this._array,r=e[t-1];return e[t-1]=void 0,this._size=t-1,r}throw new RangeError},u.prototype.clear=function(){for(var t=this._array,e=this._size-1;0<=e;e-=1)t[e]=void 0;this._size=0},u.prototype.forEach=function(t,e){for(var r=this._array,n=0,i=this._size;n<i;n+=1){var o=t.call(e,r[n],n);if(void 0!==o)return o}},u.prototype.iterator=function(){return 0<this._size?new l(this._array):s.Empty},u.prototype.equals=function(t){if(this===t)return!0;if(t instanceof u){var e=this._size;if(e!==t._size)return!1;for(var r=this._array,n=t._array,i=0;i<e;i+=1)if(!r[i].equals(n[i]))return!1;return!0}return!1},u.prototype.hashCode=function(){for(var t=2079781727,e=this._array,r=0,n=this._size;r<n;r+=1)t=h.mix(t,e[r].hashCode());return h.mash(t)},u.prototype.toString=function(){var t=new m;t.push("EvalStack",46,"of",40);var e=this._size;if(0<e){var r=this._array;r[0].writeString(t);for(var n=1;n<e;n+=1)t.push(", "),r[n].writeString(t)}return t.push(")"),t.bind()},u.of=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=arguments.length,n=new Array(u.expand(r)),i=0;i<r;i+=1){var o=g.fromAny(arguments[i]);n[i]=o}return new u(n,r,Math.max(r,u.Capacity))},u.fromAny=function(t,e){if(void 0===e&&(e=u.GlobalScope),!(t instanceof u)){var r=g.fromAny(t);return t=new u,e&&t.push(e),t.push(r),t}return t},u.expand=function(t){return t=Math.max(32,t)-1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1},u.Capacity=1024,u.GlobalScope=void 0,u}(),P=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.toValue=function(){return this.value},Object.defineProperty(e.prototype,"length",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tag",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return g.Absent},enumerable:!0,configurable:!0}),e.prototype.flattened=function(){return g.Absent},e.prototype.header=function(t){return g.Absent},e.prototype.headers=function(t){},e.prototype.head=function(){return g.Absent},e.prototype.tail=function(){return g.Empty},e.prototype.body=function(){return g.Absent},e.prototype.get=function(t){return g.Absent},e.prototype.getAttr=function(t){return g.Absent},e.prototype.getItem=function(t){return g.Absent},e.prototype.stringValue=function(t){return this.value.stringValue(t)},e.prototype.numberValue=function(t){return this.value.numberValue(t)},e.prototype.booleanValue=function(t){return this.value.booleanValue(t)},e.prototype.withoutKey=function(t){return this},e.prototype.cond=function(t,e){return t=g.of(t)},e.prototype.or=function(t){return this},e.prototype.and=function(t){return t=g.of(t)},e.prototype.isAliased=function(){return!1},e.prototype.cast=function(t,e){return this.value.cast(t,e)},e.prototype.coerce=function(t){return this.value.coerce(t)},e.of=function(t,e){var r;return"string"==typeof t?r=t:t instanceof g.Text&&(r=t.value),void 0!==r&&64===r.charCodeAt(0)?g.Attr.of.apply(void 0,arguments):g.Slot.of.apply(void 0,arguments)},e.IMMUTABLE=1,e}(g),M=function(i){function n(t,e,r){void 0===e&&(e=_.Extant),void 0===r&&(r=0);var n=i.call(this)||this;return n._key=t,n._value=e,n._flags=r,n}return c(n,i),Object.defineProperty(n.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),n.prototype.setValue=function(t){if(0!=(this._flags&P.IMMUTABLE))throw new Error("immutable");var e=this._value;return this._value=t,e},n.prototype.withValue=function(t){return new n(this._key,t)},n.prototype.bor=function(t){return(t=g.of(t))instanceof g.DynamicValue?new g.BorExpr(this,t):(e=t instanceof n&&this._key.equals(t._key)?this._value.bor(t._value):t instanceof _?this._value.bor(t):_.Absent).isDefined()?new n(this._key,e):_.Absent;var e},n.prototype.bxor=function(t){return(t=g.of(t))instanceof g.DynamicValue?new g.BxorExpr(this,t):(e=t instanceof n&&this._key.equals(t._key)?this._value.bxor(t._value):t instanceof _?this._value.bxor(t):_.Absent).isDefined()?new n(this._key,e):_.Absent;var e},n.prototype.band=function(t){return(t=g.of(t))instanceof g.DynamicValue?new g.BandExpr(this,t):(e=t instanceof n&&this._key.equals(t._key)?this._value.band(t._value):t instanceof _?this._value.band(t):_.Absent).isDefined()?new n(this._key,e):_.Absent;var e},n.prototype.plus=function(t){return(t=g.of(t))instanceof g.DynamicValue?new g.AddExpr(this,t):(e=t instanceof n&&this._key.equals(t._key)?this._value.plus(t._value):t instanceof _?this._value.plus(t):_.Absent).isDefined()?new n(this._key,e):_.Absent;var e},n.prototype.minus=function(t){return(t=g.of(t))instanceof g.DynamicValue?new g.SubExpr(this,t):(e=t instanceof n&&this._key.equals(t._key)?this._value.minus(t._value):t instanceof _?this._value.minus(t):_.Absent).isDefined()?new n(this._key,e):_.Absent;var e},n.prototype.times=function(t){return(t=g.of(t))instanceof g.DynamicValue?new g.MulExpr(this,t):(e=t instanceof n&&this._key.equals(t._key)?this._value.times(t._value):t instanceof _?this._value.times(t):_.Absent).isDefined()?new n(this._key,e):_.Absent;var e},n.prototype.divide=function(t){return(t=g.of(t))instanceof g.DynamicValue?new g.DivExpr(this,t):(e=t instanceof n&&this._key.equals(t._key)?this._value.divide(t._value):t instanceof _?this._value.divide(t):_.Absent).isDefined()?new n(this._key,e):_.Absent;var e},n.prototype.modulo=function(t){return(t=g.of(t))instanceof g.DynamicValue?new g.ModExpr(this,t):(e=t instanceof n&&this._key.equals(t._key)?this._value.modulo(t._value):t instanceof _?this._value.modulo(t):_.Absent).isDefined()?new n(this._key,e):_.Absent;var e},n.prototype.not=function(){var t=this._value.not();return t.isDefined()?new n(this._key,t):_.Absent},n.prototype.bnot=function(){var t=this._value.bnot();return t.isDefined()?new n(this._key,t):_.Absent},n.prototype.neg=function(){var t=this._value.neg();return t.isDefined()?new n(this._key,t):_.Absent},n.prototype.pos=function(){var t=this._value.pos();return t.isDefined()?new n(this._key,t):_.Absent},n.prototype.inv=function(){var t=this._value.inv();return t.isDefined()?new n(this._key,t):_.Absent},n.prototype.evaluate=function(t){t=S.fromAny(t);var e=this._key.evaluate(t).toValue(),r=this._value.evaluate(t).toValue();return e===this._key&&r===this._value?this:e.isDefined()&&r.isDefined()?e instanceof g.Text?new n(e,r):new g.Slot(e,r):g.Absent},n.prototype.substitute=function(t){t=S.fromAny(t);var e=this._key.substitute(t).toValue(),r=this._value.substitute(t).toValue();return e===this._key&&r===this._value?this:e.isDefined()&&r.isDefined()?e instanceof g.Text?new n(e,r):new g.Slot(e,r):g.Absent},n.prototype.isMutable=function(){return 0==(this._flags&P.IMMUTABLE)},n.prototype.alias=function(){this._flags|=P.IMMUTABLE},n.prototype.branch=function(){return 0!=(this._flags&P.IMMUTABLE)?new n(this._key,this._value,this._flags&~P.IMMUTABLE):this},n.prototype.clone=function(){return new n(this._key.clone(),this._value.clone())},n.prototype.commit=function(){return 0==(this._flags&P.IMMUTABLE)&&(this._flags|=P.IMMUTABLE,this._value.commit()),this},n.prototype.writeRecon=function(t){t.push(64),this._key.writeRecon(t),this._value!==_.Extant&&(t.push(40),this._value.writeReconBlock(t),t.push(41))},n.prototype.compare=function(t){if(t instanceof n){var e=this._key.compare(t._key);return 0===e&&(e=this._value.compare(t._value)),e}return-1},n.prototype.equals=function(t){return this===t||t instanceof n&&(this._key.equals(t._key)&&this._value.equals(t._value))},n.prototype.hashCode=function(){return h.mash(h.mix(h.mix(687268585,this._key.hashCode()),this._value.hashCode()))},n.prototype.toString=function(){return this.toRecon()},n.of=function(t,e){return new n(t=g.Text.of(t),e=2===arguments.length?g.Value.of(e):g.Value.Extant)},n}(g.Field=P);g.Attr=M;var I=function(i){function n(t,e,r){void 0===e&&(e=_.Extant),void 0===r&&(r=0);var n=i.call(this)||this;return n._key=t,n._value=e,n._flags=r,n}return c(n,i),Object.defineProperty(n.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),n.prototype.setValue=function(t){if(0!=(this._flags&P.IMMUTABLE))throw new Error("immutable");var e=this._value;return this._value=t,e},n.prototype.withValue=function(t){return new n(this._key,t)},n.prototype.bor=function(t){return(t=g.of(t))instanceof g.DynamicValue?new g.BorExpr(this,t):(e=t instanceof n&&this._key.equals(t._key)?this._value.bor(t._value):t instanceof _?this._value.bor(t):_.Absent).isDefined()?new n(this._key,e):_.Absent;var e},n.prototype.bxor=function(t){return(t=g.of(t))instanceof g.DynamicValue?new g.BxorExpr(this,t):(e=t instanceof n&&this._key.equals(t._key)?this._value.bxor(t._value):t instanceof _?this._value.bxor(t):_.Absent).isDefined()?new n(this._key,e):_.Absent;var e},n.prototype.band=function(t){return(t=g.of(t))instanceof g.DynamicValue?new g.BandExpr(this,t):(e=t instanceof n&&this._key.equals(t._key)?this._value.band(t._value):t instanceof _?this._value.band(t):_.Absent).isDefined()?new n(this._key,e):_.Absent;var e},n.prototype.plus=function(t){return(t=g.of(t))instanceof g.DynamicValue?new g.AddExpr(this,t):(e=t instanceof n&&this._key.equals(t._key)?this._value.plus(t._value):t instanceof _?this._value.plus(t):_.Absent).isDefined()?new n(this._key,e):_.Absent;var e},n.prototype.minus=function(t){return(t=g.of(t))instanceof g.DynamicValue?new g.SubExpr(this,t):(e=t instanceof n&&this._key.equals(t._key)?this._value.minus(t._value):t instanceof _?this._value.minus(t):_.Absent).isDefined()?new n(this._key,e):_.Absent;var e},n.prototype.times=function(t){return(t=g.of(t))instanceof g.DynamicValue?new g.MulExpr(this,t):(e=t instanceof n&&this._key.equals(t._key)?this._value.times(t._value):t instanceof _?this._value.times(t):_.Absent).isDefined()?new n(this._key,e):_.Absent;var e},n.prototype.divide=function(t){return(t=g.of(t))instanceof g.DynamicValue?new g.DivExpr(this,t):(e=t instanceof n&&this._key.equals(t._key)?this._value.divide(t._value):t instanceof _?this._value.divide(t):_.Absent).isDefined()?new n(this._key,e):_.Absent;var e},n.prototype.modulo=function(t){return(t=g.of(t))instanceof g.DynamicValue?new g.ModExpr(this,t):(e=t instanceof n&&this._key.equals(t._key)?this._value.modulo(t._value):t instanceof _?this._value.modulo(t):_.Absent).isDefined()?new n(this._key,e):_.Absent;var e},n.prototype.not=function(){var t=this._value.not();return t.isDefined()?new n(this._key,t):_.Absent},n.prototype.bnot=function(){var t=this._value.bnot();return t.isDefined()?new n(this._key,t):_.Absent},n.prototype.neg=function(){var t=this._value.neg();return t.isDefined()?new n(this._key,t):_.Absent},n.prototype.pos=function(){var t=this._value.pos();return t.isDefined()?new n(this._key,t):_.Absent},n.prototype.inv=function(){var t=this._value.inv();return t.isDefined()?new n(this._key,t):_.Absent},n.prototype.evaluate=function(t){t=S.fromAny(t);var e=this._key.evaluate(t).toValue(),r=this._value.evaluate(t).toValue();return e===this._key&&r===this._value?this:e.isDefined()&&r.isDefined()?new n(e,r):g.Absent},n.prototype.substitute=function(t){t=S.fromAny(t);var e=this._key.substitute(t).toValue(),r=this._value.substitute(t).toValue();return e===this._key&&r===this._value?this:e.isDefined()&&r.isDefined()?new n(e,r):g.Absent},n.prototype.isMutable=function(){return 0==(this._flags&P.IMMUTABLE)},n.prototype.alias=function(){this._flags|=P.IMMUTABLE},n.prototype.branch=function(){return 0!=(this._flags&P.IMMUTABLE)?new n(this._key,this._value,this._flags&~P.IMMUTABLE):this},n.prototype.clone=function(){return new n(this._key.clone(),this._value.clone())},n.prototype.commit=function(){return 0==(this._flags&P.IMMUTABLE)&&(this._flags|=P.IMMUTABLE,this._value.commit()),this},n.prototype.writeRecon=function(t){this._key.writeRecon(t),t.push(58),this._value!==g.Extant&&this._value.writeRecon(t)},n.prototype.compare=function(t){if(t instanceof n){var e=this._key.compare(t._key);return 0===e&&(e=this._value.compare(t._value)),e}return t instanceof g.Attr?1:-1},n.prototype.equals=function(t){return this===t||t instanceof n&&(this._key.equals(t._key)&&this._value.equals(t._value))},n.prototype.hashCode=function(){return h.mash(h.mix(h.mix(1237723953,this._key.hashCode()),this._value.hashCode()))},n.prototype.toString=function(){return this.toRecon()},n.of=function(t,e){return new n(t=g.Value.of(t),e=2===arguments.length?g.Value.of(e):g.Value.Extant)},n}(P);g.Slot=I;var V=function(o){function t(t,e,r,n){void 0===e&&(e=0),void 0===r&&(r=t.length),void 0===n&&(n=e);var i=o.call(this)||this;return i._record=t,i._lower=e,i._upper=r,i._index=n,i._direction=0,i}return c(t,o),t.prototype.isEmpty=function(){return this._index>=this._upper},t.prototype.head=function(){if(this._direction=0,this._index<this._upper)return this._record.getItem(this._index);throw new Error("empty head")},t.prototype.step=function(){if(this._direction=0,!(this._index<this._upper))throw new Error("empty step");this._index+=1},t.prototype.skip=function(t){this._index=Math.min(Math.max(this._lower,this._index+t,this._upper))},t.prototype.hasNext=function(){return this._index<this._upper},t.prototype.nextIndex=function(){return this._index-this._lower},t.prototype.next=function(){this._direction=1;var t=this._index;return t<this._upper?(this._index=t+1,{value:this._record.getItem(t),done:this._index===this._upper}):(this._index=this._upper,{done:!0})},t.prototype.hasPrevious=function(){return this._index>this._lower},t.prototype.previousIndex=function(){return this._index-this._lower-1},t.prototype.previous=function(){this._direction=-1;var t=this._index-1;return t>=this._lower?(this._index=t,{value:this._record.getItem(t),done:t===this._lower}):{done:!(this._index=0)}},t.prototype.set=function(t){0<this._direction?this._record.setItem(this._index-1,t):this._record.setItem(this._index,t)},t.prototype.delete=function(){0<this._direction&&(this._index-=1),this._record.splice(this._index,1),this._direction=0},t}(s),O=function(t){function p(){return null!==t&&t.apply(this,arguments)||this}return c(p,t),p.prototype.isArray=function(){return!this.forEach(function(t){return t instanceof g.Field||void 0},this)},p.prototype.isObject=function(){return!this.forEach(function(t){return t instanceof g.Value||void 0},this)},Object.defineProperty(p.prototype,"fieldCount",{get:function(){var e=0;return this.forEach(function(t){t instanceof g.Field&&(e+=1)},this),e},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"valueCount",{get:function(){var e=0;return this.forEach(function(t){t instanceof g.Value&&(e+=1)},this),e},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"tag",{get:function(){var t=this.head();if(t instanceof g.Attr)return t.key.value},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"target",{get:function(){return this.forEach(function(t){return t instanceof _?t:void 0},this)||_.Absent},enumerable:!0,configurable:!0}),p.prototype.flattened=function(){var t=this.iterator();if(!t.isEmpty()){var e=t.head();return t.step(),t.isEmpty()&&e instanceof _?e:this.branch()}return _.Extant},p.prototype.header=function(t){var e=this.head();return e instanceof g.Attr&&e.key.value===t?e.value:_.Absent},p.prototype.headers=function(t){var e=this.head();if(e instanceof g.Attr&&e.key.value===t){var r=e.value;return r instanceof p?r:p.of(r)}},p.prototype.head=function(){return this.forEach(function(t){return t},this)||g.Absent},p.prototype.tail=function(){var r=p.empty();return this.forEach(function(t,e){0<e&&r.push(t)},this),r},p.prototype.body=function(){var t=this.iterator();if(!t.isEmpty()&&(t.step(),!t.isEmpty())){var e=t.head();return t.step(),t.isEmpty()?(e instanceof g.Value||(e=p.of(e)),e):this.tail().branch()}return _.Absent},p.prototype.has=function(e){return e=_.of(e),this.forEach(function(t){return!!(t instanceof g.Field&&t.key.equals(e))||void 0},this)||!1},p.prototype.get=function(e){return e=_.of(e),this.forEach(function(t){return t instanceof g.Field&&t.key.equals(e)?t.value:void 0},this)||_.Absent},p.prototype.getAttr=function(e){return e=g.Text.of(e),this.forEach(function(t){return t instanceof g.Attr&&t.key.equals(e)?t.value:void 0},this)||_.Absent},p.prototype.getField=function(e){return e=_.of(e),this.forEach(function(t){return t instanceof g.Field&&t.key.equals(e)?t:void 0},this)},p.prototype.set=function(t,e){t=_.of(t),e=_.of(e);for(var r=this.iterator();!r.isEmpty();){var n=r.head();if(n instanceof g.Field&&n.key.equals(t))return n.isMutable()?n.setValue(e):r.set(n.withValue(e)),this;r.step()}var i=new g.Slot(t,e);return this.push(i),this},p.prototype.setAttr=function(t,e){t=g.Text.of(t),e=_.of(e);for(var r=this.iterator();!r.isEmpty();){var n=r.head();if(n instanceof g.Field&&n.key.equals(t))return n instanceof g.Attr&&n.isMutable()?n.setValue(e):r.set(new g.Attr(t,e)),this;r.step()}var i=new g.Attr(t,e);return this.push(i),this},p.prototype.concat=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=this.branch(),n=0,i=t.length;n<i;n+=1){g.fromAny(t[n]).forEach(function(t){r.push(t)},this)}return r},p.prototype.withField=function(t,e){t=_.of(t),e=_.of(e);for(var r=this.isMutable()?this:this.branch(),n=r.iterator();!n.isEmpty();){var i=n.head();if(i.key.equals(t))return i instanceof g.Field&&i.isMutable()?i.setValue(e):n.set(g.Slot.of(t,e)),r;n.step()}var o=g.Slot.of(t,e);return r.push(o),r},p.prototype.withAttr=function(t,e){t=g.Text.of(t),e=_.of(e);for(var r=this.isMutable()?this:this.branch(),n=r.iterator();!n.isEmpty();){var i=n.head();if(i.key.equals(t))return i instanceof g.Attr&&i.isMutable()?i.setValue(e):n.set(g.Attr.of(t,e)),r;n.step()}var o=g.Attr.of(t,e);return r.push(o),r},p.prototype.withSlot=function(t,e){t=_.of(t),e=_.of(e);for(var r=this.isMutable()?this:this.branch(),n=r.iterator();!n.isEmpty();){var i=n.head();if(i.key.equals(t))return i instanceof g.Slot&&i.isMutable()?i.setValue(e):n.set(g.Slot.of(t,e)),r;n.step()}var o=g.Slot.of(t,e);return r.push(o),r},p.prototype.withItem=function(t){var e=this.isMutable()?this:this.branch();return e.push(t),e},p.prototype.withItems=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=this.isMutable()?this:this.branch();return r.push.apply(r,arguments),r},p.prototype.withoutKey=function(t){var e=this.isMutable()?this:this.branch();return e.delete(t),e},p.prototype.slice=function(t,e){return this.subRecord.apply(this,arguments).branch()},p.prototype.subRecord=function(r,n){var t=this.length;void 0===r?r=0:r<0&&(r=t+r),r=Math.min(Math.max(0,r),t),void 0===n?n=t:n<0&&(n=t+n);var i=p.empty();return this.forEach(function(t,e){return e<r?void 0:e<n?void i.push(t):null},this),i},p.prototype.attr=function(t,e){return this.push(g.Attr.of.apply(void 0,arguments)),this},p.prototype.slot=function(t,e){return this.push(g.Slot.of.apply(void 0,arguments)),this},p.prototype.item=function(t){return this.push(g.fromAny(t)),this},p.prototype.items=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.push.apply(this,arguments),this},p.prototype.iterator=function(){return new V(this)},p.prototype.indexOf=function(r,n){void 0===n&&(n=0),r=g.of(r);var t=this.length;n<0&&(n=t+n),n=Math.max(0,n);var i=-1;return this.forEach(function(t,e){if(n<=e&&t.equals(r))return i=e,null},this),i},p.prototype.lastIndexOf=function(r,n){r=g.of(r);var t=this.length;void 0===n?n=t-1:n<0&&(n=t+n),n=Math.min(n,t-1);var i=-1;return this.forEach(function(t,e){if(n<e)return null;t.equals(r)&&(i=e)},this),i},p.prototype.evaluate=function(r){r=S.fromAny(r);var n=p.empty();r.push(n);var i=!1;return this.forEach(function(t){var e=t.evaluate(r);e.isDefined()&&n.push(e),i=i||t!==e},this),r.pop(),i?n:this},p.prototype.substitute=function(r){r=S.fromAny(r);var n=p.empty();r.push(n);var i=!1;return this.forEach(function(t){var e=t.substitute(r);e.isDefined()&&n.push(e),i=i||t!==e},this),r.pop(),i?n:this},p.prototype.isAliased=function(){return!1},p.prototype.isMutable=function(){return!0},p.prototype.alias=function(){},p.prototype.branch=function(){var e=p.empty();return this.forEach(function(t){e.push(t)},this),e},p.prototype.clone=function(){var e=p.empty();return this.forEach(function(t){e.push(t.clone())},this),e},p.prototype.commit=function(){return this},p.prototype.toAny=function(){return!this.isEmpty()&&this.isArray()?this.toArray():this.toObject()},p.prototype.toArray=function(){var r=new Array(this.length);return this.forEach(function(t,e){t instanceof g.Value?r[e]=t.toAny():t instanceof g.Field&&(r[e]={$key:t.key.toAny(),$value:t.value.toAny()})},this),r},p.prototype.toObject=function(){var r={};return this.forEach(function(t,e){t instanceof g.Attr?r["@"+t.key.value]=t.value.toAny():t instanceof g.Slot?t.key instanceof g.Text?r[t.key.value]=t.value.toAny():r["$"+e]={$key:t.key.toAny(),$value:t.value.toAny()}:t instanceof g.Value&&(r["$"+e]=t.toAny())},this),r},p.prototype.stringValue=function(t){var r="";return void 0===this.forEach(function(t){if(t instanceof g.Value){var e=t.stringValue();if(void 0!==e)return void(r+=e)}return null},this)?r:void 0},p.prototype.bind=function(){return this},p.prototype.isBlockSafe=function(){return void 0===this.forEach(function(t){return!(t instanceof g.Attr)&&void 0},this)},p.prototype.isMarkupSafe=function(){var r=0;return void 0===this.forEach(function(t,e){if(r+=1,0===e){if(!(t instanceof g.Attr))return!1}else if(t instanceof g.Attr)return!1},this)&&0<r},p.prototype.writeRecon=function(t){var e=this.iterator();e.isEmpty()?t.push(123,125):p.writeItems(e,!1,!1,t)},p.prototype.writeReconBlock=function(t){var e=this.iterator();e.isEmpty()?t.push(123,125):p.writeItems(e,this.isBlockSafe(),!1,t)},p.writeItems=function(t,e,r,n){for(var i=!1,o=!1,s=!0,u=!0;!t.isEmpty();){var a=t.head();(a instanceof g.Expr||a instanceof g.Selector)&&(u=!1),t.step(),o&&a instanceof g.Attr&&(i&&(n.push(125),i=!1),n.push(93),o=!1),a instanceof g.Attr?(i?(n.push(125),i=!1):o&&(n.push(93),o=!1),a.writeRecon(n),s=!1):o&&a instanceof g.Text?(i&&(n.push(125),i=!1),g.Text.writeMarkup(a.value,n)):i?(s?s=!1:n.push(44),a.writeRecon(n)):o?a instanceof p&&a.isMarkupSafe()?(p.writeItems(a.iterator(),!1,!0,n),!t.isEmpty()&&t.head()instanceof g.Text?(g.Text.writeMarkup(t.head().stringValue(),n),t.step()):t.isEmpty()||t.head()instanceof g.Attr?(n.push(93),o=!1):(n.push(123),s=i=!0)):(n.push(123),a.writeRecon(n),s=!(i=!0)):!(u&&a instanceof g.Text)||t.isEmpty()||t.head()instanceof g.Field||t.head()instanceof g.Text||t.head()instanceof g.Bool?e&&!i?(s?s=!1:n.push(44),a.writeRecon(n)):r&&a instanceof g.Text&&t.isEmpty()?(n.push(91),g.Text.writeMarkup(a.value,n),n.push(93)):!r&&a instanceof _&&!(a instanceof p)&&(!s&&t.isEmpty()||!t.isEmpty()&&t.head()instanceof g.Attr)?(!s&&(a instanceof g.Text&&a.isIdent()||a instanceof g.Num||a instanceof g.Bool)&&n.push(32),a.writeRecon(n)):(n.push(123),a.writeRecon(n),s=!(i=!0)):(n.push(91),g.Text.writeMarkup(a.value,n),o=!0)}i&&n.push(125),o&&n.push(93)},p.prototype.compare=function(t){if(t instanceof p){for(var e=this.iterator(),r=t.iterator(),n=0;0===n&&!e.isEmpty()&&!r.isEmpty();)n=e.head().compare(r.head()),e.step(),r.step();return 0!==n?n:e.isEmpty()&&!r.isEmpty()?-1:!e.isEmpty()&&r.isEmpty()?1:0}return t instanceof g.Field?1:-1},p.prototype.equals=function(t){if(this===t)return!0;if(t instanceof p){for(var e=this.iterator(),r=t.iterator();!e.isEmpty()&&!r.isEmpty();){if(!e.head().equals(r.head()))return!1;e.step(),r.step()}return e.isEmpty()===r.isEmpty()}return!1},p.prototype.hashCode=function(){var e=3401408391;return this.forEach(function(t){e=h.mix(e,t.hashCode())},this),h.mash(e)},p.prototype.toString=function(){return this.toRecon()},p.fromAny=function(t){if(t instanceof p)return t;if(Array.isArray(t))return p.fromArray(t);if("object"==typeof t)return p.fromObject(t);throw new TypeError(""+t)},p.fromArray=function(t){for(var e=t.length||0,r=p.empty(e),n=0;n<e;n+=1)r.push(g.fromAny(t[n]));return r},p.fromObject=function(t){var e=p.empty(),r=0;for(var n in t){var i=t[n];36===n.charCodeAt(0)&&n==="$"+r?i&&"object"==typeof i&&i.hasOwnProperty("$key")?e.push(g.Field.of(i.$key,i.$value)):e.push(_.of(i)):e.push(g.Field.of(n,i)),r+=1}return e},p.parseRecon=function(t){var e=_.parseRecon(t);return e instanceof p?e:e.isDefined()?p.of(e):p.empty()},p.expand=function(t){return t=Math.max(8,t)-1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1},p.ALIASED=1,p.IMMUTABLE=2,p.Empty=void 0,p.empty=void 0,p.of=void 0,p}(_),q=function(s){function a(t,e,r,n,i){var o=s.call(this)||this;return o._array=t,o._table=e,o._itemCount=r,o._fieldCount=n,o._flags=i,o}return c(a,s),a.prototype.isEmpty=function(){return 0===this._itemCount},a.prototype.isArray=function(){return 0===this._fieldCount},a.prototype.isObject=function(){return this._itemCount===this._fieldCount},Object.defineProperty(a.prototype,"length",{get:function(){return this._itemCount},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"size",{get:function(){return this._itemCount},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fieldCount",{get:function(){return this._itemCount},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"valueCount",{get:function(){return this._itemCount-this._fieldCount},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"tag",{get:function(){if(0<this._fieldCount){var t=this._array[0];if(t instanceof g.Attr)return t.key.value}},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"target",{get:function(){for(var t=this._array,e=0,r=this._itemCount;e<r;e+=1){var n=t[e];if(n instanceof _)return n}return this},enumerable:!0,configurable:!0}),a.prototype.head=function(){return 0<this._itemCount?this._array[0]:_.Absent},a.prototype.tail=function(){var t=this._itemCount;return 0<t?new a.View(this,1,t):O.Empty},a.prototype.body=function(){var t=this._itemCount;if(2<t)return new a.View(this,1,t).branch();if(2===t){var e=this._array[1];return e instanceof g.Value||(e=O.of(e)),e}return _.Absent},a.prototype.has=function(t){if(0<this._fieldCount){t=_.of(t),this.hash();var e=this._table,r=e.length,n=Math.abs(t.hashCode()%r),i=n;do{var o=e[i];if(void 0===o)break;if(o.key.equals(t))return!0;i=(i+1)%r}while(i!==n)}return!1},a.prototype.get=function(t){if(0<this._fieldCount){t=_.of(t),this.hash();var e=this._table,r=e.length,n=Math.abs(t.hashCode()%r),i=n;do{var o=e[i];if(void 0===o)break;if(o.key.equals(t))return o.value;i=(i+1)%r}while(i!==n)}return _.Absent},a.prototype.getAttr=function(t){if(0<this._fieldCount){t=g.Text.of(t),this.hash();var e=this._table,r=e.length,n=Math.abs(t.hashCode()%r),i=n;do{var o=e[i];if(void 0===o)break;if(o instanceof g.Attr&&o.key.equals(t))return o.value;i=(i+1)%r}while(i!==n)}return _.Absent},a.prototype.getField=function(t){if(0<this._fieldCount){t=_.of(t),this.hash();var e=this._table,r=e.length,n=Math.abs(t.hashCode()%r),i=n;do{var o=e[i];if(void 0===o)break;if(o.key.equals(t))return o;i=(i+1)%r}while(i!==n)}},a.prototype.getItem=function(t){t instanceof g.Num&&(t=t.value);var e=this._itemCount;return t<0&&(t=e+t),0<=(t=Math.min(Math.max(0,t),e-1))?this._array[t]:g.Absent},a.prototype.set=function(t,e){if(0!=(this._flags&O.IMMUTABLE))throw new Error("immutable");return t=_.of(t),e=_.of(e),0!=(this._flags&O.ALIASED)?0<this._fieldCount?this.setAliased(t,e):this.pushAliased(new g.Slot(t,e)):0<this._fieldCount?null!==this._table?this.setMutable(t,e):this.putMutable(t,e):this.pushMutable(new g.Slot(t,e)),this},a.prototype.setAliased=function(t,e){for(var r=this._itemCount,n=this._array,i=new Array(O.expand(r+1)),o=0;o<r;o+=1){var s=n[o];if(s instanceof g.Field&&s.key.equals(t)){for(i[o]=s.withValue(e),o+=1;o<r;)i[o]=n[o],o+=1;return this._array=i,this._table=null,void(this._flags&=~O.ALIASED)}i[o]=s}this._array=i,this._table=null,this._flags&=~O.ALIASED;var u=new g.Slot(t,e);this.pushMutable(u)},a.prototype.setMutable=function(t,e){var r=this._table,n=r.length,i=Math.abs(t.hashCode()%n),o=i;do{var s=r[o];if(void 0===s)break;if(s.key.equals(t))return s.isMutable()?void s.setValue(e):void this.putMutable(t,e);o=(o+1)%n}while(o!==i);var u=new g.Slot(t,e);this.pushMutable(u),a.put(u,r)},a.prototype.putMutable=function(t,e){for(var r=this._array,n=0,i=this._itemCount;n<i;n+=1){var o=r[n];if(o instanceof g.Field&&o.key.equals(t))return r[n]=o.withValue(e),void(this._table=null)}var s=new g.Slot(t,e);this.pushMutable(s),a.put(s,this._table)},a.prototype.setAttr=function(t,e){if(0!=(this._flags&O.IMMUTABLE))throw new Error("immutable");return t=g.Text.of(t),e=_.of(e),0!=(this._flags&O.ALIASED)?0<this._fieldCount?this.setAttrAliased(t,e):this.pushAliased(new g.Attr(t,e)):0<this._fieldCount?null!==this._table?this.setAttrMutable(t,e):this.putAttrMutable(t,e):this.pushMutable(new g.Attr(t,e)),this},a.prototype.setAttrAliased=function(t,e){for(var r=this._itemCount,n=this._array,i=new Array(O.expand(r+1)),o=0;o<r;o+=1){var s=n[o];if(s instanceof g.Field&&s.key.equals(t)){for(i[o]=g.Attr.of(t,e),o+=1;o<r;)i[o]=n[o],o+=1;return this._array=i,this._table=null,void(this._flags&=~O.ALIASED)}i[o]=s}i[r]=g.Attr.of(t,e),this._array=i,this._table=null,this._itemCount=r+1,this._fieldCount+=1,this._flags&=~O.ALIASED},a.prototype.setAttrMutable=function(t,e){var r=this._table,n=r.length,i=Math.abs(t.hashCode()%n),o=i;do{var s=r[o];if(void 0===s)break;if(s.key.equals(t))return void(s instanceof g.Attr&&s.isMutable()?s.setValue(e):this.putAttrMutable(t,e));o=(o+1)%n}while(o!==i);var u=g.Attr.of(t,e);this.push(u),a.put(u,r)},a.prototype.putAttrMutable=function(t,e){for(var r=this._array,n=this._itemCount,i=0;i<n;i+=1){if(r[i].key.equals(t))return r[i]=g.Attr.of(t,e),void(this._table=null)}var o=g.Attr.of(t,e);this.push(o),a.put(o,this._table)},a.prototype.setItem=function(t,e){if(0!=(this._flags&O.IMMUTABLE))throw new Error("immutable");t instanceof g.Num&&(t=t.value),e=g.of(e);var r=this.length;return t<0&&(t=r+t),0<=(t=Math.min(Math.max(0,t),r-1))&&(0!=(this._flags&O.ALIASED)?this.setIndexAliased(t,e):this.setIndexMutable(t,e)),this},a.prototype.setIndexAliased=function(t,e){for(var r=this._itemCount,n=this._array,i=new Array(O.expand(r)),o=0;o<r;o+=1)i[o]=n[o];var s=n[t];i[t]=e,this._array=i,this._table=null,e instanceof g.Field?s instanceof g.Field||(this._fieldCount+=1):s instanceof g.Field&&(this._fieldCount-=1),this._flags&=~O.ALIASED},a.prototype.setIndexMutable=function(t,e){var r=this._array,n=r[t];(r[t]=e)instanceof g.Field?(this._table=null,n instanceof g.Field||(this._fieldCount+=1)):n instanceof g.Field&&(this._table=null,this._fieldCount-=1)},a.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0!=(this._flags&O.IMMUTABLE))throw new Error("immutable");return 0!=(this._flags&O.ALIASED)?this.pushAliased.apply(this,arguments):this.pushMutable.apply(this,arguments),this._itemCount},a.prototype.pushAliased=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t.length,n=this._itemCount,i=this._fieldCount,o=this._array,s=new Array(O.expand(n+r));if(null!==o)for(var u=0;u<n;u+=1)s[u]=o[u];for(u=0;u<r;u+=1){var a=g.fromAny(t[u]);s[n]=a,n+=1,a instanceof g.Field&&(i+=1)}this._array=s,this._table=null,this._itemCount=n,this._fieldCount=i,this._flags&=~O.ALIASED},a.prototype.pushMutable=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r,n=t.length,i=this._itemCount,o=this._fieldCount,s=this._array;if(null===s||i+n>s.length){if(r=new Array(O.expand(i+n)),null!==s)for(var u=0;u<i;u+=1)r[u]=s[u]}else r=s;for(u=0;u<n;u+=1){var a=g.fromAny(t[u]);r[i]=a,i+=1,a instanceof g.Field&&(o+=1,this._table=null)}this._array=r,this._itemCount=i,this._fieldCount=o},a.prototype.splice=function(t,e){void 0===e&&(e=0);for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];if(0!=(this._flags&O.IMMUTABLE))throw new Error("immutable");var i=this._itemCount;return t<0&&(t=i+t),t=Math.min(Math.max(0,t),i),e=Math.min(Math.max(0,e),i-t),0!=(this._flags&O.ALIASED)?this.spliceAliased.apply(this,arguments):this.spliceMutable.apply(this,arguments)},a.prototype.spliceAliased=function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];for(var i=r.length,o=this._itemCount,s=this._fieldCount,u=this._array,a=new Array(O.expand(o-e+i)),p=0;p<t;p+=1)a[p]=u[p];var h=[];for(p=t;p<t+e;p+=1){var f=u[p];h.push(f),o-=1,f instanceof g.Field&&(s-=1)}for(p=t;p<o;p+=1)a[p+i]=u[p+e];for(p=0;p<i;p+=1){var c=g.of(r[p]);o+=1,(a[p+t]=c)instanceof g.Field&&(s+=1)}return this._array=a,this._table=null,this._itemCount=o,this._fieldCount=s,this._flags&=~O.ALIASED,h},a.prototype.spliceMutable=function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i,o=r.length,s=this._itemCount,u=this._fieldCount,a=this._array;if(null===a||s-e+o>a.length){if(i=new Array(O.expand(s-e+o)),null!==a)for(var p=0;p<t;p+=1)i[p]=a[p]}else i=a;var h=[];for(p=t;p<t+e;p+=1){var f=a[p];h.push(f),s-=1,f instanceof g.Field&&(u-=1)}if(e<o)for(p=s-1;t<=p;p-=1)i[p+o]=a[p+e];else for(p=t;p<s;p+=1)i[p+o]=a[p+e];for(p=0;p<o;p+=1){var c=g.of(r[p]);s+=1,(i[p+t]=c)instanceof g.Field&&(u+=1)}return this._array=i,this._itemCount=s,this._fieldCount=u,h},a.prototype.delete=function(t){if(0!=(this._flags&O.IMMUTABLE))throw new Error("immutable");return t=_.of(t),0!=(this._flags&O.ALIASED)?this.deleteAliased(t):this.deleteMutable(t)},a.prototype.deleteAliased=function(t){for(var e=this._itemCount,r=this._array,n=new Array(O.expand(e)),i=0;i<e;i+=1){var o=r[i];if(o instanceof g.Field&&o.key.equals(t)){for(var s=i+1;s<e;s+=1,i+=1)n[i]=r[s];return this._array=n,this._table=null,this._itemCount=e-1,this._fieldCount-=1,this._flags&=~O.ALIASED,o}n[i]=o}return g.Absent},a.prototype.deleteMutable=function(t){for(var e=this._itemCount,r=this._array,n=0;n<e;n+=1){var i=r[n];if(i instanceof g.Field&&i.key.equals(t)){for(var o=n+1;o<e;o+=1,n+=1)r[n]=r[o];return r[e-1]=void 0,this._table=null,this._itemCount=e-1,this._fieldCount-=1,i}}return g.Absent},a.prototype.clear=function(){if(0!=(this._flags&O.IMMUTABLE))throw new Error("immutable");this._array=null,this._table=null,this._itemCount=0,this._fieldCount=0,this._flags=0},a.prototype.withField=function(t,e){t=_.of(t),e=_.of(e);var r=0==(this._flags&O.IMMUTABLE)?this:this.branch();return 0!=(r._flags&O.ALIASED)?0<r._fieldCount?r.setAliased(t,e):r.pushAliased(g.Slot.of(t,e)):0<r.fieldCount?null!==r._table?r.setMutable(t,e):r.putMutable(t,e):r.pushMutable(g.Slot.of(t,e)),r},a.prototype.withAttr=function(t,e){t=g.Text.of(t),e=_.of(e);var r=0==(this._flags&O.IMMUTABLE)?this:this.branch();return 0!=(r._flags&O.ALIASED)?0<r._fieldCount?r.setAttrAliased(t,e):r.pushAliased(g.Attr.of(t,e)):0<r.fieldCount?null!==r._table?r.setAttrMutable(t,e):r.putAttrMutable(t,e):r.pushMutable(g.Attr.of(t,e)),r},a.prototype.withSlot=function(t,e){t=_.of(t),e=_.of(e);var r=0==(this._flags&O.IMMUTABLE)?this:this.branch();return 0!=(r._flags&O.ALIASED)?0<r._fieldCount?r.setSlotAliased(t,e):r.pushAliased(g.Slot.of(t,e)):0<r.fieldCount?null!==r._table?r.setSlotMutable(t,e):r.putSlotMutable(t,e):r.pushMutable(g.Slot.of(t,e)),r},a.prototype.setSlotAliased=function(t,e){for(var r=this._itemCount,n=this._array,i=new Array(O.expand(r+1)),o=0;o<r;o+=1){var s=n[o];if(s instanceof g.Field&&s.key.equals(t)){for(i[o]=g.Slot.of(t,e),o+=1;o<r;)i[o]=n[o],o+=1;return this._array=i,this._table=null,void(this._flags&=~O.ALIASED)}i[o]=s}i[r]=g.Slot.of(t,e),this._array=i,this._table=null,this._itemCount=r+1,this._fieldCount+=1,this._flags&=~O.ALIASED},a.prototype.setSlotMutable=function(t,e){var r=this._table,n=r.length,i=Math.abs(t.hashCode()%n),o=i;do{var s=r[o];if(void 0===s)break;if(s.key.equals(t))return void(s instanceof g.Slot&&s.isMutable()?s.setValue(e):this.putSlotMutable(t,e));o=(o+1)%n}while(o!==i);var u=g.Slot.of(t,e);this.push(u),a.put(u,r)},a.prototype.putSlotMutable=function(t,e){for(var r=this._array,n=this._itemCount,i=0;i<n;i+=1){if(r[i].key.equals(t))return r[i]=g.Slot.of(t,e),void(this._table=null)}var o=g.Slot.of(t,e);this.push(o),a.put(o,this._table)},a.prototype.subRecord=function(t,e){var r=this._itemCount;return void 0===t?t=0:t<0&&(t=r+t),t=Math.min(Math.max(0,t),r),void 0===e?e=r:e<0&&(e=r+e),e=Math.min(Math.max(t,e),r),new a.View(this,t,e)},a.prototype.forEach=function(t,e){for(var r=this._array,n=0,i=this._itemCount;n<i;n+=1){var o=t.call(e,r[n],n);if(void 0!==o)return o}},a.prototype.indexOf=function(t,e){void 0===e&&(e=0),t=g.of(t);var r=this._array,n=this._itemCount;for(e<0&&(e=n+e),e=Math.max(0,e);e<n;){if(t.equals(r[e]))return e;e+=1}return-1},a.prototype.lastIndexOf=function(t,e){t=g.of(t);var r=this._array,n=this._itemCount;for(void 0===e?e=n-1:e<0&&(e=n+e),e=Math.min(e,n-1);0<=e;){if(t.equals(r[e]))return e;e-=1}return-1},a.prototype.evaluate=function(t){t=S.fromAny(t);var e=this._array,r=this._itemCount,n=O.empty(r);t.push(n);for(var i=!1,o=0;o<r;o+=1){var s=e[o],u=s.evaluate(t);u.isDefined()&&n.push(u),i=i||s!==u}return t.pop(),i?n:this},a.prototype.substitute=function(t){t=S.fromAny(t);var e=this._array,r=this._itemCount,n=O.empty(r);t.push(n);for(var i=!1,o=0;o<r;o+=1){var s=e[o],u=s.substitute(t);u.isDefined()&&n.push(u),i=i||s!==u}return t.pop(),i?n:this},a.prototype.isAliased=function(){return 0!=(this._flags&O.ALIASED)},a.prototype.isMutable=function(){return 0==(this._flags&O.IMMUTABLE)},a.prototype.alias=function(){this._flags|=O.ALIASED},a.prototype.branch=function(){if(0==(this._flags&(O.ALIASED|O.IMMUTABLE)))for(var t=this._array,e=0,r=this._itemCount;e<r;e+=1)t[e].alias();return this._flags|=O.ALIASED,new a(this._array,this._table,this._itemCount,this._fieldCount,O.ALIASED)},a.prototype.clone=function(){for(var t=this._itemCount,e=this._array,r=new Array(t),n=0;n<t;n+=1)r[n]=e[n].clone();return new a(r,null,t,this._fieldCount,0)},a.prototype.commit=function(){if(0==(this._flags&O.IMMUTABLE)){this._flags|=O.IMMUTABLE;for(var t=this._array,e=0,r=this._itemCount;e<r;e+=1)t[e].commit()}return this},a.prototype.hash=function(){var t=this._fieldCount;if(0<t&&null===this._table){for(var e=new Array(O.expand(Math.max(t,10*t/7))),r=this._array,n=0,i=this._itemCount;n<i;n+=1){var o=r[n];o instanceof g.Field&&a.put(o,e)}this._table=e}},a.put=function(t,e){if(null!==e){var r=e.length,n=Math.abs(t.key.hashCode()%r),i=n;do{var o=e[i];if(void 0===o)return void(e[i]=t);if(t.key.equals(o.key))return void(e[i]=t);i=(i+1)%r}while(i!==n);throw new Error}},a.empty=function(t){return new a(void 0===t?null:new Array(t),null,0,0,0)},a.of=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t.length;if(0===r)return new a(null,null,0,0,0);for(var n=new Array(r),i=0,o=0,s=0;s<r;s+=1){var u=g.fromAny(t[s]);i+=1,(n[s]=u)instanceof g.Field&&(o+=1)}return new a(n,null,i,o,0)},a.View=void 0,a.Empty=new a(null,null,0,0,O.ALIASED|O.IMMUTABLE),a}(g.Record=O);g.Empty=q.Empty,_.Empty=q.Empty,O.Empty=q.Empty,g.empty=q.empty,_.empty=q.empty,O.empty=q.empty,O.of=q.of;var T=function(i){function n(t,e,r){var n=i.call(this)||this;return n._record=t,n._lower=e,n._upper=r,n}return c(n,i),n.prototype.isEmpty=function(){return this._lower===this._upper},n.prototype.isArray=function(){for(var t=this._record._array,e=this._lower,r=this._upper;e<r;e+=1)if(t[e]instanceof g.Field)return!1;return!0},n.prototype.isObject=function(){for(var t=this._record._array,e=this._lower,r=this._upper;e<r;e+=1)if(t[e]instanceof g.Value)return!1;return!0},Object.defineProperty(n.prototype,"length",{get:function(){return this._upper-this._lower},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"size",{get:function(){return this._upper-this._lower},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fieldCount",{get:function(){for(var t=0,e=this._record._array,r=this._lower,n=this._upper;r<n;r+=1)e[r]instanceof g.Field&&(t+=1);return t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"valueCount",{get:function(){for(var t=0,e=this._record._array,r=this._lower,n=this._upper;r<n;r+=1)e[r]instanceof _&&(t+=1);return t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"tag",{get:function(){if(0<this.length){var t=this._record._array[this._lower];if(t instanceof g.Attr)return t.key.value}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"target",{get:function(){for(var t=this._record._array,e=this._lower,r=this._upper;e<r;e+=1){var n=t[e];if(n instanceof _)return n}return this},enumerable:!0,configurable:!0}),n.prototype.head=function(){return 0<this.length?this._record._array[this._lower]:_.Absent},n.prototype.tail=function(){return 0<this.length?new n(this._record,this._lower+1,this._upper):O.Empty},n.prototype.body=function(){var t=this.length;if(2<t)return new n(this._record,this._lower+1,this._upper).branch();if(2===t){var e=this._record._array[this._lower+1];return e instanceof g.Value||(e=O.of(e)),e}return _.Absent},n.prototype.getItem=function(t){t instanceof g.Num&&(t=t.value);var e=this.length;return t<0&&(t=e+t),0<=(t=Math.min(Math.max(0,t),e-1))?this._record._array[this._lower+t]:g.Absent},n.prototype.setItem=function(t,e){if(0!=(this._record._flags&O.IMMUTABLE))throw new Error("immutable");t instanceof g.Num&&(t=t.value),e=g.of(e);var r=this.length;return t<0&&(t=r+t),0<=(t=Math.min(Math.max(0,t),r-1))&&(0!=(this._record._flags&O.ALIASED)?this.setIndexAliased(t,e):this.setIndexMutable(t,e)),this},n.prototype.setIndexAliased=function(t,e){for(var r=this._record._itemCount,n=this._record._array,i=new Array(O.expand(r)),o=0;o<r;o+=1)i[o]=n[o];var s=n[this._lower+t];i[this._lower+t]=e,this._record._array=i,this._record._table=null,e instanceof g.Field?s instanceof g.Field||(this._record._fieldCount+=1):s instanceof g.Field&&(this._record._fieldCount-=1),this._record._flags&=~O.ALIASED},n.prototype.setIndexMutable=function(t,e){var r=this._record._array,n=r[this._lower+t];(r[this._lower+t]=e)instanceof g.Field?(this._record._table=null,n instanceof g.Field||(this._record._fieldCount+=1)):n instanceof g.Field&&(this._record._table=null,this._record._fieldCount-=1)},n.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0!=(this._record._flags&O.IMMUTABLE))throw new Error("immutable");return 0!=(this._record._flags&O.ALIASED)?this.pushAliased.apply(this,arguments):this.pushMutable.apply(this,arguments),this.length},n.prototype.pushAliased=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t.length,n=this._record._itemCount,i=this._record._fieldCount,o=this._record._array,s=new Array(O.expand(n+r));if(null!==o){for(var u=0;u<this._upper;u+=1)s[u]=o[u];for(u=this._upper;u<n;u+=1)s[u+r]=o[u]}for(u=0;u<r;u+=1){var a=g.fromAny(t[u]);n+=1,(s[u+this._upper]=a)instanceof g.Field&&(i+=1)}this._record._array=s,this._record._table=null,this._record._itemCount=n,this._record._fieldCount=i,this._record._flags&=~O.ALIASED,this._upper+=r},n.prototype.pushMutable=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r,n=t.length,i=this._record._itemCount,o=this._record._fieldCount,s=this._record._array;if(null===s||i+n>s.length){if(r=new Array(O.expand(i+n)),null!==s)for(var u=0;u<this._upper;u+=1)r[u]=s[u]}else r=s;for(u=i-1;u>=this._upper;u-=1)r[u+n]=s[u];for(u=0;u<n;u+=1){var a=g.fromAny(t[u]);i+=1,(r[u+this._upper]=a)instanceof g.Field&&(o+=1,this._record._table=null)}this._record._array=r,this._record._itemCount=i,this._record._fieldCount=o,this._upper+=n},n.prototype.splice=function(t,e){void 0===e&&(e=0);for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];if(0!=(this._record._flags&O.IMMUTABLE))throw new Error("immutable");var i,o,s,u=this.length;return t<0&&(t=u+t),t=Math.min(Math.max(0,t),u),e=Math.min(Math.max(0,e),u-t),i=0!=(this._record._flags&O.ALIASED)?(o=this._record).spliceAliased.apply(o,[this._lower+t,e].concat(r)):(s=this._record).spliceMutable.apply(s,[this._lower+t,e].concat(r)),this._upper+=r.length-i.length,i},n.prototype.delete=function(t){if(0!=(this._record._flags&O.IMMUTABLE))throw new Error("immutable");return t=_.of(t),0!=(this._record._flags&O.ALIASED)?this.deleteAliased(t):this.deleteMutable(t)},n.prototype.deleteAliased=function(t){for(var e=this._record._itemCount,r=this._record._array,n=new Array(O.expand(e)),i=this._lower;i<this._upper;i+=1){var o=r[i];if(o instanceof g.Field&&o.key.equals(t)){for(var s=i+1;s<e;s+=1,i+=1)n[i]=r[s];return this._record._array=n,this._record._table=null,this._record._itemCount=e-1,this._record._fieldCount-=1,this._record._flags&=~O.ALIASED,this._upper-=1,o}n[i]=o}return g.Absent},n.prototype.deleteMutable=function(t){for(var e=this._record._itemCount,r=this._record._array,n=this._lower;n<this._upper;n+=1){var i=r[n];if(i instanceof g.Field&&i.key.equals(t)){for(var o=n+1;o<e;o+=1,n+=1)r[n]=r[o];return r[e-1]=void 0,this._record._table=null,this._record._itemCount-=1,this._record._fieldCount-=1,this._upper-=1,i}}return g.Absent},n.prototype.clear=function(){if(0!=(this._record._flags&O.IMMUTABLE))throw new Error("immutable");0!=(this._record._flags&O.ALIASED)?this.clearAliased():this.clearMutable()},n.prototype.clearAliased=function(){for(var t=this._record._itemCount,e=this._record._fieldCount,r=t-this.length,n=this._record._array,i=new Array(O.expand(r)),o=0;o<this._lower;)i[o]=n[o],o+=1;for(;o<this._upper;)n[o]instanceof g.Field&&(e-=1),o+=1;o=this._lower;for(var s=this._upper;s<t;)i[o]=n[s],o+=1,s+=1;this._record._array=i,this._record._table=null,this._record._itemCount=r,this._record._fieldCount=e,this._record._flags&=~O.ALIASED,this._upper=this._lower},n.prototype.clearMutable=function(){for(var t=this._record._itemCount,e=this._record._fieldCount,r=this._record._array,n=this._lower;n<this._upper;)r[n]instanceof g.Field&&(e-=1),n+=1;n=this._lower;for(var i=this._upper;i<t;){var o=r[i];o instanceof g.Field&&(this._record._table=null),r[n]=o,n+=1,i+=1}for(this._record._itemCount=n,this._record._fieldCount=e;n<t;)r[n]=void 0,n+=1;this._upper=this._lower},n.prototype.subRecord=function(t,e){var r=this.length;return void 0===t?t=0:t<0&&(t=r+t),t=Math.min(Math.max(0,t),r),void 0===e?e=r:e<0&&(e=r+e),e=Math.min(Math.max(t,e),r),new n(this._record,this._lower+t,this._upper+e)},n.prototype.forEach=function(t,e){for(var r=this._record._array,n=this._lower,i=this._upper;n<i;n+=1){var o=t.call(e,r[n],n);if(void 0!==o)return o}},n.prototype.indexOf=function(t,e){void 0===e&&(e=0),t=g.of(t);var r=this._record._array,n=this.length;for(e<0&&(e=n+e),e=this._lower+Math.max(0,e);e<this._upper;){if(t.equals(r[e]))return e-this._lower;e+=1}return-1},n.prototype.lastIndexOf=function(t,e){t=g.of(t);var r=this._record._array,n=this.length;for(void 0===e?e=n-1:e<0&&(e=n+e),e=this._lower+Math.min(e,n-1);e>=this._lower;){if(t.equals(r[e]))return e-this._lower;e-=1}return-1},n.prototype.isAliased=function(){return 0!=(this._record._flags&O.ALIASED)},n.prototype.isMutable=function(){return 0==(this._record._flags&O.IMMUTABLE)},n.prototype.alias=function(){this._record._flags|=O.ALIASED},n.prototype.branch=function(){for(var t=this.length,e=0,r=this._record._array,n=new Array(O.expand(t)),i=this._lower,o=0;o<t;){var s=r[i];(n[o]=s)instanceof g.Field&&(e+=1),i+=1,o+=1}return new q(n,null,t,e,0)},n.prototype.clone=function(){for(var t=this.length,e=0,r=this._record._array,n=new Array(O.expand(t)),i=this._lower,o=0;o<t;){var s=r[i];n[o]=s.clone(),s instanceof g.Field&&(e+=1),i+=1,o+=1}return new q(n,null,t,e,0)},n.prototype.commit=function(){return this._record.commit(),this},n}(O);q.View=T;var R=function(r){function e(t){var e=r.call(this)||this;return e._value=t,e}return c(e,r),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e.prototype.or=function(t){return this},e.prototype.and=function(t){return t},e.prototype.not=function(){return this._value?_.False:_.True},e.prototype.stringValue=function(){return this._value?"true":"false"},e.prototype.booleanValue=function(){return this._value},e.prototype.toAny=function(){return this._value},e.prototype.valueOf=function(){return this._value},e.prototype.writeRecon=function(t){this._value?t.push(116,114,117,101):t.push(102,97,108,115,101)},e.prototype.toRecon=function(){return this._value?"true":"false"},e.prototype.toReconBlock=function(){return this._value?"true":"false"},e.prototype.compare=function(t){return t instanceof e?this._value&&!t._value?-1:!this._value&&t._value?1:0:t instanceof g.Field||t instanceof g.Record||t instanceof g.Data||t instanceof g.Text||t instanceof g.Num?1:-1},e.prototype.equals=function(t){return this===t||t instanceof e&&this._value===t._value},e.prototype.plus=function(t){return(t=g.of(t))instanceof B?this._value?B.valueOf(t._value):B.valueOf("false"):r.prototype.plus.call(this,t)},e.prototype.hashCode=function(){return this._value?1205540039:2682565394},e.prototype.toString=function(){return this.toRecon()},e.valueOf=function(t){return t?e.True:e.False},e.of=function(t){if(t instanceof e)return t;if("boolean"==typeof t)return e.valueOf(t);throw new TypeError(""+t)},e.True=new e(!0),e.False=new e(!1),e}(_);g.Bool=R,g.True=R.True,g.False=R.False,_.True=R.True,_.False=R.False;var U=function(e){function r(){return e.call(this)||this}return c(r,e),r.prototype.isDistinct=function(){return!1},r.prototype.not=function(){return _.Absent},r.prototype.stringValue=function(){return""},r.prototype.booleanValue=function(){return!0},r.prototype.toAny=function(){return null},r.prototype.valueOf=function(){return null},r.prototype.plus=function(t){return(t=g.of(t))instanceof B?B.valueOf(t._value):e.prototype.plus.call(this,t)},r.prototype.writeRecon=function(t){},r.prototype.toRecon=function(){return""},r.prototype.toReconBlock=function(){return""},r.prototype.compare=function(t){return t instanceof r?0:t===_.Absent?-1:1},r.prototype.equals=function(t){return this===t},r.prototype.hashCode=function(){return 4137424647},r.prototype.toString=function(){return"extant"},r}(_);g.Extant=new U,_.Extant=g.Extant;var B=function(n){function u(t,e){var r=n.call(this)||this;return r._value=t,r._flags=e,r}return c(u,n),Object.defineProperty(u.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"size",{get:function(){return this._value.length},enumerable:!0,configurable:!0}),u.prototype.isIdent=function(){var t=new v(this._value);if(t.isEmpty()||!g.Recon.isIdentStartChar(t.head()))return!1;for(t.step();!t.isEmpty()&&g.Recon.isIdentChar(t.head());)t.step();return t.isEmpty()},u.prototype.isDone=function(){return!1},u.prototype.isFull=function(){return!1},u.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0!=(this._flags&u.IMMUTABLE))throw new Error("immutable");for(var r=0,n=t.length;r<n;r+=1){var i=t[r];if("number"==typeof i)if(0<=i&&i<=55295||57344<=i&&i<=65535)this._value+=String.fromCharCode(i);else if(65536<=i&&i<=1114111){var o=i-65536;this._value+=String.fromCharCode(55296|o>>>10,56320|1023&o)}else this._value+=String.fromCharCode(65533);else if("string"==typeof i)for(var s=new v(i);!s.isEmpty();)this.push(s.head()),s.step()}},u.prototype.isMutable=function(){return 0==(this._flags&u.IMMUTABLE)},u.prototype.branch=function(){return this.clone()},u.prototype.clone=function(){return new u(this._value,0)},u.prototype.commit=function(){return this._flags|=u.IMMUTABLE,this},u.prototype.bind=function(){return this},u.prototype.stringValue=function(){return this._value},u.prototype.numberValue=function(){var t=+this._value;if(isFinite(t))return t},u.prototype.toAny=function(){return this._value},u.prototype.valueOf=function(){return this._value},u.prototype.writeRecon=function(t){this.isIdent()?u.writeIdent(this._value,t):u.writeString(this._value,t)},u.writeIdent=function(t,e){for(var r=new v(t);!r.isEmpty();)e.push(r.head()),r.step()},u.writeString=function(t,e){var r=new v(t);for(e.push(34);!r.isEmpty();){var n=r.head();switch(n){case 34:case 92:e.push(92,n);break;case 8:e.push(92,98);break;case 12:e.push(92,102);break;case 10:e.push(92,110);break;case 13:e.push(92,114);break;case 9:e.push(92,116);break;default:e.push(n)}r.step()}e.push(34)},u.writeMarkup=function(t,e){for(var r=new v(t);!r.isEmpty();){var n=r.head();switch(n){case 36:case 64:case 91:case 92:case 93:case 123:case 125:e.push(92,n);break;case 8:e.push(92,98);break;case 12:e.push(92,102);break;case 10:e.push(92,110);break;case 13:e.push(92,114);break;case 9:e.push(92,116);break;default:e.push(n)}r.step()}},u.prototype.compare=function(t){if(t instanceof u){var e=this._value.localeCompare(t._value);return e<0?-1:0<e?1:0}return t instanceof g.Field||t instanceof g.Record||t instanceof g.Data?1:-1},u.prototype.equals=function(t){return this===t||t instanceof u&&this._value===t._value},u.prototype.plus=function(t){return(t=g.of(t))instanceof u?u.valueOf(this._value+t._value):t instanceof g.Num?u.valueOf(this._value+t._value):t instanceof R?t._value?u.valueOf(this._value):u.valueOf("false"):t instanceof U?u.valueOf(this._value):n.prototype.plus.call(this,t)},u.prototype.hashCode=function(){return h.hash(this._value)},u.prototype.toString=function(){return this._value},u.empty=function(){return new u("",0)},u.valueOf=function(t){return 0===t.length?u.Empty:new u(t,u.IMMUTABLE)},u.of=function(t){if(t instanceof u)return t;if("string"==typeof t)return u.valueOf(t);throw new TypeError(""+t)},u.Empty=new u("",u.IMMUTABLE=1),u}(_);g.Text=B;var z=function(r){function n(t){var e=r.call(this)||this;return e._value=t,e}return c(n,r),Object.defineProperty(n.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),n.prototype.bor=function(t){return(t=g.of(t))instanceof g.Num?n.valueOf(this.value|t.value):r.prototype.bor.call(this,t)},n.prototype.bxor=function(t){return(t=g.of(t))instanceof g.Num?n.valueOf(this.value^t.value):r.prototype.bxor.call(this,t)},n.prototype.band=function(t){return(t=g.of(t))instanceof g.Num?n.valueOf(this.value&t.value):r.prototype.band.call(this,t)},n.prototype.plus=function(t){return(t=g.of(t))instanceof g.Num?n.valueOf(this.value+t.value):t instanceof B?B.valueOf(this.value+t.value):r.prototype.plus.call(this,t)},n.prototype.minus=function(t){return(t=g.of(t))instanceof g.Num?n.valueOf(this.value-t.value):r.prototype.minus.call(this,t)},n.prototype.times=function(t){return(t=g.of(t))instanceof g.Num?n.valueOf(this.value*t.value):r.prototype.times.call(this,t)},n.prototype.divide=function(t){return(t=g.of(t))instanceof g.Num?n.valueOf(this.value/t.value):r.prototype.divide.call(this,t)},n.prototype.modulo=function(t){return(t=g.of(t))instanceof g.Num?n.valueOf(this.value%t.value):r.prototype.modulo.call(this,t)},n.prototype.bnot=function(){return n.valueOf(~this.value)},n.prototype.neg=function(){return n.valueOf(-this.value)},n.prototype.pos=function(){return this},n.prototype.inv=function(){return n.valueOf(1/this.value)},n.prototype.stringValue=function(){return""+this._value},n.prototype.numberValue=function(){return this._value},n.prototype.toAny=function(){return this._value},n.prototype.valueOf=function(){return this._value},n.prototype.writeRecon=function(t){var e=this._value;if(isFinite(e)&&e===Math.floor(e)&&-2147483648<=e&&e<=2147483647)return n.writeInteger(e,t);g.Text.writeIdent(String(e),t)},n.writeInteger=function(t,e){if(t<0&&(e.push(45),t=-t),t<10)e.push(48+t);else{for(var r=new Uint8Array(19),n=18;0!==t;)r[n]=t%10,t=Math.floor(t/10),n-=1;for(n+=1;n<19;)e.push(48+r[n]),n+=1}},n.prototype.compare=function(t){if(t instanceof n){var e=this._value,r=t._value;return e<r?-1:r<e?1:0}return t instanceof g.Field||t instanceof g.Record||t instanceof g.Data||t instanceof g.Text?1:-1},n.prototype.equals=function(t){return this===t||t instanceof n&&this._value===t._value},n.prototype.hashCode=function(){return h.mash(h.mix(950747444,h.hash(this._value)))},n.prototype.toString=function(){return this.toRecon()},n.valueOf=function(t){return 0===t?n.Zero:1===t?n.One:new n(t)},n.of=function(t){if(t instanceof n)return t;if("number"==typeof t)return n.valueOf(t);throw new TypeError(""+t)},n.Zero=new n(0),n.One=new n(1),n}(_);g.Num=z;var F=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.cond=function(t,e){return t=g.of(t),e=g.of(e),new g.CondExpr(this,t,e)},e.prototype.or=function(t){return t=g.of(t),new g.LorExpr(this,t)},e.prototype.and=function(t){return t=g.of(t),new g.LandExpr(this,t)},e.prototype.bor=function(t){return t=g.of(t),new g.BorExpr(this,t)},e.prototype.bxor=function(t){return t=g.of(t),new g.BxorExpr(this,t)},e.prototype.band=function(t){return t=g.of(t),new g.BandExpr(this,t)},e.prototype.lt=function(t){return t=g.of(t),new g.LtExpr(this,t)},e.prototype.le=function(t){return t=g.of(t),new g.LeExpr(this,t)},e.prototype.eq=function(t){return t=g.of(t),new g.EqExpr(this,t)},e.prototype.ne=function(t){return t=g.of(t),new g.NeExpr(this,t)},e.prototype.ge=function(t){return t=g.of(t),new g.GeExpr(this,t)},e.prototype.gt=function(t){return t=g.of(t),new g.GtExpr(this,t)},e.prototype.plus=function(t){return t=g.of(t),new g.AddExpr(this,t)},e.prototype.minus=function(t){return t=g.of(t),new g.SubExpr(this,t)},e.prototype.times=function(t){return t=g.of(t),new g.MulExpr(this,t)},e.prototype.divide=function(t){return t=g.of(t),new g.DivExpr(this,t)},e.prototype.modulo=function(t){return t=g.of(t),new g.ModExpr(this,t)},e.prototype.not=function(){return new g.LnotExpr(this)},e.prototype.bnot=function(){return new g.BnotExpr(this)},e.prototype.neg=function(){return new g.NegExpr(this)},e.prototype.pos=function(){return new g.PosExpr(this)},e.prototype.inv=function(){return new g.DivExpr(g.Num.One,this)},e.prototype.toAny=function(){return this},e}(_),j=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.evaluate=function(t){t=S.fromAny(t);var r=_.empty();return this.forSelected(t,function(t){var e=t.peek();e&&r.push(e)},this),r.isEmpty()?_.Absent:r.flattened()},e.prototype.update=function(t,e){return t=S.fromAny(t),this.mapSelected(t,function(t){return t.peek()||g.Absent},this)},e.prototype.remove=function(t){return t=S.fromAny(t),this.mapSelected(t,function(t){return g.Absent},this)},e.prototype.get=function(t){return t=_.of(t),this.andThen(new N(t))},e.prototype.getAttr=function(t){return t=g.Text.of(t),this.andThen(new W(t))},e.prototype.getItem=function(t){return t=g.Num.of(t),this.andThen(new H(t))},e.prototype.keys=function(){return this.andThen(e.Keys)},e.prototype.children=function(){return this.andThen(e.Children)},e.prototype.descendants=function(){return this.andThen(e.Descendants)},e.prototype.invoke=function(t){return new g.InvokeExpr(this,t)},e.prototype.filter=function(t){return 0===arguments.length?new J(this):(t=g.of(t),this.andThen(t.filter()))},Object.defineProperty(e.prototype,"precedence",{get:function(){return 10},enumerable:!0,configurable:!0}),e.prototype.writeRecon=function(t){this.writeThen(t)},e.prototype.compare=function(t){return t instanceof e?0:t instanceof g.Func||t instanceof g.Expr||t===_.Extant||t===_.Absent?-1:1},e.prototype.toString=function(){return this.toRecon()},e.literal=function(t){return(t=g.of(t))instanceof e||(t=new K(t)),t},e.get=function(t){return t=_.of(t),new N(t,!0)},e.getAttr=function(t){return t=g.Text.of(t),new W(t,!0)},e.getItem=function(t){return t=g.Num.of(t),new H(t)},e.Identity=void 0,e.Keys=void 0,e.Children=void 0,e.Descendants=void 0,e}(g.DynamicValue=F),L=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.forSelected=function(t,e,r){var n;if(!t.isEmpty()){var i=t.pop(),o=i.evaluate(t);t.push(o),n=e.call(r,t),t.replace(i)}return n},e.prototype.mapSelected=function(t,e,r){return e.call(r,t)},e.prototype.substitute=function(t){return(t=S.fromAny(t)).item().substitute(t)},e.prototype.get=function(t){return t=_.of(t),this.andThen(new N(t,!0))},e.prototype.getAttr=function(t){return t=g.Text.of(t),this.andThen(new W(t,!0))},e.prototype.andThen=function(t){return t},e.prototype.writeRecon=function(t){},e.prototype.writeThen=function(t){},e.prototype.toRecon=function(){return""},e.prototype.clone=function(){return this},e.prototype.equals=function(t){return t instanceof e},e.prototype.hashCode=function(){return 2996637180},e}(g.Selector=j);j.Identity=new L,g.IdentitySelector=L;var K=function(n){function i(t,e){void 0===e&&(e=j.Identity);var r=n.call(this)||this;return r._item=t.commit(),r.then=e,r}return c(i,n),i.prototype.forSelected=function(t,e,r){var n;if(!t.isEmpty()){var i=this._item.evaluate(t);i.isDefined()&&(t.push(i),n=this.then.forSelected(t,e,r),t.pop())}return n},i.prototype.mapSelected=function(t,e,r){if(!t.isEmpty()){var n=this._item.substitute(t);return n.isDefined()&&(t.push(n),n=this.then.mapSelected(t,e,r),t.pop()),t.item()}return g.Absent},i.prototype.substitute=function(t){t=S.fromAny(t);var e=this._item.substitute(t),r=this.then.substitute(t);return r instanceof j||(r=this.then),new i(e,r)},i.prototype.andThen=function(t){return new i(this._item,this.then.andThen(t))},Object.defineProperty(i.prototype,"precedence",{get:function(){return this._item.precedence},enumerable:!0,configurable:!0}),i.prototype.writeRecon=function(t){this._item.precedence<this.then.precedence?(t.push(40),this._item.writeRecon(t),t.push(41)):this._item.writeRecon(t),this.then.writeThen(t)},i.prototype.writeThen=function(t){},i.prototype.clone=function(){return new i(this._item.clone(),this.then.clone())},i.prototype.equals=function(t){return this===t||t instanceof i&&(this._item.equals(t._item)&&this.then.equals(t.then))},i.prototype.hashCode=function(){return h.mash(h.mix(h.mix(2538907887,this._item.hashCode()),this.then.hashCode()))},i}(j);g.LiteralSelector=K;var N=function(i){function s(t,e,r){void 0===e&&(e=!1),void 0===r&&(r=j.Identity);var n=i.call(this)||this;return n._key=t.commit(),n._top=e,n.then=r,n}return c(s,i),s.prototype.forSelected=function(t,e,r){for(var n=this._key.evaluate(t).toValue(),i=t.size-1;0<=i;i-=1){var o=t.getItem(i).toValue();if(o instanceof g.Record){var s=o.get(n);if(s.isDefined()){t.push(s);var u=this.then.forSelected(t,e,r);return t.pop(),u}}}},s.prototype.mapSelected=function(t,e,r){var n=this._key.substitute(t).toValue();if(!t.isEmpty()){var i=t.item().toValue();if(i instanceof g.Record){var o=i.get(n);t.push(o);var s=this.then.mapSelected(t,e,r);t.pop(),s.isDefined()?i.set(this._key,s.toValue()):i.delete(this._key)}return t.item()}return g.Absent},s.prototype.substitute=function(t){t=S.fromAny(t);for(var e=this._key.evaluate(t).toValue(),r=t.size-1;0<=r;r-=1){var n=t.getItem(r).toValue();if(n instanceof g.Record){var i=n.get(e);if(i.isDefined())return i.substitute(t)}}var o=this.then.substitute(t);return o instanceof j||(o=this.then),new s(this._key,this._top,o)},s.prototype.andThen=function(t){return new s(this._key,this._top,this.then.andThen(t))},s.prototype.writeRecon=function(t){t.push(36),this._key instanceof g.Record?(t.push(123),this._key.writeReconBlock(t),t.push(125)):this._key.writeRecon(t),this.then.writeThen(t)},s.prototype.writeThen=function(t){t.push(46),this._key instanceof g.Record?(t.push(123),this._key.writeReconBlock(t),t.push(125)):this._key.writeRecon(t),this.then.writeThen(t)},s.prototype.clone=function(){return new s(this._key.clone(),this._top,this.then.clone())},s.prototype.equals=function(t){return this===t||t instanceof s&&(this._key.equals(t._key)&&this._top===t._top&&this.then.equals(t.then))},s.prototype.hashCode=function(){return h.mash(h.mix(h.mix(h.mix(3761108264,this._key.hashCode()),this._top?1:0),this.then.hashCode()))},s}(j);g.GetSelector=N;var W=function(i){function n(t,e,r){void 0===e&&(e=!1),void 0===r&&(r=j.Identity);var n=i.call(this)||this;return n._key=t.commit(),n._top=e,n.then=r,n}return c(n,i),n.prototype.forSelected=function(t,e,r){for(var n=t.size-1;0<=n;n-=1){var i=t.getItem(n).toValue();if(i instanceof g.Record){var o=i.getAttr(this._key);if(o.isDefined()){t.push(o);var s=this.then.forSelected(t,e,r);return t.pop(),s}}}},n.prototype.mapSelected=function(t,e,r){if(!t.isEmpty()){var n=t.item().toValue();if(n instanceof g.Record){var i=n.getAttr(this._key);t.push(i);var o=this.then.mapSelected(t,e,r);t.pop(),o.isDefined()?n.setAttr(this._key,o.toValue()):n.delete(this._key)}return t.item()}return g.Absent},n.prototype.substitute=function(t){t=S.fromAny(t);var e=this._key.substitute(t).toValue();e instanceof B||(e=this._key);var r=this.then.substitute(t);return r instanceof j||(r=this.then),new n(e,this._top,r)},n.prototype.andThen=function(t){return new n(this._key,this._top,this.then.andThen(t))},n.prototype.writeRecon=function(t){t.push(36),t.push(64),this._key.writeRecon(t),this.then.writeThen(t)},n.prototype.writeThen=function(t){t.push(46),t.push(64),this._key.writeRecon(t),this.then.writeThen(t)},n.prototype.clone=function(){return new n(this._key.clone(),this._top,this.then.clone())},n.prototype.equals=function(t){return this===t||t instanceof n&&(this._key.equals(t._key)&&this._top===t._top&&this.then.equals(t.then))},n.prototype.hashCode=function(){return h.mash(h.mix(h.mix(h.mix(1576701278,this._key.hashCode()),this._top?1:0),this.then.hashCode()))},n}(j);g.GetAttrSelector=W;var H=function(n){function r(t,e){void 0===e&&(e=j.Identity);var r=n.call(this)||this;return r._index=t,r.then=e,r}return c(r,n),r.prototype.forSelected=function(t,e,r){if(!t.isEmpty()){var n=t.item().toValue(),i=this._index.numberValue();if(n instanceof g.Record&&i<n.length){var o=n.getItem(i);t.push(o);var s=this.then.forSelected(t,e,r);return t.pop(),s}}},r.prototype.mapSelected=function(t,e,r){if(!t.isEmpty()){var n=t.item().toValue(),i=this._index.numberValue();if(n instanceof g.Record&&i<n.length){var o=n.getItem(i);t.push(o);var s=this.then.mapSelected(t,e,r);t.pop(),s.isDefined()?n.setItem(i,s):n.splice(i,1)}return t.item()}return g.Absent},r.prototype.substitute=function(t){t=S.fromAny(t);var e=this.then.substitute(t);return e instanceof j||(e=this.then),new r(this._index,e)},r.prototype.andThen=function(t){return new r(this._index,this.then.andThen(t))},r.prototype.writeRecon=function(t){t.push(36),this.writeThen(t)},r.prototype.writeThen=function(t){t.push(35),this._index.writeRecon(t),this.then.writeThen(t)},r.prototype.clone=function(){return new r(this._index,this.then.clone())},r.prototype.equals=function(t){return this===t||t instanceof r&&(this._index.equals(t._index)&&this.then.equals(t.then))},r.prototype.hashCode=function(){return h.mash(h.mix(h.mix(2148128349,this._index.hashCode()),this.then.hashCode()))},r}(j);g.GetItemSelector=H;var G=function(r){function n(t){void 0===t&&(t=j.Identity);var e=r.call(this)||this;return e.then=t,e}return c(n,r),n.prototype.forSelected=function(r,n,i){var t;if(!r.isEmpty()){var e=r.pop();e instanceof g.Field?(r.push(e.key),t=this.then.forSelected(r,n,i),r.pop()):e instanceof g.Record&&(t=e.forEach(function(t){var e;return t instanceof g.Field&&(r.push(t.key),e=this.then.forSelected(r,n,i),r.pop()),e},this)),r.push(e)}return t},n.prototype.mapSelected=function(t,e,r){if(!t.isEmpty()){var n=t.pop();if(n instanceof g.Field){var i=n.key;t.push(i);var o=this.then.mapSelected(t,e,r);t.pop(),o.isDefined()&&o instanceof g.Value?o!==i&&(n=n instanceof g.Attr&&o instanceof g.Text?g.Attr.of(o,n.value):g.Slot.of(o,n.value)):n=g.Absent}else if(n instanceof g.Record)for(var s=n.iterator();s.hasNext();){var u=s.next().value;if(u instanceof g.Field){i=u.key;t.push(i);o=this.then.mapSelected(t,e,r);t.pop(),o.isDefined()&&o instanceof g.Value?o!==i&&(u instanceof g.Attr&&o instanceof g.Text?s.set(g.Attr.of(o,u.value)):s.set(g.Slot.of(o,u.value))):s.delete()}}return t.push(n),n}return g.Absent},n.prototype.substitute=function(t){t=S.fromAny(t);var e=this.then.substitute(t);return e instanceof j||(e=this.then),new n(e)},n.prototype.andThen=function(t){return new n(this.then.andThen(t))},n.prototype.writeRecon=function(t){t.push(36),t.push(42),t.push(58),this.then.writeThen(t)},n.prototype.writeThen=function(t){t.push(46),t.push(42),t.push(58),this.then.writeThen(t)},n.prototype.clone=function(){return new n(this.then.clone())},n.prototype.equals=function(t){return this===t||t instanceof n&&this.then.equals(t.then)},n.prototype.hashCode=function(){return h.mash(h.mix(2698220346,this.then.hashCode()))},n}(j);j.Keys=new G,g.KeysSelector=G;var $=function(r){function n(t){void 0===t&&(t=j.Identity);var e=r.call(this)||this;return e.then=t,e}return c(n,r),n.prototype.forSelected=function(r,n,i){var t;if(!r.isEmpty()){var e=r.pop();e.toValue()instanceof g.Record&&(t=e.toValue().forEach(function(t){r.push(t);var e=this.then.forSelected(r,n,i);return r.pop(),e},this)),r.push(e)}return t},n.prototype.mapSelected=function(t,e,r){if(!t.isEmpty()){var n=t.pop();if(n.toValue()instanceof g.Record)for(var i=n.toValue().iterator();i.hasNext();){var o=i.next().value;t.push(o);var s=this.then.mapSelected(t,e,r);t.pop(),s.isDefined()?s!==o&&i.set(s):i.delete()}return t.push(n),n}return g.Absent},n.prototype.substitute=function(t){t=S.fromAny(t);var e=this.then.substitute(t);return e instanceof j||(e=this.then),new n(e)},n.prototype.andThen=function(t){return new n(this.then.andThen(t))},n.prototype.writeRecon=function(t){t.push(36),t.push(42),this.then.writeThen(t)},n.prototype.writeThen=function(t){t.push(46),t.push(42),this.then.writeThen(t)},n.prototype.clone=function(){return new n(this.then.clone())},n.prototype.equals=function(t){return this===t||t instanceof n&&this.then.equals(t.then)},n.prototype.hashCode=function(){return h.mash(h.mix(41095964,this.then.hashCode()))},n}(j);j.Children=new $,g.ChildrenSelector=$;var Q=function(r){function n(t){void 0===t&&(t=j.Identity);var e=r.call(this)||this;return e.then=t,e}return c(n,r),n.prototype.forSelected=function(r,n,i){var t;if(!r.isEmpty()){var e=r.pop();e.toValue()instanceof g.Record&&(t=e.toValue().forEach(function(t){r.push(t);var e=this.then.forSelected(r,n,i);return void 0===e&&this.forSelected(r,n,i),r.pop(),e},this)),r.push(e)}return t},n.prototype.mapSelected=function(t,e,r){if(!t.isEmpty()){var n=t.pop();if(n.toValue()instanceof g.Record)for(var i=n.toValue().iterator();i.hasNext();){var o=i.next().value;t.push(o);var s=this.then.mapSelected(t,e,r);s.isDefined()&&(s=this.mapSelected(t,e,r)),t.pop(),s.isDefined()?s!==o&&i.set(s):i.delete()}return t.push(n),n}return g.Absent},n.prototype.substitute=function(t){t=S.fromAny(t);var e=this.then.substitute(t);return e instanceof j||(e=this.then),new n(e)},n.prototype.andThen=function(t){return new n(this.then.andThen(t))},n.prototype.writeRecon=function(t){t.push(36),t.push(42),t.push(42),this.then.writeThen(t)},n.prototype.writeThen=function(t){t.push(46),t.push(42),t.push(42),this.then.writeThen(t)},n.prototype.clone=function(){return new n(this.then.clone())},n.prototype.equals=function(t){return this===t||t instanceof n&&this.then.equals(t.then)},n.prototype.hashCode=function(){return h.mash(h.mix(693096588,this.then.hashCode()))},n}(j);j.Descendants=new Q,g.DescendantsSelector=Q;var J=function(n){function i(t,e){void 0===e&&(e=j.Identity);var r=n.call(this)||this;return r.predicate=t,r.then=e,r}return c(i,n),i.prototype.forSelected=function(t,e,r){var n;return t.isEmpty()||this.filterSelected(t)&&(n=this.then.forSelected(t,e,r)),n},i.prototype.mapSelected=function(t,e,r){return t.isEmpty()?g.Absent:this.filterSelected(t)?this.then.mapSelected(t,e,r):t.item()},i.prototype.filterSelected=function(t){return void 0!==this.predicate.forSelected(t,this.selected,this)},i.prototype.selected=function(t){return null},i.prototype.filter=function(t){return 0===arguments.length?this:(t=g.of(t),this.andThen(t.filter()))},i.prototype.substitute=function(t){t=S.fromAny(t);var e=this.predicate.substitute(t);e instanceof j||(e=this.predicate);var r=this.then.substitute(t);return r instanceof j||(r=this.then),new i(e,r)},i.prototype.andThen=function(t){return new i(this.predicate,this.then.andThen(t))},i.prototype.writeRecon=function(t){t.push(36),this.writeThen(t)},i.prototype.writeThen=function(t){t.push(91),this.predicate.writeRecon(t),t.push(93),this.then.writeThen(t)},i.prototype.clone=function(){return new i(this.predicate.clone(),this.then.clone())},i.prototype.equals=function(t){return this===t||t instanceof i&&(this.predicate.equals(t.predicate)&&this.then.equals(t.then))},i.prototype.hashCode=function(){return h.mash(h.mix(h.mix(982049112,this.predicate.hashCode()),this.then.hashCode()))},i}(j);g.FilterSelector=J;var Z=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return c(r,t),r.prototype.partialInvoke=function(t,e,r){},r.prototype.toAny=function(){return this},r.prototype.writeRecon=function(t){},r.prototype.toRecon=function(){return""},r.prototype.toReconBlock=function(){return""},r.prototype.compare=function(t){if(t instanceof r){var e=this.name.localeCompare(t.name);return e<0?-1:0<e?1:0}return t instanceof g.Expr||t===_.Extant||t===_.Absent?-1:1},r.prototype.equals=function(t){return t instanceof r&&this.name===t.name},r.prototype.hashCode=function(){return h.mash(h.mix(3046025140,h.hash(this.name)))},r.prototype.toString=function(){return"[Func "+this.name+"]"},r.Eager=void 0,r.Abs=void 0,r.Ceil=void 0,r.Floor=void 0,r.Round=void 0,r.Pow=void 0,r.Sqrt=void 0,r.Max=void 0,r.Min=void 0,r.Count=void 0,r.Random=void 0,r.Rate=void 0,r.Percent=void 0,r.Number=void 0,r.String=void 0,r.ConsoleLog=void 0,r.NumberFormat=void 0,r}(_),X=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"eager"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){return t.evaluate(e)},e.prototype.partialInvoke=function(t,e,r){return t.evaluate(e)},e}(g.Func=Z);Z.Eager=new X;var Y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"abs"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){var r=(t=t.evaluate(e).toValue()).numberValue();return void 0!==r?g.Num.valueOf(Math.abs(r)):_.Absent},e}(Z);Z.Abs=new Y;var tt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"ceil"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){var r=(t=t.evaluate(e).toValue()).numberValue();return void 0!==r?g.Num.valueOf(Math.ceil(r)):_.Absent},e}(Z);Z.Ceil=new tt;var et=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"floor"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){var r=(t=t.evaluate(e).toValue()).numberValue();return void 0!==r?g.Num.valueOf(Math.floor(r)):_.Absent},e}(Z);Z.Floor=new et;var rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"round"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){var r=(t=t.evaluate(e).toValue()).numberValue();return void 0!==r?g.Num.valueOf(Math.round(r)):_.Absent},e}(Z);Z.Round=new rt;var nt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"pow"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e,r){var n=t.getItem(0).evaluate(e).numberValue(),i=t.getItem(1).evaluate(e).numberValue();return void 0!==n&&void 0!==i?g.Num.valueOf(Math.pow(n,i)):_.Absent},e}(Z);Z.Pow=new nt;var it=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"sqrt"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){var r=(t=t.evaluate(e).toValue()).numberValue();return void 0!==r?g.Num.valueOf(Math.sqrt(r)):_.Absent},e}(Z);Z.Sqrt=new it;var ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"max"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e,r){var n,i;return 2<=t.length?(n=t.getItem(0).evaluate(e).numberValue(),i=t.getItem(1).evaluate(e).numberValue()):n=t.evaluate(e).numberValue(),void 0!==n&&isFinite(n)&&(r.state=r.state||{},void 0===i&&(i=Math.max(n,r.state.nax||n),r.state.nax=i),void 0!==i&&isFinite(i))?g.Num.valueOf(Math.max(n,i)):_.Absent},e.prototype.partialInvoke=function(t,e,r){if(1===t.length)return t=t.evaluate(e).toValue(),this.invoke(t,e,r)},e}(Z);Z.Max=new ot;var st=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"min"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e,r){var n,i;return 2<=t.length?(n=t.getItem(0).evaluate(e).numberValue(),i=t.getItem(1).evaluate(e).numberValue()):n=t.evaluate(e).numberValue(),void 0!==n&&isFinite(n)&&(r.state=r.state||{},void 0===i&&(i=Math.min(n,r.state.min||n),r.state.min=i),void 0!==i&&isFinite(i))?g.Num.valueOf(Math.min(n,i)):_.Absent},e.prototype.partialInvoke=function(t,e,r){if(1===t.length)return t=t.evaluate(e).toValue(),this.invoke(t,e,r)},e}(Z);Z.Min=new st;var ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"count"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e,r){if(t instanceof j){var n=0;return t.forSelected(e,function(t){n+=1},this),g.Num.valueOf(n)}return t instanceof O?g.Num.valueOf(t.length):_.Absent},e}(Z);Z.Count=new ut;var at=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"percent"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e,r){var n,i;return 2<=t.length?(n=t.getItem(0).evaluate(e).numberValue(),i=t.getItem(1).evaluate(e).numberValue()):n=t.evaluate(e).numberValue(),void 0!==n&&isFinite(n)&&(r.state=r.state||{},void 0===i&&(i=Math.max(n,r.state.total||n),r.state.total=i),0!==i&&isFinite(i))?g.Text.valueOf(Math.round(100*n/i)+"%"):_.Absent},e.prototype.partialInvoke=function(t,e,r){if(1===t.length)return t=t.evaluate(e).toValue(),this.invoke(t,e,r)},e}(Z);Z.Percent=new at;var pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"random"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){var r=1<=t.length?t.getItem(0).evaluate(e).numberValue(0):0,n=2<=t.length?t.getItem(1).evaluate(e).numberValue(r+1):r+1,i=r+Math.random()*(n-r);return g.Num.valueOf(i)},e}(Z);Z.Random=new pt;var ht=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"rate"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e,r){var n,i;if(2<=t.length?(n=t.getItem(0).evaluate(e).numberValue(),i=t.getItem(1).evaluate(e).numberValue()):n=t.evaluate(e).numberValue(),void 0!==n&&isFinite(n))if(r.state=r.state||{},void 0===i&&(i=1e3),void 0===r.state.t0)r.state.t0=Date.now(),r.state.v0=n;else{var o=Date.now(),s=o-r.state.t0;if(i<s&&o>r.state.t0||2*i<s){var u=n-r.state.v0;r.state.t0=o,r.state.v0=n,r.state.dt=s,r.state.dv=u}if(void 0!==r.state.dt){var a=i*r.state.dv/(r.state.dt||1);return g.Num.valueOf(a)}}return _.Absent},e.prototype.partialInvoke=function(t,e,r){return t=t.evaluate(e).toValue(),this.invoke(t,e,r)},e}(Z);Z.Rate=new ht;var ft=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"number"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){if((t=t.evaluate(e).toValue())instanceof g.Num)return t;var r=t.numberValue();return void 0!==r?g.Num.valueOf(r):_.Absent},e}(Z);Z.Number=new ft;var ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"string"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){if((t=t.evaluate(e).toValue())instanceof g.Text)return t;var r=t.stringValue();return void 0!==r?g.Text.valueOf(r):_.Absent},e}(Z);Z.String=new ct;var lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"console.log"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){return t=t.evaluate(e).toValue(),console.log(t.toAny()),g.Absent},e}(Z);Z.ConsoleLog=new lt;var dt=function(t){function e(){return t.call(this)||this}return c(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"numberFormat"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){var r,n;if(2<=t.length?(r=t.getItem(0).evaluate(e).numberValue(),n=t.getItem(1).evaluate(e).toValue().toAny()):r=t.evaluate(e).numberValue(),void 0===r)return _.Absent;switch(n.type){case"any":return this.anyFormat(r,n);case"prefix":return this.prefixFormat(r,n);case"digits":return this.digitsFormat(r,n);default:return this.numberCommas(r,n)}},e.prototype.fixValue=function(t,e){if(!e||e&&!e.decimal)return t;var r=Math.pow(10,e.decimal);return(e.precision?Math.round(t*r)/r:+t).toFixed(e.decimal)},e.prototype.numberCommas=function(t,e){var r=this.fixValue(t,e).toString().split(".");return r[0]=r[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),g.Text.valueOf(r.join("."))},e.prototype.anyFormat=function(t,e){var r=this.fixValue(t,e);return"string"==typeof r?g.Text.valueOf(r):g.Num.valueOf(r)},e.prototype.prefixFormat=function(t,e){var r=e&&e.decimal?e.decimal:0,n=t.toExponential(r+1).split(/e/),i=+n[0],o=+n[1],s=Math.floor(o/3),u=+(i*Math.pow(10,o-3*s)).toFixed(r);return g.Text.valueOf(u+["p","n","u","m","","k","M","G","T"][s+4])},e.prototype.digitsFormat=function(t,e){for(var r=e&&e.digits?e.digits:1,n=""+Math.round(t);n.length<r;)n="0"+n;return g.Text.valueOf(n)},e}(Z);Z.NumberFormat=new dt,g.GlobalScope=_.empty().slot("eager",Z.Eager).slot("abs",Z.Abs).slot("ceil",Z.Ceil).slot("floor",Z.Floor).slot("round",Z.Round).slot("pow",Z.Pow).slot("sqrt",Z.Sqrt).slot("max",Z.Max).slot("min",Z.Min).slot("count",Z.Count).slot("random",Z.Random).slot("rate",Z.Rate).slot("percent",Z.Percent).slot("number",Z.Number).slot("string",Z.String).slot("console",_.empty().slot("log",Z.ConsoleLog)).slot("log",Z.ConsoleLog).slot("numberFormat",Z.NumberFormat).commit(),S.GlobalScope=g.GlobalScope;var yt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.compare=function(t){return t instanceof e?0:t===_.Extant||t===_.Absent?-1:1},e.prototype.toString=function(){return this.toRecon()},e}(F),vt=function(n){function t(t,e){var r=n.call(this)||this;return r.lhs=t.commit(),r.rhs=e.commit(),r}return c(t,n),t.prototype.writeRecon=function(t){this.lhs.precedence<this.precedence?(t.push(40),this.lhs.writeRecon(t),t.push(41)):this.lhs.writeRecon(t),t.push(32),g.Text.writeIdent(this.operator,t),t.push(32),this.rhs.precedence<this.precedence?(t.push(40),this.rhs.writeRecon(t),t.push(41)):this.rhs.writeRecon(t)},t}(g.Expr=yt),mt=function(r){function t(t){var e=r.call(this)||this;return e.rhs=t.commit(),e}return c(t,r),t.prototype.writeRecon=function(t){g.Text.writeIdent(this.operator,t),this.rhs.precedence<this.precedence?(t.push(40),this.rhs.writeRecon(t),t.push(41)):this.rhs.writeRecon(t)},t}(yt),gt=function(i){function e(t,e,r){var n=i.call(this)||this;return n.predExpr=t.commit(),n.thenExpr=e.commit(),n.elseExpr=r.commit(),n}return c(e,i),Object.defineProperty(e.prototype,"precedence",{get:function(){return 1},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){return t=S.fromAny(t),this.predExpr.evaluate(t).isDefined()?this.thenExpr.evaluate(t):this.elseExpr.evaluate(t)},e.prototype.substitute=function(t){return t=S.fromAny(t),new e(this.predExpr.substitute(t).toValue(),this.thenExpr.substitute(t).toValue(),this.elseExpr.substitute(t).toValue())},e.prototype.writeRecon=function(t){this.predExpr instanceof e?(t.push(40),this.predExpr.writeRecon(t),t.push(41)):this.predExpr.writeRecon(t),t.push(32),t.push(63),t.push(32),this.thenExpr.writeRecon(t),t.push(32),t.push(58),t.push(32),this.elseExpr.writeRecon(t)},e.prototype.clone=function(){return new e(this.predExpr.clone(),this.thenExpr.clone(),this.elseExpr.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.predExpr.equals(t.predExpr)&&this.thenExpr.equals(t.thenExpr)&&this.elseExpr.equals(t.elseExpr))},e.prototype.hashCode=function(){return h.mash(h.mix(h.mix(h.mix(2686268657,this.predExpr.hashCode()),this.thenExpr.hashCode()),this.elseExpr.hashCode()))},e}(yt);g.CondExpr=gt;var _t=function(r){function e(t,e){return r.call(this,t,e)||this}return c(e,r),Object.defineProperty(e.prototype,"operator",{get:function(){return"||"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 2},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=S.fromAny(t);var e=this.lhs.evaluate(t);return e.isDefined()?e:this.rhs.evaluate(t)},e.prototype.substitute=function(t){t=S.fromAny(t);var e=this.lhs.substitute(t),r=this.rhs.substitute(t);return e.or(r)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return h.mash(h.mix(h.mix(2753931048,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);g.LorExpr=_t;var bt=function(r){function e(t,e){return r.call(this,t,e)||this}return c(e,r),Object.defineProperty(e.prototype,"operator",{get:function(){return"&&"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 3},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=S.fromAny(t);var e=this.lhs.evaluate(t);return e.isDefined()?this.rhs.evaluate(t):e},e.prototype.substitute=function(t){t=S.fromAny(t);var e=this.lhs.substitute(t),r=this.rhs.substitute(t);return e.and(r)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return h.mash(h.mix(h.mix(3033319353,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);g.LandExpr=bt;var Et=function(r){function e(t,e){return r.call(this,t,e)||this}return c(e,r),Object.defineProperty(e.prototype,"operator",{get:function(){return"|"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 4},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=S.fromAny(t);var e=this.lhs.evaluate(t),r=this.rhs.evaluate(t);return e.bor(r)},e.prototype.substitute=function(t){t=S.fromAny(t);var e=this.lhs.substitute(t),r=this.rhs.substitute(t);return e.bor(r)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return h.mash(h.mix(h.mix(2951299239,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);g.BorExpr=Et;var wt=function(r){function e(t,e){return r.call(this,t,e)||this}return c(e,r),Object.defineProperty(e.prototype,"operator",{get:function(){return"^"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 5},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=S.fromAny(t);var e=this.lhs.evaluate(t),r=this.rhs.evaluate(t);return e.bxor(r)},e.prototype.substitute=function(t){t=S.fromAny(t);var e=this.lhs.substitute(t),r=this.rhs.substitute(t);return e.bxor(r)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return h.mash(h.mix(h.mix(2525026627,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);g.BxorExpr=wt;var xt=function(r){function e(t,e){return r.call(this,t,e)||this}return c(e,r),Object.defineProperty(e.prototype,"operator",{get:function(){return"&"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 6},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=S.fromAny(t);var e=this.lhs.evaluate(t),r=this.rhs.evaluate(t);return e.band(r)},e.prototype.substitute=function(t){t=S.fromAny(t);var e=this.lhs.substitute(t),r=this.rhs.substitute(t);return e.band(r)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return h.mash(h.mix(h.mix(1749678032,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);g.BandExpr=xt;var At=function(r){function e(t,e){return r.call(this,t,e)||this}return c(e,r),Object.defineProperty(e.prototype,"operator",{get:function(){return"<"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=S.fromAny(t);var e=this.lhs.evaluate(t),r=this.rhs.evaluate(t);return e.lt(r)},e.prototype.substitute=function(t){t=S.fromAny(t);var e=this.lhs.substitute(t),r=this.rhs.substitute(t);return e.lt(r)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return h.mash(h.mix(h.mix(967086719,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);g.LtExpr=At;var Ct=function(r){function e(t,e){return r.call(this,t,e)||this}return c(e,r),Object.defineProperty(e.prototype,"operator",{get:function(){return"<="},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=S.fromAny(t);var e=this.lhs.evaluate(t),r=this.rhs.evaluate(t);return e.le(r)},e.prototype.substitute=function(t){t=S.fromAny(t);var e=this.lhs.substitute(t),r=this.rhs.substitute(t);return e.le(r)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return h.mash(h.mix(h.mix(1658676620,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);g.LeExpr=Ct;var Dt=function(r){function e(t,e){return r.call(this,t,e)||this}return c(e,r),Object.defineProperty(e.prototype,"operator",{get:function(){return"=="},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=S.fromAny(t);var e=this.lhs.evaluate(t),r=this.rhs.evaluate(t);return e.eq(r)},e.prototype.substitute=function(t){t=S.fromAny(t);var e=this.lhs.substitute(t),r=this.rhs.substitute(t);return e.eq(r)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return h.mash(h.mix(h.mix(151025720,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);g.EqExpr=Dt;var kt=function(r){function e(t,e){return r.call(this,t,e)||this}return c(e,r),Object.defineProperty(e.prototype,"operator",{get:function(){return"!="},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=S.fromAny(t);var e=this.lhs.evaluate(t),r=this.rhs.evaluate(t);return e.ne(r)},e.prototype.substitute=function(t){t=S.fromAny(t);var e=this.lhs.substitute(t),r=this.rhs.substitute(t);return e.ne(r)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return h.mash(h.mix(h.mix(3400743354,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);g.NeExpr=kt;var St=function(r){function e(t,e){return r.call(this,t,e)||this}return c(e,r),Object.defineProperty(e.prototype,"operator",{get:function(){return">="},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=S.fromAny(t);var e=this.lhs.evaluate(t),r=this.rhs.evaluate(t);return e.ge(r)},e.prototype.substitute=function(t){t=S.fromAny(t);var e=this.lhs.substitute(t),r=this.rhs.substitute(t);return e.ge(r)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return h.mash(h.mix(h.mix(553703941,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);g.GeExpr=St;var Pt=function(r){function e(t,e){return r.call(this,t,e)||this}return c(e,r),Object.defineProperty(e.prototype,"operator",{get:function(){return">"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=S.fromAny(t);var e=this.lhs.evaluate(t),r=this.rhs.evaluate(t);return e.gt(r)},e.prototype.substitute=function(t){t=S.fromAny(t);var e=this.lhs.substitute(t),r=this.rhs.substitute(t);return e.gt(r)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return h.mash(h.mix(h.mix(2388803765,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);g.GtExpr=Pt;var Mt=function(r){function e(t,e){return r.call(this,t,e)||this}return c(e,r),Object.defineProperty(e.prototype,"operator",{get:function(){return"+"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 7},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=S.fromAny(t);var e=this.lhs.evaluate(t),r=this.rhs.evaluate(t);return e.plus(r)},e.prototype.substitute=function(t){t=S.fromAny(t);var e=this.lhs.substitute(t),r=this.rhs.substitute(t);return e.plus(r)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return h.mash(h.mix(h.mix(3143282824,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);g.AddExpr=Mt;var It=function(r){function e(t,e){return r.call(this,t,e)||this}return c(e,r),Object.defineProperty(e.prototype,"operator",{get:function(){return"-"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 7},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=S.fromAny(t);var e=this.lhs.evaluate(t),r=this.rhs.evaluate(t);return e.minus(r)},e.prototype.substitute=function(t){t=S.fromAny(t);var e=this.lhs.substitute(t),r=this.rhs.substitute(t);return e.minus(r)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return h.mash(h.mix(h.mix(2002724678,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);g.SubExpr=It;var Vt=function(r){function e(t,e){return r.call(this,t,e)||this}return c(e,r),Object.defineProperty(e.prototype,"operator",{get:function(){return"*"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 8},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=S.fromAny(t);var e=this.lhs.evaluate(t),r=this.rhs.evaluate(t);return e.times(r)},e.prototype.substitute=function(t){t=S.fromAny(t);var e=this.lhs.substitute(t),r=this.rhs.substitute(t);return e.times(r)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return h.mash(h.mix(h.mix(3516846473,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);g.MulExpr=Vt;var Ot=function(r){function e(t,e){return r.call(this,t,e)||this}return c(e,r),Object.defineProperty(e.prototype,"operator",{get:function(){return"/"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 8},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=S.fromAny(t);var e=this.lhs.evaluate(t),r=this.rhs.evaluate(t);return e.divide(r)},e.prototype.substitute=function(t){t=S.fromAny(t);var e=this.lhs.substitute(t),r=this.rhs.substitute(t);return e.divide(r)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return h.mash(h.mix(h.mix(588817478,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);g.DivExpr=Ot;var qt=function(r){function e(t,e){return r.call(this,t,e)||this}return c(e,r),Object.defineProperty(e.prototype,"operator",{get:function(){return"%"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 8},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=S.fromAny(t);var e=this.lhs.evaluate(t),r=this.rhs.evaluate(t);return e.modulo(r)},e.prototype.substitute=function(t){t=S.fromAny(t);var e=this.lhs.substitute(t),r=this.rhs.substitute(t);return e.modulo(r)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return h.mash(h.mix(h.mix(1939882810,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);g.ModExpr=qt;var Tt=function(e){function r(t){return e.call(this,t)||this}return c(r,e),Object.defineProperty(r.prototype,"operator",{get:function(){return"!"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"precedence",{get:function(){return 9},enumerable:!0,configurable:!0}),r.prototype.evaluate=function(t){return t=S.fromAny(t),this.rhs.evaluate(t).not()},r.prototype.substitute=function(t){return t=S.fromAny(t),this.rhs.substitute(t).not()},r.prototype.clone=function(){return new r(this.rhs.clone())},r.prototype.equals=function(t){return this===t||t instanceof r&&this.rhs.equals(t.rhs)},r.prototype.hashCode=function(){return h.mash(h.mix(1585838768,this.rhs.hashCode()))},r}(mt);g.LnotExpr=Tt;var Rt=function(e){function r(t){return e.call(this,t)||this}return c(r,e),Object.defineProperty(r.prototype,"operator",{get:function(){return"~"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"precedence",{get:function(){return 9},enumerable:!0,configurable:!0}),r.prototype.evaluate=function(t){return t=S.fromAny(t),this.rhs.evaluate(t).bnot()},r.prototype.substitute=function(t){return t=S.fromAny(t),this.rhs.substitute(t).bnot()},r.prototype.clone=function(){return new r(this.rhs.clone())},r.prototype.equals=function(t){return this===t||t instanceof r&&this.rhs.equals(t.rhs)},r.prototype.hashCode=function(){return h.mash(h.mix(636533736,this.rhs.hashCode()))},r}(mt);g.BnotExpr=Rt;var Ut=function(e){function r(t){return e.call(this,t)||this}return c(r,e),Object.defineProperty(r.prototype,"operator",{get:function(){return"-"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"precedence",{get:function(){return 9},enumerable:!0,configurable:!0}),r.prototype.evaluate=function(t){return t=S.fromAny(t),this.rhs.evaluate(t).neg()},r.prototype.substitute=function(t){return t=S.fromAny(t),this.rhs.substitute(t).neg()},r.prototype.clone=function(){return new r(this.rhs.clone())},r.prototype.equals=function(t){return this===t||t instanceof r&&this.rhs.equals(t.rhs)},r.prototype.hashCode=function(){return h.mash(h.mix(542257997,this.rhs.hashCode()))},r}(mt);g.NegExpr=Ut;var Bt=function(e){function r(t){return e.call(this,t)||this}return c(r,e),Object.defineProperty(r.prototype,"operator",{get:function(){return"+"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"precedence",{get:function(){return 9},enumerable:!0,configurable:!0}),r.prototype.evaluate=function(t){return t=S.fromAny(t),this.rhs.evaluate(t).pos()},r.prototype.substitute=function(t){return t=S.fromAny(t),this.rhs.substitute(t).pos()},r.prototype.clone=function(){return new r(this.rhs.clone())},r.prototype.equals=function(t){return this===t||t instanceof r&&this.rhs.equals(t.rhs)},r.prototype.hashCode=function(){return h.mash(h.mix(3300928030,this.rhs.hashCode()))},r}(mt);g.PosExpr=Bt;var zt=function(n){function i(t,e){var r=n.call(this)||this;return r.func=t,r.args=e.commit(),r}return c(i,n),Object.defineProperty(i.prototype,"precedence",{get:function(){return 10},enumerable:!0,configurable:!0}),i.prototype.evaluate=function(t){t=S.fromAny(t);var e=this.func.evaluate(t);return e instanceof g.Func?e.invoke(this.args,t,this):_.Absent},i.prototype.substitute=function(t){t=S.fromAny(t);var e=this.func.evaluate(t);if(e instanceof g.Func){var r=e.partialInvoke(this.args,t,this);if(r)return r}var n=this.args.substitute(t).toValue();return new i(this.func,n)},i.prototype.writeRecon=function(t){this.func.writeRecon(t),t.push(40),this.args.writeReconBlock(t),t.push(41)},i.prototype.clone=function(){return new i(this.func.clone(),this.args.clone())},i.prototype.equals=function(t){return this===t||t instanceof i&&(this.func.equals(t.func)&&this.args.equals(t.args))},i.prototype.hashCode=function(){return h.mash(h.mix(h.mix(2719252876,this.func.hashCode()),this.args.hashCode()))},i}(yt);g.InvokeExpr=zt;var Ft=function(t){function e(){return t.call(this)||this}return c(e,t),e.prototype.isDefined=function(){return!1},e.prototype.isDistinct=function(){return!1},e.prototype.isEmpty=function(){return!0},e.prototype.concat=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=_.empty(),n=0,i=t.length;n<i;n+=1)t[n].forEach(function(t){r.push(t)});return r},e.prototype.withField=function(t,e){return _.empty(1).withField(t,e)},e.prototype.withAttr=function(t,e){return _.empty(1).withAttr(t,e)},e.prototype.withSlot=function(t,e){return _.empty(1).withSlot(t,e)},e.prototype.withItem=function(t){return _.empty(1).withItem(t)},e.prototype.forEach=function(t,e){},e.prototype.iterator=function(){return s.Empty},e.prototype.cond=function(t,e){return e=g.of(e)},e.prototype.or=function(t){return t=g.of(t)},e.prototype.and=function(t){return this},e.prototype.not=function(){return _.Extant},e.prototype.booleanValue=function(){return!1},e.prototype.toAny=function(){},e.prototype.valueOf=function(){},e.prototype.writeRecon=function(t){},e.prototype.toRecon=function(){return""},e.prototype.toReconBlock=function(){return""},e.prototype.compare=function(t){return t instanceof e?0:1},e.prototype.equals=function(t){return this===t},e.prototype.hashCode=function(){return 4156558542},e.prototype.toString=function(){return"absent"},e}(_);g.Absent=new Ft,_.Absent=g.Absent;var jt=function(){function t(t){this.buckets=new Array(t),this.gen4Hits=0,this.gen3Hits=0,this.gen2Hits=0,this.gen1Hits=0,this.misses=0}return t.prototype.get=function(t){if(0!==this.buckets.length){var e=Math.abs(t.hashCode())%this.buckets.length,r=this.buckets[e];if(r){var n=r.gen4Key;if(void 0!==n&&t.equals(n)){var i=r.gen4Val;if(void 0!==i)return this.gen4Hits+=1,r.gen4Weight++,i;r.gen4Key=void 0}var o=r.gen3Key;if(void 0!==o&&t.equals(o)){var s=r.gen3Val;if(void 0!==s)return this.gen3Hits+=1,r.gen3Weight++>r.gen4Weight&&(this.buckets[e]=new Lt(r.gen3Key,r.gen3Val,r.gen3Weight,r.gen4Key,r.gen4Val,r.gen4Weight,r.gen2Key,r.gen2Val,r.gen2Weight,r.gen1Key,r.gen1Val,r.gen1Weight)),s;r.gen3Key=void 0}var u=r.gen2Key;if(void 0!==u&&t.equals(u)){var a=r.gen2Val;if(void 0!==a)return this.gen2Hits+=1,r.gen2Weight++>r.gen3Weight&&(this.buckets[e]=new Lt(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen2Key,r.gen2Val,r.gen2Weight,r.gen3Key,r.gen3Val,r.gen3Weight,r.gen1Key,r.gen1Val,r.gen1Weight)),a;r.gen2Key=void 0}var p=r.gen1Key;if(void 0!==p&&t.equals(p)){var h=r.gen1Val;if(void 0!==h)return this.gen1Hits+=1,r.gen1Weight++>r.gen2Weight&&(this.buckets[e]=new Lt(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen3Key,r.gen3Val,r.gen3Weight,r.gen1Key,r.gen1Val,r.gen1Weight,r.gen2Key,r.gen2Val,r.gen2Weight)),h;r.gen1Key=void 0}this.misses+=1}}},t.prototype.set=function(t,e){if(0!==this.buckets.length){var r=Math.abs(t.hashCode())%this.buckets.length,n=this.buckets[r]||new Lt,i=n.gen4Key;if(void 0!==i&&t.equals(i)){var o=n.gen4Val;if(void 0!==o)return this.gen4Hits+=1,n.gen4Weight++,o;i=n.gen4Key=void 0}var s=n.gen3Key;if(void 0!==s&&t.equals(s)){var u=n.gen3Val;if(void 0!==u)return this.gen3Hits+=1,n.gen3Weight++>n.gen4Weight&&(this.buckets[r]=new Lt(n.gen3Key,n.gen3Val,n.gen3Weight,n.gen4Key,n.gen4Val,n.gen4Weight,n.gen2Key,n.gen2Val,n.gen2Weight,n.gen1Key,n.gen1Val,n.gen1Weight)),u;s=n.gen3Key=void 0}var a=n.gen2Key;if(void 0!==a&&t.equals(a)){var p=n.gen2Val;if(void 0!==p)return this.gen2Hits+=1,n.gen2Weight++>n.gen3Weight&&(this.buckets[r]=new Lt(n.gen4Key,n.gen4Val,n.gen4Weight,n.gen2Key,n.gen2Val,n.gen2Weight,n.gen3Key,n.gen3Val,n.gen3Weight,n.gen1Key,n.gen1Val,n.gen1Weight)),p;a=n.gen2Key=void 0}var h=n.gen1Key;if(void 0!==h&&t.equals(h)){var f=n.gen1Val;if(void 0!==f)return this.gen1Hits+=1,n.gen1Weight++>n.gen2Weight&&(this.buckets[r]=new Lt(n.gen4Key,n.gen4Val,n.gen4Weight,n.gen3Key,n.gen3Val,n.gen3Weight,n.gen1Key,n.gen1Val,n.gen1Weight,n.gen2Key,n.gen2Val,n.gen2Weight)),f;h=n.gen1Key=void 0}this.misses+=1,this.buckets[r]=null==i?new Lt(n.gen3Key,n.gen3Val,n.gen3Weight,n.gen2Key,n.gen2Val,n.gen2Weight,n.gen1Key,n.gen1Val,n.gen1Weight,t,e,1):null==s?new Lt(n.gen4Key,n.gen4Val,n.gen4Weight,n.gen2Key,n.gen2Val,n.gen2Weight,n.gen1Key,n.gen1Val,n.gen1Weight,t,e,1):null==a?new Lt(n.gen4Key,n.gen4Val,n.gen4Weight,n.gen3Key,n.gen3Val,n.gen3Weight,n.gen1Key,n.gen1Val,n.gen1Weight,t,e,1):null==h?new Lt(n.gen4Key,n.gen4Val,n.gen4Weight,n.gen3Key,n.gen3Val,n.gen3Weight,n.gen2Key,n.gen2Val,n.gen2Weight,t,e,1):new Lt(n.gen4Key,n.gen4Val,n.gen4Weight-1,n.gen3Key,n.gen3Val,n.gen3Weight-1,n.gen1Key,n.gen1Val,n.gen1Weight,t,e,1)}},t.prototype.delete=function(t){if(0!==this.buckets.length){var e=Math.abs(t.hashCode())%this.buckets.length,r=this.buckets[e];if(r){var n=r.gen4Key;if(void 0!==n&&t.equals(n)){var i=r.gen4Val;return this.buckets[e]=new Lt(r.gen3Key,r.gen3Val,r.gen3Weight,r.gen2Key,r.gen2Val,r.gen2Weight,r.gen1Key,r.gen1Val,r.gen1Weight,void 0,void 0,0),i}var o=r.gen3Key;if(void 0!==o&&t.equals(o)){var s=r.gen3Val;return this.buckets[e]=new Lt(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen2Key,r.gen2Val,r.gen2Weight,r.gen1Key,r.gen1Val,r.gen1Weight,void 0,void 0,0),s}var u=r.gen2Key;if(void 0!==u&&t.equals(u)){var a=r.gen2Val;return this.buckets[e]=new Lt(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen3Key,r.gen3Val,r.gen3Weight,r.gen1Key,r.gen1Val,r.gen1Weight,void 0,void 0,0),a}var p=r.gen1Key;if(void 0!==p&&t.equals(p)){var h=r.gen1Val;return this.buckets[e]=new Lt(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen3Key,r.gen3Val,r.gen3Weight,r.gen2Key,r.gen2Val,r.gen2Weight,void 0,void 0,0),h}}}},t.prototype.clear=function(){for(var t=0;t<this.buckets.length;t+=1)this.buckets[t]=void 0},Object.defineProperty(t.prototype,"hits",{get:function(){return this.gen4Hits+this.gen3Hits+this.gen2Hits+this.gen1Hits},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hitRatio",{get:function(){var t=this.hits;return t/(t+this.misses)},enumerable:!0,configurable:!0}),t.prototype.toString=function(){for(var t=this.hits,e="@cache(gen4Hits: "+this.gen4Hits+", gen3Hits: "+this.gen3Hits+", gen2Hits: "+this.gen2Hits+", gen1Hits: "+this.gen1Hits+", hits: "+t+", misses: "+this.misses+", hitRatio: "+t/(t+this.misses)+") {\n",r=0;r<this.buckets.length;r+=1){var n=this.buckets[r];e+="  "+(null!=n?n.toString():"null")+"\n"}return e+="}"},t}(),Lt=function(){function t(t,e,r,n,i,o,s,u,a,p,h,f){void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===f&&(f=0),this.gen4Key=t,this.gen4Val=e,this.gen4Weight=r,this.gen3Key=n,this.gen3Val=i,this.gen3Weight=o,this.gen2Key=s,this.gen2Val=u,this.gen2Weight=a,this.gen1Key=p,this.gen1Val=h,this.gen1Weight=f}return t.prototype.toString=function(){return"@bucket(gen4Key: "+this.gen4Key+"; gen4Val: "+this.gen4Val+"; gen4Weight: "+this.gen4Weight+"; gen3Key: "+this.gen3Key+"; gen3Val: "+this.gen3Val+"; gen3Weight: "+this.gen3Weight+"; gen24Key: "+this.gen2Key+"; gen24Val: "+this.gen2Val+"; gen24Weight: "+this.gen2Weight+"; gen1Key: "+this.gen1Key+"; gen1Val: "+this.gen1Val+"; gen1Weight: "+this.gen1Weight+")"},t}(),Kt=function(u){function h(t,e,r,n,i,o){var s=u.call(this)||this;return s.schemeParser=t,s.authorityParser=e,s.pathParser=r,s.queryParser=n,s.fragmentParser=i,s.step=o,s}return c(h,u),h.prototype.feed=function(t){return h.parse(t,this.schemeParser,this.authorityParser,this.pathParser,this.queryParser,this.fragmentParser,this.step)},h.parse=function(t,e,r,n,i,o,s){void 0===s&&(s=1);var u=0;if(1===s)if(t.isEmpty())t.isDone()&&(s=3);else{for(var a=t.clone();!a.isEmpty()&&(u=a.head(),te.isSchemeChar(u));)a.step();s=a.isEmpty()||58!==u?3:2}if(2===s){for(e||(e=Nt.parse(t));e.isCont()&&(!t.isEmpty()||t.isDone());)e=e.feed(t);if(e.isDone())if(t.isEmpty()||58!==t.head()){if(!t.isEmpty())return b.expected("':'",t);if(t.isDone())return b.unexpected(t)}else t.step(),s=3;else if(e.isError())return e.asError()}if(3===s)if(t.isEmpty()){if(t.isDone())return b.done(te.of(e&&e.bind()))}else 47===(u=t.head())?(t.step(),s=4):63===u?(t.step(),s=7):35===u?(t.step(),s=8):s=6;if(4===s)if(t.isEmpty()||47!==t.head())if(t.isEmpty()){if(t.isDone())return b.done(te.of(e&&e.bind(),void 0,he.Slash))}else{var p=new de;p.push("/"),n=Zt.parse(t,p),s=6}else t.step(),s=5;if(5===s){for(r||(r=Wt.parse(t));r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())if(t.isEmpty()){if(t.isDone())return b.done(te.of(e&&e.bind(),r&&r.bind()))}else 63===(u=t.head())?(t.step(),s=7):35===u?(t.step(),s=8):s=6;else if(r.isError())return r.asError()}if(6===s){for(n||(n=Zt.parse(t));n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())if(t.isEmpty()||63!==t.head())if(t.isEmpty()||35!==t.head()){if(!t.isEmpty()||t.isDone())return b.done(te.of(e&&e.bind(),r&&r.bind(),n.bind()))}else t.step(),s=8;else t.step(),s=7;else if(n.isError())return n.asError()}if(7===s){for(i||(i=Xt.parse(t));i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())if(t.isEmpty()||35!==t.head()){if(!t.isEmpty()||t.isDone())return b.done(te.of(e&&e.bind(),r&&r.bind(),n&&n.bind(),i.bind()))}else t.step(),s=8;else if(i.isError())return i.asError()}if(8===s){for(o||(o=Yt.parse(t));o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone())return b.done(te.of(e&&e.bind(),r&&r.bind(),n&&n.bind(),i&&i.bind(),o.bind()));if(o.isError())return o.asError()}return new h(e,r,n,i,o,s)},h}(b),Nt=function(n){function i(t,e){var r=n.call(this)||this;return r.output=t,r.step=e,r}return c(i,n),i.prototype.feed=function(t){return i.parse(t,this.output,this.step)},i.parse=function(t,e,r){void 0===r&&(r=1);var n=0;if(1===r)if(!t.isEmpty()&&(n=t.head(),b.isAlpha(n)))t.step(),(e=e||new m).push(b.toLowerCase(n)),r=2;else if(!t.isEmpty()||t.isDone())return b.expected("scheme",t);if(2===r){for(;!t.isEmpty()&&(n=t.head(),te.isSchemeChar(n));)t.step(),e.push(b.toLowerCase(n));if(!t.isEmpty()||t.isDone())return b.done(ee.of(e.bind()))}return new i(e,r)},i}(b),Wt=function(o){function u(t,e,r,n){var i=o.call(this)||this;return i.userParser=t,i.hostParser=e,i.portParser=r,i.step=n,i}return c(u,o),u.prototype.feed=function(t){return u.parse(t,this.userParser,this.hostParser,this.portParser,this.step)},u.parse=function(t,e,r,n,i){void 0===i&&(i=1);var o=0;if(1===i)if(t.isEmpty())t.isDone()&&(i=3);else{for(var s=t.clone();!s.isEmpty()&&(64!==(o=s.head())&&47!==o);)s.step();i=s.isEmpty()||64!==o?3:2}if(2===i){for(e||(e=Ht.parse(t));e.isCont()&&(!t.isEmpty()||t.isDone());)e=e.feed(t);if(e.isDone())if(t.isEmpty()||64!==t.head()){if(!t.isEmpty())return b.expected(64,t);if(t.isDone())return b.unexpected(t)}else t.step(),i=3;else if(e.isError())return e.asError()}if(3===i){for(r||(r=Gt.parse(t));r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())if(t.isEmpty()||58!==t.head()){if(!t.isEmpty()||t.isDone())return b.done(re.of(e&&e.bind(),r.bind()))}else t.step(),i=4;else if(r.isError())return r.asError()}if(4===i){for(n||(n=Jt.parse(t));n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isError())return n.asError();if(!t.isEmpty()||t.isDone())return b.done(re.of(e&&e.bind(),r.bind(),n.bind()))}return new u(e,r,n,i)},u}(b),Ht=function(o){function s(t,e,r,n){var i=o.call(this)||this;return i.usernameOutput=t,i.passwordOutput=e,i.c1=r,i.step=n,i}return c(s,o),s.prototype.feed=function(t){return s.parse(t,this.usernameOutput,this.passwordOutput,this.c1,this.step)},s.parse=function(t,e,r,n,i){void 0===n&&(n=0),void 0===i&&(i=1);for(var o=0;!t.isEmpty()||t.isDone();){if(1===i){for(e||(e=new m);!t.isEmpty()&&(o=t.head(),te.isUserChar(o));)t.step(),e.push(o);if(t.isEmpty()||58!==o)if(t.isEmpty()||37!==o){if(!t.isEmpty()||t.isDone())return b.done(ne.of(e.bind()))}else t.step(),i=2;else t.step(),i=4}if(2===i)if(!t.isEmpty()&&(o=t.head(),b.isHexChar(o)))t.step(),n=o,i=3;else{if(!t.isEmpty())return b.expected("hex digit",t);if(t.isDone())return b.unexpected(t)}if(3===i)if(!t.isEmpty()&&(o=t.head(),b.isHexChar(o)))t.step(),e.push((b.decodeHexChar(n)<<4)+b.decodeHexChar(o)),n=0,i=1;else{if(!t.isEmpty())return b.expected("hex digit",t);if(t.isDone())return b.unexpected(t)}if(4===i){for(r=r||new m;!t.isEmpty()&&(o=t.head(),te.isUserInfoChar(o));)t.step(),r.push(o);if(t.isEmpty()||37!==o){if(!t.isEmpty()||t.isDone())return b.done(ne.of(e.bind(),r.bind()))}else t.step(),i=5}if(5===i)if(!t.isEmpty()&&(o=t.head(),b.isHexChar(o)))t.step(),n=o,i=6;else{if(!t.isEmpty())return b.expected("hex digit",t);if(t.isDone())return b.unexpected(t)}if(6===i)if(!t.isEmpty()&&(o=t.head(),b.isHexChar(o)))t.step(),r.push((b.decodeHexChar(n)<<4)+b.decodeHexChar(o)),n=0,i=4;else{if(!t.isEmpty())return b.expected("hex digit",t);if(t.isDone())return b.unexpected(t)}}return new s(e,r,n,i)},s}(b),Gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.feed=function(t){return e.parse(t)},e.parse=function(t){return t.isEmpty()?t.isDone()?b.done(oe.of("")):new e:91===t.head()?Qt.parse(t):$t.parse(t)},e}(b),$t=function(o){function s(t,e,r,n){var i=o.call(this)||this;return i.output=t,i.c1=e,i.x=r,i.step=n,i}return c(s,o),s.prototype.feed=function(t){return s.parse(t,this.output,this.c1,this.x,this.step)},s.parse=function(t,e,r,n,i){void 0===r&&(r=0),void 0===n&&(n=0),void 0===i&&(i=1);for(var o=0;i<=4&&(!t.isEmpty()||t.isDone());){for(e=e||new m;!t.isEmpty()&&(o=t.head(),b.isDigit(o));)t.step(),e.push(o),n=10*n+b.decodeDigit(o);if(t.isEmpty()){if(t.isDone())return 4===i&&n<=255?b.done(se.of(e.bind())):b.done(oe.of(e.bind()))}else if(46===o&&i<4&&n<=255)t.step(),e.push(o),n=0,i+=1;else{if(!te.isHostChar(o)&&37!==o&&4===i&&n<=255)return b.done(se.of(e.bind()));n=0,i=5}}for(;!t.isEmpty()||t.isDone();){if(e=e,5===i){for(;!t.isEmpty()&&(o=t.head(),te.isHostChar(o));)t.step(),e.push(b.toLowerCase(o));if(t.isEmpty()||37!==o){if(!t.isEmpty()||t.isDone())return b.done(oe.of(e.bind()))}else t.step(),i=6}if(6===i)if(!t.isEmpty()&&(o=t.head(),b.isHexChar(o)))t.step(),r=o,i=7;else{if(!t.isEmpty())return b.expected("hex digit",t);if(t.isDone())return b.unexpected(t)}if(7===i)if(!t.isEmpty()&&(o=t.head(),b.isHexChar(o)))t.step(),e.push((b.decodeHexChar(r)<<4)+b.decodeHexChar(o)),r=0,i=5;else{if(!t.isEmpty())return b.expected("hex digit",t);if(t.isDone())return b.unexpected(t)}}return new s(e,r,n,i)},s}(b),Qt=function(n){function i(t,e){var r=n.call(this)||this;return r.output=t,r.step=e,r}return c(i,n),i.prototype.feed=function(t){return i.parse(t,this.output,this.step)},i.parse=function(t,e,r){void 0===r&&(r=1);var n=0;if(1===r)if(t.isEmpty()||91!==(n=t.head())){if(!t.isEmpty())return b.expected("'['",t);if(t.isDone())return b.unexpected(t)}else t.step(),r=2;if(2===r){for(e=e||new m;!t.isEmpty()&&(n=t.head(),te.isHostChar(n)||58===n);)t.step(),e.push(b.toLowerCase(n));if(!t.isEmpty()&&93===n)return t.step(),b.done(ue.of(e.bind()));if(!t.isEmpty()||t.isDone())return b.unexpected(t)}return new i(e,r)},i}(b),Jt=function(r){function n(t){var e=r.call(this)||this;return e.port=t,e}return c(n,r),n.prototype.feed=function(t){return n.parse(t,this.port)},n.parse=function(t,e){void 0===e&&(e=0);for(var r=0;!t.isEmpty()&&(r=t.head(),b.isDigit(r));)t.step(),e=10*e+b.decodeDigit(r);return!t.isEmpty()||t.isDone()?b.done(pe.of(e)):new n(e)},n}(b),Zt=function(o){function s(t,e,r,n){var i=o.call(this)||this;return i.builder=t,i.output=e,i.c1=r,i.step=n,i}return c(s,o),s.prototype.feed=function(t){return s.parse(t,this.builder,this.output,this.c1,this.step)},s.parse=function(t,e,r,n,i){void 0===n&&(n=0),void 0===i&&(i=1);for(var o=0;!t.isEmpty()||t.isDone();){if(1===i){for(;!t.isEmpty()&&(o=t.head(),te.isPathChar(o));)r=r||new m,t.step(),r.push(o);if(t.isEmpty()||47!==o)if(t.isEmpty()||37!==o){if(!t.isEmpty()||t.isDone())return e=e||new de,r&&e.push(r.bind()),b.done(e.bind())}else t.step(),i=2;else t.step(),e=e||new de,r&&(e.push(r.bind()),r=void 0),e.push("/")}if(2===i)if(!t.isEmpty()&&(o=t.head(),b.isHexChar(o)))t.step(),n=o,i=3;else{if(!t.isEmpty())return b.expected("hex digit",t);if(t.isDone())return b.unexpected(t)}if(3===i)if(!t.isEmpty()&&(o=t.head(),b.isHexChar(o)))r=r||new m,t.step(),r.push((b.decodeHexChar(n)<<4)+b.decodeHexChar(o)),n=0,i=1;else{if(!t.isEmpty())return b.expected("hex digit",t);if(t.isDone())return b.unexpected(t)}}return new s(e,r,n,i)},s}(b),Xt=function(s){function u(t,e,r,n,i){var o=s.call(this)||this;return o.keyOutput=t,o.valueOutput=e,o.builder=r,o.c1=n,o.step=i,o}return c(u,s),u.prototype.feed=function(t){return u.parse(t,this.keyOutput,this.valueOutput,this.builder,this.c1,this.step)},u.parse=function(t,e,r,n,i,o){void 0===i&&(i=0),void 0===o&&(o=1);for(var s=0;!t.isEmpty()||t.isDone();){if(1===o){for(e=e||new m;!t.isEmpty()&&(s=t.head(),te.isParamChar(s));)t.step(),e.push(s);if(t.isEmpty()||61!==s)if(t.isEmpty()||38!==s)if(t.isEmpty()||37!==s){if(!t.isEmpty()||t.isDone())return(n=n||new ge).param(null,e.bind()),b.done(n.bind())}else t.step(),o=2;else t.step(),(n=n||new ge).param(null,e.bind()),e=void 0,o=1;else t.step(),o=4}if(2===o)if(!t.isEmpty()&&(s=t.head(),b.isHexChar(s)))t.step(),i=s,o=3;else{if(!t.isEmpty())return b.expected("hex digit",t);if(t.isDone())return b.unexpected(t)}if(3===o)if(!t.isEmpty()&&(s=t.head(),b.isHexChar(s)))t.step(),e.push((b.decodeHexChar(i)<<4)+b.decodeHexChar(s)),i=0,o=1;else{if(!t.isEmpty())return b.expected("hex digit",t);if(t.isDone())return b.unexpected(t)}if(4===o){for(r=r||new m;!t.isEmpty()&&(s=t.head(),te.isParamChar(s)||61===s);)t.step(),r.push(s);if(t.isEmpty()||38!==s)if(t.isEmpty()||38!==s){if(!t.isEmpty()||t.isDone())return(n=n||new ge).param(e.bind(),r.bind()),b.done(n.bind())}else t.step(),o=5;else t.step(),(n=n||new ge).param(e.bind(),r.bind()),r=e=void 0,o=1}if(5===o)if(!t.isEmpty()&&(s=t.head(),b.isHexChar(s)))t.step(),i=s,o=6;else{if(!t.isEmpty())return b.expected("hex digit",t);if(t.isDone())return b.unexpected(t)}if(6===o)if(!t.isEmpty()&&(s=t.head(),b.isHexChar(s)))t.step(),r.push((b.decodeHexChar(i)<<4)+b.decodeHexChar(s)),i=0,o=4;else{if(!t.isEmpty())return b.expected("hex digit",t);if(t.isDone())return b.unexpected(t)}}return new u(e,r,n,i,o)},u}(b),Yt=function(i){function o(t,e,r){var n=i.call(this)||this;return n.output=t,n.c1=e,n.step=r,n}return c(o,i),o.prototype.feed=function(t){return o.parse(t,this.output,this.c1,this.step)},o.parse=function(t,e,r,n){void 0===e&&(e=new m),void 0===r&&(r=0),void 0===n&&(n=1);for(var i=0;!t.isEmpty()||t.isDone();){if(1===n){for(;!t.isEmpty()&&(i=t.head(),te.isFragmentChar(i));)t.step(),e.push(i);if(t.isEmpty()||37!==i){if(!t.isEmpty()||t.isDone())return b.done(_e.of(e.bind()))}else t.step(),n=2}if(2===n)if(!t.isEmpty()&&(i=t.head(),b.isHexChar(i)))t.step(),r=i,n=3;else{if(!t.isEmpty())return b.expected("hex digit",t);if(t.isDone())return b.unexpected(t)}if(3===n)if(!t.isEmpty()&&(i=t.head(),b.isHexChar(i)))t.step(),e.push((b.decodeHexChar(r)<<4)+b.decodeHexChar(i)),r=0,n=1;else{if(!t.isEmpty())return b.expected("hex digit",t);if(t.isDone())return b.unexpected(t)}}return new o(e,r,n)},o}(b),te=function(){function s(t,e,r,n,i){this._scheme=t,this._authority=e,this._path=r,this._query=n,this._fragment=i}return s.prototype.isDefined=function(){return this._scheme.isDefined()||this._authority.isDefined()||this._path.isDefined()||this._query.isDefined()||this._fragment.isDefined()},s.prototype.isEmpty=function(){return!(this._scheme.isDefined()||this._authority.isDefined()||this._path.isDefined()||this._query.isDefined()||this._fragment.isDefined())},s.prototype.scheme=function(t){return void 0===t?this._scheme:(t=ee.fromAny(t),s.of(t,this._authority,this._path,this._query,this._fragment))},s.prototype.authority=function(t){return void 0===t?this._authority:(t=re.fromAny(t),s.of(this._scheme,t,this._path,this._query,this._fragment))},s.prototype.user=function(t){if(void 0===t)return this._authority._user;var e=this._authority.user(t);return s.of(this._scheme,e,this._path,this._query,this._fragment)},s.prototype.username=function(t,e){if(void 0===t)return this._authority._user._username||"";var r=this._authority.username(t,e);return s.of(this._scheme,r,this._path,this._query,this._fragment)},s.prototype.password=function(t){if(void 0===t)return this._authority._user._password;var e=this._authority.password(t);return s.of(this._scheme,e,this._path,this._query,this._fragment)},s.prototype.host=function(t){if(void 0===t)return this._authority._host;var e=this._authority.host(t);return s.of(this._scheme,e,this._path,this._query,this._fragment)},s.prototype.hostName=function(t){if(void 0===t)return this._authority._host.name();var e=this._authority.hostName(t);return s.of(this._scheme,e,this._path,this._query,this._fragment)},s.prototype.hostIPv4=function(t){if(void 0===t)return this._authority._host.ipv4();var e=this._authority.hostIPv4(t);return s.of(this._scheme,e,this._path,this._query,this._fragment)},s.prototype.hostIPv6=function(t){if(void 0===t)return this._authority._host.ipv6();var e=this._authority.hostIPv6(t);return s.of(this._scheme,e,this._path,this._query,this._fragment)},s.prototype.port=function(t){if(void 0===t)return this._authority._port;var e=this._authority.port(t);return s.of(this._scheme,e,this._path,this._query,this._fragment)},s.prototype.path=function(t){return void 0===t?this._path:(t=he.fromAny(t),s.of(this._scheme,this._authority,t,this._query,this._fragment))},s.prototype.query=function(t){return void 0===t?this._query:(t=ye.fromAny(t),s.of(this._scheme,this._authority,this._path,t,this._fragment))},s.prototype.param=function(t,e){if(void 0===e)return this._query.get(t);var r=this._query.param(t,e);return s.of(this._scheme,this._authority,this._path,r,this._fragment)},s.prototype.fragment=function(t){return void 0===t?this._fragment:(t=_e.fromAny(t),s.of(this._scheme,this._authority,this._path,this._query,t))},s.prototype.base=function(){return this._path.isDefined()||this._query.isDefined()||this._fragment.isDefined()?s.of(this._scheme,this._authority):this},s.prototype.resolve=function(t){return(t=s.fromAny(t))._scheme.isDefined()?s.of(t._scheme,t._authority,t._path.removeDotSegments(),t._query,t._fragment):t._authority.isDefined()?s.of(this._scheme,t._authority,t._path.removeDotSegments(),t._query,t._fragment):t._path.isEmpty()?s.of(this._scheme,this._authority,this._path,t._query.isDefined()?t._query:this._query,t._fragment):"/"===t._path.head()?s.of(this._scheme,this._authority,t._path.removeDotSegments(),t._query,t._fragment):s.of(this._scheme,this._authority,this.merge(t._path).removeDotSegments(),t._query,t._fragment)},s.prototype.merge=function(t){return this._authority.isDefined()&&this._path.isEmpty()?new ce(t):this._path.isEmpty()?t:this._path.merge(t)},s.prototype.unresolve=function(t){return t=s.fromAny(t),this._scheme.equals(t._scheme)&&this._authority.equals(t._authority)?s.of(ee.Undefined,re.Undefined,this._path.unmerge(t._path),t._query,t._fragment):t},s.prototype.writeUri=function(t){this._scheme.isDefined()&&(this._scheme.writeUri(t),t.push(58)),this._authority.isDefined()&&(t.push(47,47),this._authority.writeUri(t)),this._path.writeUri(t),this._query.isDefined()&&(t.push(63),this._query.writeUri(t)),this._fragment.isDefined()&&(t.push(35),this._fragment.writeUri(t))},s.prototype.toUri=function(){var t=this._string;if(void 0===t){var e=new m;this.writeUri(e),t=e.bind(),this._string=t}return t},s.prototype.compare=function(t){var e=this.toUri().localeCompare(t.toUri());return e<0?-1:0<e?1:0},s.prototype.equals=function(t){return this===t||t instanceof s&&((void 0===this._hashCode||void 0===t._hashCode||this._hashCode===t._hashCode)&&(this._scheme.equals(t._scheme)&&this._authority.equals(t._authority)&&this._path.equals(t._path)&&this._query.equals(t._query)&&this._fragment.equals(t._fragment)))},s.prototype.hashCode=function(){var t=this._hashCode;return void 0===t&&(t=h.mash(h.mix(h.mix(h.mix(h.mix(h.mix(4118306580,this._scheme.hashCode()),this._authority.hashCode()),this._path.hashCode()),this._query.hashCode()),this._fragment.hashCode())),this._hashCode=t),t},s.prototype.toString=function(){return this.toUri()},s.parse=function(t){var e=B.valueOf(t);if(t.length<=128){var r=s.ParseCache.get(e);if(void 0!==r)return r}var n=new v(t),i=Kt.parse(n);!n.isEmpty()&&i.isDone()&&(i=b.unexpected(n));var o=i.bind();return s.ParseCache.set(e,o),o},s.of=function(t,e,r,n,i){return void 0===t&&(t=ee.Undefined),void 0===e&&(e=re.Undefined),void 0===r&&(r=he.Empty),void 0===n&&(n=ye.Undefined),void 0===i&&(i=_e.Undefined),t.isDefined()||e.isDefined()||r.isDefined()||n.isDefined()||i.isDefined()?new s(t,e,r,n,i):s.Empty},s.scheme=function(t){return t=ee.fromAny(t),s.of(t,void 0,void 0,void 0,void 0)},s.authority=function(t){return t=re.fromAny(t),s.of(void 0,t,void 0,void 0,void 0)},s.user=function(t){var e=re.user(t);return s.of(void 0,e,void 0,void 0,void 0)},s.username=function(t,e){var r=re.username(t,e);return s.of(void 0,r,void 0,void 0,void 0)},s.password=function(t){var e=re.password(t);return s.of(void 0,e,void 0,void 0,void 0)},s.host=function(t){var e=re.host(t);return s.of(void 0,e,void 0,void 0,void 0)},s.hostName=function(t){var e=re.hostName(t);return s.of(void 0,e,void 0,void 0,void 0)},s.hostIPv4=function(t){var e=re.hostIPv4(t);return s.of(void 0,e,void 0,void 0,void 0)},s.hostIPv6=function(t){var e=re.hostIPv6(t);return s.of(void 0,e,void 0,void 0,void 0)},s.port=function(t){var e=re.port(t);return s.of(void 0,e,void 0,void 0,void 0)},s.path=function(t){return t=he.fromAny(t),s.of(void 0,void 0,t,void 0,void 0)},s.query=function(t){return t=ye.fromAny(t),s.of(void 0,void 0,void 0,t,void 0)},s.param=function(t,e){var r=ye.param(t,e);return s.of(void 0,void 0,void 0,r,void 0)},s.fragment=function(t){return t=_e.fromAny(t),s.of(void 0,void 0,void 0,void 0,t)},s.fromAny=function(t){if(null==t)return s.Empty;if(t instanceof s)return t;if("object"==typeof t){var e=ee.fromAny(t.scheme),r=re.fromAny(t.authority||t),n=he.fromAny(t.path),i=ye.fromAny(t.query),o=_e.fromAny(t.fragment);return e.isDefined()||r.isDefined()||n.isDefined()||i.isDefined()||o.isDefined()?new s(e,r,n,i,o):s.Empty}if("string"==typeof t)return s.parse(t);throw new TypeError(""+t)},s.resolve=function(t,e){return s.fromAny(t).resolve(e)},s.unresolve=function(t,e){return s.fromAny(t).unresolve(e)},s.isUnreservedChar=function(t){return 65<=t&&t<=90||97<=t&&t<=122||48<=t&&t<=57||45===t||46===t||95===t||126===t},s.isSubDelimChar=function(t){return 33===t||36===t||38===t||40===t||41===t||42===t||43===t||44===t||59===t||61===t||39===t},s.isSchemeChar=function(t){return 65<=t&&t<=90||97<=t&&t<=122||48<=t&&t<=57||43===t||45===t||46===t},s.isUserInfoChar=function(t){return s.isUnreservedChar(t)||s.isSubDelimChar(t)||58===t},s.isUserChar=function(t){return s.isUnreservedChar(t)||s.isSubDelimChar(t)},s.isHostChar=function(t){return s.isUnreservedChar(t)||s.isSubDelimChar(t)},s.isPathChar=function(t){return s.isUnreservedChar(t)||s.isSubDelimChar(t)||58===t||64===t},s.isQueryChar=function(t){return s.isUnreservedChar(t)||s.isSubDelimChar(t)||47===t||58===t||63===t||64===t},s.isParamChar=function(t){return s.isUnreservedChar(t)||33===t||36===t||40===t||41===t||42===t||43===t||44===t||47===t||58===t||59===t||63===t||64===t||39===t},s.isFragmentChar=function(t){return s.isUnreservedChar(t)||s.isSubDelimChar(t)||47===t||58===t||63===t||64===t},s.writeScheme=function(t,e){for(var r=0,n=t.length;r<n;r+=1){var i=t.charCodeAt(r);if(!(0<r&&s.isSchemeChar(i)||0===r&&b.isAlpha(i)))throw new Error("invalid scheme: "+t);e.push(i)}},s.writeUserInfo=function(t,e){for(var r=0,n=t.length;r<n;r+=1){var i=t.charCodeAt(r);s.isUserInfoChar(i)?e.push(i):s.writeEncoded(i,e)}},s.writeUser=function(t,e){for(var r=0,n=t.length;r<n;r+=1){var i=t.charCodeAt(r);s.isUserChar(i)?e.push(i):s.writeEncoded(i,e)}},s.writeHost=function(t,e){for(var r=0,n=t.length;r<n;r+=1){var i=t.charCodeAt(r);s.isHostChar(i)?e.push(i):s.writeEncoded(i,e)}},s.writeHostLiteral=function(t,e){for(var r=0,n=t.length;r<n;r+=1){var i=t.charCodeAt(r);s.isHostChar(i)||58===i?e.push(i):s.writeEncoded(i,e)}},s.writePort=function(t,e){for(var r=9,n=new Array(10);0<t;)n[r]=t%10,t=Math.floor(t/10),r-=1;for(r+=1;r<10;)e.push(48+n[r]),r+=1},s.writePathSegment=function(t,e){for(var r=0,n=t.length;r<n;r+=1){var i=t.charCodeAt(r);s.isPathChar(i)?e.push(i):s.writeEncoded(i,e)}},s.writeQuery=function(t,e){for(var r=0,n=t.length;r<n;r+=1){var i=t.charCodeAt(r);s.isQueryChar(i)?e.push(i):s.writeEncoded(i,e)}},s.writeParam=function(t,e){for(var r=0,n=t.length;r<n;r+=1){var i=t.charCodeAt(r);s.isParamChar(i)?e.push(i):s.writeEncoded(i,e)}},s.writeFragment=function(t,e){for(var r=0,n=t.length;r<n;r+=1){var i=t.charCodeAt(r);s.isFragmentChar(i)?e.push(i):s.writeEncoded(i,e)}},s.writeEncoded=function(t,e){0===t?(s.writePctEncoded(192,e),s.writePctEncoded(128,e)):0<=t&&t<=127?s.writePctEncoded(t,e):128<=t&&t<=2047?(s.writePctEncoded(192|t>>>6,e),s.writePctEncoded(128|63&t,e)):2048<=t&&t<=65535||57344<=t&&t<=65535?(s.writePctEncoded(224|t>>>12,e),s.writePctEncoded(128|t>>>6&63,e),s.writePctEncoded(128|63&t,e)):65536<=t&&t<=1114111?(s.writePctEncoded(240|t>>>18,e),s.writePctEncoded(128|t>>>12&63,e),s.writePctEncoded(128|t>>>6&63,e),s.writePctEncoded(128|63&t,e)):(s.writePctEncoded(239,e),s.writePctEncoded(191,e),s.writePctEncoded(189,e))},s.writePctEncoded=function(t,e){e.push(37,s.encodeHexChar(t>>>4&15),s.encodeHexChar(15&t))},s.encodeHexChar=function(t){return t<10?48+t:t-10+97},s.Empty=void 0,s.ParseCache=new jt(64),s}(),ee=function(){function e(t){this._name=t}return e.prototype.isDefined=function(){return 0!==this._name.length},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),e.prototype.valueOf=function(){return this._name},e.prototype.writeUri=function(t){te.writeScheme(this._name,t)},e.prototype.toUri=function(){var t=new m;return this.writeUri(t),t.bind()},e.prototype.equals=function(t){return this===t||t instanceof e&&this._name===t._name},e.prototype.hashCode=function(){return h.mash(h.mix(2043922308,h.hash(this._name)))},e.prototype.toString=function(){return this._name},e.parse=function(t){"string"==typeof t&&(t=new v(t));var e=Nt.parse(t);return!t.isEmpty()&&e.isDone()&&(e=b.unexpected(t)),e.bind()},e.of=function(t){return 0!==t.length?new e(t):e.Undefined},e.fromAny=function(t){if(null==t)return e.Undefined;if(t instanceof e)return t;if("string"==typeof t)return e.of(t);throw new TypeError(""+t)},e.Undefined=new e(""),e}(),re=function(){function i(t,e,r){this._user=t,this._host=e,this._port=r}return i.prototype.isDefined=function(){return this._user.isDefined()||this._host.isDefined()||this._port.isDefined()},i.prototype.user=function(t){return void 0===t?this._user:(t=ne.fromAny(t),i.of(t,this._host,this._port))},i.prototype.username=function(t,e){if(void 0===t)return this._user._username||"";var r=this._user.username(t,e);return i.of(r,this._host,this._port)},i.prototype.password=function(t){if(void 0===t)return this._user._password;var e=this._user.password(t);return i.of(e,this._host,this._port)},i.prototype.host=function(t){return void 0===t?this._host:(t=ie.fromAny(t),i.of(this._user,t,this._port))},i.prototype.hostName=function(t){if(void 0===t)return this._host.name();var e=oe.of(t);return i.of(this._user,e,this._port)},i.prototype.hostIPv4=function(t){if(void 0===t)return this._host.ipv4();var e=se.of(t);return i.of(this._user,e,this._port)},i.prototype.hostIPv6=function(t){if(void 0===t)return this._host.ipv6();var e=ue.of(t);return i.of(this._user,e,this._port)},i.prototype.port=function(t){return void 0===t?this._port:(t=pe.fromAny(t),i.of(this._user,this._host,t))},i.prototype.writeUri=function(t){this._user.isDefined()&&(this._user.writeUri(t),t.push(64)),this._host.writeUri(t),this._port.isDefined()&&(t.push(58),this._port.writeUri(t))},i.prototype.toUri=function(){var t=new m;return this.writeUri(t),t.bind()},i.prototype.equals=function(t){return this===t||t instanceof i&&(this._user.equals(t._user)&&this._host.equals(t._host)&&this._port.equals(t._port))},i.prototype.hashCode=function(){return h.mash(h.mix(h.mix(h.mix(1835556802,this._user.hashCode()),this._host.hashCode()),this._port.hashCode()))},i.prototype.toString=function(){return this.toUri()},i.parse=function(t){"string"==typeof t&&(t=new v(t));var e=Wt.parse(t);return!t.isEmpty()&&e.isDone()&&(e=b.unexpected(t)),e.bind()},i.of=function(t,e,r){return void 0===t&&(t=ne.Undefined),void 0===e&&(e=ie.Undefined),void 0===r&&(r=pe.Undefined),t.isDefined()||e.isDefined()||r.isDefined()?new i(t,e,r):i.Undefined},i.user=function(t){return t=ne.fromAny(t),i.of(t,void 0,void 0)},i.username=function(t,e){var r=ne.of(t,e);return i.of(r,void 0,void 0)},i.password=function(t){var e=ne.of("",t);return i.of(e,void 0,void 0)},i.host=function(t){return t=ie.fromAny(t),i.of(void 0,t,void 0)},i.hostName=function(t){var e=oe.of(t);return i.of(void 0,e,void 0)},i.hostIPv4=function(t){var e=se.of(t);return i.of(void 0,e,void 0)},i.hostIPv6=function(t){var e=ue.of(t);return i.of(void 0,e,void 0)},i.port=function(t){return t=pe.fromAny(t),i.of(void 0,void 0,t)},i.fromAny=function(t){if(null==t)return i.Undefined;if(t instanceof i)return t;if("object"==typeof t){var e=ne.fromAny(t.user||t),r=ie.fromAny(t.host),n=pe.fromAny(t.port);return i.of(e,r,n)}if("string"==typeof t)return i.parse(t);throw new TypeError(""+t)},i.Undefined=void 0,i}(),ne=function(){function n(t,e){void 0===e&&(e=null),this._username=t,this._password=e}return n.prototype.isDefined=function(){return null!==this._username},n.prototype.username=function(t,e){return void 0===e&&(e=this._password),void 0===t?this._username||"":n.of(t,this._password)},n.prototype.password=function(t){return void 0===t?this._password:n.of(this._username,t)},n.prototype.writeUri=function(t){null!==this._username&&(te.writeUser(this._username,t),null!==this._password&&(t.push(58),te.writeUser(this._password,t)))},n.prototype.toUri=function(){var t=new m;return this.writeUri(t),t.bind()},n.prototype.equals=function(t){return this===t||t instanceof n&&(this._username===t._username&&this._password===t._password)},n.prototype.hashCode=function(){return h.mash(h.mix(h.mix(2091562833,h.hash(this._username)),h.hash(this._password)))},n.prototype.toString=function(){return this.toUri()},n.parse=function(t){"string"==typeof t&&(t=new v(t));var e=Ht.parse(t);return!t.isEmpty()&&e.isDone()&&(e=b.unexpected(t)),e.bind()},n.of=function(t,e){return void 0===e&&(e=null),null!==t||null!==e?new n(t||"",e):n.Undefined},n.fromAny=function(t){if(null==t)return n.Undefined;if(t instanceof n)return t;if("object"==typeof t){var e="string"==typeof t.username?t.username:null,r="string"==typeof t.password?t.password:null;return n.of(e,r)}if("string"==typeof t)return n.parse(t);throw new TypeError(""+t)},n.Undefined=new n(null,null),n}(),ie=function(){function e(){}return e.prototype.name=function(){return null},e.prototype.ipv4=function(){return null},e.prototype.ipv6=function(){return null},e.prototype.toUri=function(){var t=new m;return this.writeUri(t),t.bind()},e.prototype.toString=function(){return this.toUri()},e.parse=function(t){"string"==typeof t&&(t=new v(t));var e=Gt.parse(t);return!t.isEmpty()&&e.isDone()&&(e=b.unexpected(t)),e.bind()},e.fromAny=function(t){if(null==t)return e.Undefined;if(t instanceof e)return t;if("string"==typeof t)return e.parse(t);throw new TypeError(""+t)},e.Undefined=void 0,e}(),oe=function(r){function e(t){var e=r.call(this)||this;return e._address=t,e}return c(e,r),e.prototype.isDefined=function(){return!0},Object.defineProperty(e.prototype,"address",{get:function(){return this._address},enumerable:!0,configurable:!0}),e.prototype.name=function(){return this._address},e.prototype.writeUri=function(t){te.writeHost(this._address,t)},e.prototype.equals=function(t){return this===t||t instanceof e&&this._address===t._address},e.prototype.hashCode=function(){return h.mash(h.mix(3937679e3,h.hash(this._address)))},e.of=function(t){return new e(t)},e}(ie),se=function(r){function e(t){var e=r.call(this)||this;return e._address=t,e}return c(e,r),e.prototype.isDefined=function(){return!0},Object.defineProperty(e.prototype,"address",{get:function(){return this._address},enumerable:!0,configurable:!0}),e.prototype.ipv4=function(){return this._address},e.prototype.writeUri=function(t){te.writeHost(this._address,t)},e.prototype.equals=function(t){return this===t||t instanceof e&&this._address===t._address},e.prototype.hashCode=function(){return h.mash(h.mix(2745781626,h.hash(this._address)))},e.of=function(t){return new e(t)},e}(ie),ue=function(r){function e(t){var e=r.call(this)||this;return e._address=t,e}return c(e,r),e.prototype.isDefined=function(){return!0},Object.defineProperty(e.prototype,"address",{get:function(){return this._address},enumerable:!0,configurable:!0}),e.prototype.ipv6=function(){return this._address},e.prototype.writeUri=function(t){t.push(91),te.writeHostLiteral(this._address,t),t.push(93)},e.prototype.equals=function(t){return this===t||t instanceof e&&this._address===t._address},e.prototype.hashCode=function(){return h.mash(h.mix(1131060913,h.hash(this._address)))},e.of=function(t){return new e(t)},e}(ie),ae=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.isDefined=function(){return!1},Object.defineProperty(e.prototype,"address",{get:function(){return""},enumerable:!0,configurable:!0}),e.prototype.writeUri=function(t){},e.prototype.equals=function(t){return t instanceof e},e.prototype.hashCode=function(){return 2406756600},e}(ie);ie.Undefined=new ae;var pe=function(){function e(t){this._number=t}return e.prototype.isDefined=function(){return 0!==this._number},Object.defineProperty(e.prototype,"number",{get:function(){return this._number},enumerable:!0,configurable:!0}),e.prototype.valueOf=function(){return this._number},e.prototype.writeUri=function(t){te.writePort(this._number,t)},e.prototype.toUri=function(){var t=new m;return this.writeUri(t),t.bind()},e.prototype.equals=function(t){return this===t||t instanceof e&&this._number===t._number},e.prototype.hashCode=function(){return h.mash(h.mix(213942493,this._number))},e.prototype.toString=function(){return this.toUri()},e.parse=function(t){"string"==typeof t&&(t=new v(t));var e=Jt.parse(t);return!t.isEmpty()&&e.isDone()&&(e=b.unexpected(t)),e.bind()},e.of=function(t){return 0!==t?new e(t):e.Undefined},e.fromAny=function(t){if(null==t)return e.Undefined;if(t instanceof e)return t;if("number"==typeof t)return e.of(t);if("string"==typeof t)return e.parse(t);throw new TypeError(""+t)},e.Undefined=new e(0),e}(),he=function(){function o(){}return Object.defineProperty(o.prototype,"length",{get:function(){for(var t=0,e=this;!e.isEmpty();)t+=1,e=e.tail();return t},enumerable:!0,configurable:!0}),o.prototype.removeDotSegments=function(){for(var t=this,e=new de;!t.isEmpty();){var r=t.head();if("."===r||".."===r)(t=t.tail()).isEmpty()||(t=t.tail());else if("/"===r){var n=t.tail();if(n.isEmpty())e.push(t.head()),t=t.tail();else{var i=n.head();"."===i?(t=n.tail()).isEmpty()&&(t=o.Slash):".."===i?((t=n.tail()).isEmpty()&&(t=o.Slash),e.isEmpty()||"/"===e.pop()||e.isEmpty()||e.pop()):(e.push(r,i),t=n.tail())}}else e.push(t.head()),t=t.tail()}return e.bind()},o.prototype.merge=function(t){for(var e=new de,r=this.head(),n=this.tail();!n.isEmpty();)e.push(r),r=n.head(),n=n.tail();return"/"===r&&e.push(r),e.push(t),e.bind()},o.prototype.unmerge=function(t,e){void 0===e&&(e=t);for(var r=this;;){if(r.isEmpty())return t.isEmpty()||t.tail().isEmpty()?t:t.tail();if(r.isRelative())return t;if(t.isRelative())return new ce(t);var n=r.tail(),i=t.tail();if(!n.isEmpty()&&i.isEmpty())return o.Slash;if(n.isEmpty()||i.isEmpty()||n.head()!==i.head())return i;if(n=n.tail(),i=i.tail(),!n.isEmpty()&&i.isEmpty())return e;r=n,t=i}},o.prototype.toArray=function(){for(var t=[],e=this;!e.isEmpty();)t.push(e.head()),e=e.tail();return t},o.prototype.writeUri=function(t){for(var e=this;!e.isEmpty();)e instanceof ce?t.push(47):te.writePathSegment(e.head(),t),e=e.tail()},o.prototype.toUri=function(){var t=new m;return this.writeUri(t),t.bind()},o.prototype.equals=function(t){if(this===t)return!0;if(t instanceof o){for(var e=this,r=t;!e.isEmpty()&&!r.isEmpty();){if(e.head()!==r.head())return!1;e=e.tail(),r=r.tail()}return e.isEmpty()===r.isEmpty()}return!1},o.prototype.hashCode=function(){for(var t=3618688081,e=this;!e.isEmpty();)t=h.mix(t,h.hash(e.head())),e=e.tail();return h.mash(t)},o.prototype.toString=function(){return this.toUri()},o.builder=function(){return new de},o.parse=function(t){"string"==typeof t&&(t=new v(t));var e=Zt.parse(t);return!t.isEmpty()&&e.isDone()&&(e=b.unexpected(t)),e.bind()},o.of=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=new de;return r.push.apply(r,arguments),r.bind()},o.fromAny=function(t){if(null==t)return o.Empty;if(t instanceof o)return t;if(Array.isArray(t))return o.of.apply(void 0,t);if("string"==typeof t)return o.parse(t);throw new TypeError(""+t)},o.Empty=void 0,o.Slash=void 0,o}(),fe=function(n){function e(t,e){var r=n.call(this)||this;return r._head=t,r._tail=e,r}return c(e,n),e.prototype.isDefined=function(){return!0},e.prototype.isAbsolute=function(){return!1},e.prototype.isRelative=function(){return!0},e.prototype.isEmpty=function(){return!1},e.prototype.head=function(){return this._head},e.prototype.tail=function(){return this._tail},e.prototype.setTail=function(t){t instanceof e&&(t=new ce(t)),this._tail=t},e}(he),ce=function(r){function t(t){var e=r.call(this)||this;return e._tail=t,e}return c(t,r),t.prototype.isDefined=function(){return!0},t.prototype.isAbsolute=function(){return!0},t.prototype.isRelative=function(){return!1},t.prototype.isEmpty=function(){return!1},t.prototype.head=function(){return"/"},t.prototype.tail=function(){return this._tail},t.prototype.setTail=function(t){this._tail=t},t}(he),le=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.isDefined=function(){return!1},e.prototype.isAbsolute=function(){return!1},e.prototype.isRelative=function(){return!0},e.prototype.isEmpty=function(){return!0},e.prototype.head=function(){return""},e.prototype.tail=function(){throw new Error("empty path")},e.prototype.setTail=function(t){throw new Error("empty path")},e}(he);he.Empty=new le,he.Slash=new ce(he.Empty);var de=function(){function t(){this._first=he.Empty,this._last=null,this._size=0,this._aliased=0}return t.prototype.isEmpty=function(){return 0===this._size},t.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=0;r<t.length;r+=1){var n=t[r];if(n instanceof he){if(!n.isEmpty()){for(0===this._size?this._first=n:this.dealias(this._size-1).setTail(n),this._size+=1;!n.tail().isEmpty();)n=n.tail(),this._size+=1;this._last=n}}else if(Array.isArray(n))this.push.apply(this,n);else{if("string"!=typeof n)throw new TypeError(""+n);var i=void 0;i="/"===n?new ce(he.Empty):new fe(n,he.Empty),0===this._size?this._first=i:this.dealias(this._size-1).setTail(i),this._last=i,this._size+=1,this._aliased+=1}}},t.prototype.pop=function(){if(0===this._size)throw new Error;if(1===this._size){var t=this._first,e=t.head();return this._first=t.tail(),t.tail().isEmpty()&&(this._last=null),this._size-=1,0<this._aliased&&(this._aliased-=1),e}var r=this.dealias(this._size-2);e=r.tail().head();return r.setTail(he.Empty),this._last=r,this._size-=1,this._aliased-=1,e},t.prototype.bind=function(){return this._aliased=0,this._first},t.prototype.dealias=function(t){var e=0,r=null,n=this._first;if(this._aliased<=t){for(;e<this._aliased;)n=(r=n).tail(),e+=1;for(;e<=t;){var i=void 0;i=n instanceof ce?new ce(n.tail()):new fe(n.head(),n.tail()),0===e?this._first=i:r.setTail(i),r=i,n=n.tail(),e+=1}e===this._size&&(this._last=r),this._aliased=e}else if(0===t)r=this._first;else if(t===this._size-1)r=this._last;else for(;e<=t;)n=(r=n).tail(),e+=1;return r},t}(),ye=function(){function a(){}return Object.defineProperty(a.prototype,"length",{get:function(){for(var t=0,e=this;!e.isEmpty();)t+=1,e=e.tail();return t},enumerable:!0,configurable:!0}),a.prototype.get=function(t){for(var e=this;!e.isEmpty();){if(t===e.key)return e.value;e=e.tail()}},a.prototype.param=function(t,e){if(void 0===e)return this.get(t);for(var r=new ge,n=this,i=!1;!n.isEmpty();)i||null===t||t!==n.key?r.param(n.key,n.value):(r.param(t,e),i=!0),n=n.tail();return i||r.param(t,e),r.bind()},a.prototype.toObject=function(){for(var t={},e=this,r=0;!e.isEmpty();)null!==e.key?t[e.key]=e.value:t["$"+r]=e.value,e=e.tail(),r+=1;return t},a.prototype.writeUri=function(t){for(var e=this,r=!0;!e.isEmpty();)r?r=!1:t.push(38),null!==e.key&&(te.writeParam(e.key,t),t.push(61)),te.writeParam(e.value,t),e=e.tail()},a.prototype.toUri=function(){var t=new m;return this.writeUri(t),t.bind()},a.prototype.equals=function(t){if(this===t)return!0;if(t instanceof a){for(var e=this,r=t;!e.isEmpty()&&!r.isEmpty();){if(e.key!==r.key||e.value!==r.value)return!1;e=e.tail(),r=r.tail()}return e.isEmpty()===r.isEmpty()}return!1},a.prototype.hashCode=function(){for(var t=922545508,e=this;!e.isEmpty();)t=h.mix(h.mix(t,h.hash(e.key)),h.hash(e.value)),e=e.tail();return h.mash(t)},a.prototype.toString=function(){return this.toUri()},a.builder=function(){return new ge},a.parse=function(t){"string"==typeof t&&(t=new v(t));var e=Xt.parse(t);return!t.isEmpty()&&e.isDone()&&(e=b.unexpected(t)),e.bind()},a.fromAny=function(t){if(null==t)return a.Undefined;if(t instanceof a)return t;if("object"==typeof t)return a.fromObject(t);if("string"==typeof t)return a.parse(t);throw new TypeError(""+t)},a.param=function(t,e){return new ve(t,e,a.Undefined)},a.fromObject=function(t){var e=a.Undefined,r=null,n=0;for(var i in t){var o=i,s=t[i];36===i.charCodeAt(0)&&i==="$"+n&&(o=null);var u=new ve(o,s,a.Undefined);null===r?e=u:r.setTail(u),r=u,n+=1}return e},a.Undefined=void 0,a}(),ve=function(i){function t(t,e,r){var n=i.call(this)||this;return n._key=t,n._value=e,n._tail=r,n}return c(t,i),t.prototype.isDefined=function(){return!0},t.prototype.isEmpty=function(){return!1},Object.defineProperty(t.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),t.prototype.tail=function(){return this._tail},t.prototype.setTail=function(t){this._tail=t},t}(ye),me=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.isDefined=function(){return!1},e.prototype.isEmpty=function(){return!0},Object.defineProperty(e.prototype,"key",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return""},enumerable:!0,configurable:!0}),e.prototype.tail=function(){throw new Error("undefined query")},e.prototype.setTail=function(t){throw new Error("undefined query")},e}(ye);ye.Undefined=new me;var ge=function(){function t(){this._first=ye.Undefined,this._last=null,this._size=0,this._aliased=0}return t.prototype.isEmpty=function(){return 0===this._size},t.prototype.param=function(t,e){var r=new ve(t,e,ye.Undefined);0===this._size?this._first=r:this.dealias(this._size-1).setTail(r),this._last=r,this._size+=1,this._aliased+=1},t.prototype.bind=function(){return this._aliased=0,this._first},t.prototype.dealias=function(t){var e=0,r=null,n=this._first;if(this._aliased<=t){for(;e<this._aliased;)n=(r=n).tail(),e+=1;for(;e<=t;){var i=new ve(n.key,n.value,n.tail());0===e?this._first=i:r.setTail(i),r=i,n=n.tail(),e+=1}e===this._size&&(this._last=r),this._aliased=e}else if(0===t)r=this._first;else if(t===this._size-1)r=this._last;else for(;e<=t;)n=(r=n).tail(),e+=1;return r},t}(),_e=function(){function e(t){this._part=t}return e.prototype.isDefined=function(){return null!==this._part},Object.defineProperty(e.prototype,"part",{get:function(){return this._part||""},enumerable:!0,configurable:!0}),e.prototype.writeUri=function(t){null!==this._part&&te.writeFragment(this._part,t)},e.prototype.toUri=function(){var t=new m;return this.writeUri(t),t.bind()},e.prototype.equals=function(t){return this===t||t instanceof e&&this._part===t._part},e.prototype.hashCode=function(){return h.mash(h.mix(395776270,h.hash(this._part)))},e.prototype.toString=function(){return this.toUri()},e.parse=function(t){"string"==typeof t&&(t=new v(t));var e=Yt.parse(t);return!t.isEmpty()&&e.isDone()&&(e=b.unexpected(t)),e.bind()},e.of=function(t){return null!==t?new e(t):e.Undefined},e.fromAny=function(t){if(null==t)return e.Undefined;if(t instanceof e)return t;if("string"==typeof t)return e.of(t);throw new TypeError(""+t)},e.Undefined=new e(null),e}();re.Undefined=new re(ne.Undefined,ie.Undefined,pe.Undefined),te.Empty=new te(ee.Undefined,re.Undefined,he.Empty,ye.Undefined,_e.Undefined);var be=function(){function t(){}return Object.defineProperty(t.prototype,"tag",{get:function(){},enumerable:!0,configurable:!0}),t.Any=void 0,t.Value=void 0,t.String=void 0,t.Number=void 0,t.Boolean=void 0,t.Uri=void 0,t}(),Ee=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),Object.defineProperty(e.prototype,"unit",{get:function(){},enumerable:!0,configurable:!0}),e.prototype.mold=function(t){return _.fromAny(t)},e.prototype.cast=function(t){return t.toAny()},e}(be);be.Any=new Ee;var we=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),Object.defineProperty(e.prototype,"unit",{get:function(){return _.Absent},enumerable:!0,configurable:!0}),e.prototype.mold=function(t){return _.fromAny(t)},e.prototype.cast=function(t){return t},e}(be);be.Value=new we;var xe=function(r){function t(t){void 0===t&&(t="");var e=r.call(this)||this;return e.unit=t,e}return c(t,r),t.prototype.mold=function(t){return B.valueOf(t)},t.prototype.cast=function(t){return t.target.stringValue()},t}(be);be.String=new xe;var Ae=function(r){function t(t){void 0===t&&(t=0);var e=r.call(this)||this;return e.unit=t,e}return c(t,r),t.prototype.mold=function(t){return z.valueOf(t)},t.prototype.cast=function(t){return t.target.numberValue()},t}(be);be.Number=new Ae;var Ce=function(r){function t(t){void 0===t&&(t=!1);var e=r.call(this)||this;return e.unit=t,e}return c(t,r),t.prototype.mold=function(t){return R.valueOf(t)},t.prototype.cast=function(t){return t.target.booleanValue()},t}(be);be.Boolean=new Ce;var De=function(r){function t(t){void 0===t&&(t=te.Empty);var e=r.call(this)||this;return e.unit=t,e}return c(t,r),t.prototype.mold=function(t){return B.valueOf(t.toUri())},t.prototype.cast=function(t){try{var e=t.target.stringValue();if(void 0!==e)return te.parse(e)}catch(t){}},t}(be);be.Uri=new De;var ke=function(n){function t(t,e){var r=n.call(this)||this;return r.cursor=t,r.form=e,r}return c(t,n),t.prototype.isEmpty=function(){return this.cursor.isEmpty()},t.prototype.head=function(){return this.cursor.head().coerce(this.form)},t.prototype.step=function(){this.cursor.step()},t.prototype.skip=function(t){this.cursor.skip(t)},t.prototype.hasNext=function(){return this.cursor.hasNext()},t.prototype.nextIndex=function(){return this.cursor.nextIndex()},t.prototype.next=function(){var t=this.cursor.next(),e=t.value,r=t.done;return{value:e&&e.coerce(this.form),done:r}},t.prototype.hasPrevious=function(){return this.cursor.hasPrevious()},t.prototype.previousIndex=function(){return this.cursor.previousIndex()},t.prototype.previous=function(){var t=this.cursor.next(),e=t.value,r=t.done;return{value:e&&e.coerce(this.form),done:r}},t.prototype.delete=function(){this.cursor.delete()},t}(s),Se=function(i){function t(t,e,r){var n=i.call(this)||this;return n.cursor=t,n.keyForm=e,n.valueForm=r,n}return c(t,i),t.prototype.isEmpty=function(){return this.cursor.isEmpty()},t.prototype.head=function(){var t=this.cursor.head();return[t[0].coerce(this.keyForm),t[1].coerce(this.valueForm)]},t.prototype.step=function(){this.cursor.step()},t.prototype.skip=function(t){this.cursor.skip(t)},t.prototype.hasNext=function(){return this.cursor.hasNext()},t.prototype.nextIndex=function(){return this.cursor.nextIndex()},t.prototype.next=function(){var t=this.cursor.next(),e=t.value,r=t.done;return{value:e&&[e[0].coerce(this.keyForm),e[1].coerce(this.valueForm)],done:r}},t.prototype.hasPrevious=function(){return this.cursor.hasPrevious()},t.prototype.previousIndex=function(){return this.cursor.previousIndex()},t.prototype.previous=function(){var t=this.cursor.next(),e=t.value,r=t.done;return{value:e&&[e[0].coerce(this.keyForm),e[1].coerce(this.valueForm)],done:r}},t.prototype.delete=function(){this.cursor.delete()},t}(s),Pe=function(){function t(){this._record=null,this._value=null}return t.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=0,n=t.length;r<n;r+=1){var i=t[r];i instanceof P?this.pushField(i):i instanceof _&&this.pushValue(i)}},t.prototype.pushField=function(t){null===this._record&&(this._record=O.empty(),null!==this._value&&(this._record.push(this._value),this._value=null)),this._record.push(t)},t.prototype.pushValue=function(t){null!==this._record?this._record.push(t):null!==this._value?(this._record=O.empty(),this._record.push(this._value,t),this._value=null):this._value=t},t.prototype.bind=function(){return null!==this._record?this._record:null!==this._value?this._value:_.Absent},t}(),Me=function(s){function u(t,e,r,n,i){var o=s.call(this)||this;return o.builder=e,o.keyParser=r,o.valueParser=n,o.step=i,o}return c(u,s),u.prototype.feed=function(t){return u.parse(t,this.recon,this.builder,this.keyParser,this.valueParser,this.step)},u.parse=function(t,e,r,n,i,o){void 0===o&&(o=1);var s=0;t:for(;;){if(1===o){for(;!t.isEmpty()&&(s=t.head(),b.isWhitespace(s));)t.step();if(t.isEmpty()){if(t.isDone())return r?b.done(r.bind()):b.done(e.absent())}else if(33===s||34===s||36===s||37===s||39===s||40===s||43===s||45===s||48<=s&&s<=57||64===s||91===s||123===s||126===s||rr.isIdentStartChar(s))r=r||e.valueBuilder(),o=2;else{if(35!==s)return r?b.done(r.bind()):b.done(e.absent());t.step(),o=7}}if(2===o){for(n||(n=e.parseBlockExpr(t));n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())o=3;else if(n.isError())return n}if(3===o){for(;!t.isEmpty()&&(s=t.head(),b.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return r.push(e.item(n.bind())),b.done(r.bind())}else 58===s?(t.step(),o=4):(r.push(e.item(n.bind())),n=void 0,o=6)}if(4===o){for(;!t.isEmpty()&&b.isSpace(t.head());)t.step();if(t.isEmpty()){if(t.isDone())return r.push(e.slot(n.bind())),b.done(r.bind())}else o=5}if(5===o){for(i||(i=e.parseBlockExpr(t));i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())r.push(e.slot(n.bind(),i.bind())),i=n=void 0,o=6;else if(i.isError())return i}if(6===o){for(;!t.isEmpty()&&(s=t.head(),b.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return b.done(r.bind())}else{if(44===s||59===s||b.isNewline(s)){t.step(),o=1;continue}if(35!==s)return b.done(r.bind());t.step(),o=7}}if(7===o){for(;!t.isEmpty();){if(s=t.head(),b.isNewline(s)){o=1;continue t}t.step()}if(t.isDone()){o=1;continue}}break}return new u(e,r,n,i,o)},u}(b),Ie=function(o){function s(t,e,r,n){var i=o.call(this)||this;return i.recon=t,i.keyParser=e,i.valueParser=r,i.step=n,i}return c(s,o),s.prototype.feed=function(t){return s.parse(t,this.recon,this.keyParser,this.valueParser,this.step)},s.parse=function(t,e,r,n,i){void 0===i&&(i=1);var o=0;if(1===i)if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(64!==(o=t.head()))return b.expected("@",t);t.step(),i=2}if(2===i){if(r)r=r.feed(t);else if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else if(34===(o=t.head())||39===o)r=e.parseString(t);else{if(!rr.isIdentStartChar(o))return b.expected("attribute name",t);r=e.parseIdent(t)}if(r)if(r.isDone())i=3;else if(r.isError())return r.asError()}if(3===i)if(t.isEmpty()||40!==t.head()){if(!t.isEmpty()||t.isDone())return b.done(e.attr(r.bind()))}else t.step(),i=4;if(4===i){for(;!t.isEmpty()&&(o=t.head(),b.isWhitespace(o));)t.step();if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(41===o)return t.step(),b.done(e.attr(r.bind()));n||(n=e.parseBlock(t)),i=5}}if(5===i){for(n=n;n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())i=6;else if(n.isError())return n.asError()}if(6===i){for(;!t.isEmpty()&&(o=t.head(),b.isWhitespace(o));)t.step();if(!t.isEmpty())return 41===o?(t.step(),b.done(e.attr(r.bind(),n.bind()))):b.expected(")",t);if(t.isDone())return b.unexpected(t)}return new s(e,r,n,i)},s}(b),Ve=function(s){function u(t,e,r,n,i){var o=s.call(this)||this;return o.recon=t,o.builder=e,o.fieldParser=r,o.valueParser=n,o.step=i,o}return c(u,s),u.prototype.feed=function(t){return u.parse(t,this.recon,this.builder,this.fieldParser,this.valueParser,this.step)},u.parse=function(t,e,r,n,i,o){void 0===o&&(o=1);for(var s=0;;){if(1===o)if(t.isEmpty()){if(t.isDone())return r?b.done(r.bind()):b.done(e.extant())}else if(64===(s=t.head()))n=e.parseAttr(t),o=2;else if(123===s)r=r||e.recordBuilder(),i=e.parseRecord(t,r),o=5;else if(91===s)r=r||e.recordBuilder(),i=e.parseMarkup(t,r),o=5;else if(rr.isIdentStartChar(s))i=e.parseIdent(t),o=4;else if(34===s||39===s)i=e.parseString(t),o=4;else if(45===s||48<=s&&s<=57)i=e.parseNumber(t),o=4;else if(37===s)i=e.parseData(t),o=4;else{if(36!==s)return r?b.done(r.bind()):b.done(e.extant());i=e.parseSelector(t),o=4}if(2===o){for(n=n;n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())(r=r||e.valueBuilder()).push(n.bind()),n=void 0,o=3;else if(n.isError())return n.asError()}if(3===o){for(;!t.isEmpty()&&b.isSpace(t.head());)t.step();if(!t.isEmpty()){o=1;continue}if(t.isDone())return b.done(r.bind())}if(4===o){for(i=i;i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())(r=r||e.valueBuilder()).push(e.item(i.bind())),i=void 0,o=6;else if(i.isError())return i.asError()}if(5===o){for(i=i;i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())i=void 0,o=6;else if(i.isError())return i.asError()}if(6===o){for(;!t.isEmpty()&&b.isSpace(t.head());)t.step();if(!t.isEmpty()){if(64===t.head()){o=1;continue}return b.done(r.bind())}if(t.isDone())return b.done(r.bind())}break}return new u(e,r,n,i,o)},u}(b),Oe=function(s){function u(t,e,r,n,i){var o=s.call(this)||this;return o.recon=t,o.builder=e,o.fieldParser=r,o.valueParser=n,o.step=i,o}return c(u,s),u.prototype.feed=function(t){return u.parse(t,this.recon,this.builder,this.fieldParser,this.valueParser,this.step)},u.parse=function(t,e,r,n,i,o){void 0===o&&(o=1);var s=0;if(1===o)if(t.isEmpty()){if(t.isDone())return r?b.done(r.bind()):b.done(e.extant())}else if(64===(s=t.head()))n=e.parseAttr(t),o=2;else if(123===s)r?(i=e.parseRecord(t,r),o=5):(i=e.parseRecord(t),o=4);else{if(91!==s)return r?b.done(r.bind()):b.done(e.extant());r?(i=e.parseMarkup(t,r),o=5):(i=e.parseMarkup(t),o=4)}if(2===o){for(n=n;n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())(r=r||e.valueBuilder()).push(n.bind()),n=void 0,o=3;else if(n.isError())return n.asError()}if(3===o)if(t.isEmpty()){if(t.isDone())return b.done(r.bind())}else if(123===(s=t.head()))i=e.parseRecord(t,r),o=5;else{if(91!==s)return b.done(r.bind());i=e.parseMarkup(t,r),o=5}if(4===o){for(i=i;i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())return(r=r||e.valueBuilder()).push(e.item(i.bind())),b.done(r.bind());if(i.isError())return i.asError()}if(5===o){for(i=i;i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())return b.done(r.bind());if(i.isError())return i.asError()}return new u(e,r,n,i,o)},u}(b),qe=function(s){function u(t,e,r,n,i){var o=s.call(this)||this;return o.recon=t,o.builder=e,o.keyParser=r,o.valueParser=n,o.step=i,o}return c(u,s),u.prototype.feed=function(t){return u.parse(t,this.recon,this.builder,this.keyParser,this.valueParser,this.step)},u.parse=function(t,e,r,n,i,o){void 0===o&&(o=1);var s=0;if(1===o)if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(123!==(s=t.head()))return b.expected("{",t);t.step(),o=2}t:for(;;){if(2===o){for(;!t.isEmpty()&&(s=t.head(),b.isWhitespace(s));)t.step();if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(r=r||e.recordBuilder(),125===s)return t.step(),b.done(r.bind());35===s?(t.step(),o=8):o=3}}if(3===o){for(n||(n=e.parseBlockExpr(t));n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())o=4;else if(n.isError())return n.asError()}if(4===o){for(;!t.isEmpty()&&(s=t.head(),b.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else 58===s?(t.step(),o=5):(r.push(e.item(n.bind())),n=void 0,o=7)}if(5===o){for(;!t.isEmpty()&&b.isSpace(t.head());)t.step();if(t.isEmpty()){if(t.isDone())return r.push(e.slot(n.bind())),b.done(r.bind())}else o=6}if(6===o){for(i||(i=e.parseBlockExpr(t));i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())r.push(e.slot(n.bind(),i.bind())),i=n=void 0,o=7;else if(i.isError())return i.asError()}if(7===o){for(;!t.isEmpty()&&(s=t.head(),b.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(44===s||59===s||b.isNewline(s)){t.step(),o=2;continue}if(35!==s)return 125===s?(t.step(),b.done(r.bind())):b.expected('"}", ";", ",", or newline',t);t.step(),o=8}}if(8===o){for(;!t.isEmpty();){if(s=t.head(),b.isNewline(s)){o=2;continue t}t.step()}if(t.isDone()){o=2;continue}}break}return new u(e,r,n,i,o)},u}(b),Te=function(s){function u(t,e,r,n,i){var o=s.call(this)||this;return o.recon=t,o.builder=e,o.textOutput=r,o.valueParser=n,o.step=i,o}return c(u,s),u.prototype.feed=function(t){return u.parse(t,this.recon,this.builder,this.textOutput,this.valueParser,this.step)},u.parse=function(t,e,r,n,i,o){void 0===o&&(o=1);var s=0;if(1===o)if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(91!==(s=t.head()))return b.expected("[",t);t.step(),o=2}for(;;){if(2===o){for(;!t.isEmpty()&&(64!==(s=t.head())&&91!==s&&92!==s&&93!==s&&123!==s&&125!==s);)t.step(),(n=n||e.textOutput()).push(s);if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(93===s)return t.step(),r=r||e.recordBuilder(),n&&r.push(e.item(n.bind())),b.done(r.bind());if(64===s)r=r||e.recordBuilder(),n&&(r.push(e.item(n.bind())),n=void 0),i=e.parseInlineValue(t),o=3;else if(123===s)r=r||e.recordBuilder(),n&&(r.push(e.item(n.bind())),n=void 0),i=e.parseRecord(t,r),o=4;else if(91===s)r=r||e.recordBuilder(),n&&(r.push(e.item(n.bind())),n=void 0),i=e.parseMarkup(t,r),o=4;else{if(92!==s)return b.unexpected(t);t.step(),o=5}}}if(3===o){for(i=i;i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone()){r.push(e.item(i.bind())),i=void 0,o=2;continue}if(i.isError())return i.asError()}if(4===o){for(i=i;i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone()){i=void 0,o=2;continue}if(i.isError())return i.asError()}if(5===o){if(!t.isEmpty()){if(s=t.head(),n=n||e.textOutput(),34===s||36===s||39===s||47===s||64===s||91===s||92===s||93===s||123===s||125===s)t.step(),n.push(s),o=2;else if(98===s)t.step(),n.push(8),o=2;else if(102===s)t.step(),n.push(12),o=2;else if(110===s)t.step(),n.push(10),o=2;else if(114===s)t.step(),n.push(13),o=2;else{if(116!==s)return b.expected("escape character",t);t.step(),n.push(9),o=2}continue}if(t.isDone())return b.unexpected(t)}break}return new u(e,r,n,i,o)},u}(b),Re=function(u){function a(t,e,r,n,i,o){var s=u.call(this)||this;return s.recon=t,s.dataOutput=e,s.p=r,s.q=n,s.r=i,s.step=o,s}return c(a,u),a.prototype.feed=function(t){return a.parse(t,this.recon,this.dataOutput,this.p,this.q,this.r,this.step)},a.parse=function(t,e,r,n,i,o,s){void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=1);var u=0;if(1===s)if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(37!==(u=t.head()))return b.expected("%",t);t.step(),r=r||e.dataOutput(),s=2}for(;;){if(2===s)if(t.isEmpty()){if(t.isDone())return b.done(r.bind())}else{if(u=t.head(),!b.isBase64Char(u))return b.done(r.bind());t.step(),n=u,s=3}if(3===s)if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(u=t.head(),!b.isBase64Char(u))return b.expected("base64 digit",t);t.step(),i=u,s=4}if(4===s)if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(u=t.head(),!b.isBase64Char(u)&&61!==u)return b.expected("base64 digit",t);t.step(),s=61!==(o=u)?5:6}if(5===s){if(!t.isEmpty()){if(u=t.head(),b.isBase64Char(u)||61===u){if(t.step(),a.decodeBase64Quantum(n,i,o,u,r),n=i=o=0,61!==u){s=2;continue}return b.done(r.bind())}return b.expected("base64 digit",t)}if(t.isDone())return b.unexpected(t)}else if(6===s){if(!t.isEmpty())return 61===(u=t.head())?(t.step(),a.decodeBase64Quantum(n,i,o,u,r),n=i=o=0,b.done(r.bind())):b.expected("=",t);if(t.isDone())return b.unexpected(t)}break}return new a(e,r,n,i,o,s)},a.parseBase64=function(t,e){return a.parse(t,e,e.dataOutput(),void 0,void 0,void 0,2)},a.decodeBase64Quantum=function(t,e,r,n,i){var o=b.decodeBase64Digit(t),s=b.decodeBase64Digit(e);if(61!==r){var u=b.decodeBase64Digit(r);if(61!==n){var a=b.decodeBase64Digit(n);i.push(o<<2|s>>>4,s<<4|u>>>2,u<<6|a)}else i.push(o<<2|s>>>4,s<<4|u>>>2)}else{if(61!==n)throw"incomplete base64 quantum";i.push(o<<2|s>>>4)}},a}(b),Ue=function(i){function o(t,e,r){var n=i.call(this)||this;return n.lang=t,n.output=e,n.step=r,n}return c(o,i),o.prototype.feed=function(t){return o.parse(t,this.lang,this.output,this.step)},o.parse=function(t,e,r,n){void 0===n&&(n=1);var i=0;if(1===n)if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(i=t.head(),!rr.isIdentStartChar(i))return b.expected("identifier",t);t.step(),(r=r||e.textOutput()).push(i),n=2}if(2===n){for(;!t.isEmpty()&&(i=t.head(),rr.isIdentChar(i));)t.step(),r.push(i);if(!t.isEmpty()||t.isDone())return b.done(e.ident(r.bind()))}return new o(e,r,n)},o}(b),Be=function(s){function u(t,e,r,n,i){var o=s.call(this)||this;return o.lang=t,o.output=e,o.quote=r,o.code=n,o.step=i,o}return c(u,s),u.prototype.feed=function(t){return u.parse(t,this.lang,this.output,this.quote,this.code,this.step)},u.parse=function(t,e,r,n,i,o){void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=1);var s=0;if(1===o){for(;!t.isEmpty()&&(s=t.head(),b.isWhitespace(s));)t.step();if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(34!==s&&(39!==s||n!==s&&0!==n))return b.expected("string",t);t.step(),r=r||e.textOutput(),n=s,o=2}}t:for(;;){if(r=r,2===o){for(;!t.isEmpty()&&((s=t.head())!==n&&92!==s);)t.step(),r.push(s);if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(s===n)return t.step(),b.done(r.bind());if(92!==s)return b.unexpected(t);t.step(),o=3}}if(3===o)if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(34===(s=t.head())||36===s||39===s||47===s||64===s||91===s||92===s||93===s||123===s||125===s){t.step(),r.push(s),o=2;continue}if(98===s){t.step(),r.push(8),o=2;continue}if(102===s){t.step(),r.push(12),o=2;continue}if(110===s){t.step(),r.push(10),o=2;continue}if(114===s){t.step(),r.push(13),o=2;continue}if(116===s){t.step(),r.push(9),o=2;continue}if(117!==s)return b.expected("escape character",t);t.step(),o=4}if(4<=o)for(;;){if(!t.isEmpty()){if(s=t.head(),b.isHexChar(s)){if(t.step(),i=16*i+b.decodeHexChar(s),o<=6){o+=1;continue}r.push(i),i=0,o=2;continue t}return b.expected("hex digit",t)}if(t.isDone())return b.unexpected(t);break}break}return new u(e,r,n,i,o)},u}(b),ze=function(s){function a(t,e,r,n,i){var o=s.call(this)||this;return o.lang=t,o.sign=e,o.value=r,o.mode=n,o.step=i,o}return c(a,s),a.prototype.feed=function(t){return a.parse(t,this.lang,this.sign,this.value,this.mode,this.step)},a.parse=function(t,e,r,n,i,o){void 0===r&&(r=1),void 0===n&&(n=0),void 0===i&&(i=2),void 0===o&&(o=1);var s=0;if(1===o){for(;!t.isEmpty()&&(s=t.head(),b.isWhitespace(s));)t.step();if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else 45===s&&(t.step(),r=-1),o=2}if(2===o)if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else if(48===(s=t.head()))t.step(),o=4;else{if(!(49<=s&&s<=57))return b.expected("digit",t);t.step(),n=r*(s-48),o=3}if(3===o){for(;!t.isEmpty()&&(48<=(s=t.head())&&s<=57);)t.step(),n=10*n+r*(s-48);if(t.isEmpty()){if(t.isDone())return b.done(e.number(n))}else o=4}if(4===o){if(!t.isEmpty()){if(s=t.head(),0<i&&(46===s||69===s||101===s)){var u=new m;return r<0&&0===n?u.push(45,48):u.push(n.toString()),Fe.parse(t,e,u,i)}return 120===s&&0<r&&0===n?(t.step(),je.parse(t,e)):b.done(e.number(n))}if(t.isDone())return b.done(e.number(n))}return new a(e,r,n,i,o)},a.parseInteger=function(t,e){return this.parse(t,e,void 0,void 0,0)},a.parseDecimal=function(t,e){return this.parse(t,e,void 0,void 0,1)},a}(b),Fe=function(o){function s(t,e,r,n){var i=o.call(this)||this;return i.lang=t,i.output=e,i.mode=r,i.step=n,i}return c(s,o),s.prototype.feed=function(t){return s.parse(t,this.lang,this.output,this.mode,this.step)},s.parse=function(t,e,r,n,i){void 0===n&&(n=2),void 0===i&&(i=1);var o=0;if(1===i)if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else if(46===(o=t.head()))t.step(),r.push(o),i=2;else{if(!(1<n)||69!==o&&101!==o)return b.expected("fraction or exponent",t);t.step(),r.push(o),i=5}if(2===i)if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(!(48<=(o=t.head())&&o<=57))return b.expected("digit",t);t.step(),r.push(o),i=3}if(3===i){for(;!t.isEmpty()&&(48<=(o=t.head())&&o<=57);)t.step(),r.push(o);if(t.isEmpty()){if(t.isDone())return b.done(e.number(r.bind()))}else{if(!(1<n))return b.done(e.number(r.bind()));i=4}}if(4===i){if(69!==(o=t.head())&&101!==o)return b.done(e.number(r.bind()));t.step(),r.push(o),i=5}if(5===i)if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else 43!==(o=t.head())&&45!==o||(t.step(),r.push(o)),i=6;if(6===i)if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(!(48<=(o=t.head())&&o<=57))return b.expected("digit",t);t.step(),r.push(o),i=7}if(7===i){for(;!t.isEmpty()&&(48<=(o=t.head())&&o<=57);)t.step(),r.push(o);if(!t.isEmpty()||t.isDone())return b.done(e.number(r.bind()))}return new s(e,r,n,i)},s}(b),je=function(i){function o(t,e,r){var n=i.call(this)||this;return n.lang=t,n.value=e,n.size=r,n}return c(o,i),o.prototype.feed=function(t){return o.parse(t,this.lang,this.value,this.size)},o.parse=function(t,e,r,n){void 0===r&&(r=0),void 0===n&&(n=0);for(var i=0;!t.isEmpty()&&(i=t.head(),b.isHexChar(i));)t.step(),r=16*r+b.decodeHexChar(i),n+=1;return!t.isEmpty()||t.isDone()?0<n?b.done(e.number(r)):b.expected("hex number",t):new o(e,r,n)},o}(b),Le=function(s){function u(t,e,r,n,i){var o=s.call(this)||this;return o.recon=t,o.builder=e,o.selector=r,o.valueParser=n,o.step=i,o}return c(u,s),u.prototype.feed=function(t){return u.parse(t,this.recon,this.builder,this.selector,this.valueParser,this.step)},u.parse=function(t,e,r,n,i,o){void 0===n&&(n=e.selector()),void 0===o&&(o=1);var s=0;if(1===o){for(;!t.isEmpty()&&(s=t.head(),b.isSpace(s));)t.step();if(t.isEmpty()||36!==s){if(t.isDone())return b.unexpected(t)}else t.step(),o=2}if(2===o)if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else 91===(s=t.head())?(t.step(),o=7):64===s?(t.step(),o=6):42===s?(t.step(),o=5):35===s?(t.step(),o=4):o=3;for(;;){if(3===o){for(i||(i=e.parseLiteral(t,e.valueBuilder()));i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())n=e.get(n,i.bind()),i=void 0,o=9;else if(i.isError())return i.asError()}if(4===o){for(i||(i=e.parseInteger(t));i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())n=e.value(e.getItem(n,i.bind())),i=void 0,o=9;else if(i.isError())return i.asError()}if(5===o&&(t.isEmpty()?t.isDone()&&(n=e.children(n),o=9):(58===(s=t.head())?(t.step(),n=e.keys(n)):42===s?(t.step(),n=e.descendants(n)):n=e.children(n),o=9)),6===o){for(i||(i=e.parseIdent(t));i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())n=e.getAttr(n,i.bind()),i=void 0,o=9;else if(i.isError())return i.asError()}if(7===o){for(i||(i=e.parseBlockExpr(t));i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())o=8;else if(i.isError())return i.asError()}if(8===o){for(;!t.isEmpty()&&(s=t.head(),b.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(93!==s)return b.expected("]",t);t.step(),n=e.filter(n,i.bind()),i=void 0,o=9}}if(9===o)if(t.isEmpty()){if(t.isDone())return r?(r.push(e.item(n)),b.done(r.bind())):b.done(n)}else{if(91===(s=t.head())){t.step(),o=7;continue}if(42===s){t.step(),o=5;continue}if(35===s){t.step(),o=4;continue}if(46!==s)return r?(r.push(e.item(n)),b.done(r.bind())):b.done(n);t.step(),o=10}if(10===o)if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(64!==(s=t.head())){if(42===s){t.step(),o=5;continue}o=3;continue}t.step(),o=6}break}return new u(e,r,n,i,o)},u}(b),Ke=function(o){function s(t,e,r,n){var i=o.call(this)||this;return i.recon=t,i.builder=e,i.valueParser=r,i.step=n,i}return c(s,o),s.prototype.feed=function(t){return s.parse(t,this.recon,this.builder,this.valueParser,this.step)},s.parse=function(t,e,r,n,i){void 0===i&&(i=1);var o=0;if(1===i){for(;!t.isEmpty()&&(o=t.head(),b.isSpace(o));)t.step();if(t.isEmpty()){if(t.isDone())return r?b.done(r.bind()):b.done(e.extant())}else if(40===o)t.step(),i=5;else if(123===o)r=r||e.recordBuilder(),n=e.parseRecord(t,r),i=4;else if(91===o)r=r||e.recordBuilder(),n=e.parseMarkup(t,r),i=4;else if(rr.isIdentStartChar(o))n=e.parseIdent(t),i=2;else if(34===o||39===o)n=e.parseString(t),i=2;else if(45===o||48<=o&&o<=57)n=e.parseNumber(t),i=2;else if(37===o)n=e.parseData(t),i=2;else{if(36!==o)return r?b.done(r.bind()):b.done(e.extant());n=e.parseSelector(t),i=2}}if(2===i){for(n=n;n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())return(r=r||e.valueBuilder()).push(e.item(n.bind())),b.done(r.bind());if(n.isError())return n.asError()}if(4===i){for(n=n;n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())return b.done(r.bind());if(n.isError())return n.asError()}if(5===i){for(n||(n=e.parseBlockExpr(t));n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())i=6;else if(n.isError())return n.asError()}if(6===i){for(;!t.isEmpty()&&(o=t.head(),b.isSpace(o));)t.step();if(!t.isEmpty())return 41===o?(t.step(),(r=r||e.valueBuilder()).push(e.item(n.bind())),b.done(r.bind())):b.expected(")",t);if(t.isDone())return b.unexpected(t)}return new s(e,r,n,i)},s}(b),Ne=function(u){function f(t,e,r,n,i,o){var s=u.call(this)||this;return s.recon=t,s.builder=e,s.predParser=r,s.thenParser=n,s.elseParser=i,s.step=o,s}return c(f,u),f.prototype.feed=function(t){return f.parse(t,this.recon,this.builder,this.predParser,this.thenParser,this.elseParser,this.step)},f.parse=function(t,e,r,n,i,o,s){void 0===s&&(s=1);var u=0;if(1===s){for(n||(n=e.parseLorExpr(t,r));n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())s=2;else if(n.isError())return n.asError()}if(2===s){for(;!t.isEmpty()&&(u=t.head(),b.isSpace(u));)t.step();if(t.isEmpty()){if(t.isDone())return n}else{if(63!==u)return n;t.step(),s=3}}if(3===s){for(i||(i=e.parseCondExpr(t,r));i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())s=4;else if(i.isError())return i.asError()}if(4===s){for(;!t.isEmpty()&&(u=t.head(),b.isSpace(u));)t.step();if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(58!==u)return b.expected(":",t);t.step(),s=5}}if(5===s){for(o||(o=e.parseCondExpr(t,r));o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone()){var a=n.bind(),p=i.bind(),h=o.bind();return b.done(e.cond(a,p,h))}if(o.isError())return o.asError()}return new f(e,r,n,i,o,s)},f}(b),We=function(s){function a(t,e,r,n,i){var o=s.call(this)||this;return o.recon=t,o.builder=e,o.lhsParser=r,o.rhsParser=n,o.step=i,o}return c(a,s),a.prototype.feed=function(t){return a.parse(t,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)},a.parse=function(t,e,r,n,i,o){void 0===o&&(o=1);for(;;){if(1===o){for(n||(n=e.parseLandExpr(t,r));n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())o=2;else if(n.isError())return n.asError()}if(2===o)if(t.isEmpty()){if(t.isDone())return n}else{if(124!==t.head())return n;t.step(),o=3}if(3===o){for(i||(i=e.parseLandExpr(t,r));i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone()){var s=n.bind(),u=i.bind();n=b.done(e.or(s,u)),i=void 0,o=2;continue}if(i.isError())return i.asError()}break}return new a(e,r,n,i,o)},a}(b),He=function(s){function a(t,e,r,n,i){var o=s.call(this)||this;return o.recon=t,o.builder=e,o.lhsParser=r,o.rhsParser=n,o.step=i,o}return c(a,s),a.prototype.feed=function(t){return a.parse(t,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)},a.parse=function(t,e,r,n,i,o){void 0===o&&(o=1);for(;;){if(1===o){for(n||(n=e.parseBorExpr(t,r));n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())o=2;else if(n.isError())return n.asError()}if(2===o)if(t.isEmpty()){if(t.isDone())return n}else{if(38!==t.head())return n;t.step(),o=3}if(3===o){for(i||(i=e.parseBorExpr(t,r));i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone()){var s=n.bind(),u=i.bind();n=b.done(e.and(s,u)),i=void 0,o=2;continue}if(i.isError())return i.asError()}break}return new a(e,r,n,i,o)},a}(b),Ge=function(s){function p(t,e,r,n,i){var o=s.call(this)||this;return o.recon=t,o.builder=e,o.lhsParser=r,o.rhsParser=n,o.step=i,o}return c(p,s),p.prototype.feed=function(t){return p.parse(t,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)},p.parse=function(t,e,r,n,i,o){void 0===o&&(o=1);for(var s=0;;){if(1===o){for(n||(n=e.parseBxorExpr(t,r));n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())o=2;else if(n.isError())return n.asError()}if(2===o){for(;!t.isEmpty()&&(s=t.head(),b.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return n}else{if(124!==s)return n;t.step(),o=3}}if(3===o)if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(124===(s=t.head()))return n;o=4}if(4===o){for(i||(i=e.parseBxorExpr(t,r));i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone()){var u=n.bind(),a=i.bind();n=b.done(e.bor(u,a)),i=void 0,o=2;continue}if(i.isError())return i.asError()}break}return new p(e,r,n,i,o)},p}(b),$e=function(s){function p(t,e,r,n,i){var o=s.call(this)||this;return o.recon=t,o.builder=e,o.lhsParser=r,o.rhsParser=n,o.step=i,o}return c(p,s),p.prototype.feed=function(t){return p.parse(t,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)},p.parse=function(t,e,r,n,i,o){void 0===o&&(o=1);for(var s=0;;){if(1===o){for(n||(n=e.parseBandExpr(t,r));n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())o=2;else if(n.isError())return n.asError()}if(2===o){for(;!t.isEmpty()&&(s=t.head(),b.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return n}else{if(94!==s)return n;t.step(),o=3}}if(3===o){for(i||(i=e.parseBandExpr(t,r));i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone()){var u=n.bind(),a=i.bind();n=b.done(e.bxor(u,a)),i=void 0,o=2;continue}if(i.isError())return i.asError()}break}return new p(e,r,n,i,o)},p}(b),Qe=function(s){function p(t,e,r,n,i){var o=s.call(this)||this;return o.recon=t,o.builder=e,o.lhsParser=r,o.rhsParser=n,o.step=i,o}return c(p,s),p.prototype.feed=function(t){return p.parse(t,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)},p.parse=function(t,e,r,n,i,o){void 0===o&&(o=1);for(var s=0;;){if(1===o){for(n||(n=e.parseCompExpr(t,r));n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())o=2;else if(n.isError())return n.asError()}if(2===o){for(;!t.isEmpty()&&(s=t.head(),b.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return n}else{if(38!==s)return n;t.step(),o=3}}if(3===o)if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(38===(s=t.head()))return n;o=4}if(4===o){for(i||(i=e.parseCompExpr(t,r));i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone()){var u=n.bind(),a=i.bind();n=b.done(e.band(u,a)),i=void 0,o=2;continue}if(i.isError())return i.asError()}break}return new p(e,r,n,i,o)},p}(b),Je=function(u){function h(t,e,r,n,i,o){var s=u.call(this)||this;return s.recon=t,s.builder=e,s.lhsParser=r,s.operator=n,s.rhsParser=i,s.step=o,s}return c(h,u),h.prototype.feed=function(t){return h.parse(t,this.recon,this.builder,this.lhsParser,this.operator,this.rhsParser,this.step)},h.parse=function(t,e,r,n,i,o,s){void 0===s&&(s=1);var u=0;if(1===s){for(n||(n=e.parseAttrExpr(t,r));n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())s=2;else if(n.isError())return n.asError()}if(2===s){for(;!t.isEmpty()&&(u=t.head(),b.isSpace(u));)t.step();if(t.isEmpty()){if(t.isDone())return n}else if(33===u)t.step(),s=3;else if(60===u)t.step(),s=4;else if(62===u)t.step(),s=5;else{if(61!==u)return n;t.step(),s=6}}if(3===s)if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else 61===(u=t.head())?(t.step(),i="!="):i="!",s=7;if(4===s)if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else 61===(u=t.head())?(t.step(),i="<="):i="<",s=7;if(5===s)if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else 61===(u=t.head())?(t.step(),i=">="):i=">",s=7;if(6===s)if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else 61===(u=t.head())?(t.step(),i="=="):i="=",s=7;if(7===s){for(o||(o=e.parseAttrExpr(t,r));o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone()){var a=n.bind(),p=o.bind();return"<"===i?b.done(e.lt(a,p)):"<="===i?b.done(e.le(a,p)):"=="===i?b.done(e.eq(a,p)):"!="===i?b.done(e.ne(a,p)):">="===i?b.done(e.ge(a,p)):">"===i?b.done(e.gt(a,p)):b.error(i)}if(o.isError())return o.asError()}return new h(e,r,n,i,o,s)},h}(b),Ze=function(s){function u(t,e,r,n,i){var o=s.call(this)||this;return o.recon=t,o.builder=e,o.fieldParser=r,o.valueParser=n,o.step=i,o}return c(u,s),u.prototype.feed=function(t){return u.parse(t,this.recon,this.builder,this.fieldParser,this.valueParser,this.step)},u.parse=function(t,e,r,n,i,o){void 0===o&&(o=1);for(var s=0;;){if(1===o){for(;!t.isEmpty()&&(s=t.head(),b.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return r?b.done(r.bind()):b.done(e.extant())}else if(64===s)o=2;else if(123===s||91===s)r=r||e.recordBuilder(),o=5;else{if(!(33===s||34===s||36===s||37===s||39===s||40===s||43===s||45===s||48<=s&&s<=57||126===s||rr.isIdentStartChar(s)))return r?b.done(r.bind()):b.done(e.extant());o=4}}if(2===o){for(n||(n=e.parseAttr(t));n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())(r=r||e.valueBuilder()).push(n.bind()),n=void 0,o=3;else if(n.isError())return n.asError()}if(3===o){for(;!t.isEmpty()&&b.isSpace(t.head());)t.step();if(!t.isEmpty()){o=1;continue}if(t.isDone())return b.done(r.bind())}if(4===o){for(i||(i=e.parseAddRingExpr(t));i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())(r=r||e.valueBuilder()).push(e.item(i.bind())),i=void 0,o=6;else if(i.isError())return i.asError()}if(5===o){for(i||(i=e.parseAddRingExpr(t,r));i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())i=void 0,o=6;else if(i.isError())return i.asError()}if(6===o){for(;!t.isEmpty()&&(s=t.head(),b.isSpace(s));)t.step();if(!t.isEmpty()){if(64===s){o=1;continue}return b.done(r.bind())}if(t.isDone())return b.done(r.bind())}break}return new u(e,r,n,i,o)},u}(b),Xe=function(u){function h(t,e,r,n,i,o){var s=u.call(this)||this;return s.recon=t,s.builder=e,s.lhsParser=r,s.operator=n,s.rhsParser=i,s.step=o,s}return c(h,u),h.prototype.feed=function(t){return h.parse(t,this.recon,this.builder,this.lhsParser,this.operator,this.rhsParser,this.step)},h.parse=function(t,e,r,n,i,o,s){void 0===s&&(s=1);for(var u=0;;){if(1===s){for(n||(n=e.parseMulRingExpr(t,r));n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())s=2;else if(n.isError())return n.asError()}if(2===s){for(;!t.isEmpty()&&(u=t.head(),b.isSpace(u));)t.step();if(t.isEmpty()){if(t.isDone())return n}else if(43===u)t.step(),i="+",s=3;else{if(45!==u)return n;t.step(),i="-",s=3}}if(3===s){for(o||(o=e.parseMulRingExpr(t,r));o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone()){var a=n.bind(),p=o.bind();if("+"===i)n=b.done(e.add(a,p));else{if("-"!==i)return b.error(i);n=b.done(e.sub(a,p))}i=o=void 0,s=2;continue}if(o.isError())return o.asError()}break}return new h(e,r,n,i,o,s)},h}(b),Ye=function(u){function h(t,e,r,n,i,o){var s=u.call(this)||this;return s.recon=t,s.builder=e,s.lhsParser=r,s.operator=n,s.rhsParser=i,s.step=o,s}return c(h,u),h.prototype.feed=function(t){return h.parse(t,this.recon,this.builder,this.lhsParser,this.operator,this.rhsParser,this.step)},h.parse=function(t,e,r,n,i,o,s){void 0===s&&(s=1);for(var u=0;;){if(1===s){for(n||(n=e.parsePrefixExpr(t,r));n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())s=2;else if(n.isError())return n.asError()}if(2===s){for(;!t.isEmpty()&&(u=t.head(),b.isSpace(u));)t.step();if(t.isEmpty()){if(t.isDone())return n}else if(42===u)t.step(),i="*",s=3;else if(47===u)t.step(),i="/",s=3;else{if(37!==u)return n;t.step(),i="%",s=3}}if(3===s){for(o||(o=e.parsePrefixExpr(t,r));o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone()){var a=n.bind(),p=o.bind();if("*"===i)n=b.done(e.mul(a,p));else if("/"===i)n=b.done(e.div(a,p));else{if("%"!==i)return b.error(i);n=b.done(e.mod(a,p))}i=o=void 0,s=2;continue}if(o.isError())return o.asError()}break}return new h(e,r,n,i,o,s)},h}(b),tr=function(s){function a(t,e,r,n,i){var o=s.call(this)||this;return o.recon=t,o.builder=e,o.operator=r,o.rhsParser=n,o.step=i,o}return c(a,s),a.prototype.feed=function(t){return a.parse(t,this.recon,this.builder,this.operator,this.rhsParser,this.step)},a.parse=function(t,e,r,n,i,o){void 0===o&&(o=1);var s=0;if(1===o){for(;!t.isEmpty()&&(s=t.head(),b.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return e.parsePrimaryExpr(t,r)}else{if(33===s)t.step(),n="!";else if(126===s)t.step(),n="~";else if(45===s)t.step(),n="-";else{if(43!==s)return e.parsePrimaryExpr(t,r);t.step(),n="+"}o=2}}if(2===o){for(i||(i=e.parsePrefixExpr(t,r));i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone()){var u=i.bind();return e.isDistinct(u)?"!"===n?b.done(e.not(u)):"~"===n?b.done(e.bnot(u)):"-"===n?b.done(e.neg(u)):"+"===n?b.done(e.pos(u)):b.error(n):b.expected("value",t)}if(i.isError())return i.asError()}return new a(e,r,n,i,o)},a}(b),er=function(s){function p(t,e,r,n,i){var o=s.call(this)||this;return o.recon=t,o.builder=e,o.exprParser=r,o.argsParser=n,o.step=i,o}return c(p,s),p.prototype.feed=function(t){return p.parse(t,this.recon,this.builder,this.exprParser,this.argsParser,this.step)},p.parse=function(t,e,r,n,i,o){void 0===o&&(o=1);var s=0;if(1===o){for(;!t.isEmpty()&&(s=t.head(),b.isSpace(s));)t.step();t.isEmpty()?t.isDone()&&(o=2):40===s?(t.step(),o=3):o=2}if(2===o){for(n||(n=e.parseLiteral(t,r));n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())o=5;else if(n.isError())return n.asError()}if(3===o){for(n||(n=e.parseBlockExpr(t));n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())o=4;else if(n.isError())return n.asError()}if(4===o){for(;!t.isEmpty()&&(s=t.head(),b.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(41!==s)return b.expected(")",t);t.step(),o=5}}for(;;){if(5===o){for(;!t.isEmpty()&&(s=t.head(),b.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return n}else{if(40!==s)return n;t.step(),o=6}}if(6===o){for(;!t.isEmpty()&&(s=t.head(),b.isWhitespace(s));)t.step();if(t.isEmpty()){if(t.isDone())return b.unexpected(t)}else{if(41===s){t.step();var u=n.bind();n=b.done(e.invoke(u,e.extant())),o=5;continue}o=7}}if(7===o){for(i||(i=e.parseBlock(t));i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())o=8;else if(i.isError())return i.asError()}if(8===o){for(;!t.isEmpty()&&(s=t.head(),b.isSpace(s));)t.step();if(!t.isEmpty()){if(41===s){t.step();u=n.bind();var a=i.bind();n=b.done(e.invoke(u,a)),i=void 0,o=5;continue}return b.expected(")",t)}if(t.isDone())return b.unexpected(t)}break}return new p(e,r,n,i,o)},p}(b),rr=function(){function t(){}return t.prototype.parseRecon=function(t){for("string"==typeof t&&(t=new v(t));!t.isEmpty()&&b.isWhitespace(t.head());)t.step();var e=this.parseBlock(t);if(e.isDone()){for(;!t.isEmpty()&&b.isWhitespace(t.head());)t.step();t.isEmpty()||(e=b.unexpected(t))}return e.bind()},t.prototype.parseAttr=function(t){return Ie.parse(t,this)},t.prototype.parseBlock=function(t){return Me.parse(t,this)},t.prototype.parseBlockValue=function(t){return Ve.parse(t,this)},t.prototype.parseInlineValue=function(t){return Oe.parse(t,this)},t.prototype.parseRecord=function(t,e){return qe.parse(t,this,e)},t.prototype.parseMarkup=function(t,e){return Te.parse(t,this,e)},t.prototype.parseData=function(t){return Re.parse(t,this)},t.prototype.parseBase64=function(t){return Re.parseBase64(t,this)},t.prototype.parseIdent=function(t){return Ue.parse(t,this)},t.prototype.parseString=function(t){return Be.parse(t,this)},t.prototype.parseNumber=function(t){return ze.parse(t,this)},t.prototype.parseInteger=function(t){return ze.parseInteger(t,this)},t.prototype.parseDecimal=function(t){return ze.parseDecimal(t,this)},t.prototype.parseBlockExpr=function(t,e){return this.parseCondExpr(t,e)},t.prototype.parseCondExpr=function(t,e){return Ne.parse(t,this,e)},t.prototype.parseLorExpr=function(t,e){return We.parse(t,this,e)},t.prototype.parseLandExpr=function(t,e){return He.parse(t,this,e)},t.prototype.parseBorExpr=function(t,e){return Ge.parse(t,this,e)},t.prototype.parseBxorExpr=function(t,e){return $e.parse(t,this,e)},t.prototype.parseBandExpr=function(t,e){return Qe.parse(t,this,e)},t.prototype.parseCompExpr=function(t,e){return Je.parse(t,this,e)},t.prototype.parseAttrExpr=function(t,e){return Ze.parse(t,this,e)},t.prototype.parseAddRingExpr=function(t,e){return Xe.parse(t,this,e)},t.prototype.parseMulRingExpr=function(t,e){return Ye.parse(t,this,e)},t.prototype.parsePrefixExpr=function(t,e){return tr.parse(t,this,e)},t.prototype.parsePrimaryExpr=function(t,e){return er.parse(t,this,e)},t.prototype.parseLiteral=function(t,e){return Ke.parse(t,this,e)},t.prototype.parseSelector=function(t,e){return Le.parse(t,this,e)},t.prototype.blockParser=function(){return new Me(this)},t.isIdentStartChar=function(t){return 65<=t&&t<=90||95===t||97<=t&&t<=122||192<=t&&t<=214||216<=t&&t<=246||248<=t&&t<=767||880<=t&&t<=893||895<=t&&t<=8191||8204<=t&&t<=8205||8304<=t&&t<=8591||11264<=t&&t<=12271||12289<=t&&t<=55295||63744<=t&&t<=64975||65008<=t&&t<=65533||65536<=t&&t<=983039},t.isIdentChar=function(t){return 45===t||48<=t&&t<=57||65<=t&&t<=90||95===t||97<=t&&t<=122||183===t||192<=t&&t<=214||216<=t&&t<=246||248<=t&&t<=893||895<=t&&t<=8191||8204<=t&&t<=8205||8255<=t&&t<=8256||8304<=t&&t<=8591||11264<=t&&t<=12271||12289<=t&&t<=55295||63744<=t&&t<=64975||65008<=t&&t<=65533||65536<=t&&t<=983039},t.Factory=void 0,t}(),nr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.isDistinct=function(t){return t.isDistinct()},e.prototype.item=function(t){return t},e.prototype.value=function(t){return t.toValue()},e.prototype.attr=function(t,e){return new M(t,e)},e.prototype.slot=function(t,e){return new I(t,e)},e.prototype.valueBuilder=function(){return new Pe},e.prototype.recordBuilder=function(){return O.empty()},e.prototype.dataOutput=function(){return x.empty()},e.prototype.textOutput=function(){return B.empty()},e.prototype.ident=function(t){if(t instanceof B){if("true"===t.value)return R.True;if("false"===t.value)return R.False}return t},e.prototype.number=function(t){if("number"==typeof t)return z.valueOf(t);if("string"==typeof t)return z.valueOf(+t);throw new TypeError(""+t)},e.prototype.boolean=function(t){return R.valueOf(t)},e.prototype.selector=function(){return j.Identity},e.prototype.extant=function(){return _.Extant},e.prototype.absent=function(){return _.Absent},e.prototype.cond=function(t,e,r){return t.cond(e,r)},e.prototype.or=function(t,e){return t.or(e)},e.prototype.and=function(t,e){return t.and(e)},e.prototype.bor=function(t,e){return t.bor(e)},e.prototype.bxor=function(t,e){return t.bxor(e)},e.prototype.band=function(t,e){return t.band(e)},e.prototype.lt=function(t,e){return t.lt(e)},e.prototype.le=function(t,e){return t.le(e)},e.prototype.eq=function(t,e){return t.eq(e)},e.prototype.ne=function(t,e){return t.ne(e)},e.prototype.ge=function(t,e){return t.ge(e)},e.prototype.gt=function(t,e){return t.gt(e)},e.prototype.add=function(t,e){return t.plus(e)},e.prototype.sub=function(t,e){return t.minus(e)},e.prototype.mul=function(t,e){return t.times(e)},e.prototype.div=function(t,e){return t.divide(e)},e.prototype.mod=function(t,e){return t.modulo(e)},e.prototype.not=function(t){return t.not()},e.prototype.bnot=function(t){return t.bnot()},e.prototype.neg=function(t){return t.neg()},e.prototype.pos=function(t){return t.pos()},e.prototype.invoke=function(t,e){return j.literal(t).invoke(e)},e.prototype.get=function(t,e){return t.get(e)},e.prototype.getAttr=function(t,e){return t.getAttr(B.of(e))},e.prototype.getItem=function(t,e){return t.getItem(z.of(e))},e.prototype.children=function(t){return j.literal(t).children()},e.prototype.descendants=function(t){return j.literal(t).descendants()},e.prototype.keys=function(t){return j.literal(t).keys()},e.prototype.filter=function(t,e){return t.filter(e)},e}(g.Recon=rr);rr.Factory=new nr;var ir=function(r){function t(t){void 0===t&&(t=O.empty());var e=r.call(this)||this;return e._record=t,e}return c(t,r),Object.defineProperty(t.prototype,"record",{get:function(){return this._record},set:function(t){(this._record=t).forEach(function(t,e){this.didChange(t,g.Absent,e)},this)},enumerable:!0,configurable:!0}),t.prototype.isEmpty=function(){var t;return this._record.isEmpty()&&(!(t=this.parentScope)||t.isEmpty())},t.prototype.isArray=function(){var t;return this._record.isArray()&&(!(t=this.parentScope)||t.isArray())},t.prototype.isObject=function(){var t;return this._record.isObject()&&(!(t=this.parentScope)||t.isObject())},Object.defineProperty(t.prototype,"length",{get:function(){var t;return this._record.length+((t=this.parentScope)?t.length:0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){var t;return this._record.size+((t=this.parentScope)?t.size:0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fieldCount",{get:function(){var t;return this._record.fieldCount+((t=this.parentScope)?t.fieldCount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valueCount",{get:function(){var t;return this._record.valueCount+((t=this.parentScope)?t.valueCount:0)},enumerable:!0,configurable:!0}),t.prototype.has=function(t){var e;return t=_.of(t),this._record.has(t)||!!(e=this.parentScope)&&e.has(t)},t.prototype.get=function(t){t=_.of(t);var e,r=this._record.get(t);return!r.isDefined()&&(e=this.parentScope)&&(r=e.get(t)),r},t.prototype.getAttr=function(t){t=B.of(t);var e,r=this._record.getAttr(t);return!r.isDefined()&&(e=this.parentScope)&&(r=e.getAttr(t)),r},t.prototype.getField=function(t){t=_.of(t);var e,r=this._record.getField(t);return void 0===r&&(e=this.parentScope)&&(r=e.getField(t)),r},t.prototype.getItem=function(t){t instanceof z&&(t=t.value),t<0&&(t=this.length+t),t=Math.max(0,t);var e,r=this._record.length;return t<r?this._record.getItem(t):(e=this.parentScope)&&t<r+e.length?e.getItem(t-r):g.Absent},t.prototype.set=function(t,e){var r,n=this._record.getField(t);if(void 0!==n){this._record.set(t,e);var i=this._record.getField(t);this.didChange(i,n)}else if((r=this.parentScope)&&r.get(t).isDefined())r.set(t,e);else{this._record.set(t,e);i=this._record.getField(t);this.didChange(i,g.Absent)}return this},t.prototype.setAttr=function(t,e){var r,n=this._record.getField(t);if(void 0!==n&&n instanceof M){this._record.set(t,e);var i=this._record.getField(t);this.didChange(i,n)}else if((r=this.parentScope)&&r.getAttr(t).isDefined())r.set(t,e);else{this._record.set(t,e);i=this._record.getField(t);this.didChange(i,g.Absent)}return this},t.prototype.setItem=function(t,e){t instanceof z&&(t=t.value),t<0&&(t=this.length+t),t=Math.max(0,t);var r,n=this._record.length;if(t<n){var i=this._record.getItem(t);this._record.setItem(t,e);var o=this._record.getItem(t);this.didChange(o,i,t)}else(r=this.parentScope)&&t<n+r.length&&r.setItem(t-n,e);return this},t.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=this._record.length,n=this._record.push.apply(this._record,arguments);r<n;){var i=this._record.get(r);this.didChange(i,g.Absent,r),r+=1}return n},t.prototype.splice=function(t,e){void 0===e&&(e=0);for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];t<0&&(t=this.length+t),t=Math.max(0,t);var i,o,s=this._record.length;if(e=Math.max(0,e),t<s){i=this._record.splice.apply(this._record,arguments);for(var u=0;u<i.length;u+=1)this.didChange(g.Absent,i[u],t+u);for(u=t;u<t+r.length;u+=1)this.didChange(this._record.get(u),g.Absent,u);if(s<t+e&&(o=this.parentScope)){var a=o.splice(s,t+e-s);i.push.apply(i,a)}}else(o=this.parentScope)&&(i=o.splice.apply(o,[t-s,e].concat(r)));return i},t.prototype.delete=function(t){var e,r=this._record.delete(t);return r.isDefined()?this.didChange(g.Absent,r):(e=this.parentScope)&&(r=e.delete(t)),r},t.prototype.clear=function(){var t=this._record.branch();this._record.clear(),t.forEach(function(t,e){this.didChange(g.Absent,t,e)},this);var e=this.parentScope;e&&e.clear()},t.prototype.withField=function(t,e){var r,n=this._record.getField(t);if(void 0!==n){this._record=this._record.withField(t,e);var i=this._record.getField(t);this.didChange(i,n)}else if((r=this.parentScope)&&r.has(t))r.set(t,e);else{this._record=this._record.withField(t,e);i=this._record.getField(t);this.didChange(i,g.Absent)}return this},t.prototype.withAttr=function(t,e){var r,n=this._record.getField(t);if(void 0!==n){this._record=this._record.withAttr(t,e);var i=this._record.getField(t);this.didChange(i,n)}else if((r=this.parentScope)&&r.has(t))r.set(t,e);else{this._record=this._record.withAttr(t,e);i=this._record.getField(t);this.didChange(i,g.Absent)}return this},t.prototype.withSlot=function(t,e){var r,n=this._record.getField(t);if(void 0!==n){this._record=this._record.withSlot(t,e);var i=this._record.getField(t);this.didChange(i,n)}else if((r=this.parentScope)&&r.has(t))r.set(t,e);else{this._record=this._record.withSlot(t,e);i=this._record.getField(t);this.didChange(i,g.Absent)}return this},t.prototype.forEach=function(t,e){var r=this._record.forEach(t,e);if(void 0===r){var n=this.parentScope;n&&(r=n.forEach(t,e))}return r},t.prototype.indexOf=function(t,e){void 0===e&&(e=0),e<0&&(e=this.length+e),e=Math.max(0,e);var r,n=this._record.length,i=-1;return e<n?(this._record.indexOf(t,e),e=0):e-=n,i<0&&(r=this.parentScope)&&0<=(i=r.indexOf(t,e))&&(i+=n),i},t.prototype.lastIndexOf=function(t,e){void 0===e&&(e=0),e<0&&(e=this.length+e),e=Math.max(0,e);var r,n=this._record.length,i=-1;return n<=e&&(r=this.parentScope)&&0<=(i=r.lastIndexOf(t,e-n))&&(i+=n),i<0&&(i=this._record.lastIndexOf(t,e)),i},t.prototype.isAliased=function(){return this._record.isAliased()},t.prototype.isMutable=function(){return this._record.isMutable()},t.prototype.alias=function(){this._record.alias();var t=this.parentScope;t&&t.alias()},t.prototype.branch=function(){return this._record=this._record.branch(),this},t.prototype.commit=function(){this._record.commit();var t=this.parentScope;return t&&t.commit(),this},t.prototype.didChange=function(t,e,r){},t.prototype.stack=function(){return S.of(g.GlobalScope,this)},t}(O),or=function(){function r(t){void 0===t&&(t=sr.Empty),this.root=t}return Object.defineProperty(r.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),r.prototype.isEmpty=function(){return this.root.isEmpty()},r.prototype.has=function(t){return this.root.has(t,this)},r.prototype.get=function(t){return this.root.get(t,this)},r.prototype.getEntry=function(t){return this.root.getEntry(t)},r.prototype.firstKey=function(){var t=this.root.firstEntry();return t?t[0]:void 0},r.prototype.firstValue=function(){var t=this.root.firstEntry();return t?t[1]:void 0},r.prototype.firstEntry=function(){return this.root.firstEntry()},r.prototype.lastKey=function(){var t=this.root.lastEntry();return t?t[0]:void 0},r.prototype.lastValue=function(){var t=this.root.lastEntry();return t?t[1]:void 0},r.prototype.lastEntry=function(){return this.root.lastEntry()},r.prototype.nextKey=function(t){var e=this.root.nextEntry(t,this);return e?e[0]:void 0},r.prototype.nextValue=function(t){var e=this.root.nextEntry(t,this);return e?e[1]:void 0},r.prototype.nextEntry=function(t){return this.root.nextEntry(t,this)},r.prototype.previousKey=function(t){var e=this.root.previousEntry(t,this);return e?e[0]:void 0},r.prototype.previousValue=function(t){var e=this.root.previousEntry(t,this);return e?e[1]:void 0},r.prototype.previousEntry=function(t){return this.root.previousEntry(t,this)},r.prototype.set=function(t,e){var r=this.root,n=this.root.updated(t,e,this);return r!==n&&(n.size>r.size&&(n=n.balanced(this)),this.root=n),this},r.prototype.delete=function(t){var e=this.root,r=this.root.removed(t,this);return e!==r&&(this.root=r,!0)},r.prototype.drop=function(t){return 0<t&&0<this.root.size&&(t<this.root.size?this.root=this.root.drop(t,this):this.root=sr.Empty),this},r.prototype.take=function(t){return t<this.root.size&&0<this.root.size&&(this.root=0<t?this.root.take(t,this):sr.Empty),this},r.prototype.clear=function(){this.root=sr.Empty},r.prototype.updated=function(t,e){var r=this.root,n=r.updated(t,e,this);return r!==n?(n.size>r.size&&(n=n.balanced(this)),this.copy(n)):this},r.prototype.removed=function(t){var e=this.root,r=e.removed(t,this);return e!==r?this.copy(r):this},r.prototype.cleared=function(){return this.root.isEmpty()?this:this.copy(sr.Empty)},r.prototype.forEach=function(t,e){return this.root.forEach(t,e,this)},r.prototype.keys=function(){return this.root.keys()},r.prototype.values=function(){return this.root.values()},r.prototype.entries=function(){return this.root.entries()},r.prototype.reverseKeys=function(){return this.root.reverseKeys()},r.prototype.reverseValues=function(){return this.root.reverseValues()},r.prototype.reverseEntries=function(){return this.root.reverseEntries()},r.prototype.clone=function(){return this.copy(this.root)},r.prototype.copy=function(t){var e=new r(t);return e.compare!==this.compare&&(e.compare=this.compare),e.pageSplitSize!==this.pageSplitSize&&(e.pageSplitSize=this.pageSplitSize),e},r.prototype.toValue=function(){return this.root.toValue()},r.prototype.toRecon=function(){return this.toValue().toRecon()},r.prototype.compare=function(t,e){return k(t,e)},r.prototype.pageShouldSplit=function(t){return t.arity>this.pageSplitSize},r.prototype.pageShouldMerge=function(t){return t.arity<this.pageSplitSize>>>1},r}();or.prototype.pageSplitSize=32;var sr=function(){function t(){}return t.prototype.keys=function(){return new p(this.entries())},t.prototype.values=function(){return new f(this.entries())},t.prototype.reverseKeys=function(){return new p(this.reverseEntries())},t.prototype.reverseValues=function(){return new f(this.reverseEntries())},t.prototype.toRecon=function(){return this.toValue().toRecon()},t.Empty=void 0,t}(),ur=function(r){function s(t){var e=r.call(this)||this;return e.slots=t,e}return c(s,r),Object.defineProperty(s.prototype,"arity",{get:function(){return this.slots.length},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"size",{get:function(){return this.slots.length},enumerable:!0,configurable:!0}),s.prototype.isEmpty=function(){return 0===this.slots.length},s.prototype.minKey=function(){return this.slots[0][0]},s.prototype.maxKey=function(){return this.slots[this.slots.length-1][0]},s.prototype.has=function(t,e){return 0<=this.lookup(t,e)},s.prototype.get=function(t,e){var r=this.lookup(t,e);return 0<=r?this.slots[r][1]:void 0},s.prototype.getEntry=function(t){return this.slots[t]},s.prototype.firstEntry=function(){return this.slots.length?this.slots[0]:void 0},s.prototype.lastEntry=function(){return this.slots.length?this.slots[this.slots.length-1]:void 0},s.prototype.nextEntry=function(t,e){var r=this.lookup(t,e);return 0<=r?r+=1:r=-(r+1),this.slots[r]},s.prototype.previousEntry=function(t,e){var r=this.lookup(t,e);return 0<=r?r-=1:r=-(r+2),this.slots[r]},s.prototype.updated=function(t,e,r){var n=this.lookup(t,r);return 0<=n?this.updatedSlot(n,t,e):(n=-(n+1),this.insertedSlot(n,t,e))},s.prototype.updatedSlot=function(t,e,r){var n=this.slots;if(r!==n[t][1]){var i=n.slice(0);return i[t]=[e,r],new s(i)}return this},s.prototype.insertedSlot=function(t,e,r){for(var n=this.slots,i=new Array(n.length+1),o=0;o<t;o+=1)i[o]=n[o];i[t]=[e,r];for(o=t;o<n.length;o+=1)i[o+1]=n[o];return new s(i)},s.prototype.removed=function(t,e){var r=this.lookup(t,e);return 0<=r?1<this.slots.length?this.removedSlot(r):sr.Empty:this},s.prototype.removedSlot=function(t){for(var e=this.slots,r=new Array(e.length-1),n=0;n<t;n+=1)r[n]=e[n];for(n=t;n<r.length;n+=1)r[n]=e[n+1];return new s(r)},s.prototype.drop=function(t,e){var r=this.slots;if(0<t&&0<r.length){if(t<r.length){for(var n=r.length-t,i=new Array(n),o=0;o<n;o+=1)i[o]=r[o+t];return new s(i)}return sr.Empty}return this},s.prototype.take=function(t,e){var r=this.slots;if(t<r.length&&0<r.length){if(0<t){for(var n=new Array(t),i=0;i<t;i+=1)n[i]=r[i];return new s(n)}return sr.Empty}return this},s.prototype.balanced=function(t){var e=this.slots.length;return 1<e&&t.pageShouldSplit(this)?this.split(e>>>1):this},s.prototype.split=function(t){var e=new Array(2),r=this.splitLeft(t),n=this.splitRight(t);e[0]=r,e[1]=n;var i=new Array(1);return i[0]=n.minKey(),new ar(e,i,this.slots.length)},s.prototype.splitLeft=function(t){for(var e=this.slots,r=new Array(t),n=0;n<t;n+=1)r[n]=e[n];return new s(r)},s.prototype.splitRight=function(t){for(var e=this.slots,r=e.length-t,n=new Array(r),i=0;i<r;i+=1)n[i]=e[i+t];return new s(n)},s.prototype.forEach=function(t,e,r){for(var n=0;n<this.slots.length;n+=1){var i=this.slots[n],o=t.call(e,i[0],i[1],r);if(void 0!==o)return o}},s.prototype.entries=function(){return new l(this.slots)},s.prototype.reverseEntries=function(){return new l(this.slots,this.slots.length)},s.prototype.toValue=function(){var t=O.empty(1+this.slots.length);t.attr("bleaf",O.empty(1).slot("size",this.slots.length));for(var e=0;e<this.slots.length;e+=1){var r=this.slots[e];t.slot(_.fromAny(r[0]),_.fromAny(r[1]))}return t},s.prototype.lookup=function(t,e){for(var r=0,n=this.slots.length-1;r<=n;){var i=r+n>>>1,o=e.compare(t,this.slots[i][0]);if(0<o)r=i+1;else{if(!(o<0))return i;n=i-1}}return-(r+1)},s}(sr);sr.Empty=new ur([]);var ar=function(i){function l(t,e,r){var n=i.call(this)||this;return n.pages=t,n.knots=e,n.size=r,n}return c(l,i),Object.defineProperty(l.prototype,"arity",{get:function(){return this.pages.length},enumerable:!0,configurable:!0}),l.prototype.isEmpty=function(){return 0===this.size},l.prototype.minKey=function(){return this.pages[0].minKey()},l.prototype.maxKey=function(){return this.pages[this.pages.length-1].maxKey()},l.prototype.has=function(t,e){var r=this.lookup(t,e);if(0<r)r+=1;else{if(!(r<0))return!0;r=-(r+1)}return this.pages[r].has(t,e)},l.prototype.get=function(t,e){var r=this.lookup(t,e);return 0<=r?r+=1:r=-(r+1),this.pages[r].get(t,e)},l.prototype.getEntry=function(t){for(var e=0;e<this.pages.length;e+=1){var r=this.pages[e];if(t<r.size)return r.getEntry(t);t-=r.size}},l.prototype.firstEntry=function(){return this.pages.length?this.pages[0].firstEntry():void 0},l.prototype.lastEntry=function(){return this.pages.length?this.pages[this.pages.length-1].lastEntry():void 0},l.prototype.nextEntry=function(t,e){var r=this.lookup(t,e);0<=r?r+=1:r=-(r+1);var n=this.pages[r].nextEntry(t,e);return void 0===n&&r+1<this.pages.length&&(n=this.pages[r+1].nextEntry(t,e)),n},l.prototype.previousEntry=function(t,e){var r=this.lookup(t,e);0<=r?r+=1:r=-(r+1);var n=this.pages[r].previousEntry(t,e);return void 0===n&&0<r&&(n=this.pages[r-1].previousEntry(t,e)),n},l.prototype.updated=function(t,e,r){var n=this.lookup(t,r);0<=n?n+=1:n=-(n+1);var i=this.pages[n],o=i.updated(t,e,r);return i!==o?i.size!==o.size&&r.pageShouldSplit(o)?this.updatedPageSplit(n,o,i):this.updatedPage(n,o,i):this},l.prototype.updatedPage=function(t,e,r){var n=this.pages.slice(0);n[t]=e;var i,o=this.knots;return 0<o.length?(i=o.slice(0),0<t&&(i[t-1]=e.minKey())):i=[],new l(n,i,this.size-r.size+e.size)},l.prototype.updatedPageSplit=function(t,e,r){for(var n=this.pages,i=new Array(n.length+1),o=0;o<t;o+=1)i[o]=n[o];var s=e.splitLeft(e.arity>>>1),u=e.splitRight(e.arity>>>1);i[t]=s,i[t+1]=u;for(o=t+1;o<n.length;o+=1)i[o+1]=n[o];var a=this.knots,p=new Array(n.length);if(0<t){for(o=0;o<t-1;o+=1)p[o]=a[o];p[t-1]=s.minKey(),p[t]=u.minKey();for(o=t;o<a.length;o+=1)p[o+1]=a[o]}else{p[0]=u.minKey();for(o=0;o<a.length;o+=1)p[o+1]=a[o]}return new l(i,p,this.size-r.size+e.size)},l.prototype.updatedPageMerge=function(t,e,r){for(var n=this.pages,i=e.pages,o=new Array(n.length+i.length-1),s=0;s<t;s+=1)o[s]=n[s];for(s=0;s<i.length;s+=1)o[s+t]=i[s];for(s=t+1;s<n.length;s+=1)o[s+i.length-1]=n[s];var u=this.knots,a=e.knots,p=new Array(o.length-1);if(0<t){for(s=0;s<t-1;s+=1)p[s]=u[s];p[t-1]=i[0].minKey();for(s=0;s<a.length;s+=1)p[s+t]=a[s];for(s=t;s<u.length;s+=1)p[s+a.length]=u[s]}else{for(s=0;s<a.length;s+=1)p[s]=a[s];p[a.length]=n[1].minKey();for(s=1;s<u.length;s+=1)p[s+a.length]=u[s]}return new l(o,p,this.size-r.size+e.size)},l.prototype.removed=function(t,e){var r=this.lookup(t,e);0<=r?r+=1:r=-(r+1);var n=this.pages[r],i=n.removed(t,e);return n!==i?this.replacedPage(r,i,n,e):this},l.prototype.replacedPage=function(t,e,r,n){return e.isEmpty()?2<this.pages.length?this.removedPage(t,e,r):1<this.pages.length?0===t?this.pages[1]:this.pages[0]:sr.Empty:e instanceof l&&n.pageShouldMerge(e)?this.updatedPageMerge(t,e,r):this.updatedPage(t,e,r)},l.prototype.removedPage=function(t,e,r){for(var n=this.pages,i=new Array(n.length-1),o=0;o<t;o+=1)i[o]=n[o];for(o=t+1;o<n.length;o+=1)i[o-1]=n[o];var s=this.knots,u=new Array(s.length-1);if(0<t){for(o=0;o<t-1;o+=1)u[o]=s[o];for(o=t;o<s.length;o+=1)u[o-1]=s[o]}else for(o=1;o<s.length;o+=1)u[o-1]=s[o];return new l(i,u,this.size-r.size)},l.prototype.drop=function(t,e){if(0<t){var r=this.size;if(t<r){for(var n=this.pages,i=0;i<n.length;){var o=n[i].size;if(!(o<=t))break;r-=o,t-=o,i+=1}var s=n.length-i;if(1<s){var u=void 0;if(0<i){for(var a=new Array(s),p=0;p<s;p+=1)a[p]=n[p+i];var h=new Array(s-1);for(p=0;p<h.length;p+=1)h[p]=this.knots[p+i];u=new l(a,h,r)}else u=this;if(0<t){var f=n[i],c=f.drop(t,e);return u.replacedPage(0,c,f,e)}return u}return n[i].drop(t,e)}return sr.Empty}return this},l.prototype.take=function(t,e){if(t<this.size){if(0<t){for(var r=this.pages,n=0,i=0;i<r.length&&0<t;){var o=r[i].size;if(n+=o,i+=1,!(o<=t))break;t-=o}var s=0===t?i:i+1;if(1<s){var u=void 0;if(i<r.length){for(var a=new Array(s),p=0;p<s;p+=1)a[p]=r[p];var h=new Array(s-1);for(p=0;p<h.length;p+=1)h[p]=this.knots[p];u=new l(a,h,n)}else u=this;if(0<t){var f=r[i-1],c=f.take(t,e);return u.replacedPage(i-1,c,f,e)}return u}return 0<t?r[0].take(t,e):r[0]}return sr.Empty}return this},l.prototype.balanced=function(t){return 1<this.pages.length&&t.pageShouldSplit(this)?this.split(this.knots.length>>>1):this},l.prototype.split=function(t){var e=new Array(2),r=this.splitLeft(t),n=this.splitRight(t);e[0]=r,e[1]=n;var i=new Array(1);return i[0]=n.minKey(),new l(e,i,this.size)},l.prototype.splitLeft=function(t){for(var e=this.pages,r=new Array(t+1),n=0;n<t+1;n+=1)r[n]=e[n];var i=this.knots,o=new Array(t);for(n=0;n<t;n+=1)o[n]=i[n];var s=0;for(n=0;n<=t;n+=1)s+=r[n].size;return new l(r,o,s)},l.prototype.splitRight=function(t){for(var e=this.pages,r=e.length-(t+1),n=new Array(r),i=0;i<r;i+=1)n[i]=e[i+(t+1)];var o=this.knots,s=new Array(r-1);for(i=0;i<s.length;i+=1)s[i]=o[i+(t+1)];var u=0;for(i=0;i<r;i+=1)u+=n[i].size;return new l(n,s,u)},l.prototype.forEach=function(t,e,r){for(var n=0;n<this.pages.length;n+=1){var i=this.pages[n].forEach(t,e,r);if(void 0!==i)return i}},l.prototype.entries=function(){return new pr(this.pages)},l.prototype.reverseEntries=function(){return new pr(this.pages,this.size,this.pages.length)},l.prototype.toValue=function(){var t=O.empty(1+this.pages.length+this.knots.length);t.attr("bnode",O.empty(1).slot("size",this.size));for(var e=0;e<this.pages.length;e+=1){if(0<e){var r=_.fromAny(this.knots[e-1]);t.push(O.empty(1).attr("knot",O.empty(1).slot("key",r)))}t.push(this.pages[e].toValue())}return t},l.prototype.lookup=function(t,e){for(var r=0,n=this.knots.length-1;r<=n;){var i=r+n>>>1,o=e.compare(t,this.knots[i]);if(0<o)r=i+1;else{if(!(o<0))return i;n=i-1}}return-(r+1)},l}(sr),pr=function(i){function t(t,e,r,n){return i.call(this,t,e,r,n)||this}return c(t,i),t.prototype.pageSize=function(t){return t.size},t.prototype.pageCursor=function(t){return t.entries()},t.prototype.reversePageCursor=function(t){return t.reverseEntries()},t}(d),hr=function(){function r(t){void 0===t&&(t=fr.Empty),this.root=t}return Object.defineProperty(r.prototype,"length",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),r.prototype.isEmpty=function(){return this.root.isEmpty()},r.prototype.get=function(t,e){if(!(void 0!==e&&(t=this.lookup(e,t))<0))return this.root.get(t)},r.prototype.getEntry=function(t,e){if(!(void 0!==e&&(t=this.lookup(e,t))<0))return this.root.getEntry(t)},r.prototype.set=function(t,e,r){if(void 0!==r&&(t=this.lookup(r,t))<0)throw new RangeError(""+r);if(t<0||t>=this.root.size)throw new RangeError(""+t);return this.root=this.root.updated(t,e,this),this},r.prototype.insert=function(t,e,r){if(t<0||t>this.root.size)throw new RangeError(""+t);return this.root=this.root.inserted(t,e,r,this).balanced(this),this},r.prototype.remove=function(t,e){if(void 0!==e&&(t=this.lookup(e,t))<0)throw new RangeError(""+e);if(t<0||t>this.root.size)throw new RangeError(""+t);return this.root=this.root.removed(t,this),this},r.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=0;r<t.length;r+=1)this.root=this.root.inserted(this.root.size,t[r],void 0,this).balanced(this);return this.root.size},r.prototype.pop=function(){var t=this.root.size-1;if(0<=t){var e=this.root.get(t);return this.root=this.root.removed(t,this),e}},r.prototype.unshift=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=t.length-1;0<=r;r-=1)this.root=this.root.inserted(0,t[r],void 0,this).balanced(this);return this.root.size},r.prototype.shift=function(){if(0<this.root.size){var t=this.root.get(0);return this.root=this.root.removed(0,this),t}},r.prototype.move=function(t,e,r){if(void 0!==r&&(t=this.lookup(r,t))<0)throw new RangeError(""+r);if(t<0||t>=this.root.size)throw new RangeError(""+t);if(e<0||e>=this.root.size)throw new RangeError(""+e);if(t!==e){var n=this.root.getEntry(t);this.root=this.root.removed(t,this).inserted(e,n[1],n[0],this).balanced(this)}return this},r.prototype.splice=function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];t<0&&(t=this.root.size+t),t=Math.min(Math.max(0,t),this.root.size),void 0===e&&(e=this.root.size-t);for(var i=[],o=t,s=t+e;o<s;o+=1)i.push(this.root.get(t)),this.root=this.root.removed(t,this);for(o=0;o<r.length;o+=1)this.root=this.root.inserted(t+o,r[o],void 0,this).balanced(this);return i},r.prototype.drop=function(t){return 0<t&&0<this.root.size&&(t<this.root.size?this.root=this.root.drop(t,this):this.root=fr.Empty),this},r.prototype.take=function(t){return t<this.root.size&&0<this.root.size&&(this.root=0<t?this.root.take(t,this):fr.Empty),this},r.prototype.clear=function(){this.root=fr.Empty},r.prototype.forEach=function(t,e){return this.root.forEach(t,e,0,this)},r.prototype.keys=function(){return this.root.keys()},r.prototype.values=function(){return this.root.values()},r.prototype.entries=function(){return this.root.entries()},r.prototype.reverseKeys=function(){return this.root.reverseKeys()},r.prototype.reverseValues=function(){return this.root.reverseValues()},r.prototype.reverseEntries=function(){return this.root.reverseEntries()},r.prototype.clone=function(){return this.copy(this.root)},r.prototype.copy=function(t){var e=new r(t);return e.identify!==this.identify&&(e.identify=this.identify),e.compare!==this.compare&&(e.compare=this.compare),e.pageSplitSize!==this.pageSplitSize&&(e.pageSplitSize=this.pageSplitSize),e},r.prototype.toValue=function(){return this.root.toValue()},r.prototype.toRecon=function(){return this.toValue().toRecon()},r.prototype.identify=function(t){var e=new Uint8Array(6);return C.fillBytes(e),e},r.prototype.compare=function(t,e){return k(t,e)},r.prototype.pageShouldSplit=function(t){return t.arity>this.pageSplitSize},r.prototype.pageShouldMerge=function(t){return t.arity<this.pageSplitSize>>>1},r.prototype.lookup=function(t,e){void 0===e&&(e=0);var r=e=Math.min(Math.max(0,e),this.root.size-1);do{var n=this.root.getEntry(r);if(n&&0===this.compare(n[0],t))return r;r=(r+1)%this.root.size}while(isFinite(r)&&r!==e);return-1},r}();hr.prototype.pageSplitSize=32;var fr=function(){function t(){}return t.prototype.keys=function(){return new p(this.entries())},t.prototype.values=function(){return new f(this.entries())},t.prototype.reverseKeys=function(){return new p(this.reverseEntries())},t.prototype.reverseValues=function(){return new f(this.reverseEntries())},t.prototype.toRecon=function(){return this.toValue().toRecon()},t.Empty=void 0,t}(),cr=function(r){function u(t){var e=r.call(this)||this;return e.slots=t,e}return c(u,r),Object.defineProperty(u.prototype,"arity",{get:function(){return this.slots.length},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"size",{get:function(){return this.slots.length},enumerable:!0,configurable:!0}),u.prototype.isEmpty=function(){return 0===this.slots.length},u.prototype.get=function(t){var e=this.slots[t];return e?e[1]:void 0},u.prototype.getEntry=function(t){return this.slots[t]},u.prototype.updated=function(t,e,r){if(t<0||t>=this.slots.length)throw new RangeError(""+t);return this.updatedItem(t,e)},u.prototype.updatedItem=function(t,e){var r=this.slots,n=r[t];if(e!==n[1]){var i=r.slice(0);return i[t]=[n[0],e],new u(i)}return this},u.prototype.inserted=function(t,e,r,n){if(t<0||t>this.slots.length)throw new RangeError(""+t);return this.insertedItem(t,e,r,n)},u.prototype.insertedItem=function(t,e,r,n){void 0===r&&(r=n.identify(e));for(var i=this.slots,o=new Array(i.length+1),s=0;s<t;s+=1)o[s]=i[s];o[t]=[r,e];for(s=t;s<i.length;s+=1)o[s+1]=i[s];return new u(o)},u.prototype.removed=function(t,e){if(t<0||t>=this.slots.length)throw new RangeError(""+t);return 1<this.slots.length?this.removedSlot(t):fr.Empty},u.prototype.removedSlot=function(t){for(var e=this.slots,r=new Array(e.length-1),n=0;n<t;n+=1)r[n]=e[n];for(n=t;n<r.length;n+=1)r[n]=e[n+1];return new u(r)},u.prototype.drop=function(t,e){var r=this.slots;if(0<t&&0<r.length){if(t<r.length){for(var n=r.length-t,i=new Array(n),o=0;o<n;o+=1)i[o]=r[o+t];return new u(i)}return fr.Empty}return this},u.prototype.take=function(t,e){var r=this.slots;if(t<r.length&&0<r.length){if(0<t){for(var n=new Array(t),i=0;i<t;i+=1)n[i]=r[i];return new u(n)}return fr.Empty}return this},u.prototype.balanced=function(t){var e=this.slots.length;return 1<e&&t.pageShouldSplit(this)?this.split(e>>>1):this},u.prototype.split=function(t){var e=new Array(2),r=this.splitLeft(t),n=this.splitRight(t);e[0]=r,e[1]=n;var i=new Array(1);return i[0]=t,new lr(e,i,this.slots.length)},u.prototype.splitLeft=function(t){for(var e=this.slots,r=new Array(t),n=0;n<t;n+=1)r[n]=e[n];return new u(r)},u.prototype.splitRight=function(t){for(var e=this.slots,r=e.length-t,n=new Array(r),i=0;i<r;i+=1)n[i]=e[i+t];return new u(n)},u.prototype.forEach=function(t,e,r,n){for(var i=0;i<this.slots.length;i+=1){var o=this.slots[i],s=t.call(e,o[1],r+i,n,o[0]);if(void 0!==s)return s}},u.prototype.entries=function(){return new l(this.slots)},u.prototype.reverseEntries=function(){return new l(this.slots,this.slots.length)},u.prototype.toValue=function(){var t=O.empty(1+this.slots.length);t.attr("sleaf",O.empty(1).slot("size",this.slots.length));for(var e=0;e<this.slots.length;e+=1){var r=this.slots[e];t.slot(_.of(r[0]),_.of(r[1]))}return t},u}(fr);fr.Empty=new cr([]);var lr=function(o){function f(t,e,r){var n=o.call(this)||this;if(n.pages=t,void 0===e||void 0===r){e=new Array(t.length-1);for(var i=r=0;i<e.length;i+=1)r+=t[i].size,e[i]=r;r+=t[e.length].size}return n.knots=e,n.size=r,n}return c(f,o),Object.defineProperty(f.prototype,"arity",{get:function(){return this.pages.length},enumerable:!0,configurable:!0}),f.prototype.isEmpty=function(){return 0===this.size},f.prototype.get=function(t){var e=this.lookup(t);0<=e?e+=1:e=-(e+1);var r=0===e?t:t-this.knots[e-1];return this.pages[e].get(r)},f.prototype.getEntry=function(t){var e=this.lookup(t);0<=e?e+=1:e=-(e+1);var r=0===e?t:t-this.knots[e-1];return this.pages[e].getEntry(r)},f.prototype.updated=function(t,e,r){var n=this.lookup(t);0<=n?n+=1:n=-(n+1);var i=0===n?t:t-this.knots[n-1],o=this.pages[n],s=o.updated(i,e,r);return o!==s?o.size!==s.size&&r.pageShouldSplit(s)?this.updatedPageSplit(n,s,o):this.updatedPage(n,s,o):this},f.prototype.updatedPage=function(t,e,r){var n=this.pages,i=n.slice(0);i[t]=e;var o,s,u=this.knots;if(0<n.length-1){o=u.slice(0),s=0<t?u[t-1]:0;for(var a=t;a<o.length;a+=1)s+=i[a].size,o[a]=s;s+=i[o.length].size}else o=[],s=0;return new f(i,o,s)},f.prototype.updatedPageSplit=function(t,e,r){for(var n=this.pages,i=new Array(n.length+1),o=0;o<t;o+=1)i[o]=n[o];var s=e.splitLeft(e.arity>>>1),u=e.splitRight(e.arity>>>1);i[t]=s,i[t+1]=u;for(o=t+1;o<n.length;o+=1)i[o+1]=n[o];return new f(i)},f.prototype.updatedPageMerge=function(t,e,r){for(var n=this.pages,i=e.pages,o=new Array(n.length+i.length-1),s=0;s<t;s+=1)o[s]=n[s];for(s=0;s<i.length;s+=1)o[s+t]=i[s];for(s=t+1;s<n.length;s+=1)o[s+i.length-1]=n[s];return new f(o)},f.prototype.inserted=function(t,e,r,n){var i=this.lookup(t);0<=i?i+=1:i=-(i+1);var o=0===i?t:t-this.knots[i-1],s=this.pages[i],u=s.inserted(o,e,r,n);return s!==u?n.pageShouldSplit(u)?this.updatedPageSplit(i,u,s):this.updatedPage(i,u,s):this},f.prototype.removed=function(t,e){var r=this.lookup(t);0<=r?r+=1:r=-(r+1);var n=0===r?t:t-this.knots[r-1],i=this.pages[r],o=i.removed(n,e);return i!==o?this.replacedPage(r,o,i,e):this},f.prototype.replacedPage=function(t,e,r,n){return e.isEmpty()?2<this.pages.length?this.removedPage(t,e,r):1<this.pages.length?0===t?this.pages[1]:this.pages[0]:fr.Empty:e instanceof f&&n.pageShouldMerge(e)?this.updatedPageMerge(t,e,r):this.updatedPage(t,e,r)},f.prototype.removedPage=function(t,e,r){for(var n=this.pages,i=new Array(n.length-1),o=0;o<t;o+=1)i[o]=n[o];for(o=t+1;o<n.length;o+=1)i[o-1]=n[o];var s,u=this.knots,a=new Array(u.length-1);if(0<t){for(o=0;o<t;o+=1)a[o]=u[o];s=u[t-1]}else s=0;for(o=t;o<a.length;o+=1)s+=i[o].size,a[o]=s;return new f(i,a,s+=i[a.length].size)},f.prototype.drop=function(t,e){if(0<t){if(t<this.size){var r=this.lookup(t);0<=r?r+=1:r=-(r+1),t=0===r?t:t-this.knots[r-1];var n=this.pages,i=n.length-r;if(1<i){var o=void 0;if(0<r){for(var s=new Array(i),u=0;u<i;u+=1)s[u]=n[u+r];o=new f(s)}else o=this;if(0<t){var a=n[r],p=a.drop(t,e);return o.replacedPage(0,p,a,e)}return o}return n[r].drop(t,e)}return fr.Empty}return this},f.prototype.take=function(t,e){if(t<this.size){if(0<t){var r=this.lookup(t);0<=r?r+=1:r=-(r+1),t=0===r?t:t-this.knots[r-1];var n=this.pages,i=0===t?r:r+1;if(1<i){var o=void 0;if(r<n.length){for(var s=new Array(i),u=0;u<i;u+=1)s[u]=n[u];var a=new Array(i-1);for(u=0;u<a.length;u+=1)a[u]=this.knots[u];o=new f(s,a,a[i-2]+s[i-1].size)}else o=this;if(0<t){var p=n[r],h=p.take(t,e);return o.replacedPage(r,h,p,e)}return o}return 0<t?n[0].take(t,e):n[0]}return fr.Empty}return this},f.prototype.balanced=function(t){return 1<this.pages.length&&t.pageShouldSplit(this)?this.split(this.knots.length>>>1):this},f.prototype.split=function(t){var e=new Array(2),r=this.splitLeft(t),n=this.splitRight(t);e[0]=r,e[1]=n;var i=new Array(1);return i[0]=r.size,new f(e,i,this.size)},f.prototype.splitLeft=function(t){for(var e=this.pages,r=new Array(t+1),n=0;n<t+1;n+=1)r[n]=e[n];var i=this.knots,o=new Array(t);for(n=0;n<t;n+=1)o[n]=i[n];var s=0;for(n=0;n<=t;n+=1)s+=r[n].size;return new f(r,o,s)},f.prototype.splitRight=function(t){for(var e=this.pages,r=e.length-(t+1),n=new Array(r),i=0;i<r;i+=1)n[i]=e[i+(t+1)];var o,s=new Array(r-1);if(0<r){o=n[0].size;for(i=1;i<r;i+=1)s[i-1]=o,o+=n[i].size}else o=0;return new f(n,s,o)},f.prototype.forEach=function(t,e,r,n){for(var i=0;i<this.pages.length;i+=1){var o=this.pages[i],s=o.forEach(t,e,r,n);if(void 0!==s)return s;r+=o.size}},f.prototype.entries=function(){return new dr(this.pages)},f.prototype.reverseEntries=function(){return new dr(this.pages,this.size,this.pages.length)},f.prototype.toValue=function(){var t=O.empty(1+this.pages.length+this.knots.length);t.attr("snode",O.empty(1).slot("size",this.size));for(var e=0;e<this.pages.length;e+=1)0<e&&t.push(O.empty(1).attr("knot",O.empty(1).slot("index",this.knots[e-1]))),t.push(this.pages[e].toValue());return t},f.prototype.lookup=function(t){for(var e=0,r=this.knots.length-1;e<=r;){var n=e+r>>>1;if(t>this.knots[n])e=n+1;else{if(!(t<this.knots[n]))return n;r=n-1}}return-(e+1)},f}(fr),dr=function(i){function t(t,e,r,n){return i.call(this,t,e,r,n)||this}return c(t,i),t.prototype.pageSize=function(t){return t.size},t.prototype.pageCursor=function(t){return t.entries()},t.prototype.reversePageCursor=function(t){return t.reverseEntries()},t}(d),yr=function(){function t(t,e){void 0===e&&(e=32),this.base=t,this.resolveCache=new jt(e),this.unresolveCache=new jt(e)}return t.prototype.resolve=function(t){t=te.fromAny(t);var e=this.resolveCache.get(t);return void 0===e&&(e=this.base.resolve(t),this.resolveCache.set(t,e)),e},t.prototype.unresolve=function(t){t=te.fromAny(t);var e=this.unresolveCache.get(t);return void 0===e&&(e=this.base.unresolve(t),this.unresolveCache.set(t,e)),e},t}();t.Murmur3=h,t.Random=C,t.equal=D,t.compare=k,t.Cursor=s,t.Input=y,t.StringInput=v,t.StringOutput=m,t.Iteratee=b,t.EvalStack=S,t.Item=g,t.Field=P,t.Attr=M,t.Slot=I,t.Value=_,t.Record=O,t.RecordMap=q,t.RecordMapView=T,t.Data=x,t.Text=B,t.Num=z,t.Bool=R,t.DynamicValue=F,t.Func=Z,t.Extant=U,t.Absent=Ft,t.Form=be,t.FormCursor=ke,t.FormPairCursor=Se,t.Recon=rr,t.RecordScope=ir,t.BTree=or,t.BTreePage=sr,t.STree=hr,t.STreePage=fr,t.HashGenCacheMap=jt,t.Uri=te,t.UriScheme=ee,t.UriAuthority=re,t.UriUser=ne,t.UriHost=ie,t.UriPort=pe,t.UriPath=he,t.UriPathBuilder=de,t.UriQuery=ye,t.UriQueryBuilder=ge,t.UriFragment=_e,t.UriParser=Kt,t.UriCache=yr,t.Selector=j,t.IdentitySelector=L,t.LiteralSelector=K,t.GetSelector=N,t.GetAttrSelector=W,t.GetItemSelector=H,t.KeysSelector=G,t.ChildrenSelector=$,t.DescendantsSelector=Q,t.FilterSelector=J,t.Expr=yt,t.InfixExpr=vt,t.PrefixExpr=mt,t.CondExpr=gt,t.LorExpr=_t,t.LandExpr=bt,t.BorExpr=Et,t.BxorExpr=wt,t.BandExpr=xt,t.LtExpr=At,t.LeExpr=Ct,t.EqExpr=Dt,t.NeExpr=kt,t.GeExpr=St,t.GtExpr=Pt,t.AddExpr=Mt,t.SubExpr=It,t.MulExpr=Vt,t.DivExpr=Ot,t.ModExpr=qt,t.LnotExpr=Tt,t.BnotExpr=Rt,t.NegExpr=Ut,t.PosExpr=Bt,t.InvokeExpr=zt,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=recon.min.js.map