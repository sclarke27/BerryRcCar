/*!
  * SWIM Library - APP
  * Version: 0.3.1
  * Copyright Â© 2016-2018 SWIM Inc. All Rights Reserved
  * Website: https://www.swim.ai
  * Date: Thu Aug 23 2018 13:16:49 GMT-0700 (DST)
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("mapbox-gl")):"function"==typeof define&&define.amd?define(["exports","mapbox-gl"],e):e(t.swim={},t.mapboxgl)}(this,function(t,l){"use strict";var e=new ArrayBuffer(8),o=new Float64Array(e),n=new Int32Array(e),p={hash:function(t){if(null===t)return 0;if("string"==typeof t){for(var e=0,i=0,r=t.length;i<r;i+=1)e=p.mix(e,t.charCodeAt(i));return e=p.mash(e)}if("number"==typeof t)return~~t===t?~~t:(o[0]=t,n[0]^n[1]);throw new TypeError(""+t)},mix:function(t,e){return e=i(e*=3432918353,15),t=5*(t=i(t^=e*=461845907,13))+3864292196},mash:function(t){return t^=t>>>16,t*=2246822507,t^=t>>>13,t*=3266489909,t^=t>>>16}};function i(t,e){return t<<e|t>>>32-e}var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};function v(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var s=function(){function t(){}return t.prototype.set=function(t){throw new Error("immutable")},t.prototype.delete=function(){throw new Error("immutable")},t.Empty=void 0,t}(),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.isEmpty=function(){return!0},e.prototype.head=function(){throw new Error("empty head")},e.prototype.step=function(){throw new Error("empty step")},e.prototype.skip=function(t){},e.prototype.hasNext=function(){return!1},e.prototype.nextIndex=function(){return 0},e.prototype.next=function(){return{done:!0}},e.prototype.hasPrevious=function(){return!1},e.prototype.previousIndex=function(){return-1},e.prototype.previous=function(){return{done:!0}},e}(s);s.Empty=new a;var u=function(i){function t(t){var e=i.call(this)||this;return e._value=t,e._index=0,e}return v(t,i),t.prototype.isEmpty=function(){return 0!==this._index},t.prototype.head=function(){if(0===this._index)return this._value;throw new Error("empty head")},t.prototype.step=function(){if(0!==this._index)throw new Error("empty step");this._index=1},t.prototype.skip=function(t){this._index=Math.min(Math.max(0,this._index+t),1)},t.prototype.hasNext=function(){return 0===this._index},t.prototype.nextIndex=function(){return this._index},t.prototype.next=function(){return 0===this._index?(this._index=1,{value:this._value,done:!0}):{done:!0}},t.prototype.hasPrevious=function(){return 1===this._index},t.prototype.previousIndex=function(){return this._index-1},t.prototype.previous=function(){return 1===this._index?(this._index=0,{value:this._value,done:!0}):{done:!0}},t}(s),h=function(i){function t(t){var e=i.call(this)||this;return e.cursor=t,e}return v(t,i),t.prototype.isEmpty=function(){return this.cursor.isEmpty()},t.prototype.head=function(){return this.cursor.head()[0]},t.prototype.step=function(){this.cursor.step()},t.prototype.skip=function(t){this.cursor.skip(t)},t.prototype.hasNext=function(){return this.cursor.hasNext()},t.prototype.nextIndex=function(){return this.cursor.nextIndex()},t.prototype.next=function(){var t=this.cursor.next(),e=t.value,i=t.done;return{value:e&&e[0],done:i}},t.prototype.hasPrevious=function(){return this.cursor.hasPrevious()},t.prototype.previousIndex=function(){return this.cursor.previousIndex()},t.prototype.previous=function(){var t=this.cursor.next(),e=t.value,i=t.done;return{value:e&&e[0],done:i}},t.prototype.delete=function(){this.cursor.delete()},t}(s),c=function(i){function t(t){var e=i.call(this)||this;return e.cursor=t,e}return v(t,i),t.prototype.isEmpty=function(){return this.cursor.isEmpty()},t.prototype.head=function(){return this.cursor.head()[1]},t.prototype.step=function(){this.cursor.step()},t.prototype.skip=function(t){this.cursor.skip(t)},t.prototype.hasNext=function(){return this.cursor.hasNext()},t.prototype.nextIndex=function(){return this.cursor.nextIndex()},t.prototype.next=function(){var t=this.cursor.next(),e=t.value,i=t.done;return{value:e&&e[1],done:i}},t.prototype.hasPrevious=function(){return this.cursor.hasPrevious()},t.prototype.previousIndex=function(){return this.cursor.previousIndex()},t.prototype.previous=function(){var t=this.cursor.next(),e=t.value,i=t.done;return{value:e&&e[1],done:i}},t.prototype.delete=function(){this.cursor.delete()},t}(s),d=function(r){function t(t,e){void 0===e&&(e=0);var i=r.call(this)||this;return i._array=t,i._index=e,i}return v(t,r),t.prototype.isEmpty=function(){return this._index>=this._array.length},t.prototype.head=function(){if(this._index<this._array.length)return this._array[this._index];throw new Error("empty head")},t.prototype.step=function(){if(!(this._index<this._array.length))throw new Error("empty step");this._index=1},t.prototype.skip=function(t){this._index=Math.min(this._index+t,this._array.length)},t.prototype.hasNext=function(){return this._index<this._array.length},t.prototype.nextIndex=function(){return this._index},t.prototype.next=function(){var t=this._index;return t<this._array.length?(this._index=t+1,{value:this._array[t],done:this._index===this._array.length}):(this._index=this._array.length,{done:!0})},t.prototype.hasPrevious=function(){return 0<this._index},t.prototype.previousIndex=function(){return this._index-1},t.prototype.previous=function(){var t=this._index-1;return 0<=t?(this._index=t,{value:this._array[t],done:0===t}):{done:!(this._index=0)}},t}(s),f=function(n){function t(t,e,i,r){void 0===e&&(e=0),void 0===i&&(i=0);var o=n.call(this)||this;return o.pages=t,o._index=e,o._pageIndex=i,o._subCursor=r,o}return v(t,n),t.prototype.isEmpty=function(){for(;;)if(this._subCursor){if(!this._subCursor.isEmpty())return!1;this._subCursor=void 0}else{if(!(this._pageIndex<this.pages.length))return this._pageIndex=this.pages.length,!0;this._subCursor=this.pageCursor(this.pages[this._pageIndex]),this._pageIndex+=1}},t.prototype.head=function(){for(;;)if(this._subCursor){if(!this._subCursor.isEmpty())return this._subCursor.head();this._subCursor=void 0}else{if(!(this._pageIndex<this.pages.length))throw this._pageIndex=this.pages.length,new Error("empty head");this._subCursor=this.pageCursor(this.pages[this._pageIndex]),this._pageIndex+=1}},t.prototype.step=function(){for(;;)if(this._subCursor){if(!this._subCursor.isEmpty())return void(this._index+=1);this._subCursor=void 0}else{if(!(this._pageIndex<this.pages.length))throw this._pageIndex=this.pages.length,new Error("empty step");this._subCursor=this.pageCursor(this.pages[this._pageIndex]),this._pageIndex+=1}},t.prototype.skip=function(t){for(;0<t;)if(this._subCursor)this._subCursor.hasNext()?(this._index+=1,t-=1,this._subCursor.next()):this._subCursor=void 0;else{if(!(this._pageIndex<this.pages.length))break;var e=this.pages[this._pageIndex],i=this.pageSize(e);if(this._pageIndex+=1,i<t){this._subCursor=this.pageCursor(e),0<t&&(this._index+=t,this._subCursor.skip(t),t=0);break}this._index+=i,t-=i}},t.prototype.hasNext=function(){for(;;)if(this._subCursor){if(this._subCursor.hasNext())return!0;this._subCursor=void 0}else{if(!(this._pageIndex<this.pages.length))return this._pageIndex=this.pages.length,!1;this._subCursor=this.pageCursor(this.pages[this._pageIndex]),this._pageIndex+=1}},t.prototype.nextIndex=function(){return this._index},t.prototype.next=function(){for(;;)if(this._subCursor){if(this._subCursor.hasNext())return this._index+=1,this._subCursor.next();this._subCursor=void 0}else{if(!(this._pageIndex<this.pages.length))return this._pageIndex=this.pages.length,{done:!0};this._subCursor=this.pageCursor(this.pages[this._pageIndex]),this._pageIndex+=1}},t.prototype.hasPrevious=function(){for(;;)if(this._subCursor){if(this._subCursor.hasPrevious())return!0;this._subCursor=void 0}else{if(!(0<this._pageIndex))return this._pageIndex=0,!1;this._subCursor=this.reversePageCursor(this.pages[this._pageIndex-1]),this._pageIndex-=1}},t.prototype.previousIndex=function(){return this._index-1},t.prototype.previous=function(){for(;;)if(this._subCursor){if(this._subCursor.hasPrevious())return this._index-=1,this._subCursor.previous();this._subCursor=void 0}else{if(!(0<this._pageIndex))return{done:!(this._pageIndex=0)};this._subCursor=this.reversePageCursor(this.pages[this._pageIndex-1]),this._pageIndex-=1}},t.prototype.set=function(t){this._subCursor.set(t)},t.prototype.delete=function(){this._subCursor.delete()},t}(s),y=function(){function t(){}return t.done=function(){return new m("")},t}(),m=function(o){function t(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!1);var r=o.call(this)||this;return r.buffer=t,r.index=e,r.more=i,r}return v(t,o),t.prototype.isDone=function(){return this.isEmpty()&&!this.more},t.prototype.isEmpty=function(){return this.index>=this.buffer.length},t.prototype.head=function(){var t=this.buffer.charCodeAt(this.index);if(t<=55295||57344<=t)return t;if(t<=56319&&this.index+1<this.buffer.length){var e=this.buffer.charCodeAt(this.index+1);return 56320<=e&&e<=57343?65536+((1023&t)<<10|1023&e):65533}return 65533},t.prototype.step=function(){var t=this.buffer.charCodeAt(this.index);if(t<=55295||57344<=t)this.index+=1;else if(t<=56319&&this.index+1<this.buffer.length){var e=this.buffer.charCodeAt(this.index+1);this.index+=56320<=e&&e<=57343?2:1}else this.index+=1},t.prototype.clone=function(){return new t(this.buffer,this.index,this.more)},t}(y),g=function(){function t(t){void 0===t&&(t=""),this.buffer=t}return t.prototype.isDone=function(){return!1},t.prototype.isFull=function(){return!1},t.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0,r=t.length;i<r;i+=1){var o=t[i];if("number"==typeof o)if(0<=o&&o<=55295||57344<=o&&o<=65535)this.buffer+=String.fromCharCode(o);else if(65536<=o&&o<=1114111){var n=o-65536;this.buffer+=String.fromCharCode(55296|n>>>10,56320|1023&n)}else this.buffer+=String.fromCharCode(65533);else if("string"==typeof o)for(var s=new m(o);!s.isEmpty();)this.push(s.head()),s.step()}},t.prototype.bind=function(){return this.buffer},t}(),b=function(){function n(){}return n.prototype.isDefined=function(){return!0},n.prototype.isDistinct=function(){return!0},n.prototype.isEmpty=function(){return!1},n.prototype.stringValue=function(t){return t},n.prototype.numberValue=function(t){return t},n.prototype.booleanValue=function(t){return t},n.prototype.concat=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=n.empty();i.push(this);for(var r=0,o=t.length;r<o;r+=1){n.fromAny(t[r]).forEach(function(t){i.push(t)})}return i},n.prototype.withField=function(t,e){var i=n.empty(2);return i.push(this),i.withField(t,e)},n.prototype.withAttr=function(t,e){var i=n.empty(2);return i.push(this),i.withAttr(t,e)},n.prototype.withSlot=function(t,e){var i=n.empty(2);return i.push(this),i.withSlot(t,e)},n.prototype.withItem=function(t){var e=n.empty(2);return e.push(this),e.withItem(t)},n.prototype.withItems=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=n.empty(1+arguments.length);return i.push(this),i.withItems.apply(i,arguments)},n.prototype.forEach=function(t,e){return t.call(e,this,0)},n.prototype.iterator=function(){return new u(this)},n.prototype.lt=function(t){return t=n.of(t),this.compare(t)<0?n.True:n.Absent},n.prototype.le=function(t){return t=n.of(t),this.compare(t)<=0?n.True:n.Absent},n.prototype.eq=function(t){return t=n.of(t),this.equals(t)?n.True:n.Absent},n.prototype.ne=function(t){return t=n.of(t),this.equals(t)?n.Absent:n.True},n.prototype.ge=function(t){return t=n.of(t),0<=this.compare(t)?n.True:n.Absent},n.prototype.gt=function(t){return t=n.of(t),0<this.compare(t)?n.True:n.Absent},n.prototype.filter=function(t){var e=n.Selector.literal(this);return e.filter.apply(e,arguments)},n.prototype.max=function(t){return 0<=this.compare(t)?this:t},n.prototype.min=function(t){return this.compare(t)<=0?this:t},n.prototype.evaluate=function(t){return this},n.prototype.substitute=function(t){return this},Object.defineProperty(n.prototype,"precedence",{get:function(){return 11},enumerable:!0,configurable:!0}),n.prototype.writeReconBlock=function(t){return this.writeRecon(t)},n.prototype.toRecon=function(){var t=new g;return this.writeRecon(t),t.bind()},n.prototype.toReconBlock=function(){var t=new g;return this.writeReconBlock(t),t.bind()},n.prototype.writeString=function(t){t.push(this.toString())},n.Recon=void 0,n.Field=void 0,n.Attr=void 0,n.Slot=void 0,n.Value=void 0,n.Record=void 0,n.Data=void 0,n.Text=void 0,n.Num=void 0,n.Bool=void 0,n.DynamicValue=void 0,n.Selector=void 0,n.IdentitySelector=void 0,n.LiteralSelector=void 0,n.GetSelector=void 0,n.GetAttrSelector=void 0,n.GetItemSelector=void 0,n.KeysSelector=void 0,n.ChildrenSelector=void 0,n.DescendantsSelector=void 0,n.FilterSelector=void 0,n.Func=void 0,n.Expr=void 0,n.CondExpr=void 0,n.LorExpr=void 0,n.LandExpr=void 0,n.BorExpr=void 0,n.BxorExpr=void 0,n.BandExpr=void 0,n.LtExpr=void 0,n.LeExpr=void 0,n.EqExpr=void 0,n.NeExpr=void 0,n.GeExpr=void 0,n.GtExpr=void 0,n.AddExpr=void 0,n.SubExpr=void 0,n.MulExpr=void 0,n.DivExpr=void 0,n.ModExpr=void 0,n.LnotExpr=void 0,n.BnotExpr=void 0,n.NegExpr=void 0,n.PosExpr=void 0,n.InvokeExpr=void 0,n.Empty=void 0,n.True=void 0,n.False=void 0,n.Extant=void 0,n.Absent=void 0,n.GlobalScope=void 0,n.empty=void 0,n.of=void 0,n.fromAny=void 0,n}(),w=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return v(i,e),Object.defineProperty(i.prototype,"key",{get:function(){return i.Absent},enumerable:!0,configurable:!0}),i.prototype.toValue=function(){return this},Object.defineProperty(i.prototype,"length",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tag",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"target",{get:function(){return this},enumerable:!0,configurable:!0}),i.prototype.flattened=function(){return this},i.prototype.header=function(t){return i.Absent},i.prototype.headers=function(t){},i.prototype.head=function(){return i.Absent},i.prototype.tail=function(){return i.Empty},i.prototype.body=function(){return this},i.prototype.get=function(t){return i.Absent},i.prototype.getAttr=function(t){return i.Absent},i.prototype.getItem=function(t){return i.Absent},i.prototype.withoutKey=function(t){return this},i.prototype.cond=function(t,e){return t=b.of(t)},i.prototype.or=function(t){return this},i.prototype.and=function(t){return t=b.of(t)},i.prototype.bor=function(t){if((t=b.of(t))instanceof b.DynamicValue)return new b.BorExpr(this,t);if(t instanceof b.Attr){if((e=this.bor(t.value)).isDefined())return new b.Attr(t.key,e)}else if(t instanceof b.Slot){var e;if((e=this.bor(t.value)).isDefined())return new b.Slot(t.key,e)}return i.Absent},i.prototype.bxor=function(t){if((t=b.of(t))instanceof b.DynamicValue)return new b.BxorExpr(this,t);if(t instanceof b.Attr){if((e=this.bxor(t.value)).isDefined())return new b.Attr(t.key,e)}else if(t instanceof b.Slot){var e;if((e=this.bxor(t.value)).isDefined())return new b.Slot(t.key,e)}return i.Absent},i.prototype.band=function(t){if((t=b.of(t))instanceof b.DynamicValue)return new b.BandExpr(this,t);if(t instanceof b.Attr){if((e=this.band(t.value)).isDefined())return new b.Attr(t.key,e)}else if(t instanceof b.Slot){var e;if((e=this.band(t.value)).isDefined())return new b.Slot(t.key,e)}return i.Absent},i.prototype.lt=function(t){return(t=b.of(t))instanceof b.DynamicValue?new b.LtExpr(this,t):e.prototype.lt.call(this,t)},i.prototype.le=function(t){return(t=b.of(t))instanceof b.DynamicValue?new b.LeExpr(this,t):e.prototype.le.call(this,t)},i.prototype.eq=function(t){return(t=b.of(t))instanceof b.DynamicValue?new b.EqExpr(this,t):e.prototype.eq.call(this,t)},i.prototype.ne=function(t){return(t=b.of(t))instanceof b.DynamicValue?new b.NeExpr(this,t):e.prototype.ne.call(this,t)},i.prototype.ge=function(t){return(t=b.of(t))instanceof b.DynamicValue?new b.GeExpr(this,t):e.prototype.ge.call(this,t)},i.prototype.gt=function(t){return(t=b.of(t))instanceof b.DynamicValue?new b.GtExpr(this,t):e.prototype.gt.call(this,t)},i.prototype.plus=function(t){if((t=b.of(t))instanceof b.DynamicValue)return new b.AddExpr(this,t);if(t instanceof b.Attr){if((e=this.plus(t.value)).isDefined())return new b.Attr(t.key,e)}else if(t instanceof b.Slot){var e;if((e=this.plus(t.value)).isDefined())return new b.Slot(t.key,e)}return i.Absent},i.prototype.minus=function(t){if((t=b.of(t))instanceof b.DynamicValue)return new b.SubExpr(this,t);if(t instanceof b.Attr){if((e=this.minus(t.value)).isDefined())return new b.Attr(t.key,e)}else if(t instanceof b.Slot){var e;if((e=this.minus(t.value)).isDefined())return new b.Slot(t.key,e)}return i.Absent},i.prototype.times=function(t){if((t=b.of(t))instanceof b.DynamicValue)return new b.MulExpr(this,t);if(t instanceof b.Attr){if((e=this.times(t.value)).isDefined())return new b.Attr(t.key,e)}else if(t instanceof b.Slot){var e;if((e=this.times(t.value)).isDefined())return new b.Slot(t.key,e)}return i.Absent},i.prototype.divide=function(t){if((t=b.of(t))instanceof b.DynamicValue)return new b.DivExpr(this,t);if(t instanceof b.Attr){if((e=this.divide(t.value)).isDefined())return new b.Attr(t.key,e)}else if(t instanceof b.Slot){var e;if((e=this.divide(t.value)).isDefined())return new b.Slot(t.key,e)}return i.Absent},i.prototype.modulo=function(t){if((t=b.of(t))instanceof b.DynamicValue)return new b.ModExpr(this,t);if(t instanceof b.Attr){if((e=this.modulo(t.value)).isDefined())return new b.Attr(t.key,e)}else if(t instanceof b.Slot){var e;if((e=this.modulo(t.value)).isDefined())return new b.Slot(t.key,e)}return i.Absent},i.prototype.not=function(){return i.Absent},i.prototype.bnot=function(){return i.Absent},i.prototype.neg=function(){return i.Absent},i.prototype.pos=function(){return i.Absent},i.prototype.inv=function(){return i.Absent},i.prototype.isAliased=function(){return!1},i.prototype.isMutable=function(){return!1},i.prototype.alias=function(){},i.prototype.branch=function(){return this},i.prototype.clone=function(){return this},i.prototype.commit=function(){return this},i.prototype.cast=function(t,e){var i=t.cast(this);return void 0===i&&(i=e),i},i.prototype.coerce=function(t){var e=t.cast(this);return void 0===e&&(e=t.unit),e},i.of=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?i.Absent:1===t.length?i.fromAny(t[0]):i.Record.fromArray(arguments)},i.fromAny=function(t){if(void 0===t)return i.Absent;if(null===t)return i.Extant;if(t instanceof i)return t;if(t instanceof b)return t.toValue();if(t instanceof Uint8Array)return i.Data.valueOf(t);if("string"==typeof t)return i.Text.valueOf(t);if("number"==typeof t)return i.Num.valueOf(t);if("boolean"==typeof t)return i.Bool.valueOf(t);if(Array.isArray(t))return i.Record.fromArray(t);if("object"==typeof t)return i.Record.fromObject(t);throw new TypeError(""+t)},i.parseRecon=function(t){return i.Recon.Factory.parseRecon(t)},i.Empty=void 0,i.True=void 0,i.False=void 0,i.Extant=void 0,i.Absent=void 0,i.empty=void 0,i}(b);b.Value=w,b.of=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?w.Absent:1===t.length?b.fromAny(t[0]):w.Record.fromArray(arguments)},b.fromAny=function(t){return t instanceof b?t:w.fromAny(t)};var _=function(){function r(){}return r.prototype.isCont=function(){return!0},r.prototype.isDone=function(){return!1},r.prototype.isError=function(){return!1},r.prototype.run=function(t){for(var e=this;e.isCont()&&(!t.isEmpty()||t.isDone());)e=e.feed(t);return e.isCont()&&t.isEmpty()&&!t.isDone()&&(e=e.feed(y.done())),e},r.prototype.parse=function(t){"string"==typeof t&&(t=new m(t));var e=this.run(t);return!t.isEmpty()&&e.isDone()&&(e=r.unexpected(t)),e.bind()},r.prototype.bind=function(){throw this},r.prototype.trap=function(){throw this},r.prototype.asVariant=function(){return this},r.prototype.asError=function(){throw this},r.done=function(t){return new x(t)},r.error=function(t){return new k(t)},r.unexpected=function(t){var e="unexpected ";return t.isEmpty()?e+="end of input":e+=JSON.stringify(String.fromCharCode(t.head())),r.error(e)},r.expected=function(t,e){"number"==typeof t&&(t=String.fromCharCode(t)),1===t.length&&(t=JSON.stringify(t));var i="expected "+t;return e.isEmpty()||(i+=", but found "+JSON.stringify(String.fromCharCode(e.head()))),r.error(i)},r.isSpace=function(t){return 32===t||9===t},r.isNewline=function(t){return 10===t||13===t},r.isWhitespace=function(t){return r.isSpace(t)||r.isNewline(t)},r.isAlpha=function(t){return 65<=t&&t<=90||97<=t&&t<=122},r.toLowerCase=function(t){return 65<=t&&t<=90?t+32:t},r.isDigit=function(t){return 48<=t&&t<=57},r.decodeDigit=function(t){if(48<=t&&t<=57)return t-48;throw t},r.isHexChar=function(t){return 65<=t&&t<=70||97<=t&&t<=102||48<=t&&t<=57},r.decodeHexChar=function(t){if(48<=t&&t<=57)return t-48;if(65<=t&&t<=70)return t-65+10;if(97<=t&&t<=102)return t-97+10;throw t},r.isBase64Char=function(t){return 48<=t&&t<=57||65<=t&&t<=90||97<=t&&t<=122||43===t||45===t||47===t||95===t},r.decodeBase64Digit=function(t){if(65<=t&&t<=90)return t-65;if(97<=t&&t<=122)return t-71;if(48<=t&&t<=57)return t+4;if(43===t||45===t)return 62;if(47===t||95===t)return 63;throw t},r}(),x=function(i){function t(t){var e=i.call(this)||this;return e.value=t,e}return v(t,i),t.prototype.isCont=function(){return!1},t.prototype.isDone=function(){return!0},t.prototype.feed=function(t){return this},t.prototype.bind=function(){return this.value},t}(_),k=function(i){function t(t){var e=i.call(this)||this;return e.cause=t,e}return v(t,i),t.prototype.isCont=function(){return!1},t.prototype.isError=function(){return!0},t.prototype.feed=function(t){return this},t.prototype.bind=function(){throw this.cause},t.prototype.trap=function(){return this.cause},t.prototype.asError=function(){return this},t}(_),A=function(o){function a(t,e,i){var r=o.call(this)||this;return r._array=t,r._size=e,r._flags=i,r}return v(a,o),Object.defineProperty(a.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),a.prototype.isDone=function(){return!1},a.prototype.isFull=function(){return!1},a.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0!=(this._flags&a.IMMUTABLE))throw new Error("immutable");0!=(this._flags&a.ALIASED)?this.pushAliased.apply(this,t):this.pushMutable.apply(this,t)},a.prototype.pushAliased=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t.length,r=this._size,o=this._array,n=new Uint8Array(a.expand(r+i));null!==o&&n.set(o);for(var s=0;s<i;s+=1)n[r+s]=t[s];this._array=n,this._size=r+i,this._flags&=~a.ALIASED},a.prototype.pushMutable=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i,r=t.length,o=this._size,n=this._array;null===n||o+r>n.length?(i=new Uint8Array(a.expand(o+r)),null!==n&&i.set(n),this._array=i):i=n;for(var s=0;s<r;s+=1)i[o+s]=t[s];this._size=o+r},a.prototype.isAliased=function(){return 0!=(this._flags&a.ALIASED)},a.prototype.isMutable=function(){return 0==(this._flags&a.IMMUTABLE)},a.prototype.alias=function(){this._flags|=a.ALIASED},a.prototype.branch=function(){return this._flags|=a.ALIASED,new a(this._array,this._size,a.ALIASED)},a.prototype.clone=function(){return this.branch()},a.prototype.commit=function(){return this._flags|=a.IMMUTABLE,this},a.prototype.bind=function(){return this},a.prototype.toAny=function(){return this.valueOf()},a.prototype.valueOf=function(){var t=this._size,e=this._array;if(0!=(this._flags&(a.ALIASED|a.IMMUTABLE))||t!==e.length){var i=null!==e?e.slice(0,t):new Uint8Array(0);return 0==(this._flags&a.IMMUTABLE)&&(this._array=i,this._size=t,this._flags&=~a.ALIASED),i}return e},a.prototype.writeRecon=function(t){t.push(37),a.writeBase64(this._array,this._size,t)},a.writeBase64=function(t,e,i){for(var r=0;r+2<e;){var o=t[r],n=t[r+1],s=t[r+2];i.push(a.encodeBase64Digit(o>>>2),a.encodeBase64Digit(63&(o<<4|n>>>4)),a.encodeBase64Digit(63&(n<<2|s>>>6)),a.encodeBase64Digit(63&s)),r+=3}if(r+1<e){o=t[r],n=t[r+1];i.push(a.encodeBase64Digit(o>>>2),a.encodeBase64Digit(63&(o<<4|n>>>4)),a.encodeBase64Digit(n<<2&63),61),r+=2}else if(r<e){o=t[r];i.push(a.encodeBase64Digit(o>>>2),a.encodeBase64Digit(o<<4&63),61,61),r+=1}},a.prototype.toBase64=function(){var t=new g;return a.writeBase64(this._array,this._size,t),t.bind()},a.prototype.compare=function(t){if(t instanceof a){for(var e=this._size,i=t._size,r=this._array,o=t._array,n=0,s=0;0===n&&s<e&&s<i;)n=r[s]-o[s],s+=1;return 0<n?1:n<0?-1:i<e?1:e<i?-1:0}return t instanceof b.Field||t instanceof b.Record?1:-1},a.prototype.equals=function(t){if(this===t)return!0;if(t instanceof a){var e=this._size;if(e!==t._size)return!1;for(var i=this._array,r=t._array,o=0;o<e;o+=1)if(i[o]!==r[o])return!1;return!0}return!1},a.prototype.hashCode=function(){for(var t=1375461820,e=this._array,i=0,r=this._size;i<r;i+=1)t=p.mix(t,e[i]);return p.mash(t)},a.prototype.toString=function(){return this.toBase64()},a.empty=function(t){return new a(void 0===t?null:new Uint8Array(t),0,0)},a.valueOf=function(t){return new a(t,t.length,a.ALIASED)},a.of=function(t){if(t instanceof a)return t;if(t instanceof Uint8Array)return a.valueOf(t);throw new TypeError(""+t)},a.base64=function(t){"string"==typeof t&&(t=new m(t));var e=w.Recon.Factory.parseBase64(t);return e.isDone()&&(t.isEmpty()||(e=_.unexpected(t))),e.bind()},a.expand=function(t){return t=Math.max(32,t)-1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1},a.encodeBase64Digit=function(t){if(0<=t&&t<26)return t+65;if(26<=t&&t<52)return t+71;if(52<=t&&t<62)return t-4;if(62===t)return 43;if(63===t)return 47;throw t},a.Empty=new a(null,0,(a.ALIASED=1)|(a.IMMUTABLE=2)),a}(w);b.Data=A;var E="undefined"!=typeof window&&(window.crypto||window.msCrypto);var C={fillBytes:E?function(t){E.getRandomValues(t)}:function(t){if(t instanceof Int8Array)for(var e=0;e<t.length;e+=1)t[e]=128-Math.round(256*Math.random());else if(t instanceof Uint8Array)for(e=0;e<t.length;e+=1)t[e]=Math.round(256*Math.random());else if(t instanceof Int16Array)for(e=0;e<t.length;e+=1)t[e]=32768-Math.round(65536*Math.random());else if(t instanceof Uint16Array)for(e=0;e<t.length;e+=1)t[e]=Math.round(65536*Math.random());else if(t instanceof Int32Array)for(e=0;e<t.length;e+=1)t[e]=2147483648-Math.round(4294967296*Math.random());else{if(!(t instanceof Uint32Array))throw new TypeError(""+t);for(e=0;e<t.length;e+=1)t[e]=Math.round(4294967296*Math.random())}},generateId:function(t){void 0===t&&(t=12);var e=new Uint8Array(t);C.fillBytes(e);var i=new g;return A.writeBase64(e,t,i),i.bind()}};function S(t,e){if(t instanceof Date&&(t=t.getTime()),e instanceof Date&&(e=e.getTime()),t===e)return!0;if(t&&"object"==typeof t&&"function"==typeof t.equals)return t.equals(e);if(Array.isArray(t)){if(Array.isArray(e))return function(t,e){var i=t.length;if(i!==e.length)return!1;for(var r=0;r<i;r+=1)if(!S(t[r],e[r]))return!1;return!0}(t,e)}else if(t&&"object"==typeof t&&e&&"object"==typeof e)return function(t,e){var i=Object.keys(t),r=Object.keys(e),o=i.length;if(o!==r.length)return!1;for(var n=0;n<o;n+=1){var s=i[n];if(s!==r[n]||!S(t[s],e[s]))return!1}return!0}(t,e);return!1}function V(t,e){return t instanceof Date&&(t=t.getTime()),e instanceof Date&&(e=e.getTime()),void 0===t?void 0===e?0:1:null===t?void 0===e?-1:null===e?0:1:"number"==typeof t?null==e?-1:"number"==typeof e?t<e?-1:e<t?1:0:1:"string"==typeof t?null==e||"number"==typeof e?-1:"string"==typeof e?t<e?-1:e<t?1:0:1:"object"==typeof t&&"function"==typeof t.compare?t.compare(e):Array.isArray(t)?null==e||"number"==typeof e||"string"==typeof e?-1:Array.isArray(e)?function(t,e){for(var i=t.length,r=e.length,o=0,n=0,s=Math.min(i,r);n<s&&0===o;n+=1)o=V(t[n],e[n]);return 0!==o?o:r<i?1:i<r?-1:0}(t,e):1:null==e||"number"==typeof e||"string"==typeof e||Array.isArray(e)?-1:function(t,e){for(var i=Object.keys(t),r=Object.keys(e),o=i.length,n=r.length,s=Math.min(o,n),a=0,u=0;u<s&&0===a;u+=1){var h=i[u],l=r[u];0===(a=V(h,l))&&(a=V(t[h],e[l]))}return 0!==a?a:n<o?1:o<n?-1:0}(t,e)}var D=function(){function a(t,e,i){void 0===t&&(t=null),void 0===e&&(e=0),void 0===i&&(i=a.Capacity),this._array=t,this._size=e,this._capacity=i}return a.prototype.isEmpty=function(){return 0===this._size},Object.defineProperty(a.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),a.prototype.get=function(t){t=w.fromAny(t);for(var e=w.Absent,i=this._size-1;0<=i&&!(e=this._array[i].get(t)).isDefined();i-=1);return e},a.prototype.peek=function(){var t=this._size;return 0<t?this._array[t-1]:void 0},a.prototype.item=function(){var t=this._size;if(0<t)return this._array[t-1];throw new RangeError},a.prototype.getItem=function(t){if(0<=t&&t<this._size)return this._array[t];throw new RangeError(""+t)},a.prototype.offer=function(t){var e=this._size;if(e<this._capacity){var i=this._array,r=void 0;if(null===i||e+1>i.length){if(r=new Array(a.expand(e+1)),null!==i)for(var o=0;o<e;o+=1)r[o]=i[o];this._array=r}else r=i;return r[e]=t,this._size=e+1,!0}return!1},a.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this._size,r=arguments.length;if(0===r)return i;if(i+r<this._capacity){var o=this._array,n=void 0;if(null===o||i+r>o.length){if(n=new Array(a.expand(i+r)),null!==o)for(var s=0;s<i;s+=1)n[s]=o[s]}else n=o;for(s=0;s<r;s+=1)n[i]=arguments[s],i+=1;return this._array=n,this._size=i}throw new RangeError(""+(i+r))},a.prototype.replace=function(t){var e=this._size;if(0<e){var i=this._array,r=i[e-1];return i[e-1]=t,r}throw new RangeError},a.prototype.poll=function(){var t=this._size;if(0<t){var e=this._array,i=e[t-1];return e[t-1]=void 0,this._size=t-1,i}},a.prototype.pop=function(){var t=this._size;if(0<t){var e=this._array,i=e[t-1];return e[t-1]=void 0,this._size=t-1,i}throw new RangeError},a.prototype.clear=function(){for(var t=this._array,e=this._size-1;0<=e;e-=1)t[e]=void 0;this._size=0},a.prototype.forEach=function(t,e){for(var i=this._array,r=0,o=this._size;r<o;r+=1){var n=t.call(e,i[r],r);if(void 0!==n)return n}},a.prototype.iterator=function(){return 0<this._size?new d(this._array):s.Empty},a.prototype.equals=function(t){if(this===t)return!0;if(t instanceof a){var e=this._size;if(e!==t._size)return!1;for(var i=this._array,r=t._array,o=0;o<e;o+=1)if(!i[o].equals(r[o]))return!1;return!0}return!1},a.prototype.hashCode=function(){for(var t=2079781727,e=this._array,i=0,r=this._size;i<r;i+=1)t=p.mix(t,e[i].hashCode());return p.mash(t)},a.prototype.toString=function(){var t=new g;t.push("EvalStack",46,"of",40);var e=this._size;if(0<e){var i=this._array;i[0].writeString(t);for(var r=1;r<e;r+=1)t.push(", "),i[r].writeString(t)}return t.push(")"),t.bind()},a.of=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=arguments.length,r=new Array(a.expand(i)),o=0;o<i;o+=1){var n=b.fromAny(arguments[o]);r[o]=n}return new a(r,i,Math.max(i,a.Capacity))},a.fromAny=function(t,e){if(void 0===e&&(e=a.GlobalScope),!(t instanceof a)){var i=b.fromAny(t);return t=new a,e&&t.push(e),t.push(i),t}return t},a.expand=function(t){return t=Math.max(32,t)-1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1},a.Capacity=1024,a.GlobalScope=void 0,a}(),M=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.toValue=function(){return this.value},Object.defineProperty(e.prototype,"length",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tag",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return b.Absent},enumerable:!0,configurable:!0}),e.prototype.flattened=function(){return b.Absent},e.prototype.header=function(t){return b.Absent},e.prototype.headers=function(t){},e.prototype.head=function(){return b.Absent},e.prototype.tail=function(){return b.Empty},e.prototype.body=function(){return b.Absent},e.prototype.get=function(t){return b.Absent},e.prototype.getAttr=function(t){return b.Absent},e.prototype.getItem=function(t){return b.Absent},e.prototype.stringValue=function(t){return this.value.stringValue(t)},e.prototype.numberValue=function(t){return this.value.numberValue(t)},e.prototype.booleanValue=function(t){return this.value.booleanValue(t)},e.prototype.withoutKey=function(t){return this},e.prototype.cond=function(t,e){return t=b.of(t)},e.prototype.or=function(t){return this},e.prototype.and=function(t){return t=b.of(t)},e.prototype.isAliased=function(){return!1},e.prototype.cast=function(t,e){return this.value.cast(t,e)},e.prototype.coerce=function(t){return this.value.coerce(t)},e.of=function(t,e){var i;return"string"==typeof t?i=t:t instanceof b.Text&&(i=t.value),void 0!==i&&64===i.charCodeAt(0)?b.Attr.of.apply(void 0,arguments):b.Slot.of.apply(void 0,arguments)},e.IMMUTABLE=1,e}(b),P=function(o){function r(t,e,i){void 0===e&&(e=w.Extant),void 0===i&&(i=0);var r=o.call(this)||this;return r._key=t,r._value=e,r._flags=i,r}return v(r,o),Object.defineProperty(r.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),r.prototype.setValue=function(t){if(0!=(this._flags&M.IMMUTABLE))throw new Error("immutable");var e=this._value;return this._value=t,e},r.prototype.withValue=function(t){return new r(this._key,t)},r.prototype.bor=function(t){return(t=b.of(t))instanceof b.DynamicValue?new b.BorExpr(this,t):(e=t instanceof r&&this._key.equals(t._key)?this._value.bor(t._value):t instanceof w?this._value.bor(t):w.Absent).isDefined()?new r(this._key,e):w.Absent;var e},r.prototype.bxor=function(t){return(t=b.of(t))instanceof b.DynamicValue?new b.BxorExpr(this,t):(e=t instanceof r&&this._key.equals(t._key)?this._value.bxor(t._value):t instanceof w?this._value.bxor(t):w.Absent).isDefined()?new r(this._key,e):w.Absent;var e},r.prototype.band=function(t){return(t=b.of(t))instanceof b.DynamicValue?new b.BandExpr(this,t):(e=t instanceof r&&this._key.equals(t._key)?this._value.band(t._value):t instanceof w?this._value.band(t):w.Absent).isDefined()?new r(this._key,e):w.Absent;var e},r.prototype.plus=function(t){return(t=b.of(t))instanceof b.DynamicValue?new b.AddExpr(this,t):(e=t instanceof r&&this._key.equals(t._key)?this._value.plus(t._value):t instanceof w?this._value.plus(t):w.Absent).isDefined()?new r(this._key,e):w.Absent;var e},r.prototype.minus=function(t){return(t=b.of(t))instanceof b.DynamicValue?new b.SubExpr(this,t):(e=t instanceof r&&this._key.equals(t._key)?this._value.minus(t._value):t instanceof w?this._value.minus(t):w.Absent).isDefined()?new r(this._key,e):w.Absent;var e},r.prototype.times=function(t){return(t=b.of(t))instanceof b.DynamicValue?new b.MulExpr(this,t):(e=t instanceof r&&this._key.equals(t._key)?this._value.times(t._value):t instanceof w?this._value.times(t):w.Absent).isDefined()?new r(this._key,e):w.Absent;var e},r.prototype.divide=function(t){return(t=b.of(t))instanceof b.DynamicValue?new b.DivExpr(this,t):(e=t instanceof r&&this._key.equals(t._key)?this._value.divide(t._value):t instanceof w?this._value.divide(t):w.Absent).isDefined()?new r(this._key,e):w.Absent;var e},r.prototype.modulo=function(t){return(t=b.of(t))instanceof b.DynamicValue?new b.ModExpr(this,t):(e=t instanceof r&&this._key.equals(t._key)?this._value.modulo(t._value):t instanceof w?this._value.modulo(t):w.Absent).isDefined()?new r(this._key,e):w.Absent;var e},r.prototype.not=function(){var t=this._value.not();return t.isDefined()?new r(this._key,t):w.Absent},r.prototype.bnot=function(){var t=this._value.bnot();return t.isDefined()?new r(this._key,t):w.Absent},r.prototype.neg=function(){var t=this._value.neg();return t.isDefined()?new r(this._key,t):w.Absent},r.prototype.pos=function(){var t=this._value.pos();return t.isDefined()?new r(this._key,t):w.Absent},r.prototype.inv=function(){var t=this._value.inv();return t.isDefined()?new r(this._key,t):w.Absent},r.prototype.evaluate=function(t){t=D.fromAny(t);var e=this._key.evaluate(t).toValue(),i=this._value.evaluate(t).toValue();return e===this._key&&i===this._value?this:e.isDefined()&&i.isDefined()?e instanceof b.Text?new r(e,i):new b.Slot(e,i):b.Absent},r.prototype.substitute=function(t){t=D.fromAny(t);var e=this._key.substitute(t).toValue(),i=this._value.substitute(t).toValue();return e===this._key&&i===this._value?this:e.isDefined()&&i.isDefined()?e instanceof b.Text?new r(e,i):new b.Slot(e,i):b.Absent},r.prototype.isMutable=function(){return 0==(this._flags&M.IMMUTABLE)},r.prototype.alias=function(){this._flags|=M.IMMUTABLE},r.prototype.branch=function(){return 0!=(this._flags&M.IMMUTABLE)?new r(this._key,this._value,this._flags&~M.IMMUTABLE):this},r.prototype.clone=function(){return new r(this._key.clone(),this._value.clone())},r.prototype.commit=function(){return 0==(this._flags&M.IMMUTABLE)&&(this._flags|=M.IMMUTABLE,this._value.commit()),this},r.prototype.writeRecon=function(t){t.push(64),this._key.writeRecon(t),this._value!==w.Extant&&(t.push(40),this._value.writeReconBlock(t),t.push(41))},r.prototype.compare=function(t){if(t instanceof r){var e=this._key.compare(t._key);return 0===e&&(e=this._value.compare(t._value)),e}return-1},r.prototype.equals=function(t){return this===t||t instanceof r&&(this._key.equals(t._key)&&this._value.equals(t._value))},r.prototype.hashCode=function(){return p.mash(p.mix(p.mix(687268585,this._key.hashCode()),this._value.hashCode()))},r.prototype.toString=function(){return this.toRecon()},r.of=function(t,e){return new r(t=b.Text.of(t),e=2===arguments.length?b.Value.of(e):b.Value.Extant)},r}(b.Field=M);b.Attr=P;var R=function(o){function r(t,e,i){void 0===e&&(e=w.Extant),void 0===i&&(i=0);var r=o.call(this)||this;return r._key=t,r._value=e,r._flags=i,r}return v(r,o),Object.defineProperty(r.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),r.prototype.setValue=function(t){if(0!=(this._flags&M.IMMUTABLE))throw new Error("immutable");var e=this._value;return this._value=t,e},r.prototype.withValue=function(t){return new r(this._key,t)},r.prototype.bor=function(t){return(t=b.of(t))instanceof b.DynamicValue?new b.BorExpr(this,t):(e=t instanceof r&&this._key.equals(t._key)?this._value.bor(t._value):t instanceof w?this._value.bor(t):w.Absent).isDefined()?new r(this._key,e):w.Absent;var e},r.prototype.bxor=function(t){return(t=b.of(t))instanceof b.DynamicValue?new b.BxorExpr(this,t):(e=t instanceof r&&this._key.equals(t._key)?this._value.bxor(t._value):t instanceof w?this._value.bxor(t):w.Absent).isDefined()?new r(this._key,e):w.Absent;var e},r.prototype.band=function(t){return(t=b.of(t))instanceof b.DynamicValue?new b.BandExpr(this,t):(e=t instanceof r&&this._key.equals(t._key)?this._value.band(t._value):t instanceof w?this._value.band(t):w.Absent).isDefined()?new r(this._key,e):w.Absent;var e},r.prototype.plus=function(t){return(t=b.of(t))instanceof b.DynamicValue?new b.AddExpr(this,t):(e=t instanceof r&&this._key.equals(t._key)?this._value.plus(t._value):t instanceof w?this._value.plus(t):w.Absent).isDefined()?new r(this._key,e):w.Absent;var e},r.prototype.minus=function(t){return(t=b.of(t))instanceof b.DynamicValue?new b.SubExpr(this,t):(e=t instanceof r&&this._key.equals(t._key)?this._value.minus(t._value):t instanceof w?this._value.minus(t):w.Absent).isDefined()?new r(this._key,e):w.Absent;var e},r.prototype.times=function(t){return(t=b.of(t))instanceof b.DynamicValue?new b.MulExpr(this,t):(e=t instanceof r&&this._key.equals(t._key)?this._value.times(t._value):t instanceof w?this._value.times(t):w.Absent).isDefined()?new r(this._key,e):w.Absent;var e},r.prototype.divide=function(t){return(t=b.of(t))instanceof b.DynamicValue?new b.DivExpr(this,t):(e=t instanceof r&&this._key.equals(t._key)?this._value.divide(t._value):t instanceof w?this._value.divide(t):w.Absent).isDefined()?new r(this._key,e):w.Absent;var e},r.prototype.modulo=function(t){return(t=b.of(t))instanceof b.DynamicValue?new b.ModExpr(this,t):(e=t instanceof r&&this._key.equals(t._key)?this._value.modulo(t._value):t instanceof w?this._value.modulo(t):w.Absent).isDefined()?new r(this._key,e):w.Absent;var e},r.prototype.not=function(){var t=this._value.not();return t.isDefined()?new r(this._key,t):w.Absent},r.prototype.bnot=function(){var t=this._value.bnot();return t.isDefined()?new r(this._key,t):w.Absent},r.prototype.neg=function(){var t=this._value.neg();return t.isDefined()?new r(this._key,t):w.Absent},r.prototype.pos=function(){var t=this._value.pos();return t.isDefined()?new r(this._key,t):w.Absent},r.prototype.inv=function(){var t=this._value.inv();return t.isDefined()?new r(this._key,t):w.Absent},r.prototype.evaluate=function(t){t=D.fromAny(t);var e=this._key.evaluate(t).toValue(),i=this._value.evaluate(t).toValue();return e===this._key&&i===this._value?this:e.isDefined()&&i.isDefined()?new r(e,i):b.Absent},r.prototype.substitute=function(t){t=D.fromAny(t);var e=this._key.substitute(t).toValue(),i=this._value.substitute(t).toValue();return e===this._key&&i===this._value?this:e.isDefined()&&i.isDefined()?new r(e,i):b.Absent},r.prototype.isMutable=function(){return 0==(this._flags&M.IMMUTABLE)},r.prototype.alias=function(){this._flags|=M.IMMUTABLE},r.prototype.branch=function(){return 0!=(this._flags&M.IMMUTABLE)?new r(this._key,this._value,this._flags&~M.IMMUTABLE):this},r.prototype.clone=function(){return new r(this._key.clone(),this._value.clone())},r.prototype.commit=function(){return 0==(this._flags&M.IMMUTABLE)&&(this._flags|=M.IMMUTABLE,this._value.commit()),this},r.prototype.writeRecon=function(t){this._key.writeRecon(t),t.push(58),this._value!==b.Extant&&this._value.writeRecon(t)},r.prototype.compare=function(t){if(t instanceof r){var e=this._key.compare(t._key);return 0===e&&(e=this._value.compare(t._value)),e}return t instanceof b.Attr?1:-1},r.prototype.equals=function(t){return this===t||t instanceof r&&(this._key.equals(t._key)&&this._value.equals(t._value))},r.prototype.hashCode=function(){return p.mash(p.mix(p.mix(1237723953,this._key.hashCode()),this._value.hashCode()))},r.prototype.toString=function(){return this.toRecon()},r.of=function(t,e){return new r(t=b.Value.of(t),e=2===arguments.length?b.Value.of(e):b.Value.Extant)},r}(M);b.Slot=R;var T=function(n){function t(t,e,i,r){void 0===e&&(e=0),void 0===i&&(i=t.length),void 0===r&&(r=e);var o=n.call(this)||this;return o._record=t,o._lower=e,o._upper=i,o._index=r,o._direction=0,o}return v(t,n),t.prototype.isEmpty=function(){return this._index>=this._upper},t.prototype.head=function(){if(this._direction=0,this._index<this._upper)return this._record.getItem(this._index);throw new Error("empty head")},t.prototype.step=function(){if(this._direction=0,!(this._index<this._upper))throw new Error("empty step");this._index+=1},t.prototype.skip=function(t){this._index=Math.min(Math.max(this._lower,this._index+t,this._upper))},t.prototype.hasNext=function(){return this._index<this._upper},t.prototype.nextIndex=function(){return this._index-this._lower},t.prototype.next=function(){this._direction=1;var t=this._index;return t<this._upper?(this._index=t+1,{value:this._record.getItem(t),done:this._index===this._upper}):(this._index=this._upper,{done:!0})},t.prototype.hasPrevious=function(){return this._index>this._lower},t.prototype.previousIndex=function(){return this._index-this._lower-1},t.prototype.previous=function(){this._direction=-1;var t=this._index-1;return t>=this._lower?(this._index=t,{value:this._record.getItem(t),done:t===this._lower}):{done:!(this._index=0)}},t.prototype.set=function(t){0<this._direction?this._record.setItem(this._index-1,t):this._record.setItem(this._index,t)},t.prototype.delete=function(){0<this._direction&&(this._index-=1),this._record.splice(this._index,1),this._direction=0},t}(s),F=function(t){function h(){return null!==t&&t.apply(this,arguments)||this}return v(h,t),h.prototype.isArray=function(){return!this.forEach(function(t){return t instanceof b.Field||void 0},this)},h.prototype.isObject=function(){return!this.forEach(function(t){return t instanceof b.Value||void 0},this)},Object.defineProperty(h.prototype,"fieldCount",{get:function(){var e=0;return this.forEach(function(t){t instanceof b.Field&&(e+=1)},this),e},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"valueCount",{get:function(){var e=0;return this.forEach(function(t){t instanceof b.Value&&(e+=1)},this),e},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"tag",{get:function(){var t=this.head();if(t instanceof b.Attr)return t.key.value},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"target",{get:function(){return this.forEach(function(t){return t instanceof w?t:void 0},this)||w.Absent},enumerable:!0,configurable:!0}),h.prototype.flattened=function(){var t=this.iterator();if(!t.isEmpty()){var e=t.head();return t.step(),t.isEmpty()&&e instanceof w?e:this.branch()}return w.Extant},h.prototype.header=function(t){var e=this.head();return e instanceof b.Attr&&e.key.value===t?e.value:w.Absent},h.prototype.headers=function(t){var e=this.head();if(e instanceof b.Attr&&e.key.value===t){var i=e.value;return i instanceof h?i:h.of(i)}},h.prototype.head=function(){return this.forEach(function(t){return t},this)||b.Absent},h.prototype.tail=function(){var i=h.empty();return this.forEach(function(t,e){0<e&&i.push(t)},this),i},h.prototype.body=function(){var t=this.iterator();if(!t.isEmpty()&&(t.step(),!t.isEmpty())){var e=t.head();return t.step(),t.isEmpty()?(e instanceof b.Value||(e=h.of(e)),e):this.tail().branch()}return w.Absent},h.prototype.has=function(e){return e=w.of(e),this.forEach(function(t){return!!(t instanceof b.Field&&t.key.equals(e))||void 0},this)||!1},h.prototype.get=function(e){return e=w.of(e),this.forEach(function(t){return t instanceof b.Field&&t.key.equals(e)?t.value:void 0},this)||w.Absent},h.prototype.getAttr=function(e){return e=b.Text.of(e),this.forEach(function(t){return t instanceof b.Attr&&t.key.equals(e)?t.value:void 0},this)||w.Absent},h.prototype.getField=function(e){return e=w.of(e),this.forEach(function(t){return t instanceof b.Field&&t.key.equals(e)?t:void 0},this)},h.prototype.set=function(t,e){t=w.of(t),e=w.of(e);for(var i=this.iterator();!i.isEmpty();){var r=i.head();if(r instanceof b.Field&&r.key.equals(t))return r.isMutable()?r.setValue(e):i.set(r.withValue(e)),this;i.step()}var o=new b.Slot(t,e);return this.push(o),this},h.prototype.setAttr=function(t,e){t=b.Text.of(t),e=w.of(e);for(var i=this.iterator();!i.isEmpty();){var r=i.head();if(r instanceof b.Field&&r.key.equals(t))return r instanceof b.Attr&&r.isMutable()?r.setValue(e):i.set(new b.Attr(t,e)),this;i.step()}var o=new b.Attr(t,e);return this.push(o),this},h.prototype.concat=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=this.branch(),r=0,o=t.length;r<o;r+=1){b.fromAny(t[r]).forEach(function(t){i.push(t)},this)}return i},h.prototype.withField=function(t,e){t=w.of(t),e=w.of(e);for(var i=this.isMutable()?this:this.branch(),r=i.iterator();!r.isEmpty();){var o=r.head();if(o.key.equals(t))return o instanceof b.Field&&o.isMutable()?o.setValue(e):r.set(b.Slot.of(t,e)),i;r.step()}var n=b.Slot.of(t,e);return i.push(n),i},h.prototype.withAttr=function(t,e){t=b.Text.of(t),e=w.of(e);for(var i=this.isMutable()?this:this.branch(),r=i.iterator();!r.isEmpty();){var o=r.head();if(o.key.equals(t))return o instanceof b.Attr&&o.isMutable()?o.setValue(e):r.set(b.Attr.of(t,e)),i;r.step()}var n=b.Attr.of(t,e);return i.push(n),i},h.prototype.withSlot=function(t,e){t=w.of(t),e=w.of(e);for(var i=this.isMutable()?this:this.branch(),r=i.iterator();!r.isEmpty();){var o=r.head();if(o.key.equals(t))return o instanceof b.Slot&&o.isMutable()?o.setValue(e):r.set(b.Slot.of(t,e)),i;r.step()}var n=b.Slot.of(t,e);return i.push(n),i},h.prototype.withItem=function(t){var e=this.isMutable()?this:this.branch();return e.push(t),e},h.prototype.withItems=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.isMutable()?this:this.branch();return i.push.apply(i,arguments),i},h.prototype.withoutKey=function(t){var e=this.isMutable()?this:this.branch();return e.delete(t),e},h.prototype.slice=function(t,e){return this.subRecord.apply(this,arguments).branch()},h.prototype.subRecord=function(i,r){var t=this.length;void 0===i?i=0:i<0&&(i=t+i),i=Math.min(Math.max(0,i),t),void 0===r?r=t:r<0&&(r=t+r);var o=h.empty();return this.forEach(function(t,e){return e<i?void 0:e<r?void o.push(t):null},this),o},h.prototype.attr=function(t,e){return this.push(b.Attr.of.apply(void 0,arguments)),this},h.prototype.slot=function(t,e){return this.push(b.Slot.of.apply(void 0,arguments)),this},h.prototype.item=function(t){return this.push(b.fromAny(t)),this},h.prototype.items=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.push.apply(this,arguments),this},h.prototype.iterator=function(){return new T(this)},h.prototype.indexOf=function(i,r){void 0===r&&(r=0),i=b.of(i);var t=this.length;r<0&&(r=t+r),r=Math.max(0,r);var o=-1;return this.forEach(function(t,e){if(r<=e&&t.equals(i))return o=e,null},this),o},h.prototype.lastIndexOf=function(i,r){i=b.of(i);var t=this.length;void 0===r?r=t-1:r<0&&(r=t+r),r=Math.min(r,t-1);var o=-1;return this.forEach(function(t,e){if(r<e)return null;t.equals(i)&&(o=e)},this),o},h.prototype.evaluate=function(i){i=D.fromAny(i);var r=h.empty();i.push(r);var o=!1;return this.forEach(function(t){var e=t.evaluate(i);e.isDefined()&&r.push(e),o=o||t!==e},this),i.pop(),o?r:this},h.prototype.substitute=function(i){i=D.fromAny(i);var r=h.empty();i.push(r);var o=!1;return this.forEach(function(t){var e=t.substitute(i);e.isDefined()&&r.push(e),o=o||t!==e},this),i.pop(),o?r:this},h.prototype.isAliased=function(){return!1},h.prototype.isMutable=function(){return!0},h.prototype.alias=function(){},h.prototype.branch=function(){var e=h.empty();return this.forEach(function(t){e.push(t)},this),e},h.prototype.clone=function(){var e=h.empty();return this.forEach(function(t){e.push(t.clone())},this),e},h.prototype.commit=function(){return this},h.prototype.toAny=function(){return!this.isEmpty()&&this.isArray()?this.toArray():this.toObject()},h.prototype.toArray=function(){var i=new Array(this.length);return this.forEach(function(t,e){t instanceof b.Value?i[e]=t.toAny():t instanceof b.Field&&(i[e]={$key:t.key.toAny(),$value:t.value.toAny()})},this),i},h.prototype.toObject=function(){var i={};return this.forEach(function(t,e){t instanceof b.Attr?i["@"+t.key.value]=t.value.toAny():t instanceof b.Slot?t.key instanceof b.Text?i[t.key.value]=t.value.toAny():i["$"+e]={$key:t.key.toAny(),$value:t.value.toAny()}:t instanceof b.Value&&(i["$"+e]=t.toAny())},this),i},h.prototype.stringValue=function(t){var i="";return void 0===this.forEach(function(t){if(t instanceof b.Value){var e=t.stringValue();if(void 0!==e)return void(i+=e)}return null},this)?i:void 0},h.prototype.bind=function(){return this},h.prototype.isBlockSafe=function(){return void 0===this.forEach(function(t){return!(t instanceof b.Attr)&&void 0},this)},h.prototype.isMarkupSafe=function(){var i=0;return void 0===this.forEach(function(t,e){if(i+=1,0===e){if(!(t instanceof b.Attr))return!1}else if(t instanceof b.Attr)return!1},this)&&0<i},h.prototype.writeRecon=function(t){var e=this.iterator();e.isEmpty()?t.push(123,125):h.writeItems(e,!1,!1,t)},h.prototype.writeReconBlock=function(t){var e=this.iterator();e.isEmpty()?t.push(123,125):h.writeItems(e,this.isBlockSafe(),!1,t)},h.writeItems=function(t,e,i,r){for(var o=!1,n=!1,s=!0,a=!0;!t.isEmpty();){var u=t.head();(u instanceof b.Expr||u instanceof b.Selector)&&(a=!1),t.step(),n&&u instanceof b.Attr&&(o&&(r.push(125),o=!1),r.push(93),n=!1),u instanceof b.Attr?(o?(r.push(125),o=!1):n&&(r.push(93),n=!1),u.writeRecon(r),s=!1):n&&u instanceof b.Text?(o&&(r.push(125),o=!1),b.Text.writeMarkup(u.value,r)):o?(s?s=!1:r.push(44),u.writeRecon(r)):n?u instanceof h&&u.isMarkupSafe()?(h.writeItems(u.iterator(),!1,!0,r),!t.isEmpty()&&t.head()instanceof b.Text?(b.Text.writeMarkup(t.head().stringValue(),r),t.step()):t.isEmpty()||t.head()instanceof b.Attr?(r.push(93),n=!1):(r.push(123),s=o=!0)):(r.push(123),u.writeRecon(r),s=!(o=!0)):!(a&&u instanceof b.Text)||t.isEmpty()||t.head()instanceof b.Field||t.head()instanceof b.Text||t.head()instanceof b.Bool?e&&!o?(s?s=!1:r.push(44),u.writeRecon(r)):i&&u instanceof b.Text&&t.isEmpty()?(r.push(91),b.Text.writeMarkup(u.value,r),r.push(93)):!i&&u instanceof w&&!(u instanceof h)&&(!s&&t.isEmpty()||!t.isEmpty()&&t.head()instanceof b.Attr)?(!s&&(u instanceof b.Text&&u.isIdent()||u instanceof b.Num||u instanceof b.Bool)&&r.push(32),u.writeRecon(r)):(r.push(123),u.writeRecon(r),s=!(o=!0)):(r.push(91),b.Text.writeMarkup(u.value,r),n=!0)}o&&r.push(125),n&&r.push(93)},h.prototype.compare=function(t){if(t instanceof h){for(var e=this.iterator(),i=t.iterator(),r=0;0===r&&!e.isEmpty()&&!i.isEmpty();)r=e.head().compare(i.head()),e.step(),i.step();return 0!==r?r:e.isEmpty()&&!i.isEmpty()?-1:!e.isEmpty()&&i.isEmpty()?1:0}return t instanceof b.Field?1:-1},h.prototype.equals=function(t){if(this===t)return!0;if(t instanceof h){for(var e=this.iterator(),i=t.iterator();!e.isEmpty()&&!i.isEmpty();){if(!e.head().equals(i.head()))return!1;e.step(),i.step()}return e.isEmpty()===i.isEmpty()}return!1},h.prototype.hashCode=function(){var e=3401408391;return this.forEach(function(t){e=p.mix(e,t.hashCode())},this),p.mash(e)},h.prototype.toString=function(){return this.toRecon()},h.fromAny=function(t){if(t instanceof h)return t;if(Array.isArray(t))return h.fromArray(t);if("object"==typeof t)return h.fromObject(t);throw new TypeError(""+t)},h.fromArray=function(t){for(var e=t.length||0,i=h.empty(e),r=0;r<e;r+=1)i.push(b.fromAny(t[r]));return i},h.fromObject=function(t){var e=h.empty(),i=0;for(var r in t){var o=t[r];36===r.charCodeAt(0)&&r==="$"+i?o&&"object"==typeof o&&o.hasOwnProperty("$key")?e.push(b.Field.of(o.$key,o.$value)):e.push(w.of(o)):e.push(b.Field.of(r,o)),i+=1}return e},h.parseRecon=function(t){var e=w.parseRecon(t);return e instanceof h?e:e.isDefined()?h.of(e):h.empty()},h.expand=function(t){return t=Math.max(8,t)-1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1},h.ALIASED=1,h.IMMUTABLE=2,h.Empty=void 0,h.empty=void 0,h.of=void 0,h}(w),L=function(s){function u(t,e,i,r,o){var n=s.call(this)||this;return n._array=t,n._table=e,n._itemCount=i,n._fieldCount=r,n._flags=o,n}return v(u,s),u.prototype.isEmpty=function(){return 0===this._itemCount},u.prototype.isArray=function(){return 0===this._fieldCount},u.prototype.isObject=function(){return this._itemCount===this._fieldCount},Object.defineProperty(u.prototype,"length",{get:function(){return this._itemCount},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"size",{get:function(){return this._itemCount},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"fieldCount",{get:function(){return this._itemCount},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"valueCount",{get:function(){return this._itemCount-this._fieldCount},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"tag",{get:function(){if(0<this._fieldCount){var t=this._array[0];if(t instanceof b.Attr)return t.key.value}},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"target",{get:function(){for(var t=this._array,e=0,i=this._itemCount;e<i;e+=1){var r=t[e];if(r instanceof w)return r}return this},enumerable:!0,configurable:!0}),u.prototype.head=function(){return 0<this._itemCount?this._array[0]:w.Absent},u.prototype.tail=function(){var t=this._itemCount;return 0<t?new u.View(this,1,t):F.Empty},u.prototype.body=function(){var t=this._itemCount;if(2<t)return new u.View(this,1,t).branch();if(2===t){var e=this._array[1];return e instanceof b.Value||(e=F.of(e)),e}return w.Absent},u.prototype.has=function(t){if(0<this._fieldCount){t=w.of(t),this.hash();var e=this._table,i=e.length,r=Math.abs(t.hashCode()%i),o=r;do{var n=e[o];if(void 0===n)break;if(n.key.equals(t))return!0;o=(o+1)%i}while(o!==r)}return!1},u.prototype.get=function(t){if(0<this._fieldCount){t=w.of(t),this.hash();var e=this._table,i=e.length,r=Math.abs(t.hashCode()%i),o=r;do{var n=e[o];if(void 0===n)break;if(n.key.equals(t))return n.value;o=(o+1)%i}while(o!==r)}return w.Absent},u.prototype.getAttr=function(t){if(0<this._fieldCount){t=b.Text.of(t),this.hash();var e=this._table,i=e.length,r=Math.abs(t.hashCode()%i),o=r;do{var n=e[o];if(void 0===n)break;if(n instanceof b.Attr&&n.key.equals(t))return n.value;o=(o+1)%i}while(o!==r)}return w.Absent},u.prototype.getField=function(t){if(0<this._fieldCount){t=w.of(t),this.hash();var e=this._table,i=e.length,r=Math.abs(t.hashCode()%i),o=r;do{var n=e[o];if(void 0===n)break;if(n.key.equals(t))return n;o=(o+1)%i}while(o!==r)}},u.prototype.getItem=function(t){t instanceof b.Num&&(t=t.value);var e=this._itemCount;return t<0&&(t=e+t),0<=(t=Math.min(Math.max(0,t),e-1))?this._array[t]:b.Absent},u.prototype.set=function(t,e){if(0!=(this._flags&F.IMMUTABLE))throw new Error("immutable");return t=w.of(t),e=w.of(e),0!=(this._flags&F.ALIASED)?0<this._fieldCount?this.setAliased(t,e):this.pushAliased(new b.Slot(t,e)):0<this._fieldCount?null!==this._table?this.setMutable(t,e):this.putMutable(t,e):this.pushMutable(new b.Slot(t,e)),this},u.prototype.setAliased=function(t,e){for(var i=this._itemCount,r=this._array,o=new Array(F.expand(i+1)),n=0;n<i;n+=1){var s=r[n];if(s instanceof b.Field&&s.key.equals(t)){for(o[n]=s.withValue(e),n+=1;n<i;)o[n]=r[n],n+=1;return this._array=o,this._table=null,void(this._flags&=~F.ALIASED)}o[n]=s}this._array=o,this._table=null,this._flags&=~F.ALIASED;var a=new b.Slot(t,e);this.pushMutable(a)},u.prototype.setMutable=function(t,e){var i=this._table,r=i.length,o=Math.abs(t.hashCode()%r),n=o;do{var s=i[n];if(void 0===s)break;if(s.key.equals(t))return s.isMutable()?void s.setValue(e):void this.putMutable(t,e);n=(n+1)%r}while(n!==o);var a=new b.Slot(t,e);this.pushMutable(a),u.put(a,i)},u.prototype.putMutable=function(t,e){for(var i=this._array,r=0,o=this._itemCount;r<o;r+=1){var n=i[r];if(n instanceof b.Field&&n.key.equals(t))return i[r]=n.withValue(e),void(this._table=null)}var s=new b.Slot(t,e);this.pushMutable(s),u.put(s,this._table)},u.prototype.setAttr=function(t,e){if(0!=(this._flags&F.IMMUTABLE))throw new Error("immutable");return t=b.Text.of(t),e=w.of(e),0!=(this._flags&F.ALIASED)?0<this._fieldCount?this.setAttrAliased(t,e):this.pushAliased(new b.Attr(t,e)):0<this._fieldCount?null!==this._table?this.setAttrMutable(t,e):this.putAttrMutable(t,e):this.pushMutable(new b.Attr(t,e)),this},u.prototype.setAttrAliased=function(t,e){for(var i=this._itemCount,r=this._array,o=new Array(F.expand(i+1)),n=0;n<i;n+=1){var s=r[n];if(s instanceof b.Field&&s.key.equals(t)){for(o[n]=b.Attr.of(t,e),n+=1;n<i;)o[n]=r[n],n+=1;return this._array=o,this._table=null,void(this._flags&=~F.ALIASED)}o[n]=s}o[i]=b.Attr.of(t,e),this._array=o,this._table=null,this._itemCount=i+1,this._fieldCount+=1,this._flags&=~F.ALIASED},u.prototype.setAttrMutable=function(t,e){var i=this._table,r=i.length,o=Math.abs(t.hashCode()%r),n=o;do{var s=i[n];if(void 0===s)break;if(s.key.equals(t))return void(s instanceof b.Attr&&s.isMutable()?s.setValue(e):this.putAttrMutable(t,e));n=(n+1)%r}while(n!==o);var a=b.Attr.of(t,e);this.push(a),u.put(a,i)},u.prototype.putAttrMutable=function(t,e){for(var i=this._array,r=this._itemCount,o=0;o<r;o+=1){if(i[o].key.equals(t))return i[o]=b.Attr.of(t,e),void(this._table=null)}var n=b.Attr.of(t,e);this.push(n),u.put(n,this._table)},u.prototype.setItem=function(t,e){if(0!=(this._flags&F.IMMUTABLE))throw new Error("immutable");t instanceof b.Num&&(t=t.value),e=b.of(e);var i=this.length;return t<0&&(t=i+t),0<=(t=Math.min(Math.max(0,t),i-1))&&(0!=(this._flags&F.ALIASED)?this.setIndexAliased(t,e):this.setIndexMutable(t,e)),this},u.prototype.setIndexAliased=function(t,e){for(var i=this._itemCount,r=this._array,o=new Array(F.expand(i)),n=0;n<i;n+=1)o[n]=r[n];var s=r[t];o[t]=e,this._array=o,this._table=null,e instanceof b.Field?s instanceof b.Field||(this._fieldCount+=1):s instanceof b.Field&&(this._fieldCount-=1),this._flags&=~F.ALIASED},u.prototype.setIndexMutable=function(t,e){var i=this._array,r=i[t];(i[t]=e)instanceof b.Field?(this._table=null,r instanceof b.Field||(this._fieldCount+=1)):r instanceof b.Field&&(this._table=null,this._fieldCount-=1)},u.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0!=(this._flags&F.IMMUTABLE))throw new Error("immutable");return 0!=(this._flags&F.ALIASED)?this.pushAliased.apply(this,arguments):this.pushMutable.apply(this,arguments),this._itemCount},u.prototype.pushAliased=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t.length,r=this._itemCount,o=this._fieldCount,n=this._array,s=new Array(F.expand(r+i));if(null!==n)for(var a=0;a<r;a+=1)s[a]=n[a];for(a=0;a<i;a+=1){var u=b.fromAny(t[a]);s[r]=u,r+=1,u instanceof b.Field&&(o+=1)}this._array=s,this._table=null,this._itemCount=r,this._fieldCount=o,this._flags&=~F.ALIASED},u.prototype.pushMutable=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i,r=t.length,o=this._itemCount,n=this._fieldCount,s=this._array;if(null===s||o+r>s.length){if(i=new Array(F.expand(o+r)),null!==s)for(var a=0;a<o;a+=1)i[a]=s[a]}else i=s;for(a=0;a<r;a+=1){var u=b.fromAny(t[a]);i[o]=u,o+=1,u instanceof b.Field&&(n+=1,this._table=null)}this._array=i,this._itemCount=o,this._fieldCount=n},u.prototype.splice=function(t,e){void 0===e&&(e=0);for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(0!=(this._flags&F.IMMUTABLE))throw new Error("immutable");var o=this._itemCount;return t<0&&(t=o+t),t=Math.min(Math.max(0,t),o),e=Math.min(Math.max(0,e),o-t),0!=(this._flags&F.ALIASED)?this.spliceAliased.apply(this,arguments):this.spliceMutable.apply(this,arguments)},u.prototype.spliceAliased=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];for(var o=i.length,n=this._itemCount,s=this._fieldCount,a=this._array,u=new Array(F.expand(n-e+o)),h=0;h<t;h+=1)u[h]=a[h];var l=[];for(h=t;h<t+e;h+=1){var p=a[h];l.push(p),n-=1,p instanceof b.Field&&(s-=1)}for(h=t;h<n;h+=1)u[h+o]=a[h+e];for(h=0;h<o;h+=1){var c=b.of(i[h]);n+=1,(u[h+t]=c)instanceof b.Field&&(s+=1)}return this._array=u,this._table=null,this._itemCount=n,this._fieldCount=s,this._flags&=~F.ALIASED,l},u.prototype.spliceMutable=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];var o,n=i.length,s=this._itemCount,a=this._fieldCount,u=this._array;if(null===u||s-e+n>u.length){if(o=new Array(F.expand(s-e+n)),null!==u)for(var h=0;h<t;h+=1)o[h]=u[h]}else o=u;var l=[];for(h=t;h<t+e;h+=1){var p=u[h];l.push(p),s-=1,p instanceof b.Field&&(a-=1)}if(e<n)for(h=s-1;t<=h;h-=1)o[h+n]=u[h+e];else for(h=t;h<s;h+=1)o[h+n]=u[h+e];for(h=0;h<n;h+=1){var c=b.of(i[h]);s+=1,(o[h+t]=c)instanceof b.Field&&(a+=1)}return this._array=o,this._itemCount=s,this._fieldCount=a,l},u.prototype.delete=function(t){if(0!=(this._flags&F.IMMUTABLE))throw new Error("immutable");return t=w.of(t),0!=(this._flags&F.ALIASED)?this.deleteAliased(t):this.deleteMutable(t)},u.prototype.deleteAliased=function(t){for(var e=this._itemCount,i=this._array,r=new Array(F.expand(e)),o=0;o<e;o+=1){var n=i[o];if(n instanceof b.Field&&n.key.equals(t)){for(var s=o+1;s<e;s+=1,o+=1)r[o]=i[s];return this._array=r,this._table=null,this._itemCount=e-1,this._fieldCount-=1,this._flags&=~F.ALIASED,n}r[o]=n}return b.Absent},u.prototype.deleteMutable=function(t){for(var e=this._itemCount,i=this._array,r=0;r<e;r+=1){var o=i[r];if(o instanceof b.Field&&o.key.equals(t)){for(var n=r+1;n<e;n+=1,r+=1)i[r]=i[n];return i[e-1]=void 0,this._table=null,this._itemCount=e-1,this._fieldCount-=1,o}}return b.Absent},u.prototype.clear=function(){if(0!=(this._flags&F.IMMUTABLE))throw new Error("immutable");this._array=null,this._table=null,this._itemCount=0,this._fieldCount=0,this._flags=0},u.prototype.withField=function(t,e){t=w.of(t),e=w.of(e);var i=0==(this._flags&F.IMMUTABLE)?this:this.branch();return 0!=(i._flags&F.ALIASED)?0<i._fieldCount?i.setAliased(t,e):i.pushAliased(b.Slot.of(t,e)):0<i.fieldCount?null!==i._table?i.setMutable(t,e):i.putMutable(t,e):i.pushMutable(b.Slot.of(t,e)),i},u.prototype.withAttr=function(t,e){t=b.Text.of(t),e=w.of(e);var i=0==(this._flags&F.IMMUTABLE)?this:this.branch();return 0!=(i._flags&F.ALIASED)?0<i._fieldCount?i.setAttrAliased(t,e):i.pushAliased(b.Attr.of(t,e)):0<i.fieldCount?null!==i._table?i.setAttrMutable(t,e):i.putAttrMutable(t,e):i.pushMutable(b.Attr.of(t,e)),i},u.prototype.withSlot=function(t,e){t=w.of(t),e=w.of(e);var i=0==(this._flags&F.IMMUTABLE)?this:this.branch();return 0!=(i._flags&F.ALIASED)?0<i._fieldCount?i.setSlotAliased(t,e):i.pushAliased(b.Slot.of(t,e)):0<i.fieldCount?null!==i._table?i.setSlotMutable(t,e):i.putSlotMutable(t,e):i.pushMutable(b.Slot.of(t,e)),i},u.prototype.setSlotAliased=function(t,e){for(var i=this._itemCount,r=this._array,o=new Array(F.expand(i+1)),n=0;n<i;n+=1){var s=r[n];if(s instanceof b.Field&&s.key.equals(t)){for(o[n]=b.Slot.of(t,e),n+=1;n<i;)o[n]=r[n],n+=1;return this._array=o,this._table=null,void(this._flags&=~F.ALIASED)}o[n]=s}o[i]=b.Slot.of(t,e),this._array=o,this._table=null,this._itemCount=i+1,this._fieldCount+=1,this._flags&=~F.ALIASED},u.prototype.setSlotMutable=function(t,e){var i=this._table,r=i.length,o=Math.abs(t.hashCode()%r),n=o;do{var s=i[n];if(void 0===s)break;if(s.key.equals(t))return void(s instanceof b.Slot&&s.isMutable()?s.setValue(e):this.putSlotMutable(t,e));n=(n+1)%r}while(n!==o);var a=b.Slot.of(t,e);this.push(a),u.put(a,i)},u.prototype.putSlotMutable=function(t,e){for(var i=this._array,r=this._itemCount,o=0;o<r;o+=1){if(i[o].key.equals(t))return i[o]=b.Slot.of(t,e),void(this._table=null)}var n=b.Slot.of(t,e);this.push(n),u.put(n,this._table)},u.prototype.subRecord=function(t,e){var i=this._itemCount;return void 0===t?t=0:t<0&&(t=i+t),t=Math.min(Math.max(0,t),i),void 0===e?e=i:e<0&&(e=i+e),e=Math.min(Math.max(t,e),i),new u.View(this,t,e)},u.prototype.forEach=function(t,e){for(var i=this._array,r=0,o=this._itemCount;r<o;r+=1){var n=t.call(e,i[r],r);if(void 0!==n)return n}},u.prototype.indexOf=function(t,e){void 0===e&&(e=0),t=b.of(t);var i=this._array,r=this._itemCount;for(e<0&&(e=r+e),e=Math.max(0,e);e<r;){if(t.equals(i[e]))return e;e+=1}return-1},u.prototype.lastIndexOf=function(t,e){t=b.of(t);var i=this._array,r=this._itemCount;for(void 0===e?e=r-1:e<0&&(e=r+e),e=Math.min(e,r-1);0<=e;){if(t.equals(i[e]))return e;e-=1}return-1},u.prototype.evaluate=function(t){t=D.fromAny(t);var e=this._array,i=this._itemCount,r=F.empty(i);t.push(r);for(var o=!1,n=0;n<i;n+=1){var s=e[n],a=s.evaluate(t);a.isDefined()&&r.push(a),o=o||s!==a}return t.pop(),o?r:this},u.prototype.substitute=function(t){t=D.fromAny(t);var e=this._array,i=this._itemCount,r=F.empty(i);t.push(r);for(var o=!1,n=0;n<i;n+=1){var s=e[n],a=s.substitute(t);a.isDefined()&&r.push(a),o=o||s!==a}return t.pop(),o?r:this},u.prototype.isAliased=function(){return 0!=(this._flags&F.ALIASED)},u.prototype.isMutable=function(){return 0==(this._flags&F.IMMUTABLE)},u.prototype.alias=function(){this._flags|=F.ALIASED},u.prototype.branch=function(){if(0==(this._flags&(F.ALIASED|F.IMMUTABLE)))for(var t=this._array,e=0,i=this._itemCount;e<i;e+=1)t[e].alias();return this._flags|=F.ALIASED,new u(this._array,this._table,this._itemCount,this._fieldCount,F.ALIASED)},u.prototype.clone=function(){for(var t=this._itemCount,e=this._array,i=new Array(t),r=0;r<t;r+=1)i[r]=e[r].clone();return new u(i,null,t,this._fieldCount,0)},u.prototype.commit=function(){if(0==(this._flags&F.IMMUTABLE)){this._flags|=F.IMMUTABLE;for(var t=this._array,e=0,i=this._itemCount;e<i;e+=1)t[e].commit()}return this},u.prototype.hash=function(){var t=this._fieldCount;if(0<t&&null===this._table){for(var e=new Array(F.expand(Math.max(t,10*t/7))),i=this._array,r=0,o=this._itemCount;r<o;r+=1){var n=i[r];n instanceof b.Field&&u.put(n,e)}this._table=e}},u.put=function(t,e){if(null!==e){var i=e.length,r=Math.abs(t.key.hashCode()%i),o=r;do{var n=e[o];if(void 0===n)return void(e[o]=t);if(t.key.equals(n.key))return void(e[o]=t);o=(o+1)%i}while(o!==r);throw new Error}},u.empty=function(t){return new u(void 0===t?null:new Array(t),null,0,0,0)},u.of=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t.length;if(0===i)return new u(null,null,0,0,0);for(var r=new Array(i),o=0,n=0,s=0;s<i;s+=1){var a=b.fromAny(t[s]);o+=1,(r[s]=a)instanceof b.Field&&(n+=1)}return new u(r,null,o,n,0)},u.View=void 0,u.Empty=new u(null,null,0,0,F.ALIASED|F.IMMUTABLE),u}(b.Record=F);b.Empty=L.Empty,w.Empty=L.Empty,F.Empty=L.Empty,b.empty=L.empty,w.empty=L.empty,F.empty=L.empty,F.of=L.of;var I=function(o){function r(t,e,i){var r=o.call(this)||this;return r._record=t,r._lower=e,r._upper=i,r}return v(r,o),r.prototype.isEmpty=function(){return this._lower===this._upper},r.prototype.isArray=function(){for(var t=this._record._array,e=this._lower,i=this._upper;e<i;e+=1)if(t[e]instanceof b.Field)return!1;return!0},r.prototype.isObject=function(){for(var t=this._record._array,e=this._lower,i=this._upper;e<i;e+=1)if(t[e]instanceof b.Value)return!1;return!0},Object.defineProperty(r.prototype,"length",{get:function(){return this._upper-this._lower},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"size",{get:function(){return this._upper-this._lower},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fieldCount",{get:function(){for(var t=0,e=this._record._array,i=this._lower,r=this._upper;i<r;i+=1)e[i]instanceof b.Field&&(t+=1);return t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"valueCount",{get:function(){for(var t=0,e=this._record._array,i=this._lower,r=this._upper;i<r;i+=1)e[i]instanceof w&&(t+=1);return t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"tag",{get:function(){if(0<this.length){var t=this._record._array[this._lower];if(t instanceof b.Attr)return t.key.value}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"target",{get:function(){for(var t=this._record._array,e=this._lower,i=this._upper;e<i;e+=1){var r=t[e];if(r instanceof w)return r}return this},enumerable:!0,configurable:!0}),r.prototype.head=function(){return 0<this.length?this._record._array[this._lower]:w.Absent},r.prototype.tail=function(){return 0<this.length?new r(this._record,this._lower+1,this._upper):F.Empty},r.prototype.body=function(){var t=this.length;if(2<t)return new r(this._record,this._lower+1,this._upper).branch();if(2===t){var e=this._record._array[this._lower+1];return e instanceof b.Value||(e=F.of(e)),e}return w.Absent},r.prototype.getItem=function(t){t instanceof b.Num&&(t=t.value);var e=this.length;return t<0&&(t=e+t),0<=(t=Math.min(Math.max(0,t),e-1))?this._record._array[this._lower+t]:b.Absent},r.prototype.setItem=function(t,e){if(0!=(this._record._flags&F.IMMUTABLE))throw new Error("immutable");t instanceof b.Num&&(t=t.value),e=b.of(e);var i=this.length;return t<0&&(t=i+t),0<=(t=Math.min(Math.max(0,t),i-1))&&(0!=(this._record._flags&F.ALIASED)?this.setIndexAliased(t,e):this.setIndexMutable(t,e)),this},r.prototype.setIndexAliased=function(t,e){for(var i=this._record._itemCount,r=this._record._array,o=new Array(F.expand(i)),n=0;n<i;n+=1)o[n]=r[n];var s=r[this._lower+t];o[this._lower+t]=e,this._record._array=o,this._record._table=null,e instanceof b.Field?s instanceof b.Field||(this._record._fieldCount+=1):s instanceof b.Field&&(this._record._fieldCount-=1),this._record._flags&=~F.ALIASED},r.prototype.setIndexMutable=function(t,e){var i=this._record._array,r=i[this._lower+t];(i[this._lower+t]=e)instanceof b.Field?(this._record._table=null,r instanceof b.Field||(this._record._fieldCount+=1)):r instanceof b.Field&&(this._record._table=null,this._record._fieldCount-=1)},r.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0!=(this._record._flags&F.IMMUTABLE))throw new Error("immutable");return 0!=(this._record._flags&F.ALIASED)?this.pushAliased.apply(this,arguments):this.pushMutable.apply(this,arguments),this.length},r.prototype.pushAliased=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t.length,r=this._record._itemCount,o=this._record._fieldCount,n=this._record._array,s=new Array(F.expand(r+i));if(null!==n){for(var a=0;a<this._upper;a+=1)s[a]=n[a];for(a=this._upper;a<r;a+=1)s[a+i]=n[a]}for(a=0;a<i;a+=1){var u=b.fromAny(t[a]);r+=1,(s[a+this._upper]=u)instanceof b.Field&&(o+=1)}this._record._array=s,this._record._table=null,this._record._itemCount=r,this._record._fieldCount=o,this._record._flags&=~F.ALIASED,this._upper+=i},r.prototype.pushMutable=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i,r=t.length,o=this._record._itemCount,n=this._record._fieldCount,s=this._record._array;if(null===s||o+r>s.length){if(i=new Array(F.expand(o+r)),null!==s)for(var a=0;a<this._upper;a+=1)i[a]=s[a]}else i=s;for(a=o-1;a>=this._upper;a-=1)i[a+r]=s[a];for(a=0;a<r;a+=1){var u=b.fromAny(t[a]);o+=1,(i[a+this._upper]=u)instanceof b.Field&&(n+=1,this._record._table=null)}this._record._array=i,this._record._itemCount=o,this._record._fieldCount=n,this._upper+=r},r.prototype.splice=function(t,e){void 0===e&&(e=0);for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(0!=(this._record._flags&F.IMMUTABLE))throw new Error("immutable");var o,n,s,a=this.length;return t<0&&(t=a+t),t=Math.min(Math.max(0,t),a),e=Math.min(Math.max(0,e),a-t),o=0!=(this._record._flags&F.ALIASED)?(n=this._record).spliceAliased.apply(n,[this._lower+t,e].concat(i)):(s=this._record).spliceMutable.apply(s,[this._lower+t,e].concat(i)),this._upper+=i.length-o.length,o},r.prototype.delete=function(t){if(0!=(this._record._flags&F.IMMUTABLE))throw new Error("immutable");return t=w.of(t),0!=(this._record._flags&F.ALIASED)?this.deleteAliased(t):this.deleteMutable(t)},r.prototype.deleteAliased=function(t){for(var e=this._record._itemCount,i=this._record._array,r=new Array(F.expand(e)),o=this._lower;o<this._upper;o+=1){var n=i[o];if(n instanceof b.Field&&n.key.equals(t)){for(var s=o+1;s<e;s+=1,o+=1)r[o]=i[s];return this._record._array=r,this._record._table=null,this._record._itemCount=e-1,this._record._fieldCount-=1,this._record._flags&=~F.ALIASED,this._upper-=1,n}r[o]=n}return b.Absent},r.prototype.deleteMutable=function(t){for(var e=this._record._itemCount,i=this._record._array,r=this._lower;r<this._upper;r+=1){var o=i[r];if(o instanceof b.Field&&o.key.equals(t)){for(var n=r+1;n<e;n+=1,r+=1)i[r]=i[n];return i[e-1]=void 0,this._record._table=null,this._record._itemCount-=1,this._record._fieldCount-=1,this._upper-=1,o}}return b.Absent},r.prototype.clear=function(){if(0!=(this._record._flags&F.IMMUTABLE))throw new Error("immutable");0!=(this._record._flags&F.ALIASED)?this.clearAliased():this.clearMutable()},r.prototype.clearAliased=function(){for(var t=this._record._itemCount,e=this._record._fieldCount,i=t-this.length,r=this._record._array,o=new Array(F.expand(i)),n=0;n<this._lower;)o[n]=r[n],n+=1;for(;n<this._upper;)r[n]instanceof b.Field&&(e-=1),n+=1;n=this._lower;for(var s=this._upper;s<t;)o[n]=r[s],n+=1,s+=1;this._record._array=o,this._record._table=null,this._record._itemCount=i,this._record._fieldCount=e,this._record._flags&=~F.ALIASED,this._upper=this._lower},r.prototype.clearMutable=function(){for(var t=this._record._itemCount,e=this._record._fieldCount,i=this._record._array,r=this._lower;r<this._upper;)i[r]instanceof b.Field&&(e-=1),r+=1;r=this._lower;for(var o=this._upper;o<t;){var n=i[o];n instanceof b.Field&&(this._record._table=null),i[r]=n,r+=1,o+=1}for(this._record._itemCount=r,this._record._fieldCount=e;r<t;)i[r]=void 0,r+=1;this._upper=this._lower},r.prototype.subRecord=function(t,e){var i=this.length;return void 0===t?t=0:t<0&&(t=i+t),t=Math.min(Math.max(0,t),i),void 0===e?e=i:e<0&&(e=i+e),e=Math.min(Math.max(t,e),i),new r(this._record,this._lower+t,this._upper+e)},r.prototype.forEach=function(t,e){for(var i=this._record._array,r=this._lower,o=this._upper;r<o;r+=1){var n=t.call(e,i[r],r);if(void 0!==n)return n}},r.prototype.indexOf=function(t,e){void 0===e&&(e=0),t=b.of(t);var i=this._record._array,r=this.length;for(e<0&&(e=r+e),e=this._lower+Math.max(0,e);e<this._upper;){if(t.equals(i[e]))return e-this._lower;e+=1}return-1},r.prototype.lastIndexOf=function(t,e){t=b.of(t);var i=this._record._array,r=this.length;for(void 0===e?e=r-1:e<0&&(e=r+e),e=this._lower+Math.min(e,r-1);e>=this._lower;){if(t.equals(i[e]))return e-this._lower;e-=1}return-1},r.prototype.isAliased=function(){return 0!=(this._record._flags&F.ALIASED)},r.prototype.isMutable=function(){return 0==(this._record._flags&F.IMMUTABLE)},r.prototype.alias=function(){this._record._flags|=F.ALIASED},r.prototype.branch=function(){for(var t=this.length,e=0,i=this._record._array,r=new Array(F.expand(t)),o=this._lower,n=0;n<t;){var s=i[o];(r[n]=s)instanceof b.Field&&(e+=1),o+=1,n+=1}return new L(r,null,t,e,0)},r.prototype.clone=function(){for(var t=this.length,e=0,i=this._record._array,r=new Array(F.expand(t)),o=this._lower,n=0;n<t;){var s=i[o];r[n]=s.clone(),s instanceof b.Field&&(e+=1),o+=1,n+=1}return new L(r,null,t,e,0)},r.prototype.commit=function(){return this._record.commit(),this},r}(F);L.View=I;var z=function(i){function e(t){var e=i.call(this)||this;return e._value=t,e}return v(e,i),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e.prototype.or=function(t){return this},e.prototype.and=function(t){return t},e.prototype.not=function(){return this._value?w.False:w.True},e.prototype.stringValue=function(){return this._value?"true":"false"},e.prototype.booleanValue=function(){return this._value},e.prototype.toAny=function(){return this._value},e.prototype.valueOf=function(){return this._value},e.prototype.writeRecon=function(t){this._value?t.push(116,114,117,101):t.push(102,97,108,115,101)},e.prototype.toRecon=function(){return this._value?"true":"false"},e.prototype.toReconBlock=function(){return this._value?"true":"false"},e.prototype.compare=function(t){return t instanceof e?this._value&&!t._value?-1:!this._value&&t._value?1:0:t instanceof b.Field||t instanceof b.Record||t instanceof b.Data||t instanceof b.Text||t instanceof b.Num?1:-1},e.prototype.equals=function(t){return this===t||t instanceof e&&this._value===t._value},e.prototype.plus=function(t){return(t=b.of(t))instanceof O?this._value?O.valueOf(t._value):O.valueOf("false"):i.prototype.plus.call(this,t)},e.prototype.hashCode=function(){return this._value?1205540039:2682565394},e.prototype.toString=function(){return this.toRecon()},e.valueOf=function(t){return t?e.True:e.False},e.of=function(t){if(t instanceof e)return t;if("boolean"==typeof t)return e.valueOf(t);throw new TypeError(""+t)},e.True=new e(!0),e.False=new e(!1),e}(w);b.Bool=z,b.True=z.True,b.False=z.False,w.True=z.True,w.False=z.False;var U=function(e){function i(){return e.call(this)||this}return v(i,e),i.prototype.isDistinct=function(){return!1},i.prototype.not=function(){return w.Absent},i.prototype.stringValue=function(){return""},i.prototype.booleanValue=function(){return!0},i.prototype.toAny=function(){return null},i.prototype.valueOf=function(){return null},i.prototype.plus=function(t){return(t=b.of(t))instanceof O?O.valueOf(t._value):e.prototype.plus.call(this,t)},i.prototype.writeRecon=function(t){},i.prototype.toRecon=function(){return""},i.prototype.toReconBlock=function(){return""},i.prototype.compare=function(t){return t instanceof i?0:t===w.Absent?-1:1},i.prototype.equals=function(t){return this===t},i.prototype.hashCode=function(){return 4137424647},i.prototype.toString=function(){return"extant"},i}(w);b.Extant=new U,w.Extant=b.Extant;var O=function(r){function a(t,e){var i=r.call(this)||this;return i._value=t,i._flags=e,i}return v(a,r),Object.defineProperty(a.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"size",{get:function(){return this._value.length},enumerable:!0,configurable:!0}),a.prototype.isIdent=function(){var t=new m(this._value);if(t.isEmpty()||!b.Recon.isIdentStartChar(t.head()))return!1;for(t.step();!t.isEmpty()&&b.Recon.isIdentChar(t.head());)t.step();return t.isEmpty()},a.prototype.isDone=function(){return!1},a.prototype.isFull=function(){return!1},a.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0!=(this._flags&a.IMMUTABLE))throw new Error("immutable");for(var i=0,r=t.length;i<r;i+=1){var o=t[i];if("number"==typeof o)if(0<=o&&o<=55295||57344<=o&&o<=65535)this._value+=String.fromCharCode(o);else if(65536<=o&&o<=1114111){var n=o-65536;this._value+=String.fromCharCode(55296|n>>>10,56320|1023&n)}else this._value+=String.fromCharCode(65533);else if("string"==typeof o)for(var s=new m(o);!s.isEmpty();)this.push(s.head()),s.step()}},a.prototype.isMutable=function(){return 0==(this._flags&a.IMMUTABLE)},a.prototype.branch=function(){return this.clone()},a.prototype.clone=function(){return new a(this._value,0)},a.prototype.commit=function(){return this._flags|=a.IMMUTABLE,this},a.prototype.bind=function(){return this},a.prototype.stringValue=function(){return this._value},a.prototype.numberValue=function(){var t=+this._value;if(isFinite(t))return t},a.prototype.toAny=function(){return this._value},a.prototype.valueOf=function(){return this._value},a.prototype.writeRecon=function(t){this.isIdent()?a.writeIdent(this._value,t):a.writeString(this._value,t)},a.writeIdent=function(t,e){for(var i=new m(t);!i.isEmpty();)e.push(i.head()),i.step()},a.writeString=function(t,e){var i=new m(t);for(e.push(34);!i.isEmpty();){var r=i.head();switch(r){case 34:case 92:e.push(92,r);break;case 8:e.push(92,98);break;case 12:e.push(92,102);break;case 10:e.push(92,110);break;case 13:e.push(92,114);break;case 9:e.push(92,116);break;default:e.push(r)}i.step()}e.push(34)},a.writeMarkup=function(t,e){for(var i=new m(t);!i.isEmpty();){var r=i.head();switch(r){case 36:case 64:case 91:case 92:case 93:case 123:case 125:e.push(92,r);break;case 8:e.push(92,98);break;case 12:e.push(92,102);break;case 10:e.push(92,110);break;case 13:e.push(92,114);break;case 9:e.push(92,116);break;default:e.push(r)}i.step()}},a.prototype.compare=function(t){if(t instanceof a){var e=this._value.localeCompare(t._value);return e<0?-1:0<e?1:0}return t instanceof b.Field||t instanceof b.Record||t instanceof b.Data?1:-1},a.prototype.equals=function(t){return this===t||t instanceof a&&this._value===t._value},a.prototype.plus=function(t){return(t=b.of(t))instanceof a?a.valueOf(this._value+t._value):t instanceof b.Num?a.valueOf(this._value+t._value):t instanceof z?t._value?a.valueOf(this._value):a.valueOf("false"):t instanceof U?a.valueOf(this._value):r.prototype.plus.call(this,t)},a.prototype.hashCode=function(){return p.hash(this._value)},a.prototype.toString=function(){return this._value},a.empty=function(){return new a("",0)},a.valueOf=function(t){return 0===t.length?a.Empty:new a(t,a.IMMUTABLE)},a.of=function(t){if(t instanceof a)return t;if("string"==typeof t)return a.valueOf(t);throw new TypeError(""+t)},a.Empty=new a("",a.IMMUTABLE=1),a}(w);b.Text=O;var W=function(i){function r(t){var e=i.call(this)||this;return e._value=t,e}return v(r,i),Object.defineProperty(r.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),r.prototype.bor=function(t){return(t=b.of(t))instanceof b.Num?r.valueOf(this.value|t.value):i.prototype.bor.call(this,t)},r.prototype.bxor=function(t){return(t=b.of(t))instanceof b.Num?r.valueOf(this.value^t.value):i.prototype.bxor.call(this,t)},r.prototype.band=function(t){return(t=b.of(t))instanceof b.Num?r.valueOf(this.value&t.value):i.prototype.band.call(this,t)},r.prototype.plus=function(t){return(t=b.of(t))instanceof b.Num?r.valueOf(this.value+t.value):t instanceof O?O.valueOf(this.value+t.value):i.prototype.plus.call(this,t)},r.prototype.minus=function(t){return(t=b.of(t))instanceof b.Num?r.valueOf(this.value-t.value):i.prototype.minus.call(this,t)},r.prototype.times=function(t){return(t=b.of(t))instanceof b.Num?r.valueOf(this.value*t.value):i.prototype.times.call(this,t)},r.prototype.divide=function(t){return(t=b.of(t))instanceof b.Num?r.valueOf(this.value/t.value):i.prototype.divide.call(this,t)},r.prototype.modulo=function(t){return(t=b.of(t))instanceof b.Num?r.valueOf(this.value%t.value):i.prototype.modulo.call(this,t)},r.prototype.bnot=function(){return r.valueOf(~this.value)},r.prototype.neg=function(){return r.valueOf(-this.value)},r.prototype.pos=function(){return this},r.prototype.inv=function(){return r.valueOf(1/this.value)},r.prototype.stringValue=function(){return""+this._value},r.prototype.numberValue=function(){return this._value},r.prototype.toAny=function(){return this._value},r.prototype.valueOf=function(){return this._value},r.prototype.writeRecon=function(t){var e=this._value;if(isFinite(e)&&e===Math.floor(e)&&-2147483648<=e&&e<=2147483647)return r.writeInteger(e,t);b.Text.writeIdent(String(e),t)},r.writeInteger=function(t,e){if(t<0&&(e.push(45),t=-t),t<10)e.push(48+t);else{for(var i=new Uint8Array(19),r=18;0!==t;)i[r]=t%10,t=Math.floor(t/10),r-=1;for(r+=1;r<19;)e.push(48+i[r]),r+=1}},r.prototype.compare=function(t){if(t instanceof r){var e=this._value,i=t._value;return e<i?-1:i<e?1:0}return t instanceof b.Field||t instanceof b.Record||t instanceof b.Data||t instanceof b.Text?1:-1},r.prototype.equals=function(t){return this===t||t instanceof r&&this._value===t._value},r.prototype.hashCode=function(){return p.mash(p.mix(950747444,p.hash(this._value)))},r.prototype.toString=function(){return this.toRecon()},r.valueOf=function(t){return 0===t?r.Zero:1===t?r.One:new r(t)},r.of=function(t){if(t instanceof r)return t;if("number"==typeof t)return r.valueOf(t);throw new TypeError(""+t)},r.Zero=new r(0),r.One=new r(1),r}(w);b.Num=W;var B=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.cond=function(t,e){return t=b.of(t),e=b.of(e),new b.CondExpr(this,t,e)},e.prototype.or=function(t){return t=b.of(t),new b.LorExpr(this,t)},e.prototype.and=function(t){return t=b.of(t),new b.LandExpr(this,t)},e.prototype.bor=function(t){return t=b.of(t),new b.BorExpr(this,t)},e.prototype.bxor=function(t){return t=b.of(t),new b.BxorExpr(this,t)},e.prototype.band=function(t){return t=b.of(t),new b.BandExpr(this,t)},e.prototype.lt=function(t){return t=b.of(t),new b.LtExpr(this,t)},e.prototype.le=function(t){return t=b.of(t),new b.LeExpr(this,t)},e.prototype.eq=function(t){return t=b.of(t),new b.EqExpr(this,t)},e.prototype.ne=function(t){return t=b.of(t),new b.NeExpr(this,t)},e.prototype.ge=function(t){return t=b.of(t),new b.GeExpr(this,t)},e.prototype.gt=function(t){return t=b.of(t),new b.GtExpr(this,t)},e.prototype.plus=function(t){return t=b.of(t),new b.AddExpr(this,t)},e.prototype.minus=function(t){return t=b.of(t),new b.SubExpr(this,t)},e.prototype.times=function(t){return t=b.of(t),new b.MulExpr(this,t)},e.prototype.divide=function(t){return t=b.of(t),new b.DivExpr(this,t)},e.prototype.modulo=function(t){return t=b.of(t),new b.ModExpr(this,t)},e.prototype.not=function(){return new b.LnotExpr(this)},e.prototype.bnot=function(){return new b.BnotExpr(this)},e.prototype.neg=function(){return new b.NegExpr(this)},e.prototype.pos=function(){return new b.PosExpr(this)},e.prototype.inv=function(){return new b.DivExpr(b.Num.One,this)},e.prototype.toAny=function(){return this},e}(w),q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.evaluate=function(t){t=D.fromAny(t);var i=w.empty();return this.forSelected(t,function(t){var e=t.peek();e&&i.push(e)},this),i.isEmpty()?w.Absent:i.flattened()},e.prototype.update=function(t,e){return t=D.fromAny(t),this.mapSelected(t,function(t){return t.peek()||b.Absent},this)},e.prototype.remove=function(t){return t=D.fromAny(t),this.mapSelected(t,function(t){return b.Absent},this)},e.prototype.get=function(t){return t=w.of(t),this.andThen(new H(t))},e.prototype.getAttr=function(t){return t=b.Text.of(t),this.andThen(new j(t))},e.prototype.getItem=function(t){return t=b.Num.of(t),this.andThen(new K(t))},e.prototype.keys=function(){return this.andThen(e.Keys)},e.prototype.children=function(){return this.andThen(e.Children)},e.prototype.descendants=function(){return this.andThen(e.Descendants)},e.prototype.invoke=function(t){return new b.InvokeExpr(this,t)},e.prototype.filter=function(t){return 0===arguments.length?new Z(this):(t=b.of(t),this.andThen(t.filter()))},Object.defineProperty(e.prototype,"precedence",{get:function(){return 10},enumerable:!0,configurable:!0}),e.prototype.writeRecon=function(t){this.writeThen(t)},e.prototype.compare=function(t){return t instanceof e?0:t instanceof b.Func||t instanceof b.Expr||t===w.Extant||t===w.Absent?-1:1},e.prototype.toString=function(){return this.toRecon()},e.literal=function(t){return(t=b.of(t))instanceof e||(t=new N(t)),t},e.get=function(t){return t=w.of(t),new H(t,!0)},e.getAttr=function(t){return t=b.Text.of(t),new j(t,!0)},e.getItem=function(t){return t=b.Num.of(t),new K(t)},e.Identity=void 0,e.Keys=void 0,e.Children=void 0,e.Descendants=void 0,e}(b.DynamicValue=B),G=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.forSelected=function(t,e,i){var r;if(!t.isEmpty()){var o=t.pop(),n=o.evaluate(t);t.push(n),r=e.call(i,t),t.replace(o)}return r},e.prototype.mapSelected=function(t,e,i){return e.call(i,t)},e.prototype.substitute=function(t){return(t=D.fromAny(t)).item().substitute(t)},e.prototype.get=function(t){return t=w.of(t),this.andThen(new H(t,!0))},e.prototype.getAttr=function(t){return t=b.Text.of(t),this.andThen(new j(t,!0))},e.prototype.andThen=function(t){return t},e.prototype.writeRecon=function(t){},e.prototype.writeThen=function(t){},e.prototype.toRecon=function(){return""},e.prototype.clone=function(){return this},e.prototype.equals=function(t){return t instanceof e},e.prototype.hashCode=function(){return 2996637180},e}(b.Selector=q);q.Identity=new G,b.IdentitySelector=G;var N=function(r){function o(t,e){void 0===e&&(e=q.Identity);var i=r.call(this)||this;return i._item=t.commit(),i.then=e,i}return v(o,r),o.prototype.forSelected=function(t,e,i){var r;if(!t.isEmpty()){var o=this._item.evaluate(t);o.isDefined()&&(t.push(o),r=this.then.forSelected(t,e,i),t.pop())}return r},o.prototype.mapSelected=function(t,e,i){if(!t.isEmpty()){var r=this._item.substitute(t);return r.isDefined()&&(t.push(r),r=this.then.mapSelected(t,e,i),t.pop()),t.item()}return b.Absent},o.prototype.substitute=function(t){t=D.fromAny(t);var e=this._item.substitute(t),i=this.then.substitute(t);return i instanceof q||(i=this.then),new o(e,i)},o.prototype.andThen=function(t){return new o(this._item,this.then.andThen(t))},Object.defineProperty(o.prototype,"precedence",{get:function(){return this._item.precedence},enumerable:!0,configurable:!0}),o.prototype.writeRecon=function(t){this._item.precedence<this.then.precedence?(t.push(40),this._item.writeRecon(t),t.push(41)):this._item.writeRecon(t),this.then.writeThen(t)},o.prototype.writeThen=function(t){},o.prototype.clone=function(){return new o(this._item.clone(),this.then.clone())},o.prototype.equals=function(t){return this===t||t instanceof o&&(this._item.equals(t._item)&&this.then.equals(t.then))},o.prototype.hashCode=function(){return p.mash(p.mix(p.mix(2538907887,this._item.hashCode()),this.then.hashCode()))},o}(q);b.LiteralSelector=N;var H=function(o){function s(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=q.Identity);var r=o.call(this)||this;return r._key=t.commit(),r._top=e,r.then=i,r}return v(s,o),s.prototype.forSelected=function(t,e,i){for(var r=this._key.evaluate(t).toValue(),o=t.size-1;0<=o;o-=1){var n=t.getItem(o).toValue();if(n instanceof b.Record){var s=n.get(r);if(s.isDefined()){t.push(s);var a=this.then.forSelected(t,e,i);return t.pop(),a}}}},s.prototype.mapSelected=function(t,e,i){var r=this._key.substitute(t).toValue();if(!t.isEmpty()){var o=t.item().toValue();if(o instanceof b.Record){var n=o.get(r);t.push(n);var s=this.then.mapSelected(t,e,i);t.pop(),s.isDefined()?o.set(this._key,s.toValue()):o.delete(this._key)}return t.item()}return b.Absent},s.prototype.substitute=function(t){t=D.fromAny(t);for(var e=this._key.evaluate(t).toValue(),i=t.size-1;0<=i;i-=1){var r=t.getItem(i).toValue();if(r instanceof b.Record){var o=r.get(e);if(o.isDefined())return o.substitute(t)}}var n=this.then.substitute(t);return n instanceof q||(n=this.then),new s(this._key,this._top,n)},s.prototype.andThen=function(t){return new s(this._key,this._top,this.then.andThen(t))},s.prototype.writeRecon=function(t){t.push(36),this._key instanceof b.Record?(t.push(123),this._key.writeReconBlock(t),t.push(125)):this._key.writeRecon(t),this.then.writeThen(t)},s.prototype.writeThen=function(t){t.push(46),this._key instanceof b.Record?(t.push(123),this._key.writeReconBlock(t),t.push(125)):this._key.writeRecon(t),this.then.writeThen(t)},s.prototype.clone=function(){return new s(this._key.clone(),this._top,this.then.clone())},s.prototype.equals=function(t){return this===t||t instanceof s&&(this._key.equals(t._key)&&this._top===t._top&&this.then.equals(t.then))},s.prototype.hashCode=function(){return p.mash(p.mix(p.mix(p.mix(3761108264,this._key.hashCode()),this._top?1:0),this.then.hashCode()))},s}(q);b.GetSelector=H;var j=function(o){function r(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=q.Identity);var r=o.call(this)||this;return r._key=t.commit(),r._top=e,r.then=i,r}return v(r,o),r.prototype.forSelected=function(t,e,i){for(var r=t.size-1;0<=r;r-=1){var o=t.getItem(r).toValue();if(o instanceof b.Record){var n=o.getAttr(this._key);if(n.isDefined()){t.push(n);var s=this.then.forSelected(t,e,i);return t.pop(),s}}}},r.prototype.mapSelected=function(t,e,i){if(!t.isEmpty()){var r=t.item().toValue();if(r instanceof b.Record){var o=r.getAttr(this._key);t.push(o);var n=this.then.mapSelected(t,e,i);t.pop(),n.isDefined()?r.setAttr(this._key,n.toValue()):r.delete(this._key)}return t.item()}return b.Absent},r.prototype.substitute=function(t){t=D.fromAny(t);var e=this._key.substitute(t).toValue();e instanceof O||(e=this._key);var i=this.then.substitute(t);return i instanceof q||(i=this.then),new r(e,this._top,i)},r.prototype.andThen=function(t){return new r(this._key,this._top,this.then.andThen(t))},r.prototype.writeRecon=function(t){t.push(36),t.push(64),this._key.writeRecon(t),this.then.writeThen(t)},r.prototype.writeThen=function(t){t.push(46),t.push(64),this._key.writeRecon(t),this.then.writeThen(t)},r.prototype.clone=function(){return new r(this._key.clone(),this._top,this.then.clone())},r.prototype.equals=function(t){return this===t||t instanceof r&&(this._key.equals(t._key)&&this._top===t._top&&this.then.equals(t.then))},r.prototype.hashCode=function(){return p.mash(p.mix(p.mix(p.mix(1576701278,this._key.hashCode()),this._top?1:0),this.then.hashCode()))},r}(q);b.GetAttrSelector=j;var K=function(r){function i(t,e){void 0===e&&(e=q.Identity);var i=r.call(this)||this;return i._index=t,i.then=e,i}return v(i,r),i.prototype.forSelected=function(t,e,i){if(!t.isEmpty()){var r=t.item().toValue(),o=this._index.numberValue();if(r instanceof b.Record&&o<r.length){var n=r.getItem(o);t.push(n);var s=this.then.forSelected(t,e,i);return t.pop(),s}}},i.prototype.mapSelected=function(t,e,i){if(!t.isEmpty()){var r=t.item().toValue(),o=this._index.numberValue();if(r instanceof b.Record&&o<r.length){var n=r.getItem(o);t.push(n);var s=this.then.mapSelected(t,e,i);t.pop(),s.isDefined()?r.setItem(o,s):r.splice(o,1)}return t.item()}return b.Absent},i.prototype.substitute=function(t){t=D.fromAny(t);var e=this.then.substitute(t);return e instanceof q||(e=this.then),new i(this._index,e)},i.prototype.andThen=function(t){return new i(this._index,this.then.andThen(t))},i.prototype.writeRecon=function(t){t.push(36),this.writeThen(t)},i.prototype.writeThen=function(t){t.push(35),this._index.writeRecon(t),this.then.writeThen(t)},i.prototype.clone=function(){return new i(this._index,this.then.clone())},i.prototype.equals=function(t){return this===t||t instanceof i&&(this._index.equals(t._index)&&this.then.equals(t.then))},i.prototype.hashCode=function(){return p.mash(p.mix(p.mix(2148128349,this._index.hashCode()),this.then.hashCode()))},i}(q);b.GetItemSelector=K;var Y=function(i){function r(t){void 0===t&&(t=q.Identity);var e=i.call(this)||this;return e.then=t,e}return v(r,i),r.prototype.forSelected=function(i,r,o){var t;if(!i.isEmpty()){var e=i.pop();e instanceof b.Field?(i.push(e.key),t=this.then.forSelected(i,r,o),i.pop()):e instanceof b.Record&&(t=e.forEach(function(t){var e;return t instanceof b.Field&&(i.push(t.key),e=this.then.forSelected(i,r,o),i.pop()),e},this)),i.push(e)}return t},r.prototype.mapSelected=function(t,e,i){if(!t.isEmpty()){var r=t.pop();if(r instanceof b.Field){var o=r.key;t.push(o);var n=this.then.mapSelected(t,e,i);t.pop(),n.isDefined()&&n instanceof b.Value?n!==o&&(r=r instanceof b.Attr&&n instanceof b.Text?b.Attr.of(n,r.value):b.Slot.of(n,r.value)):r=b.Absent}else if(r instanceof b.Record)for(var s=r.iterator();s.hasNext();){var a=s.next().value;if(a instanceof b.Field){o=a.key;t.push(o);n=this.then.mapSelected(t,e,i);t.pop(),n.isDefined()&&n instanceof b.Value?n!==o&&(a instanceof b.Attr&&n instanceof b.Text?s.set(b.Attr.of(n,a.value)):s.set(b.Slot.of(n,a.value))):s.delete()}}return t.push(r),r}return b.Absent},r.prototype.substitute=function(t){t=D.fromAny(t);var e=this.then.substitute(t);return e instanceof q||(e=this.then),new r(e)},r.prototype.andThen=function(t){return new r(this.then.andThen(t))},r.prototype.writeRecon=function(t){t.push(36),t.push(42),t.push(58),this.then.writeThen(t)},r.prototype.writeThen=function(t){t.push(46),t.push(42),t.push(58),this.then.writeThen(t)},r.prototype.clone=function(){return new r(this.then.clone())},r.prototype.equals=function(t){return this===t||t instanceof r&&this.then.equals(t.then)},r.prototype.hashCode=function(){return p.mash(p.mix(2698220346,this.then.hashCode()))},r}(q);q.Keys=new Y,b.KeysSelector=Y;var X=function(i){function r(t){void 0===t&&(t=q.Identity);var e=i.call(this)||this;return e.then=t,e}return v(r,i),r.prototype.forSelected=function(i,r,o){var t;if(!i.isEmpty()){var e=i.pop();e.toValue()instanceof b.Record&&(t=e.toValue().forEach(function(t){i.push(t);var e=this.then.forSelected(i,r,o);return i.pop(),e},this)),i.push(e)}return t},r.prototype.mapSelected=function(t,e,i){if(!t.isEmpty()){var r=t.pop();if(r.toValue()instanceof b.Record)for(var o=r.toValue().iterator();o.hasNext();){var n=o.next().value;t.push(n);var s=this.then.mapSelected(t,e,i);t.pop(),s.isDefined()?s!==n&&o.set(s):o.delete()}return t.push(r),r}return b.Absent},r.prototype.substitute=function(t){t=D.fromAny(t);var e=this.then.substitute(t);return e instanceof q||(e=this.then),new r(e)},r.prototype.andThen=function(t){return new r(this.then.andThen(t))},r.prototype.writeRecon=function(t){t.push(36),t.push(42),this.then.writeThen(t)},r.prototype.writeThen=function(t){t.push(46),t.push(42),this.then.writeThen(t)},r.prototype.clone=function(){return new r(this.then.clone())},r.prototype.equals=function(t){return this===t||t instanceof r&&this.then.equals(t.then)},r.prototype.hashCode=function(){return p.mash(p.mix(41095964,this.then.hashCode()))},r}(q);q.Children=new X,b.ChildrenSelector=X;var Q=function(i){function r(t){void 0===t&&(t=q.Identity);var e=i.call(this)||this;return e.then=t,e}return v(r,i),r.prototype.forSelected=function(i,r,o){var t;if(!i.isEmpty()){var e=i.pop();e.toValue()instanceof b.Record&&(t=e.toValue().forEach(function(t){i.push(t);var e=this.then.forSelected(i,r,o);return void 0===e&&this.forSelected(i,r,o),i.pop(),e},this)),i.push(e)}return t},r.prototype.mapSelected=function(t,e,i){if(!t.isEmpty()){var r=t.pop();if(r.toValue()instanceof b.Record)for(var o=r.toValue().iterator();o.hasNext();){var n=o.next().value;t.push(n);var s=this.then.mapSelected(t,e,i);s.isDefined()&&(s=this.mapSelected(t,e,i)),t.pop(),s.isDefined()?s!==n&&o.set(s):o.delete()}return t.push(r),r}return b.Absent},r.prototype.substitute=function(t){t=D.fromAny(t);var e=this.then.substitute(t);return e instanceof q||(e=this.then),new r(e)},r.prototype.andThen=function(t){return new r(this.then.andThen(t))},r.prototype.writeRecon=function(t){t.push(36),t.push(42),t.push(42),this.then.writeThen(t)},r.prototype.writeThen=function(t){t.push(46),t.push(42),t.push(42),this.then.writeThen(t)},r.prototype.clone=function(){return new r(this.then.clone())},r.prototype.equals=function(t){return this===t||t instanceof r&&this.then.equals(t.then)},r.prototype.hashCode=function(){return p.mash(p.mix(693096588,this.then.hashCode()))},r}(q);q.Descendants=new Q,b.DescendantsSelector=Q;var Z=function(r){function o(t,e){void 0===e&&(e=q.Identity);var i=r.call(this)||this;return i.predicate=t,i.then=e,i}return v(o,r),o.prototype.forSelected=function(t,e,i){var r;return t.isEmpty()||this.filterSelected(t)&&(r=this.then.forSelected(t,e,i)),r},o.prototype.mapSelected=function(t,e,i){return t.isEmpty()?b.Absent:this.filterSelected(t)?this.then.mapSelected(t,e,i):t.item()},o.prototype.filterSelected=function(t){return void 0!==this.predicate.forSelected(t,this.selected,this)},o.prototype.selected=function(t){return null},o.prototype.filter=function(t){return 0===arguments.length?this:(t=b.of(t),this.andThen(t.filter()))},o.prototype.substitute=function(t){t=D.fromAny(t);var e=this.predicate.substitute(t);e instanceof q||(e=this.predicate);var i=this.then.substitute(t);return i instanceof q||(i=this.then),new o(e,i)},o.prototype.andThen=function(t){return new o(this.predicate,this.then.andThen(t))},o.prototype.writeRecon=function(t){t.push(36),this.writeThen(t)},o.prototype.writeThen=function(t){t.push(91),this.predicate.writeRecon(t),t.push(93),this.then.writeThen(t)},o.prototype.clone=function(){return new o(this.predicate.clone(),this.then.clone())},o.prototype.equals=function(t){return this===t||t instanceof o&&(this.predicate.equals(t.predicate)&&this.then.equals(t.then))},o.prototype.hashCode=function(){return p.mash(p.mix(p.mix(982049112,this.predicate.hashCode()),this.then.hashCode()))},o}(q);b.FilterSelector=Z;var J=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return v(i,t),i.prototype.partialInvoke=function(t,e,i){},i.prototype.toAny=function(){return this},i.prototype.writeRecon=function(t){},i.prototype.toRecon=function(){return""},i.prototype.toReconBlock=function(){return""},i.prototype.compare=function(t){if(t instanceof i){var e=this.name.localeCompare(t.name);return e<0?-1:0<e?1:0}return t instanceof b.Expr||t===w.Extant||t===w.Absent?-1:1},i.prototype.equals=function(t){return t instanceof i&&this.name===t.name},i.prototype.hashCode=function(){return p.mash(p.mix(3046025140,p.hash(this.name)))},i.prototype.toString=function(){return"[Func "+this.name+"]"},i.Eager=void 0,i.Abs=void 0,i.Ceil=void 0,i.Floor=void 0,i.Round=void 0,i.Pow=void 0,i.Sqrt=void 0,i.Max=void 0,i.Min=void 0,i.Count=void 0,i.Random=void 0,i.Rate=void 0,i.Percent=void 0,i.Number=void 0,i.String=void 0,i.ConsoleLog=void 0,i.NumberFormat=void 0,i}(w),$=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"eager"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){return t.evaluate(e)},e.prototype.partialInvoke=function(t,e,i){return t.evaluate(e)},e}(b.Func=J);J.Eager=new $;var tt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"abs"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){var i=(t=t.evaluate(e).toValue()).numberValue();return void 0!==i?b.Num.valueOf(Math.abs(i)):w.Absent},e}(J);J.Abs=new tt;var et=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"ceil"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){var i=(t=t.evaluate(e).toValue()).numberValue();return void 0!==i?b.Num.valueOf(Math.ceil(i)):w.Absent},e}(J);J.Ceil=new et;var it=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"floor"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){var i=(t=t.evaluate(e).toValue()).numberValue();return void 0!==i?b.Num.valueOf(Math.floor(i)):w.Absent},e}(J);J.Floor=new it;var rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"round"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){var i=(t=t.evaluate(e).toValue()).numberValue();return void 0!==i?b.Num.valueOf(Math.round(i)):w.Absent},e}(J);J.Round=new rt;var ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"pow"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e,i){var r=t.getItem(0).evaluate(e).numberValue(),o=t.getItem(1).evaluate(e).numberValue();return void 0!==r&&void 0!==o?b.Num.valueOf(Math.pow(r,o)):w.Absent},e}(J);J.Pow=new ot;var nt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"sqrt"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){var i=(t=t.evaluate(e).toValue()).numberValue();return void 0!==i?b.Num.valueOf(Math.sqrt(i)):w.Absent},e}(J);J.Sqrt=new nt;var st=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"max"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e,i){var r,o;return 2<=t.length?(r=t.getItem(0).evaluate(e).numberValue(),o=t.getItem(1).evaluate(e).numberValue()):r=t.evaluate(e).numberValue(),void 0!==r&&isFinite(r)&&(i.state=i.state||{},void 0===o&&(o=Math.max(r,i.state.nax||r),i.state.nax=o),void 0!==o&&isFinite(o))?b.Num.valueOf(Math.max(r,o)):w.Absent},e.prototype.partialInvoke=function(t,e,i){if(1===t.length)return t=t.evaluate(e).toValue(),this.invoke(t,e,i)},e}(J);J.Max=new st;var at=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"min"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e,i){var r,o;return 2<=t.length?(r=t.getItem(0).evaluate(e).numberValue(),o=t.getItem(1).evaluate(e).numberValue()):r=t.evaluate(e).numberValue(),void 0!==r&&isFinite(r)&&(i.state=i.state||{},void 0===o&&(o=Math.min(r,i.state.min||r),i.state.min=o),void 0!==o&&isFinite(o))?b.Num.valueOf(Math.min(r,o)):w.Absent},e.prototype.partialInvoke=function(t,e,i){if(1===t.length)return t=t.evaluate(e).toValue(),this.invoke(t,e,i)},e}(J);J.Min=new at;var ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"count"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e,i){if(t instanceof q){var r=0;return t.forSelected(e,function(t){r+=1},this),b.Num.valueOf(r)}return t instanceof F?b.Num.valueOf(t.length):w.Absent},e}(J);J.Count=new ut;var ht=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"percent"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e,i){var r,o;return 2<=t.length?(r=t.getItem(0).evaluate(e).numberValue(),o=t.getItem(1).evaluate(e).numberValue()):r=t.evaluate(e).numberValue(),void 0!==r&&isFinite(r)&&(i.state=i.state||{},void 0===o&&(o=Math.max(r,i.state.total||r),i.state.total=o),0!==o&&isFinite(o))?b.Text.valueOf(Math.round(100*r/o)+"%"):w.Absent},e.prototype.partialInvoke=function(t,e,i){if(1===t.length)return t=t.evaluate(e).toValue(),this.invoke(t,e,i)},e}(J);J.Percent=new ht;var lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"random"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){var i=1<=t.length?t.getItem(0).evaluate(e).numberValue(0):0,r=2<=t.length?t.getItem(1).evaluate(e).numberValue(i+1):i+1,o=i+Math.random()*(r-i);return b.Num.valueOf(o)},e}(J);J.Random=new lt;var pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"rate"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e,i){var r,o;if(2<=t.length?(r=t.getItem(0).evaluate(e).numberValue(),o=t.getItem(1).evaluate(e).numberValue()):r=t.evaluate(e).numberValue(),void 0!==r&&isFinite(r))if(i.state=i.state||{},void 0===o&&(o=1e3),void 0===i.state.t0)i.state.t0=Date.now(),i.state.v0=r;else{var n=Date.now(),s=n-i.state.t0;if(o<s&&n>i.state.t0||2*o<s){var a=r-i.state.v0;i.state.t0=n,i.state.v0=r,i.state.dt=s,i.state.dv=a}if(void 0!==i.state.dt){var u=o*i.state.dv/(i.state.dt||1);return b.Num.valueOf(u)}}return w.Absent},e.prototype.partialInvoke=function(t,e,i){return t=t.evaluate(e).toValue(),this.invoke(t,e,i)},e}(J);J.Rate=new pt;var ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"number"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){if((t=t.evaluate(e).toValue())instanceof b.Num)return t;var i=t.numberValue();return void 0!==i?b.Num.valueOf(i):w.Absent},e}(J);J.Number=new ct;var dt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"string"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){if((t=t.evaluate(e).toValue())instanceof b.Text)return t;var i=t.stringValue();return void 0!==i?b.Text.valueOf(i):w.Absent},e}(J);J.String=new dt;var ft=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"console.log"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){return t=t.evaluate(e).toValue(),console.log(t.toAny()),b.Absent},e}(J);J.ConsoleLog=new ft;var yt=function(t){function e(){return t.call(this)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"numberFormat"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){var i,r;if(2<=t.length?(i=t.getItem(0).evaluate(e).numberValue(),r=t.getItem(1).evaluate(e).toValue().toAny()):i=t.evaluate(e).numberValue(),void 0===i)return w.Absent;switch(r.type){case"any":return this.anyFormat(i,r);case"prefix":return this.prefixFormat(i,r);case"digits":return this.digitsFormat(i,r);default:return this.numberCommas(i,r)}},e.prototype.fixValue=function(t,e){if(!e||e&&!e.decimal)return t;var i=Math.pow(10,e.decimal);return(e.precision?Math.round(t*i)/i:+t).toFixed(e.decimal)},e.prototype.numberCommas=function(t,e){var i=this.fixValue(t,e).toString().split(".");return i[0]=i[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),b.Text.valueOf(i.join("."))},e.prototype.anyFormat=function(t,e){var i=this.fixValue(t,e);return"string"==typeof i?b.Text.valueOf(i):b.Num.valueOf(i)},e.prototype.prefixFormat=function(t,e){var i=e&&e.decimal?e.decimal:0,r=t.toExponential(i+1).split(/e/),o=+r[0],n=+r[1],s=Math.floor(n/3),a=+(o*Math.pow(10,n-3*s)).toFixed(i);return b.Text.valueOf(a+["p","n","u","m","","k","M","G","T"][s+4])},e.prototype.digitsFormat=function(t,e){for(var i=e&&e.digits?e.digits:1,r=""+Math.round(t);r.length<i;)r="0"+r;return b.Text.valueOf(r)},e}(J);J.NumberFormat=new yt,b.GlobalScope=w.empty().slot("eager",J.Eager).slot("abs",J.Abs).slot("ceil",J.Ceil).slot("floor",J.Floor).slot("round",J.Round).slot("pow",J.Pow).slot("sqrt",J.Sqrt).slot("max",J.Max).slot("min",J.Min).slot("count",J.Count).slot("random",J.Random).slot("rate",J.Rate).slot("percent",J.Percent).slot("number",J.Number).slot("string",J.String).slot("console",w.empty().slot("log",J.ConsoleLog)).slot("log",J.ConsoleLog).slot("numberFormat",J.NumberFormat).commit(),D.GlobalScope=b.GlobalScope;var mt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.compare=function(t){return t instanceof e?0:t===w.Extant||t===w.Absent?-1:1},e.prototype.toString=function(){return this.toRecon()},e}(B),vt=function(r){function t(t,e){var i=r.call(this)||this;return i.lhs=t.commit(),i.rhs=e.commit(),i}return v(t,r),t.prototype.writeRecon=function(t){this.lhs.precedence<this.precedence?(t.push(40),this.lhs.writeRecon(t),t.push(41)):this.lhs.writeRecon(t),t.push(32),b.Text.writeIdent(this.operator,t),t.push(32),this.rhs.precedence<this.precedence?(t.push(40),this.rhs.writeRecon(t),t.push(41)):this.rhs.writeRecon(t)},t}(b.Expr=mt),gt=function(i){function t(t){var e=i.call(this)||this;return e.rhs=t.commit(),e}return v(t,i),t.prototype.writeRecon=function(t){b.Text.writeIdent(this.operator,t),this.rhs.precedence<this.precedence?(t.push(40),this.rhs.writeRecon(t),t.push(41)):this.rhs.writeRecon(t)},t}(mt),bt=function(o){function e(t,e,i){var r=o.call(this)||this;return r.predExpr=t.commit(),r.thenExpr=e.commit(),r.elseExpr=i.commit(),r}return v(e,o),Object.defineProperty(e.prototype,"precedence",{get:function(){return 1},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){return t=D.fromAny(t),this.predExpr.evaluate(t).isDefined()?this.thenExpr.evaluate(t):this.elseExpr.evaluate(t)},e.prototype.substitute=function(t){return t=D.fromAny(t),new e(this.predExpr.substitute(t).toValue(),this.thenExpr.substitute(t).toValue(),this.elseExpr.substitute(t).toValue())},e.prototype.writeRecon=function(t){this.predExpr instanceof e?(t.push(40),this.predExpr.writeRecon(t),t.push(41)):this.predExpr.writeRecon(t),t.push(32),t.push(63),t.push(32),this.thenExpr.writeRecon(t),t.push(32),t.push(58),t.push(32),this.elseExpr.writeRecon(t)},e.prototype.clone=function(){return new e(this.predExpr.clone(),this.thenExpr.clone(),this.elseExpr.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.predExpr.equals(t.predExpr)&&this.thenExpr.equals(t.thenExpr)&&this.elseExpr.equals(t.elseExpr))},e.prototype.hashCode=function(){return p.mash(p.mix(p.mix(p.mix(2686268657,this.predExpr.hashCode()),this.thenExpr.hashCode()),this.elseExpr.hashCode()))},e}(mt);b.CondExpr=bt;var wt=function(i){function e(t,e){return i.call(this,t,e)||this}return v(e,i),Object.defineProperty(e.prototype,"operator",{get:function(){return"||"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 2},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=D.fromAny(t);var e=this.lhs.evaluate(t);return e.isDefined()?e:this.rhs.evaluate(t)},e.prototype.substitute=function(t){t=D.fromAny(t);var e=this.lhs.substitute(t),i=this.rhs.substitute(t);return e.or(i)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return p.mash(p.mix(p.mix(2753931048,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);b.LorExpr=wt;var _t=function(i){function e(t,e){return i.call(this,t,e)||this}return v(e,i),Object.defineProperty(e.prototype,"operator",{get:function(){return"&&"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 3},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=D.fromAny(t);var e=this.lhs.evaluate(t);return e.isDefined()?this.rhs.evaluate(t):e},e.prototype.substitute=function(t){t=D.fromAny(t);var e=this.lhs.substitute(t),i=this.rhs.substitute(t);return e.and(i)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return p.mash(p.mix(p.mix(3033319353,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);b.LandExpr=_t;var xt=function(i){function e(t,e){return i.call(this,t,e)||this}return v(e,i),Object.defineProperty(e.prototype,"operator",{get:function(){return"|"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 4},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=D.fromAny(t);var e=this.lhs.evaluate(t),i=this.rhs.evaluate(t);return e.bor(i)},e.prototype.substitute=function(t){t=D.fromAny(t);var e=this.lhs.substitute(t),i=this.rhs.substitute(t);return e.bor(i)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return p.mash(p.mix(p.mix(2951299239,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);b.BorExpr=xt;var kt=function(i){function e(t,e){return i.call(this,t,e)||this}return v(e,i),Object.defineProperty(e.prototype,"operator",{get:function(){return"^"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 5},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=D.fromAny(t);var e=this.lhs.evaluate(t),i=this.rhs.evaluate(t);return e.bxor(i)},e.prototype.substitute=function(t){t=D.fromAny(t);var e=this.lhs.substitute(t),i=this.rhs.substitute(t);return e.bxor(i)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return p.mash(p.mix(p.mix(2525026627,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);b.BxorExpr=kt;var At=function(i){function e(t,e){return i.call(this,t,e)||this}return v(e,i),Object.defineProperty(e.prototype,"operator",{get:function(){return"&"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 6},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=D.fromAny(t);var e=this.lhs.evaluate(t),i=this.rhs.evaluate(t);return e.band(i)},e.prototype.substitute=function(t){t=D.fromAny(t);var e=this.lhs.substitute(t),i=this.rhs.substitute(t);return e.band(i)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return p.mash(p.mix(p.mix(1749678032,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);b.BandExpr=At;var Et=function(i){function e(t,e){return i.call(this,t,e)||this}return v(e,i),Object.defineProperty(e.prototype,"operator",{get:function(){return"<"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=D.fromAny(t);var e=this.lhs.evaluate(t),i=this.rhs.evaluate(t);return e.lt(i)},e.prototype.substitute=function(t){t=D.fromAny(t);var e=this.lhs.substitute(t),i=this.rhs.substitute(t);return e.lt(i)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return p.mash(p.mix(p.mix(967086719,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);b.LtExpr=Et;var Ct=function(i){function e(t,e){return i.call(this,t,e)||this}return v(e,i),Object.defineProperty(e.prototype,"operator",{get:function(){return"<="},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=D.fromAny(t);var e=this.lhs.evaluate(t),i=this.rhs.evaluate(t);return e.le(i)},e.prototype.substitute=function(t){t=D.fromAny(t);var e=this.lhs.substitute(t),i=this.rhs.substitute(t);return e.le(i)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return p.mash(p.mix(p.mix(1658676620,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);b.LeExpr=Ct;var St=function(i){function e(t,e){return i.call(this,t,e)||this}return v(e,i),Object.defineProperty(e.prototype,"operator",{get:function(){return"=="},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=D.fromAny(t);var e=this.lhs.evaluate(t),i=this.rhs.evaluate(t);return e.eq(i)},e.prototype.substitute=function(t){t=D.fromAny(t);var e=this.lhs.substitute(t),i=this.rhs.substitute(t);return e.eq(i)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return p.mash(p.mix(p.mix(151025720,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);b.EqExpr=St;var Vt=function(i){function e(t,e){return i.call(this,t,e)||this}return v(e,i),Object.defineProperty(e.prototype,"operator",{get:function(){return"!="},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=D.fromAny(t);var e=this.lhs.evaluate(t),i=this.rhs.evaluate(t);return e.ne(i)},e.prototype.substitute=function(t){t=D.fromAny(t);var e=this.lhs.substitute(t),i=this.rhs.substitute(t);return e.ne(i)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return p.mash(p.mix(p.mix(3400743354,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);b.NeExpr=Vt;var Dt=function(i){function e(t,e){return i.call(this,t,e)||this}return v(e,i),Object.defineProperty(e.prototype,"operator",{get:function(){return">="},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=D.fromAny(t);var e=this.lhs.evaluate(t),i=this.rhs.evaluate(t);return e.ge(i)},e.prototype.substitute=function(t){t=D.fromAny(t);var e=this.lhs.substitute(t),i=this.rhs.substitute(t);return e.ge(i)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return p.mash(p.mix(p.mix(553703941,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);b.GeExpr=Dt;var Mt=function(i){function e(t,e){return i.call(this,t,e)||this}return v(e,i),Object.defineProperty(e.prototype,"operator",{get:function(){return">"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=D.fromAny(t);var e=this.lhs.evaluate(t),i=this.rhs.evaluate(t);return e.gt(i)},e.prototype.substitute=function(t){t=D.fromAny(t);var e=this.lhs.substitute(t),i=this.rhs.substitute(t);return e.gt(i)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return p.mash(p.mix(p.mix(2388803765,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);b.GtExpr=Mt;var Pt=function(i){function e(t,e){return i.call(this,t,e)||this}return v(e,i),Object.defineProperty(e.prototype,"operator",{get:function(){return"+"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 7},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=D.fromAny(t);var e=this.lhs.evaluate(t),i=this.rhs.evaluate(t);return e.plus(i)},e.prototype.substitute=function(t){t=D.fromAny(t);var e=this.lhs.substitute(t),i=this.rhs.substitute(t);return e.plus(i)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return p.mash(p.mix(p.mix(3143282824,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);b.AddExpr=Pt;var Rt=function(i){function e(t,e){return i.call(this,t,e)||this}return v(e,i),Object.defineProperty(e.prototype,"operator",{get:function(){return"-"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 7},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=D.fromAny(t);var e=this.lhs.evaluate(t),i=this.rhs.evaluate(t);return e.minus(i)},e.prototype.substitute=function(t){t=D.fromAny(t);var e=this.lhs.substitute(t),i=this.rhs.substitute(t);return e.minus(i)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return p.mash(p.mix(p.mix(2002724678,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);b.SubExpr=Rt;var Tt=function(i){function e(t,e){return i.call(this,t,e)||this}return v(e,i),Object.defineProperty(e.prototype,"operator",{get:function(){return"*"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 8},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=D.fromAny(t);var e=this.lhs.evaluate(t),i=this.rhs.evaluate(t);return e.times(i)},e.prototype.substitute=function(t){t=D.fromAny(t);var e=this.lhs.substitute(t),i=this.rhs.substitute(t);return e.times(i)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return p.mash(p.mix(p.mix(3516846473,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);b.MulExpr=Tt;var Lt=function(i){function e(t,e){return i.call(this,t,e)||this}return v(e,i),Object.defineProperty(e.prototype,"operator",{get:function(){return"/"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 8},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=D.fromAny(t);var e=this.lhs.evaluate(t),i=this.rhs.evaluate(t);return e.divide(i)},e.prototype.substitute=function(t){t=D.fromAny(t);var e=this.lhs.substitute(t),i=this.rhs.substitute(t);return e.divide(i)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return p.mash(p.mix(p.mix(588817478,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);b.DivExpr=Lt;var Ft=function(i){function e(t,e){return i.call(this,t,e)||this}return v(e,i),Object.defineProperty(e.prototype,"operator",{get:function(){return"%"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"precedence",{get:function(){return 8},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t){t=D.fromAny(t);var e=this.lhs.evaluate(t),i=this.rhs.evaluate(t);return e.modulo(i)},e.prototype.substitute=function(t){t=D.fromAny(t);var e=this.lhs.substitute(t),i=this.rhs.substitute(t);return e.modulo(i)},e.prototype.clone=function(){return new e(this.lhs.clone(),this.rhs.clone())},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhs.equals(t.lhs)&&this.rhs.equals(t.rhs))},e.prototype.hashCode=function(){return p.mash(p.mix(p.mix(1939882810,this.lhs.hashCode()),this.rhs.hashCode()))},e}(vt);b.ModExpr=Ft;var It=function(e){function i(t){return e.call(this,t)||this}return v(i,e),Object.defineProperty(i.prototype,"operator",{get:function(){return"!"},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"precedence",{get:function(){return 9},enumerable:!0,configurable:!0}),i.prototype.evaluate=function(t){return t=D.fromAny(t),this.rhs.evaluate(t).not()},i.prototype.substitute=function(t){return t=D.fromAny(t),this.rhs.substitute(t).not()},i.prototype.clone=function(){return new i(this.rhs.clone())},i.prototype.equals=function(t){return this===t||t instanceof i&&this.rhs.equals(t.rhs)},i.prototype.hashCode=function(){return p.mash(p.mix(1585838768,this.rhs.hashCode()))},i}(gt);b.LnotExpr=It;var zt=function(e){function i(t){return e.call(this,t)||this}return v(i,e),Object.defineProperty(i.prototype,"operator",{get:function(){return"~"},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"precedence",{get:function(){return 9},enumerable:!0,configurable:!0}),i.prototype.evaluate=function(t){return t=D.fromAny(t),this.rhs.evaluate(t).bnot()},i.prototype.substitute=function(t){return t=D.fromAny(t),this.rhs.substitute(t).bnot()},i.prototype.clone=function(){return new i(this.rhs.clone())},i.prototype.equals=function(t){return this===t||t instanceof i&&this.rhs.equals(t.rhs)},i.prototype.hashCode=function(){return p.mash(p.mix(636533736,this.rhs.hashCode()))},i}(gt);b.BnotExpr=zt;var Ut=function(e){function i(t){return e.call(this,t)||this}return v(i,e),Object.defineProperty(i.prototype,"operator",{get:function(){return"-"},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"precedence",{get:function(){return 9},enumerable:!0,configurable:!0}),i.prototype.evaluate=function(t){return t=D.fromAny(t),this.rhs.evaluate(t).neg()},i.prototype.substitute=function(t){return t=D.fromAny(t),this.rhs.substitute(t).neg()},i.prototype.clone=function(){return new i(this.rhs.clone())},i.prototype.equals=function(t){return this===t||t instanceof i&&this.rhs.equals(t.rhs)},i.prototype.hashCode=function(){return p.mash(p.mix(542257997,this.rhs.hashCode()))},i}(gt);b.NegExpr=Ut;var Ot=function(e){function i(t){return e.call(this,t)||this}return v(i,e),Object.defineProperty(i.prototype,"operator",{get:function(){return"+"},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"precedence",{get:function(){return 9},enumerable:!0,configurable:!0}),i.prototype.evaluate=function(t){return t=D.fromAny(t),this.rhs.evaluate(t).pos()},i.prototype.substitute=function(t){return t=D.fromAny(t),this.rhs.substitute(t).pos()},i.prototype.clone=function(){return new i(this.rhs.clone())},i.prototype.equals=function(t){return this===t||t instanceof i&&this.rhs.equals(t.rhs)},i.prototype.hashCode=function(){return p.mash(p.mix(3300928030,this.rhs.hashCode()))},i}(gt);b.PosExpr=Ot;var Wt=function(r){function o(t,e){var i=r.call(this)||this;return i.func=t,i.args=e.commit(),i}return v(o,r),Object.defineProperty(o.prototype,"precedence",{get:function(){return 10},enumerable:!0,configurable:!0}),o.prototype.evaluate=function(t){t=D.fromAny(t);var e=this.func.evaluate(t);return e instanceof b.Func?e.invoke(this.args,t,this):w.Absent},o.prototype.substitute=function(t){t=D.fromAny(t);var e=this.func.evaluate(t);if(e instanceof b.Func){var i=e.partialInvoke(this.args,t,this);if(i)return i}var r=this.args.substitute(t).toValue();return new o(this.func,r)},o.prototype.writeRecon=function(t){this.func.writeRecon(t),t.push(40),this.args.writeReconBlock(t),t.push(41)},o.prototype.clone=function(){return new o(this.func.clone(),this.args.clone())},o.prototype.equals=function(t){return this===t||t instanceof o&&(this.func.equals(t.func)&&this.args.equals(t.args))},o.prototype.hashCode=function(){return p.mash(p.mix(p.mix(2719252876,this.func.hashCode()),this.args.hashCode()))},o}(mt);b.InvokeExpr=Wt;var Bt=function(t){function e(){return t.call(this)||this}return v(e,t),e.prototype.isDefined=function(){return!1},e.prototype.isDistinct=function(){return!1},e.prototype.isEmpty=function(){return!0},e.prototype.concat=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=w.empty(),r=0,o=t.length;r<o;r+=1)t[r].forEach(function(t){i.push(t)});return i},e.prototype.withField=function(t,e){return w.empty(1).withField(t,e)},e.prototype.withAttr=function(t,e){return w.empty(1).withAttr(t,e)},e.prototype.withSlot=function(t,e){return w.empty(1).withSlot(t,e)},e.prototype.withItem=function(t){return w.empty(1).withItem(t)},e.prototype.forEach=function(t,e){},e.prototype.iterator=function(){return s.Empty},e.prototype.cond=function(t,e){return e=b.of(e)},e.prototype.or=function(t){return t=b.of(t)},e.prototype.and=function(t){return this},e.prototype.not=function(){return w.Extant},e.prototype.booleanValue=function(){return!1},e.prototype.toAny=function(){},e.prototype.valueOf=function(){},e.prototype.writeRecon=function(t){},e.prototype.toRecon=function(){return""},e.prototype.toReconBlock=function(){return""},e.prototype.compare=function(t){return t instanceof e?0:1},e.prototype.equals=function(t){return this===t},e.prototype.hashCode=function(){return 4156558542},e.prototype.toString=function(){return"absent"},e}(w);b.Absent=new Bt,w.Absent=b.Absent;var qt=function(){function t(t){this.buckets=new Array(t),this.gen4Hits=0,this.gen3Hits=0,this.gen2Hits=0,this.gen1Hits=0,this.misses=0}return t.prototype.get=function(t){if(0!==this.buckets.length){var e=Math.abs(t.hashCode())%this.buckets.length,i=this.buckets[e];if(i){var r=i.gen4Key;if(void 0!==r&&t.equals(r)){var o=i.gen4Val;if(void 0!==o)return this.gen4Hits+=1,i.gen4Weight++,o;i.gen4Key=void 0}var n=i.gen3Key;if(void 0!==n&&t.equals(n)){var s=i.gen3Val;if(void 0!==s)return this.gen3Hits+=1,i.gen3Weight++>i.gen4Weight&&(this.buckets[e]=new Gt(i.gen3Key,i.gen3Val,i.gen3Weight,i.gen4Key,i.gen4Val,i.gen4Weight,i.gen2Key,i.gen2Val,i.gen2Weight,i.gen1Key,i.gen1Val,i.gen1Weight)),s;i.gen3Key=void 0}var a=i.gen2Key;if(void 0!==a&&t.equals(a)){var u=i.gen2Val;if(void 0!==u)return this.gen2Hits+=1,i.gen2Weight++>i.gen3Weight&&(this.buckets[e]=new Gt(i.gen4Key,i.gen4Val,i.gen4Weight,i.gen2Key,i.gen2Val,i.gen2Weight,i.gen3Key,i.gen3Val,i.gen3Weight,i.gen1Key,i.gen1Val,i.gen1Weight)),u;i.gen2Key=void 0}var h=i.gen1Key;if(void 0!==h&&t.equals(h)){var l=i.gen1Val;if(void 0!==l)return this.gen1Hits+=1,i.gen1Weight++>i.gen2Weight&&(this.buckets[e]=new Gt(i.gen4Key,i.gen4Val,i.gen4Weight,i.gen3Key,i.gen3Val,i.gen3Weight,i.gen1Key,i.gen1Val,i.gen1Weight,i.gen2Key,i.gen2Val,i.gen2Weight)),l;i.gen1Key=void 0}this.misses+=1}}},t.prototype.set=function(t,e){if(0!==this.buckets.length){var i=Math.abs(t.hashCode())%this.buckets.length,r=this.buckets[i]||new Gt,o=r.gen4Key;if(void 0!==o&&t.equals(o)){var n=r.gen4Val;if(void 0!==n)return this.gen4Hits+=1,r.gen4Weight++,n;o=r.gen4Key=void 0}var s=r.gen3Key;if(void 0!==s&&t.equals(s)){var a=r.gen3Val;if(void 0!==a)return this.gen3Hits+=1,r.gen3Weight++>r.gen4Weight&&(this.buckets[i]=new Gt(r.gen3Key,r.gen3Val,r.gen3Weight,r.gen4Key,r.gen4Val,r.gen4Weight,r.gen2Key,r.gen2Val,r.gen2Weight,r.gen1Key,r.gen1Val,r.gen1Weight)),a;s=r.gen3Key=void 0}var u=r.gen2Key;if(void 0!==u&&t.equals(u)){var h=r.gen2Val;if(void 0!==h)return this.gen2Hits+=1,r.gen2Weight++>r.gen3Weight&&(this.buckets[i]=new Gt(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen2Key,r.gen2Val,r.gen2Weight,r.gen3Key,r.gen3Val,r.gen3Weight,r.gen1Key,r.gen1Val,r.gen1Weight)),h;u=r.gen2Key=void 0}var l=r.gen1Key;if(void 0!==l&&t.equals(l)){var p=r.gen1Val;if(void 0!==p)return this.gen1Hits+=1,r.gen1Weight++>r.gen2Weight&&(this.buckets[i]=new Gt(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen3Key,r.gen3Val,r.gen3Weight,r.gen1Key,r.gen1Val,r.gen1Weight,r.gen2Key,r.gen2Val,r.gen2Weight)),p;l=r.gen1Key=void 0}this.misses+=1,this.buckets[i]=null==o?new Gt(r.gen3Key,r.gen3Val,r.gen3Weight,r.gen2Key,r.gen2Val,r.gen2Weight,r.gen1Key,r.gen1Val,r.gen1Weight,t,e,1):null==s?new Gt(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen2Key,r.gen2Val,r.gen2Weight,r.gen1Key,r.gen1Val,r.gen1Weight,t,e,1):null==u?new Gt(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen3Key,r.gen3Val,r.gen3Weight,r.gen1Key,r.gen1Val,r.gen1Weight,t,e,1):null==l?new Gt(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen3Key,r.gen3Val,r.gen3Weight,r.gen2Key,r.gen2Val,r.gen2Weight,t,e,1):new Gt(r.gen4Key,r.gen4Val,r.gen4Weight-1,r.gen3Key,r.gen3Val,r.gen3Weight-1,r.gen1Key,r.gen1Val,r.gen1Weight,t,e,1)}},t.prototype.delete=function(t){if(0!==this.buckets.length){var e=Math.abs(t.hashCode())%this.buckets.length,i=this.buckets[e];if(i){var r=i.gen4Key;if(void 0!==r&&t.equals(r)){var o=i.gen4Val;return this.buckets[e]=new Gt(i.gen3Key,i.gen3Val,i.gen3Weight,i.gen2Key,i.gen2Val,i.gen2Weight,i.gen1Key,i.gen1Val,i.gen1Weight,void 0,void 0,0),o}var n=i.gen3Key;if(void 0!==n&&t.equals(n)){var s=i.gen3Val;return this.buckets[e]=new Gt(i.gen4Key,i.gen4Val,i.gen4Weight,i.gen2Key,i.gen2Val,i.gen2Weight,i.gen1Key,i.gen1Val,i.gen1Weight,void 0,void 0,0),s}var a=i.gen2Key;if(void 0!==a&&t.equals(a)){var u=i.gen2Val;return this.buckets[e]=new Gt(i.gen4Key,i.gen4Val,i.gen4Weight,i.gen3Key,i.gen3Val,i.gen3Weight,i.gen1Key,i.gen1Val,i.gen1Weight,void 0,void 0,0),u}var h=i.gen1Key;if(void 0!==h&&t.equals(h)){var l=i.gen1Val;return this.buckets[e]=new Gt(i.gen4Key,i.gen4Val,i.gen4Weight,i.gen3Key,i.gen3Val,i.gen3Weight,i.gen2Key,i.gen2Val,i.gen2Weight,void 0,void 0,0),l}}}},t.prototype.clear=function(){for(var t=0;t<this.buckets.length;t+=1)this.buckets[t]=void 0},Object.defineProperty(t.prototype,"hits",{get:function(){return this.gen4Hits+this.gen3Hits+this.gen2Hits+this.gen1Hits},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hitRatio",{get:function(){var t=this.hits;return t/(t+this.misses)},enumerable:!0,configurable:!0}),t.prototype.toString=function(){for(var t=this.hits,e="@cache(gen4Hits: "+this.gen4Hits+", gen3Hits: "+this.gen3Hits+", gen2Hits: "+this.gen2Hits+", gen1Hits: "+this.gen1Hits+", hits: "+t+", misses: "+this.misses+", hitRatio: "+t/(t+this.misses)+") {\n",i=0;i<this.buckets.length;i+=1){var r=this.buckets[i];e+="  "+(null!=r?r.toString():"null")+"\n"}return e+="}"},t}(),Gt=function(){function t(t,e,i,r,o,n,s,a,u,h,l,p){void 0===i&&(i=0),void 0===n&&(n=0),void 0===u&&(u=0),void 0===p&&(p=0),this.gen4Key=t,this.gen4Val=e,this.gen4Weight=i,this.gen3Key=r,this.gen3Val=o,this.gen3Weight=n,this.gen2Key=s,this.gen2Val=a,this.gen2Weight=u,this.gen1Key=h,this.gen1Val=l,this.gen1Weight=p}return t.prototype.toString=function(){return"@bucket(gen4Key: "+this.gen4Key+"; gen4Val: "+this.gen4Val+"; gen4Weight: "+this.gen4Weight+"; gen3Key: "+this.gen3Key+"; gen3Val: "+this.gen3Val+"; gen3Weight: "+this.gen3Weight+"; gen24Key: "+this.gen2Key+"; gen24Val: "+this.gen2Val+"; gen24Weight: "+this.gen2Weight+"; gen1Key: "+this.gen1Key+"; gen1Val: "+this.gen1Val+"; gen1Weight: "+this.gen1Weight+")"},t}(),Nt=function(a){function l(t,e,i,r,o,n){var s=a.call(this)||this;return s.schemeParser=t,s.authorityParser=e,s.pathParser=i,s.queryParser=r,s.fragmentParser=o,s.step=n,s}return v(l,a),l.prototype.feed=function(t){return l.parse(t,this.schemeParser,this.authorityParser,this.pathParser,this.queryParser,this.fragmentParser,this.step)},l.parse=function(t,e,i,r,o,n,s){void 0===s&&(s=1);var a=0;if(1===s)if(t.isEmpty())t.isDone()&&(s=3);else{for(var u=t.clone();!u.isEmpty()&&(a=u.head(),ee.isSchemeChar(a));)u.step();s=u.isEmpty()||58!==a?3:2}if(2===s){for(e||(e=Ht.parse(t));e.isCont()&&(!t.isEmpty()||t.isDone());)e=e.feed(t);if(e.isDone())if(t.isEmpty()||58!==t.head()){if(!t.isEmpty())return _.expected("':'",t);if(t.isDone())return _.unexpected(t)}else t.step(),s=3;else if(e.isError())return e.asError()}if(3===s)if(t.isEmpty()){if(t.isDone())return _.done(ee.of(e&&e.bind()))}else 47===(a=t.head())?(t.step(),s=4):63===a?(t.step(),s=7):35===a?(t.step(),s=8):s=6;if(4===s)if(t.isEmpty()||47!==t.head())if(t.isEmpty()){if(t.isDone())return _.done(ee.of(e&&e.bind(),void 0,pe.Slash))}else{var h=new ye;h.push("/"),r=Jt.parse(t,h),s=6}else t.step(),s=5;if(5===s){for(i||(i=jt.parse(t));i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())if(t.isEmpty()){if(t.isDone())return _.done(ee.of(e&&e.bind(),i&&i.bind()))}else 63===(a=t.head())?(t.step(),s=7):35===a?(t.step(),s=8):s=6;else if(i.isError())return i.asError()}if(6===s){for(r||(r=Jt.parse(t));r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())if(t.isEmpty()||63!==t.head())if(t.isEmpty()||35!==t.head()){if(!t.isEmpty()||t.isDone())return _.done(ee.of(e&&e.bind(),i&&i.bind(),r.bind()))}else t.step(),s=8;else t.step(),s=7;else if(r.isError())return r.asError()}if(7===s){for(o||(o=$t.parse(t));o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone())if(t.isEmpty()||35!==t.head()){if(!t.isEmpty()||t.isDone())return _.done(ee.of(e&&e.bind(),i&&i.bind(),r&&r.bind(),o.bind()))}else t.step(),s=8;else if(o.isError())return o.asError()}if(8===s){for(n||(n=te.parse(t));n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())return _.done(ee.of(e&&e.bind(),i&&i.bind(),r&&r.bind(),o&&o.bind(),n.bind()));if(n.isError())return n.asError()}return new l(e,i,r,o,n,s)},l}(_),Ht=function(r){function o(t,e){var i=r.call(this)||this;return i.output=t,i.step=e,i}return v(o,r),o.prototype.feed=function(t){return o.parse(t,this.output,this.step)},o.parse=function(t,e,i){void 0===i&&(i=1);var r=0;if(1===i)if(!t.isEmpty()&&(r=t.head(),_.isAlpha(r)))t.step(),(e=e||new g).push(_.toLowerCase(r)),i=2;else if(!t.isEmpty()||t.isDone())return _.expected("scheme",t);if(2===i){for(;!t.isEmpty()&&(r=t.head(),ee.isSchemeChar(r));)t.step(),e.push(_.toLowerCase(r));if(!t.isEmpty()||t.isDone())return _.done(ie.of(e.bind()))}return new o(e,i)},o}(_),jt=function(n){function a(t,e,i,r){var o=n.call(this)||this;return o.userParser=t,o.hostParser=e,o.portParser=i,o.step=r,o}return v(a,n),a.prototype.feed=function(t){return a.parse(t,this.userParser,this.hostParser,this.portParser,this.step)},a.parse=function(t,e,i,r,o){void 0===o&&(o=1);var n=0;if(1===o)if(t.isEmpty())t.isDone()&&(o=3);else{for(var s=t.clone();!s.isEmpty()&&(64!==(n=s.head())&&47!==n);)s.step();o=s.isEmpty()||64!==n?3:2}if(2===o){for(e||(e=Kt.parse(t));e.isCont()&&(!t.isEmpty()||t.isDone());)e=e.feed(t);if(e.isDone())if(t.isEmpty()||64!==t.head()){if(!t.isEmpty())return _.expected(64,t);if(t.isDone())return _.unexpected(t)}else t.step(),o=3;else if(e.isError())return e.asError()}if(3===o){for(i||(i=Yt.parse(t));i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())if(t.isEmpty()||58!==t.head()){if(!t.isEmpty()||t.isDone())return _.done(re.of(e&&e.bind(),i.bind()))}else t.step(),o=4;else if(i.isError())return i.asError()}if(4===o){for(r||(r=Zt.parse(t));r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isError())return r.asError();if(!t.isEmpty()||t.isDone())return _.done(re.of(e&&e.bind(),i.bind(),r.bind()))}return new a(e,i,r,o)},a}(_),Kt=function(n){function s(t,e,i,r){var o=n.call(this)||this;return o.usernameOutput=t,o.passwordOutput=e,o.c1=i,o.step=r,o}return v(s,n),s.prototype.feed=function(t){return s.parse(t,this.usernameOutput,this.passwordOutput,this.c1,this.step)},s.parse=function(t,e,i,r,o){void 0===r&&(r=0),void 0===o&&(o=1);for(var n=0;!t.isEmpty()||t.isDone();){if(1===o){for(e||(e=new g);!t.isEmpty()&&(n=t.head(),ee.isUserChar(n));)t.step(),e.push(n);if(t.isEmpty()||58!==n)if(t.isEmpty()||37!==n){if(!t.isEmpty()||t.isDone())return _.done(oe.of(e.bind()))}else t.step(),o=2;else t.step(),o=4}if(2===o)if(!t.isEmpty()&&(n=t.head(),_.isHexChar(n)))t.step(),r=n,o=3;else{if(!t.isEmpty())return _.expected("hex digit",t);if(t.isDone())return _.unexpected(t)}if(3===o)if(!t.isEmpty()&&(n=t.head(),_.isHexChar(n)))t.step(),e.push((_.decodeHexChar(r)<<4)+_.decodeHexChar(n)),r=0,o=1;else{if(!t.isEmpty())return _.expected("hex digit",t);if(t.isDone())return _.unexpected(t)}if(4===o){for(i=i||new g;!t.isEmpty()&&(n=t.head(),ee.isUserInfoChar(n));)t.step(),i.push(n);if(t.isEmpty()||37!==n){if(!t.isEmpty()||t.isDone())return _.done(oe.of(e.bind(),i.bind()))}else t.step(),o=5}if(5===o)if(!t.isEmpty()&&(n=t.head(),_.isHexChar(n)))t.step(),r=n,o=6;else{if(!t.isEmpty())return _.expected("hex digit",t);if(t.isDone())return _.unexpected(t)}if(6===o)if(!t.isEmpty()&&(n=t.head(),_.isHexChar(n)))t.step(),i.push((_.decodeHexChar(r)<<4)+_.decodeHexChar(n)),r=0,o=4;else{if(!t.isEmpty())return _.expected("hex digit",t);if(t.isDone())return _.unexpected(t)}}return new s(e,i,r,o)},s}(_),Yt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.feed=function(t){return e.parse(t)},e.parse=function(t){return t.isEmpty()?t.isDone()?_.done(se.of("")):new e:91===t.head()?Qt.parse(t):Xt.parse(t)},e}(_),Xt=function(n){function s(t,e,i,r){var o=n.call(this)||this;return o.output=t,o.c1=e,o.x=i,o.step=r,o}return v(s,n),s.prototype.feed=function(t){return s.parse(t,this.output,this.c1,this.x,this.step)},s.parse=function(t,e,i,r,o){void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=1);for(var n=0;o<=4&&(!t.isEmpty()||t.isDone());){for(e=e||new g;!t.isEmpty()&&(n=t.head(),_.isDigit(n));)t.step(),e.push(n),r=10*r+_.decodeDigit(n);if(t.isEmpty()){if(t.isDone())return 4===o&&r<=255?_.done(ae.of(e.bind())):_.done(se.of(e.bind()))}else if(46===n&&o<4&&r<=255)t.step(),e.push(n),r=0,o+=1;else{if(!ee.isHostChar(n)&&37!==n&&4===o&&r<=255)return _.done(ae.of(e.bind()));r=0,o=5}}for(;!t.isEmpty()||t.isDone();){if(e=e,5===o){for(;!t.isEmpty()&&(n=t.head(),ee.isHostChar(n));)t.step(),e.push(_.toLowerCase(n));if(t.isEmpty()||37!==n){if(!t.isEmpty()||t.isDone())return _.done(se.of(e.bind()))}else t.step(),o=6}if(6===o)if(!t.isEmpty()&&(n=t.head(),_.isHexChar(n)))t.step(),i=n,o=7;else{if(!t.isEmpty())return _.expected("hex digit",t);if(t.isDone())return _.unexpected(t)}if(7===o)if(!t.isEmpty()&&(n=t.head(),_.isHexChar(n)))t.step(),e.push((_.decodeHexChar(i)<<4)+_.decodeHexChar(n)),i=0,o=5;else{if(!t.isEmpty())return _.expected("hex digit",t);if(t.isDone())return _.unexpected(t)}}return new s(e,i,r,o)},s}(_),Qt=function(r){function o(t,e){var i=r.call(this)||this;return i.output=t,i.step=e,i}return v(o,r),o.prototype.feed=function(t){return o.parse(t,this.output,this.step)},o.parse=function(t,e,i){void 0===i&&(i=1);var r=0;if(1===i)if(t.isEmpty()||91!==(r=t.head())){if(!t.isEmpty())return _.expected("'['",t);if(t.isDone())return _.unexpected(t)}else t.step(),i=2;if(2===i){for(e=e||new g;!t.isEmpty()&&(r=t.head(),ee.isHostChar(r)||58===r);)t.step(),e.push(_.toLowerCase(r));if(!t.isEmpty()&&93===r)return t.step(),_.done(ue.of(e.bind()));if(!t.isEmpty()||t.isDone())return _.unexpected(t)}return new o(e,i)},o}(_),Zt=function(i){function r(t){var e=i.call(this)||this;return e.port=t,e}return v(r,i),r.prototype.feed=function(t){return r.parse(t,this.port)},r.parse=function(t,e){void 0===e&&(e=0);for(var i=0;!t.isEmpty()&&(i=t.head(),_.isDigit(i));)t.step(),e=10*e+_.decodeDigit(i);return!t.isEmpty()||t.isDone()?_.done(le.of(e)):new r(e)},r}(_),Jt=function(n){function s(t,e,i,r){var o=n.call(this)||this;return o.builder=t,o.output=e,o.c1=i,o.step=r,o}return v(s,n),s.prototype.feed=function(t){return s.parse(t,this.builder,this.output,this.c1,this.step)},s.parse=function(t,e,i,r,o){void 0===r&&(r=0),void 0===o&&(o=1);for(var n=0;!t.isEmpty()||t.isDone();){if(1===o){for(;!t.isEmpty()&&(n=t.head(),ee.isPathChar(n));)i=i||new g,t.step(),i.push(n);if(t.isEmpty()||47!==n)if(t.isEmpty()||37!==n){if(!t.isEmpty()||t.isDone())return e=e||new ye,i&&e.push(i.bind()),_.done(e.bind())}else t.step(),o=2;else t.step(),e=e||new ye,i&&(e.push(i.bind()),i=void 0),e.push("/")}if(2===o)if(!t.isEmpty()&&(n=t.head(),_.isHexChar(n)))t.step(),r=n,o=3;else{if(!t.isEmpty())return _.expected("hex digit",t);if(t.isDone())return _.unexpected(t)}if(3===o)if(!t.isEmpty()&&(n=t.head(),_.isHexChar(n)))i=i||new g,t.step(),i.push((_.decodeHexChar(r)<<4)+_.decodeHexChar(n)),r=0,o=1;else{if(!t.isEmpty())return _.expected("hex digit",t);if(t.isDone())return _.unexpected(t)}}return new s(e,i,r,o)},s}(_),$t=function(s){function a(t,e,i,r,o){var n=s.call(this)||this;return n.keyOutput=t,n.valueOutput=e,n.builder=i,n.c1=r,n.step=o,n}return v(a,s),a.prototype.feed=function(t){return a.parse(t,this.keyOutput,this.valueOutput,this.builder,this.c1,this.step)},a.parse=function(t,e,i,r,o,n){void 0===o&&(o=0),void 0===n&&(n=1);for(var s=0;!t.isEmpty()||t.isDone();){if(1===n){for(e=e||new g;!t.isEmpty()&&(s=t.head(),ee.isParamChar(s));)t.step(),e.push(s);if(t.isEmpty()||61!==s)if(t.isEmpty()||38!==s)if(t.isEmpty()||37!==s){if(!t.isEmpty()||t.isDone())return(r=r||new be).param(null,e.bind()),_.done(r.bind())}else t.step(),n=2;else t.step(),(r=r||new be).param(null,e.bind()),e=void 0,n=1;else t.step(),n=4}if(2===n)if(!t.isEmpty()&&(s=t.head(),_.isHexChar(s)))t.step(),o=s,n=3;else{if(!t.isEmpty())return _.expected("hex digit",t);if(t.isDone())return _.unexpected(t)}if(3===n)if(!t.isEmpty()&&(s=t.head(),_.isHexChar(s)))t.step(),e.push((_.decodeHexChar(o)<<4)+_.decodeHexChar(s)),o=0,n=1;else{if(!t.isEmpty())return _.expected("hex digit",t);if(t.isDone())return _.unexpected(t)}if(4===n){for(i=i||new g;!t.isEmpty()&&(s=t.head(),ee.isParamChar(s)||61===s);)t.step(),i.push(s);if(t.isEmpty()||38!==s)if(t.isEmpty()||38!==s){if(!t.isEmpty()||t.isDone())return(r=r||new be).param(e.bind(),i.bind()),_.done(r.bind())}else t.step(),n=5;else t.step(),(r=r||new be).param(e.bind(),i.bind()),i=e=void 0,n=1}if(5===n)if(!t.isEmpty()&&(s=t.head(),_.isHexChar(s)))t.step(),o=s,n=6;else{if(!t.isEmpty())return _.expected("hex digit",t);if(t.isDone())return _.unexpected(t)}if(6===n)if(!t.isEmpty()&&(s=t.head(),_.isHexChar(s)))t.step(),i.push((_.decodeHexChar(o)<<4)+_.decodeHexChar(s)),o=0,n=4;else{if(!t.isEmpty())return _.expected("hex digit",t);if(t.isDone())return _.unexpected(t)}}return new a(e,i,r,o,n)},a}(_),te=function(o){function n(t,e,i){var r=o.call(this)||this;return r.output=t,r.c1=e,r.step=i,r}return v(n,o),n.prototype.feed=function(t){return n.parse(t,this.output,this.c1,this.step)},n.parse=function(t,e,i,r){void 0===e&&(e=new g),void 0===i&&(i=0),void 0===r&&(r=1);for(var o=0;!t.isEmpty()||t.isDone();){if(1===r){for(;!t.isEmpty()&&(o=t.head(),ee.isFragmentChar(o));)t.step(),e.push(o);if(t.isEmpty()||37!==o){if(!t.isEmpty()||t.isDone())return _.done(we.of(e.bind()))}else t.step(),r=2}if(2===r)if(!t.isEmpty()&&(o=t.head(),_.isHexChar(o)))t.step(),i=o,r=3;else{if(!t.isEmpty())return _.expected("hex digit",t);if(t.isDone())return _.unexpected(t)}if(3===r)if(!t.isEmpty()&&(o=t.head(),_.isHexChar(o)))t.step(),e.push((_.decodeHexChar(i)<<4)+_.decodeHexChar(o)),i=0,r=1;else{if(!t.isEmpty())return _.expected("hex digit",t);if(t.isDone())return _.unexpected(t)}}return new n(e,i,r)},n}(_),ee=function(){function s(t,e,i,r,o){this._scheme=t,this._authority=e,this._path=i,this._query=r,this._fragment=o}return s.prototype.isDefined=function(){return this._scheme.isDefined()||this._authority.isDefined()||this._path.isDefined()||this._query.isDefined()||this._fragment.isDefined()},s.prototype.isEmpty=function(){return!(this._scheme.isDefined()||this._authority.isDefined()||this._path.isDefined()||this._query.isDefined()||this._fragment.isDefined())},s.prototype.scheme=function(t){return void 0===t?this._scheme:(t=ie.fromAny(t),s.of(t,this._authority,this._path,this._query,this._fragment))},s.prototype.authority=function(t){return void 0===t?this._authority:(t=re.fromAny(t),s.of(this._scheme,t,this._path,this._query,this._fragment))},s.prototype.user=function(t){if(void 0===t)return this._authority._user;var e=this._authority.user(t);return s.of(this._scheme,e,this._path,this._query,this._fragment)},s.prototype.username=function(t,e){if(void 0===t)return this._authority._user._username||"";var i=this._authority.username(t,e);return s.of(this._scheme,i,this._path,this._query,this._fragment)},s.prototype.password=function(t){if(void 0===t)return this._authority._user._password;var e=this._authority.password(t);return s.of(this._scheme,e,this._path,this._query,this._fragment)},s.prototype.host=function(t){if(void 0===t)return this._authority._host;var e=this._authority.host(t);return s.of(this._scheme,e,this._path,this._query,this._fragment)},s.prototype.hostName=function(t){if(void 0===t)return this._authority._host.name();var e=this._authority.hostName(t);return s.of(this._scheme,e,this._path,this._query,this._fragment)},s.prototype.hostIPv4=function(t){if(void 0===t)return this._authority._host.ipv4();var e=this._authority.hostIPv4(t);return s.of(this._scheme,e,this._path,this._query,this._fragment)},s.prototype.hostIPv6=function(t){if(void 0===t)return this._authority._host.ipv6();var e=this._authority.hostIPv6(t);return s.of(this._scheme,e,this._path,this._query,this._fragment)},s.prototype.port=function(t){if(void 0===t)return this._authority._port;var e=this._authority.port(t);return s.of(this._scheme,e,this._path,this._query,this._fragment)},s.prototype.path=function(t){return void 0===t?this._path:(t=pe.fromAny(t),s.of(this._scheme,this._authority,t,this._query,this._fragment))},s.prototype.query=function(t){return void 0===t?this._query:(t=me.fromAny(t),s.of(this._scheme,this._authority,this._path,t,this._fragment))},s.prototype.param=function(t,e){if(void 0===e)return this._query.get(t);var i=this._query.param(t,e);return s.of(this._scheme,this._authority,this._path,i,this._fragment)},s.prototype.fragment=function(t){return void 0===t?this._fragment:(t=we.fromAny(t),s.of(this._scheme,this._authority,this._path,this._query,t))},s.prototype.base=function(){return this._path.isDefined()||this._query.isDefined()||this._fragment.isDefined()?s.of(this._scheme,this._authority):this},s.prototype.resolve=function(t){return(t=s.fromAny(t))._scheme.isDefined()?s.of(t._scheme,t._authority,t._path.removeDotSegments(),t._query,t._fragment):t._authority.isDefined()?s.of(this._scheme,t._authority,t._path.removeDotSegments(),t._query,t._fragment):t._path.isEmpty()?s.of(this._scheme,this._authority,this._path,t._query.isDefined()?t._query:this._query,t._fragment):"/"===t._path.head()?s.of(this._scheme,this._authority,t._path.removeDotSegments(),t._query,t._fragment):s.of(this._scheme,this._authority,this.merge(t._path).removeDotSegments(),t._query,t._fragment)},s.prototype.merge=function(t){return this._authority.isDefined()&&this._path.isEmpty()?new de(t):this._path.isEmpty()?t:this._path.merge(t)},s.prototype.unresolve=function(t){return t=s.fromAny(t),this._scheme.equals(t._scheme)&&this._authority.equals(t._authority)?s.of(ie.Undefined,re.Undefined,this._path.unmerge(t._path),t._query,t._fragment):t},s.prototype.writeUri=function(t){this._scheme.isDefined()&&(this._scheme.writeUri(t),t.push(58)),this._authority.isDefined()&&(t.push(47,47),this._authority.writeUri(t)),this._path.writeUri(t),this._query.isDefined()&&(t.push(63),this._query.writeUri(t)),this._fragment.isDefined()&&(t.push(35),this._fragment.writeUri(t))},s.prototype.toUri=function(){var t=this._string;if(void 0===t){var e=new g;this.writeUri(e),t=e.bind(),this._string=t}return t},s.prototype.compare=function(t){var e=this.toUri().localeCompare(t.toUri());return e<0?-1:0<e?1:0},s.prototype.equals=function(t){return this===t||t instanceof s&&((void 0===this._hashCode||void 0===t._hashCode||this._hashCode===t._hashCode)&&(this._scheme.equals(t._scheme)&&this._authority.equals(t._authority)&&this._path.equals(t._path)&&this._query.equals(t._query)&&this._fragment.equals(t._fragment)))},s.prototype.hashCode=function(){var t=this._hashCode;return void 0===t&&(t=p.mash(p.mix(p.mix(p.mix(p.mix(p.mix(4118306580,this._scheme.hashCode()),this._authority.hashCode()),this._path.hashCode()),this._query.hashCode()),this._fragment.hashCode())),this._hashCode=t),t},s.prototype.toString=function(){return this.toUri()},s.parse=function(t){var e=O.valueOf(t);if(t.length<=128){var i=s.ParseCache.get(e);if(void 0!==i)return i}var r=new m(t),o=Nt.parse(r);!r.isEmpty()&&o.isDone()&&(o=_.unexpected(r));var n=o.bind();return s.ParseCache.set(e,n),n},s.of=function(t,e,i,r,o){return void 0===t&&(t=ie.Undefined),void 0===e&&(e=re.Undefined),void 0===i&&(i=pe.Empty),void 0===r&&(r=me.Undefined),void 0===o&&(o=we.Undefined),t.isDefined()||e.isDefined()||i.isDefined()||r.isDefined()||o.isDefined()?new s(t,e,i,r,o):s.Empty},s.scheme=function(t){return t=ie.fromAny(t),s.of(t,void 0,void 0,void 0,void 0)},s.authority=function(t){return t=re.fromAny(t),s.of(void 0,t,void 0,void 0,void 0)},s.user=function(t){var e=re.user(t);return s.of(void 0,e,void 0,void 0,void 0)},s.username=function(t,e){var i=re.username(t,e);return s.of(void 0,i,void 0,void 0,void 0)},s.password=function(t){var e=re.password(t);return s.of(void 0,e,void 0,void 0,void 0)},s.host=function(t){var e=re.host(t);return s.of(void 0,e,void 0,void 0,void 0)},s.hostName=function(t){var e=re.hostName(t);return s.of(void 0,e,void 0,void 0,void 0)},s.hostIPv4=function(t){var e=re.hostIPv4(t);return s.of(void 0,e,void 0,void 0,void 0)},s.hostIPv6=function(t){var e=re.hostIPv6(t);return s.of(void 0,e,void 0,void 0,void 0)},s.port=function(t){var e=re.port(t);return s.of(void 0,e,void 0,void 0,void 0)},s.path=function(t){return t=pe.fromAny(t),s.of(void 0,void 0,t,void 0,void 0)},s.query=function(t){return t=me.fromAny(t),s.of(void 0,void 0,void 0,t,void 0)},s.param=function(t,e){var i=me.param(t,e);return s.of(void 0,void 0,void 0,i,void 0)},s.fragment=function(t){return t=we.fromAny(t),s.of(void 0,void 0,void 0,void 0,t)},s.fromAny=function(t){if(null==t)return s.Empty;if(t instanceof s)return t;if("object"==typeof t){var e=ie.fromAny(t.scheme),i=re.fromAny(t.authority||t),r=pe.fromAny(t.path),o=me.fromAny(t.query),n=we.fromAny(t.fragment);return e.isDefined()||i.isDefined()||r.isDefined()||o.isDefined()||n.isDefined()?new s(e,i,r,o,n):s.Empty}if("string"==typeof t)return s.parse(t);throw new TypeError(""+t)},s.resolve=function(t,e){return s.fromAny(t).resolve(e)},s.unresolve=function(t,e){return s.fromAny(t).unresolve(e)},s.isUnreservedChar=function(t){return 65<=t&&t<=90||97<=t&&t<=122||48<=t&&t<=57||45===t||46===t||95===t||126===t},s.isSubDelimChar=function(t){return 33===t||36===t||38===t||40===t||41===t||42===t||43===t||44===t||59===t||61===t||39===t},s.isSchemeChar=function(t){return 65<=t&&t<=90||97<=t&&t<=122||48<=t&&t<=57||43===t||45===t||46===t},s.isUserInfoChar=function(t){return s.isUnreservedChar(t)||s.isSubDelimChar(t)||58===t},s.isUserChar=function(t){return s.isUnreservedChar(t)||s.isSubDelimChar(t)},s.isHostChar=function(t){return s.isUnreservedChar(t)||s.isSubDelimChar(t)},s.isPathChar=function(t){return s.isUnreservedChar(t)||s.isSubDelimChar(t)||58===t||64===t},s.isQueryChar=function(t){return s.isUnreservedChar(t)||s.isSubDelimChar(t)||47===t||58===t||63===t||64===t},s.isParamChar=function(t){return s.isUnreservedChar(t)||33===t||36===t||40===t||41===t||42===t||43===t||44===t||47===t||58===t||59===t||63===t||64===t||39===t},s.isFragmentChar=function(t){return s.isUnreservedChar(t)||s.isSubDelimChar(t)||47===t||58===t||63===t||64===t},s.writeScheme=function(t,e){for(var i=0,r=t.length;i<r;i+=1){var o=t.charCodeAt(i);if(!(0<i&&s.isSchemeChar(o)||0===i&&_.isAlpha(o)))throw new Error("invalid scheme: "+t);e.push(o)}},s.writeUserInfo=function(t,e){for(var i=0,r=t.length;i<r;i+=1){var o=t.charCodeAt(i);s.isUserInfoChar(o)?e.push(o):s.writeEncoded(o,e)}},s.writeUser=function(t,e){for(var i=0,r=t.length;i<r;i+=1){var o=t.charCodeAt(i);s.isUserChar(o)?e.push(o):s.writeEncoded(o,e)}},s.writeHost=function(t,e){for(var i=0,r=t.length;i<r;i+=1){var o=t.charCodeAt(i);s.isHostChar(o)?e.push(o):s.writeEncoded(o,e)}},s.writeHostLiteral=function(t,e){for(var i=0,r=t.length;i<r;i+=1){var o=t.charCodeAt(i);s.isHostChar(o)||58===o?e.push(o):s.writeEncoded(o,e)}},s.writePort=function(t,e){for(var i=9,r=new Array(10);0<t;)r[i]=t%10,t=Math.floor(t/10),i-=1;for(i+=1;i<10;)e.push(48+r[i]),i+=1},s.writePathSegment=function(t,e){for(var i=0,r=t.length;i<r;i+=1){var o=t.charCodeAt(i);s.isPathChar(o)?e.push(o):s.writeEncoded(o,e)}},s.writeQuery=function(t,e){for(var i=0,r=t.length;i<r;i+=1){var o=t.charCodeAt(i);s.isQueryChar(o)?e.push(o):s.writeEncoded(o,e)}},s.writeParam=function(t,e){for(var i=0,r=t.length;i<r;i+=1){var o=t.charCodeAt(i);s.isParamChar(o)?e.push(o):s.writeEncoded(o,e)}},s.writeFragment=function(t,e){for(var i=0,r=t.length;i<r;i+=1){var o=t.charCodeAt(i);s.isFragmentChar(o)?e.push(o):s.writeEncoded(o,e)}},s.writeEncoded=function(t,e){0===t?(s.writePctEncoded(192,e),s.writePctEncoded(128,e)):0<=t&&t<=127?s.writePctEncoded(t,e):128<=t&&t<=2047?(s.writePctEncoded(192|t>>>6,e),s.writePctEncoded(128|63&t,e)):2048<=t&&t<=65535||57344<=t&&t<=65535?(s.writePctEncoded(224|t>>>12,e),s.writePctEncoded(128|t>>>6&63,e),s.writePctEncoded(128|63&t,e)):65536<=t&&t<=1114111?(s.writePctEncoded(240|t>>>18,e),s.writePctEncoded(128|t>>>12&63,e),s.writePctEncoded(128|t>>>6&63,e),s.writePctEncoded(128|63&t,e)):(s.writePctEncoded(239,e),s.writePctEncoded(191,e),s.writePctEncoded(189,e))},s.writePctEncoded=function(t,e){e.push(37,s.encodeHexChar(t>>>4&15),s.encodeHexChar(15&t))},s.encodeHexChar=function(t){return t<10?48+t:t-10+97},s.Empty=void 0,s.ParseCache=new qt(64),s}(),ie=function(){function e(t){this._name=t}return e.prototype.isDefined=function(){return 0!==this._name.length},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),e.prototype.valueOf=function(){return this._name},e.prototype.writeUri=function(t){ee.writeScheme(this._name,t)},e.prototype.toUri=function(){var t=new g;return this.writeUri(t),t.bind()},e.prototype.equals=function(t){return this===t||t instanceof e&&this._name===t._name},e.prototype.hashCode=function(){return p.mash(p.mix(2043922308,p.hash(this._name)))},e.prototype.toString=function(){return this._name},e.parse=function(t){"string"==typeof t&&(t=new m(t));var e=Ht.parse(t);return!t.isEmpty()&&e.isDone()&&(e=_.unexpected(t)),e.bind()},e.of=function(t){return 0!==t.length?new e(t):e.Undefined},e.fromAny=function(t){if(null==t)return e.Undefined;if(t instanceof e)return t;if("string"==typeof t)return e.of(t);throw new TypeError(""+t)},e.Undefined=new e(""),e}(),re=function(){function o(t,e,i){this._user=t,this._host=e,this._port=i}return o.prototype.isDefined=function(){return this._user.isDefined()||this._host.isDefined()||this._port.isDefined()},o.prototype.user=function(t){return void 0===t?this._user:(t=oe.fromAny(t),o.of(t,this._host,this._port))},o.prototype.username=function(t,e){if(void 0===t)return this._user._username||"";var i=this._user.username(t,e);return o.of(i,this._host,this._port)},o.prototype.password=function(t){if(void 0===t)return this._user._password;var e=this._user.password(t);return o.of(e,this._host,this._port)},o.prototype.host=function(t){return void 0===t?this._host:(t=ne.fromAny(t),o.of(this._user,t,this._port))},o.prototype.hostName=function(t){if(void 0===t)return this._host.name();var e=se.of(t);return o.of(this._user,e,this._port)},o.prototype.hostIPv4=function(t){if(void 0===t)return this._host.ipv4();var e=ae.of(t);return o.of(this._user,e,this._port)},o.prototype.hostIPv6=function(t){if(void 0===t)return this._host.ipv6();var e=ue.of(t);return o.of(this._user,e,this._port)},o.prototype.port=function(t){return void 0===t?this._port:(t=le.fromAny(t),o.of(this._user,this._host,t))},o.prototype.writeUri=function(t){this._user.isDefined()&&(this._user.writeUri(t),t.push(64)),this._host.writeUri(t),this._port.isDefined()&&(t.push(58),this._port.writeUri(t))},o.prototype.toUri=function(){var t=new g;return this.writeUri(t),t.bind()},o.prototype.equals=function(t){return this===t||t instanceof o&&(this._user.equals(t._user)&&this._host.equals(t._host)&&this._port.equals(t._port))},o.prototype.hashCode=function(){return p.mash(p.mix(p.mix(p.mix(1835556802,this._user.hashCode()),this._host.hashCode()),this._port.hashCode()))},o.prototype.toString=function(){return this.toUri()},o.parse=function(t){"string"==typeof t&&(t=new m(t));var e=jt.parse(t);return!t.isEmpty()&&e.isDone()&&(e=_.unexpected(t)),e.bind()},o.of=function(t,e,i){return void 0===t&&(t=oe.Undefined),void 0===e&&(e=ne.Undefined),void 0===i&&(i=le.Undefined),t.isDefined()||e.isDefined()||i.isDefined()?new o(t,e,i):o.Undefined},o.user=function(t){return t=oe.fromAny(t),o.of(t,void 0,void 0)},o.username=function(t,e){var i=oe.of(t,e);return o.of(i,void 0,void 0)},o.password=function(t){var e=oe.of("",t);return o.of(e,void 0,void 0)},o.host=function(t){return t=ne.fromAny(t),o.of(void 0,t,void 0)},o.hostName=function(t){var e=se.of(t);return o.of(void 0,e,void 0)},o.hostIPv4=function(t){var e=ae.of(t);return o.of(void 0,e,void 0)},o.hostIPv6=function(t){var e=ue.of(t);return o.of(void 0,e,void 0)},o.port=function(t){return t=le.fromAny(t),o.of(void 0,void 0,t)},o.fromAny=function(t){if(null==t)return o.Undefined;if(t instanceof o)return t;if("object"==typeof t){var e=oe.fromAny(t.user||t),i=ne.fromAny(t.host),r=le.fromAny(t.port);return o.of(e,i,r)}if("string"==typeof t)return o.parse(t);throw new TypeError(""+t)},o.Undefined=void 0,o}(),oe=function(){function r(t,e){void 0===e&&(e=null),this._username=t,this._password=e}return r.prototype.isDefined=function(){return null!==this._username},r.prototype.username=function(t,e){return void 0===e&&(e=this._password),void 0===t?this._username||"":r.of(t,this._password)},r.prototype.password=function(t){return void 0===t?this._password:r.of(this._username,t)},r.prototype.writeUri=function(t){null!==this._username&&(ee.writeUser(this._username,t),null!==this._password&&(t.push(58),ee.writeUser(this._password,t)))},r.prototype.toUri=function(){var t=new g;return this.writeUri(t),t.bind()},r.prototype.equals=function(t){return this===t||t instanceof r&&(this._username===t._username&&this._password===t._password)},r.prototype.hashCode=function(){return p.mash(p.mix(p.mix(2091562833,p.hash(this._username)),p.hash(this._password)))},r.prototype.toString=function(){return this.toUri()},r.parse=function(t){"string"==typeof t&&(t=new m(t));var e=Kt.parse(t);return!t.isEmpty()&&e.isDone()&&(e=_.unexpected(t)),e.bind()},r.of=function(t,e){return void 0===e&&(e=null),null!==t||null!==e?new r(t||"",e):r.Undefined},r.fromAny=function(t){if(null==t)return r.Undefined;if(t instanceof r)return t;if("object"==typeof t){var e="string"==typeof t.username?t.username:null,i="string"==typeof t.password?t.password:null;return r.of(e,i)}if("string"==typeof t)return r.parse(t);throw new TypeError(""+t)},r.Undefined=new r(null,null),r}(),ne=function(){function e(){}return e.prototype.name=function(){return null},e.prototype.ipv4=function(){return null},e.prototype.ipv6=function(){return null},e.prototype.toUri=function(){var t=new g;return this.writeUri(t),t.bind()},e.prototype.toString=function(){return this.toUri()},e.parse=function(t){"string"==typeof t&&(t=new m(t));var e=Yt.parse(t);return!t.isEmpty()&&e.isDone()&&(e=_.unexpected(t)),e.bind()},e.fromAny=function(t){if(null==t)return e.Undefined;if(t instanceof e)return t;if("string"==typeof t)return e.parse(t);throw new TypeError(""+t)},e.Undefined=void 0,e}(),se=function(i){function e(t){var e=i.call(this)||this;return e._address=t,e}return v(e,i),e.prototype.isDefined=function(){return!0},Object.defineProperty(e.prototype,"address",{get:function(){return this._address},enumerable:!0,configurable:!0}),e.prototype.name=function(){return this._address},e.prototype.writeUri=function(t){ee.writeHost(this._address,t)},e.prototype.equals=function(t){return this===t||t instanceof e&&this._address===t._address},e.prototype.hashCode=function(){return p.mash(p.mix(3937679e3,p.hash(this._address)))},e.of=function(t){return new e(t)},e}(ne),ae=function(i){function e(t){var e=i.call(this)||this;return e._address=t,e}return v(e,i),e.prototype.isDefined=function(){return!0},Object.defineProperty(e.prototype,"address",{get:function(){return this._address},enumerable:!0,configurable:!0}),e.prototype.ipv4=function(){return this._address},e.prototype.writeUri=function(t){ee.writeHost(this._address,t)},e.prototype.equals=function(t){return this===t||t instanceof e&&this._address===t._address},e.prototype.hashCode=function(){return p.mash(p.mix(2745781626,p.hash(this._address)))},e.of=function(t){return new e(t)},e}(ne),ue=function(i){function e(t){var e=i.call(this)||this;return e._address=t,e}return v(e,i),e.prototype.isDefined=function(){return!0},Object.defineProperty(e.prototype,"address",{get:function(){return this._address},enumerable:!0,configurable:!0}),e.prototype.ipv6=function(){return this._address},e.prototype.writeUri=function(t){t.push(91),ee.writeHostLiteral(this._address,t),t.push(93)},e.prototype.equals=function(t){return this===t||t instanceof e&&this._address===t._address},e.prototype.hashCode=function(){return p.mash(p.mix(1131060913,p.hash(this._address)))},e.of=function(t){return new e(t)},e}(ne),he=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.isDefined=function(){return!1},Object.defineProperty(e.prototype,"address",{get:function(){return""},enumerable:!0,configurable:!0}),e.prototype.writeUri=function(t){},e.prototype.equals=function(t){return t instanceof e},e.prototype.hashCode=function(){return 2406756600},e}(ne);ne.Undefined=new he;var le=function(){function e(t){this._number=t}return e.prototype.isDefined=function(){return 0!==this._number},Object.defineProperty(e.prototype,"number",{get:function(){return this._number},enumerable:!0,configurable:!0}),e.prototype.valueOf=function(){return this._number},e.prototype.writeUri=function(t){ee.writePort(this._number,t)},e.prototype.toUri=function(){var t=new g;return this.writeUri(t),t.bind()},e.prototype.equals=function(t){return this===t||t instanceof e&&this._number===t._number},e.prototype.hashCode=function(){return p.mash(p.mix(213942493,this._number))},e.prototype.toString=function(){return this.toUri()},e.parse=function(t){"string"==typeof t&&(t=new m(t));var e=Zt.parse(t);return!t.isEmpty()&&e.isDone()&&(e=_.unexpected(t)),e.bind()},e.of=function(t){return 0!==t?new e(t):e.Undefined},e.fromAny=function(t){if(null==t)return e.Undefined;if(t instanceof e)return t;if("number"==typeof t)return e.of(t);if("string"==typeof t)return e.parse(t);throw new TypeError(""+t)},e.Undefined=new e(0),e}(),pe=function(){function n(){}return Object.defineProperty(n.prototype,"length",{get:function(){for(var t=0,e=this;!e.isEmpty();)t+=1,e=e.tail();return t},enumerable:!0,configurable:!0}),n.prototype.removeDotSegments=function(){for(var t=this,e=new ye;!t.isEmpty();){var i=t.head();if("."===i||".."===i)(t=t.tail()).isEmpty()||(t=t.tail());else if("/"===i){var r=t.tail();if(r.isEmpty())e.push(t.head()),t=t.tail();else{var o=r.head();"."===o?(t=r.tail()).isEmpty()&&(t=n.Slash):".."===o?((t=r.tail()).isEmpty()&&(t=n.Slash),e.isEmpty()||"/"===e.pop()||e.isEmpty()||e.pop()):(e.push(i,o),t=r.tail())}}else e.push(t.head()),t=t.tail()}return e.bind()},n.prototype.merge=function(t){for(var e=new ye,i=this.head(),r=this.tail();!r.isEmpty();)e.push(i),i=r.head(),r=r.tail();return"/"===i&&e.push(i),e.push(t),e.bind()},n.prototype.unmerge=function(t,e){void 0===e&&(e=t);for(var i=this;;){if(i.isEmpty())return t.isEmpty()||t.tail().isEmpty()?t:t.tail();if(i.isRelative())return t;if(t.isRelative())return new de(t);var r=i.tail(),o=t.tail();if(!r.isEmpty()&&o.isEmpty())return n.Slash;if(r.isEmpty()||o.isEmpty()||r.head()!==o.head())return o;if(r=r.tail(),o=o.tail(),!r.isEmpty()&&o.isEmpty())return e;i=r,t=o}},n.prototype.toArray=function(){for(var t=[],e=this;!e.isEmpty();)t.push(e.head()),e=e.tail();return t},n.prototype.writeUri=function(t){for(var e=this;!e.isEmpty();)e instanceof de?t.push(47):ee.writePathSegment(e.head(),t),e=e.tail()},n.prototype.toUri=function(){var t=new g;return this.writeUri(t),t.bind()},n.prototype.equals=function(t){if(this===t)return!0;if(t instanceof n){for(var e=this,i=t;!e.isEmpty()&&!i.isEmpty();){if(e.head()!==i.head())return!1;e=e.tail(),i=i.tail()}return e.isEmpty()===i.isEmpty()}return!1},n.prototype.hashCode=function(){for(var t=3618688081,e=this;!e.isEmpty();)t=p.mix(t,p.hash(e.head())),e=e.tail();return p.mash(t)},n.prototype.toString=function(){return this.toUri()},n.builder=function(){return new ye},n.parse=function(t){"string"==typeof t&&(t=new m(t));var e=Jt.parse(t);return!t.isEmpty()&&e.isDone()&&(e=_.unexpected(t)),e.bind()},n.of=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=new ye;return i.push.apply(i,arguments),i.bind()},n.fromAny=function(t){if(null==t)return n.Empty;if(t instanceof n)return t;if(Array.isArray(t))return n.of.apply(void 0,t);if("string"==typeof t)return n.parse(t);throw new TypeError(""+t)},n.Empty=void 0,n.Slash=void 0,n}(),ce=function(r){function e(t,e){var i=r.call(this)||this;return i._head=t,i._tail=e,i}return v(e,r),e.prototype.isDefined=function(){return!0},e.prototype.isAbsolute=function(){return!1},e.prototype.isRelative=function(){return!0},e.prototype.isEmpty=function(){return!1},e.prototype.head=function(){return this._head},e.prototype.tail=function(){return this._tail},e.prototype.setTail=function(t){t instanceof e&&(t=new de(t)),this._tail=t},e}(pe),de=function(i){function t(t){var e=i.call(this)||this;return e._tail=t,e}return v(t,i),t.prototype.isDefined=function(){return!0},t.prototype.isAbsolute=function(){return!0},t.prototype.isRelative=function(){return!1},t.prototype.isEmpty=function(){return!1},t.prototype.head=function(){return"/"},t.prototype.tail=function(){return this._tail},t.prototype.setTail=function(t){this._tail=t},t}(pe),fe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.isDefined=function(){return!1},e.prototype.isAbsolute=function(){return!1},e.prototype.isRelative=function(){return!0},e.prototype.isEmpty=function(){return!0},e.prototype.head=function(){return""},e.prototype.tail=function(){throw new Error("empty path")},e.prototype.setTail=function(t){throw new Error("empty path")},e}(pe);pe.Empty=new fe,pe.Slash=new de(pe.Empty);var ye=function(){function t(){this._first=pe.Empty,this._last=null,this._size=0,this._aliased=0}return t.prototype.isEmpty=function(){return 0===this._size},t.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<t.length;i+=1){var r=t[i];if(r instanceof pe){if(!r.isEmpty()){for(0===this._size?this._first=r:this.dealias(this._size-1).setTail(r),this._size+=1;!r.tail().isEmpty();)r=r.tail(),this._size+=1;this._last=r}}else if(Array.isArray(r))this.push.apply(this,r);else{if("string"!=typeof r)throw new TypeError(""+r);var o=void 0;o="/"===r?new de(pe.Empty):new ce(r,pe.Empty),0===this._size?this._first=o:this.dealias(this._size-1).setTail(o),this._last=o,this._size+=1,this._aliased+=1}}},t.prototype.pop=function(){if(0===this._size)throw new Error;if(1===this._size){var t=this._first,e=t.head();return this._first=t.tail(),t.tail().isEmpty()&&(this._last=null),this._size-=1,0<this._aliased&&(this._aliased-=1),e}var i=this.dealias(this._size-2);e=i.tail().head();return i.setTail(pe.Empty),this._last=i,this._size-=1,this._aliased-=1,e},t.prototype.bind=function(){return this._aliased=0,this._first},t.prototype.dealias=function(t){var e=0,i=null,r=this._first;if(this._aliased<=t){for(;e<this._aliased;)r=(i=r).tail(),e+=1;for(;e<=t;){var o=void 0;o=r instanceof de?new de(r.tail()):new ce(r.head(),r.tail()),0===e?this._first=o:i.setTail(o),i=o,r=r.tail(),e+=1}e===this._size&&(this._last=i),this._aliased=e}else if(0===t)i=this._first;else if(t===this._size-1)i=this._last;else for(;e<=t;)r=(i=r).tail(),e+=1;return i},t}(),me=function(){function u(){}return Object.defineProperty(u.prototype,"length",{get:function(){for(var t=0,e=this;!e.isEmpty();)t+=1,e=e.tail();return t},enumerable:!0,configurable:!0}),u.prototype.get=function(t){for(var e=this;!e.isEmpty();){if(t===e.key)return e.value;e=e.tail()}},u.prototype.param=function(t,e){if(void 0===e)return this.get(t);for(var i=new be,r=this,o=!1;!r.isEmpty();)o||null===t||t!==r.key?i.param(r.key,r.value):(i.param(t,e),o=!0),r=r.tail();return o||i.param(t,e),i.bind()},u.prototype.toObject=function(){for(var t={},e=this,i=0;!e.isEmpty();)null!==e.key?t[e.key]=e.value:t["$"+i]=e.value,e=e.tail(),i+=1;return t},u.prototype.writeUri=function(t){for(var e=this,i=!0;!e.isEmpty();)i?i=!1:t.push(38),null!==e.key&&(ee.writeParam(e.key,t),t.push(61)),ee.writeParam(e.value,t),e=e.tail()},u.prototype.toUri=function(){var t=new g;return this.writeUri(t),t.bind()},u.prototype.equals=function(t){if(this===t)return!0;if(t instanceof u){for(var e=this,i=t;!e.isEmpty()&&!i.isEmpty();){if(e.key!==i.key||e.value!==i.value)return!1;e=e.tail(),i=i.tail()}return e.isEmpty()===i.isEmpty()}return!1},u.prototype.hashCode=function(){for(var t=922545508,e=this;!e.isEmpty();)t=p.mix(p.mix(t,p.hash(e.key)),p.hash(e.value)),e=e.tail();return p.mash(t)},u.prototype.toString=function(){return this.toUri()},u.builder=function(){return new be},u.parse=function(t){"string"==typeof t&&(t=new m(t));var e=$t.parse(t);return!t.isEmpty()&&e.isDone()&&(e=_.unexpected(t)),e.bind()},u.fromAny=function(t){if(null==t)return u.Undefined;if(t instanceof u)return t;if("object"==typeof t)return u.fromObject(t);if("string"==typeof t)return u.parse(t);throw new TypeError(""+t)},u.param=function(t,e){return new ve(t,e,u.Undefined)},u.fromObject=function(t){var e=u.Undefined,i=null,r=0;for(var o in t){var n=o,s=t[o];36===o.charCodeAt(0)&&o==="$"+r&&(n=null);var a=new ve(n,s,u.Undefined);null===i?e=a:i.setTail(a),i=a,r+=1}return e},u.Undefined=void 0,u}(),ve=function(o){function t(t,e,i){var r=o.call(this)||this;return r._key=t,r._value=e,r._tail=i,r}return v(t,o),t.prototype.isDefined=function(){return!0},t.prototype.isEmpty=function(){return!1},Object.defineProperty(t.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),t.prototype.tail=function(){return this._tail},t.prototype.setTail=function(t){this._tail=t},t}(me),ge=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.isDefined=function(){return!1},e.prototype.isEmpty=function(){return!0},Object.defineProperty(e.prototype,"key",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return""},enumerable:!0,configurable:!0}),e.prototype.tail=function(){throw new Error("undefined query")},e.prototype.setTail=function(t){throw new Error("undefined query")},e}(me);me.Undefined=new ge;var be=function(){function t(){this._first=me.Undefined,this._last=null,this._size=0,this._aliased=0}return t.prototype.isEmpty=function(){return 0===this._size},t.prototype.param=function(t,e){var i=new ve(t,e,me.Undefined);0===this._size?this._first=i:this.dealias(this._size-1).setTail(i),this._last=i,this._size+=1,this._aliased+=1},t.prototype.bind=function(){return this._aliased=0,this._first},t.prototype.dealias=function(t){var e=0,i=null,r=this._first;if(this._aliased<=t){for(;e<this._aliased;)r=(i=r).tail(),e+=1;for(;e<=t;){var o=new ve(r.key,r.value,r.tail());0===e?this._first=o:i.setTail(o),i=o,r=r.tail(),e+=1}e===this._size&&(this._last=i),this._aliased=e}else if(0===t)i=this._first;else if(t===this._size-1)i=this._last;else for(;e<=t;)r=(i=r).tail(),e+=1;return i},t}(),we=function(){function e(t){this._part=t}return e.prototype.isDefined=function(){return null!==this._part},Object.defineProperty(e.prototype,"part",{get:function(){return this._part||""},enumerable:!0,configurable:!0}),e.prototype.writeUri=function(t){null!==this._part&&ee.writeFragment(this._part,t)},e.prototype.toUri=function(){var t=new g;return this.writeUri(t),t.bind()},e.prototype.equals=function(t){return this===t||t instanceof e&&this._part===t._part},e.prototype.hashCode=function(){return p.mash(p.mix(395776270,p.hash(this._part)))},e.prototype.toString=function(){return this.toUri()},e.parse=function(t){"string"==typeof t&&(t=new m(t));var e=te.parse(t);return!t.isEmpty()&&e.isDone()&&(e=_.unexpected(t)),e.bind()},e.of=function(t){return null!==t?new e(t):e.Undefined},e.fromAny=function(t){if(null==t)return e.Undefined;if(t instanceof e)return t;if("string"==typeof t)return e.of(t);throw new TypeError(""+t)},e.Undefined=new e(null),e}();re.Undefined=new re(oe.Undefined,ne.Undefined,le.Undefined),ee.Empty=new ee(ie.Undefined,re.Undefined,pe.Empty,me.Undefined,we.Undefined);var _e=function(){function t(){}return Object.defineProperty(t.prototype,"tag",{get:function(){},enumerable:!0,configurable:!0}),t.Any=void 0,t.Value=void 0,t.String=void 0,t.Number=void 0,t.Boolean=void 0,t.Uri=void 0,t}(),xe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"unit",{get:function(){},enumerable:!0,configurable:!0}),e.prototype.mold=function(t){return w.fromAny(t)},e.prototype.cast=function(t){return t.toAny()},e}(_e);_e.Any=new xe;var ke=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"unit",{get:function(){return w.Absent},enumerable:!0,configurable:!0}),e.prototype.mold=function(t){return w.fromAny(t)},e.prototype.cast=function(t){return t},e}(_e);_e.Value=new ke;var Ae=function(i){function t(t){void 0===t&&(t="");var e=i.call(this)||this;return e.unit=t,e}return v(t,i),t.prototype.mold=function(t){return O.valueOf(t)},t.prototype.cast=function(t){return t.target.stringValue()},t}(_e);_e.String=new Ae;var Ee=function(i){function t(t){void 0===t&&(t=0);var e=i.call(this)||this;return e.unit=t,e}return v(t,i),t.prototype.mold=function(t){return W.valueOf(t)},t.prototype.cast=function(t){return t.target.numberValue()},t}(_e);_e.Number=new Ee;var Ce=function(i){function t(t){void 0===t&&(t=!1);var e=i.call(this)||this;return e.unit=t,e}return v(t,i),t.prototype.mold=function(t){return z.valueOf(t)},t.prototype.cast=function(t){return t.target.booleanValue()},t}(_e);_e.Boolean=new Ce;var Se=function(i){function t(t){void 0===t&&(t=ee.Empty);var e=i.call(this)||this;return e.unit=t,e}return v(t,i),t.prototype.mold=function(t){return O.valueOf(t.toUri())},t.prototype.cast=function(t){try{var e=t.target.stringValue();if(void 0!==e)return ee.parse(e)}catch(t){}},t}(_e);_e.Uri=new Se;var Ve=function(r){function t(t,e){var i=r.call(this)||this;return i.cursor=t,i.form=e,i}return v(t,r),t.prototype.isEmpty=function(){return this.cursor.isEmpty()},t.prototype.head=function(){return this.cursor.head().coerce(this.form)},t.prototype.step=function(){this.cursor.step()},t.prototype.skip=function(t){this.cursor.skip(t)},t.prototype.hasNext=function(){return this.cursor.hasNext()},t.prototype.nextIndex=function(){return this.cursor.nextIndex()},t.prototype.next=function(){var t=this.cursor.next(),e=t.value,i=t.done;return{value:e&&e.coerce(this.form),done:i}},t.prototype.hasPrevious=function(){return this.cursor.hasPrevious()},t.prototype.previousIndex=function(){return this.cursor.previousIndex()},t.prototype.previous=function(){var t=this.cursor.next(),e=t.value,i=t.done;return{value:e&&e.coerce(this.form),done:i}},t.prototype.delete=function(){this.cursor.delete()},t}(s),De=function(o){function t(t,e,i){var r=o.call(this)||this;return r.cursor=t,r.keyForm=e,r.valueForm=i,r}return v(t,o),t.prototype.isEmpty=function(){return this.cursor.isEmpty()},t.prototype.head=function(){var t=this.cursor.head();return[t[0].coerce(this.keyForm),t[1].coerce(this.valueForm)]},t.prototype.step=function(){this.cursor.step()},t.prototype.skip=function(t){this.cursor.skip(t)},t.prototype.hasNext=function(){return this.cursor.hasNext()},t.prototype.nextIndex=function(){return this.cursor.nextIndex()},t.prototype.next=function(){var t=this.cursor.next(),e=t.value,i=t.done;return{value:e&&[e[0].coerce(this.keyForm),e[1].coerce(this.valueForm)],done:i}},t.prototype.hasPrevious=function(){return this.cursor.hasPrevious()},t.prototype.previousIndex=function(){return this.cursor.previousIndex()},t.prototype.previous=function(){var t=this.cursor.next(),e=t.value,i=t.done;return{value:e&&[e[0].coerce(this.keyForm),e[1].coerce(this.valueForm)],done:i}},t.prototype.delete=function(){this.cursor.delete()},t}(s),Me=function(){function t(){this._record=null,this._value=null}return t.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0,r=t.length;i<r;i+=1){var o=t[i];o instanceof M?this.pushField(o):o instanceof w&&this.pushValue(o)}},t.prototype.pushField=function(t){null===this._record&&(this._record=F.empty(),null!==this._value&&(this._record.push(this._value),this._value=null)),this._record.push(t)},t.prototype.pushValue=function(t){null!==this._record?this._record.push(t):null!==this._value?(this._record=F.empty(),this._record.push(this._value,t),this._value=null):this._value=t},t.prototype.bind=function(){return null!==this._record?this._record:null!==this._value?this._value:w.Absent},t}(),Pe=function(s){function a(t,e,i,r,o){var n=s.call(this)||this;return n.builder=e,n.keyParser=i,n.valueParser=r,n.step=o,n}return v(a,s),a.prototype.feed=function(t){return a.parse(t,this.recon,this.builder,this.keyParser,this.valueParser,this.step)},a.parse=function(t,e,i,r,o,n){void 0===n&&(n=1);var s=0;t:for(;;){if(1===n){for(;!t.isEmpty()&&(s=t.head(),_.isWhitespace(s));)t.step();if(t.isEmpty()){if(t.isDone())return i?_.done(i.bind()):_.done(e.absent())}else if(33===s||34===s||36===s||37===s||39===s||40===s||43===s||45===s||48<=s&&s<=57||64===s||91===s||123===s||126===s||ri.isIdentStartChar(s))i=i||e.valueBuilder(),n=2;else{if(35!==s)return i?_.done(i.bind()):_.done(e.absent());t.step(),n=7}}if(2===n){for(r||(r=e.parseBlockExpr(t));r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())n=3;else if(r.isError())return r}if(3===n){for(;!t.isEmpty()&&(s=t.head(),_.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return i.push(e.item(r.bind())),_.done(i.bind())}else 58===s?(t.step(),n=4):(i.push(e.item(r.bind())),r=void 0,n=6)}if(4===n){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();if(t.isEmpty()){if(t.isDone())return i.push(e.slot(r.bind())),_.done(i.bind())}else n=5}if(5===n){for(o||(o=e.parseBlockExpr(t));o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone())i.push(e.slot(r.bind(),o.bind())),o=r=void 0,n=6;else if(o.isError())return o}if(6===n){for(;!t.isEmpty()&&(s=t.head(),_.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return _.done(i.bind())}else{if(44===s||59===s||_.isNewline(s)){t.step(),n=1;continue}if(35!==s)return _.done(i.bind());t.step(),n=7}}if(7===n){for(;!t.isEmpty();){if(s=t.head(),_.isNewline(s)){n=1;continue t}t.step()}if(t.isDone()){n=1;continue}}break}return new a(e,i,r,o,n)},a}(_),Re=function(n){function s(t,e,i,r){var o=n.call(this)||this;return o.recon=t,o.keyParser=e,o.valueParser=i,o.step=r,o}return v(s,n),s.prototype.feed=function(t){return s.parse(t,this.recon,this.keyParser,this.valueParser,this.step)},s.parse=function(t,e,i,r,o){void 0===o&&(o=1);var n=0;if(1===o)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(64!==(n=t.head()))return _.expected("@",t);t.step(),o=2}if(2===o){if(i)i=i.feed(t);else if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else if(34===(n=t.head())||39===n)i=e.parseString(t);else{if(!ri.isIdentStartChar(n))return _.expected("attribute name",t);i=e.parseIdent(t)}if(i)if(i.isDone())o=3;else if(i.isError())return i.asError()}if(3===o)if(t.isEmpty()||40!==t.head()){if(!t.isEmpty()||t.isDone())return _.done(e.attr(i.bind()))}else t.step(),o=4;if(4===o){for(;!t.isEmpty()&&(n=t.head(),_.isWhitespace(n));)t.step();if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(41===n)return t.step(),_.done(e.attr(i.bind()));r||(r=e.parseBlock(t)),o=5}}if(5===o){for(r=r;r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())o=6;else if(r.isError())return r.asError()}if(6===o){for(;!t.isEmpty()&&(n=t.head(),_.isWhitespace(n));)t.step();if(!t.isEmpty())return 41===n?(t.step(),_.done(e.attr(i.bind(),r.bind()))):_.expected(")",t);if(t.isDone())return _.unexpected(t)}return new s(e,i,r,o)},s}(_),Te=function(s){function a(t,e,i,r,o){var n=s.call(this)||this;return n.recon=t,n.builder=e,n.fieldParser=i,n.valueParser=r,n.step=o,n}return v(a,s),a.prototype.feed=function(t){return a.parse(t,this.recon,this.builder,this.fieldParser,this.valueParser,this.step)},a.parse=function(t,e,i,r,o,n){void 0===n&&(n=1);for(var s=0;;){if(1===n)if(t.isEmpty()){if(t.isDone())return i?_.done(i.bind()):_.done(e.extant())}else if(64===(s=t.head()))r=e.parseAttr(t),n=2;else if(123===s)i=i||e.recordBuilder(),o=e.parseRecord(t,i),n=5;else if(91===s)i=i||e.recordBuilder(),o=e.parseMarkup(t,i),n=5;else if(ri.isIdentStartChar(s))o=e.parseIdent(t),n=4;else if(34===s||39===s)o=e.parseString(t),n=4;else if(45===s||48<=s&&s<=57)o=e.parseNumber(t),n=4;else if(37===s)o=e.parseData(t),n=4;else{if(36!==s)return i?_.done(i.bind()):_.done(e.extant());o=e.parseSelector(t),n=4}if(2===n){for(r=r;r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())(i=i||e.valueBuilder()).push(r.bind()),r=void 0,n=3;else if(r.isError())return r.asError()}if(3===n){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();if(!t.isEmpty()){n=1;continue}if(t.isDone())return _.done(i.bind())}if(4===n){for(o=o;o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone())(i=i||e.valueBuilder()).push(e.item(o.bind())),o=void 0,n=6;else if(o.isError())return o.asError()}if(5===n){for(o=o;o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone())o=void 0,n=6;else if(o.isError())return o.asError()}if(6===n){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();if(!t.isEmpty()){if(64===t.head()){n=1;continue}return _.done(i.bind())}if(t.isDone())return _.done(i.bind())}break}return new a(e,i,r,o,n)},a}(_),Le=function(s){function a(t,e,i,r,o){var n=s.call(this)||this;return n.recon=t,n.builder=e,n.fieldParser=i,n.valueParser=r,n.step=o,n}return v(a,s),a.prototype.feed=function(t){return a.parse(t,this.recon,this.builder,this.fieldParser,this.valueParser,this.step)},a.parse=function(t,e,i,r,o,n){void 0===n&&(n=1);var s=0;if(1===n)if(t.isEmpty()){if(t.isDone())return i?_.done(i.bind()):_.done(e.extant())}else if(64===(s=t.head()))r=e.parseAttr(t),n=2;else if(123===s)i?(o=e.parseRecord(t,i),n=5):(o=e.parseRecord(t),n=4);else{if(91!==s)return i?_.done(i.bind()):_.done(e.extant());i?(o=e.parseMarkup(t,i),n=5):(o=e.parseMarkup(t),n=4)}if(2===n){for(r=r;r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())(i=i||e.valueBuilder()).push(r.bind()),r=void 0,n=3;else if(r.isError())return r.asError()}if(3===n)if(t.isEmpty()){if(t.isDone())return _.done(i.bind())}else if(123===(s=t.head()))o=e.parseRecord(t,i),n=5;else{if(91!==s)return _.done(i.bind());o=e.parseMarkup(t,i),n=5}if(4===n){for(o=o;o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone())return(i=i||e.valueBuilder()).push(e.item(o.bind())),_.done(i.bind());if(o.isError())return o.asError()}if(5===n){for(o=o;o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone())return _.done(i.bind());if(o.isError())return o.asError()}return new a(e,i,r,o,n)},a}(_),Fe=function(s){function a(t,e,i,r,o){var n=s.call(this)||this;return n.recon=t,n.builder=e,n.keyParser=i,n.valueParser=r,n.step=o,n}return v(a,s),a.prototype.feed=function(t){return a.parse(t,this.recon,this.builder,this.keyParser,this.valueParser,this.step)},a.parse=function(t,e,i,r,o,n){void 0===n&&(n=1);var s=0;if(1===n)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(123!==(s=t.head()))return _.expected("{",t);t.step(),n=2}t:for(;;){if(2===n){for(;!t.isEmpty()&&(s=t.head(),_.isWhitespace(s));)t.step();if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(i=i||e.recordBuilder(),125===s)return t.step(),_.done(i.bind());35===s?(t.step(),n=8):n=3}}if(3===n){for(r||(r=e.parseBlockExpr(t));r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())n=4;else if(r.isError())return r.asError()}if(4===n){for(;!t.isEmpty()&&(s=t.head(),_.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else 58===s?(t.step(),n=5):(i.push(e.item(r.bind())),r=void 0,n=7)}if(5===n){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();if(t.isEmpty()){if(t.isDone())return i.push(e.slot(r.bind())),_.done(i.bind())}else n=6}if(6===n){for(o||(o=e.parseBlockExpr(t));o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone())i.push(e.slot(r.bind(),o.bind())),o=r=void 0,n=7;else if(o.isError())return o.asError()}if(7===n){for(;!t.isEmpty()&&(s=t.head(),_.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(44===s||59===s||_.isNewline(s)){t.step(),n=2;continue}if(35!==s)return 125===s?(t.step(),_.done(i.bind())):_.expected('"}", ";", ",", or newline',t);t.step(),n=8}}if(8===n){for(;!t.isEmpty();){if(s=t.head(),_.isNewline(s)){n=2;continue t}t.step()}if(t.isDone()){n=2;continue}}break}return new a(e,i,r,o,n)},a}(_),Ie=function(s){function a(t,e,i,r,o){var n=s.call(this)||this;return n.recon=t,n.builder=e,n.textOutput=i,n.valueParser=r,n.step=o,n}return v(a,s),a.prototype.feed=function(t){return a.parse(t,this.recon,this.builder,this.textOutput,this.valueParser,this.step)},a.parse=function(t,e,i,r,o,n){void 0===n&&(n=1);var s=0;if(1===n)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(91!==(s=t.head()))return _.expected("[",t);t.step(),n=2}for(;;){if(2===n){for(;!t.isEmpty()&&(64!==(s=t.head())&&91!==s&&92!==s&&93!==s&&123!==s&&125!==s);)t.step(),(r=r||e.textOutput()).push(s);if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(93===s)return t.step(),i=i||e.recordBuilder(),r&&i.push(e.item(r.bind())),_.done(i.bind());if(64===s)i=i||e.recordBuilder(),r&&(i.push(e.item(r.bind())),r=void 0),o=e.parseInlineValue(t),n=3;else if(123===s)i=i||e.recordBuilder(),r&&(i.push(e.item(r.bind())),r=void 0),o=e.parseRecord(t,i),n=4;else if(91===s)i=i||e.recordBuilder(),r&&(i.push(e.item(r.bind())),r=void 0),o=e.parseMarkup(t,i),n=4;else{if(92!==s)return _.unexpected(t);t.step(),n=5}}}if(3===n){for(o=o;o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone()){i.push(e.item(o.bind())),o=void 0,n=2;continue}if(o.isError())return o.asError()}if(4===n){for(o=o;o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone()){o=void 0,n=2;continue}if(o.isError())return o.asError()}if(5===n){if(!t.isEmpty()){if(s=t.head(),r=r||e.textOutput(),34===s||36===s||39===s||47===s||64===s||91===s||92===s||93===s||123===s||125===s)t.step(),r.push(s),n=2;else if(98===s)t.step(),r.push(8),n=2;else if(102===s)t.step(),r.push(12),n=2;else if(110===s)t.step(),r.push(10),n=2;else if(114===s)t.step(),r.push(13),n=2;else{if(116!==s)return _.expected("escape character",t);t.step(),r.push(9),n=2}continue}if(t.isDone())return _.unexpected(t)}break}return new a(e,i,r,o,n)},a}(_),ze=function(a){function u(t,e,i,r,o,n){var s=a.call(this)||this;return s.recon=t,s.dataOutput=e,s.p=i,s.q=r,s.r=o,s.step=n,s}return v(u,a),u.prototype.feed=function(t){return u.parse(t,this.recon,this.dataOutput,this.p,this.q,this.r,this.step)},u.parse=function(t,e,i,r,o,n,s){void 0===r&&(r=0),void 0===o&&(o=0),void 0===n&&(n=0),void 0===s&&(s=1);var a=0;if(1===s)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(37!==(a=t.head()))return _.expected("%",t);t.step(),i=i||e.dataOutput(),s=2}for(;;){if(2===s)if(t.isEmpty()){if(t.isDone())return _.done(i.bind())}else{if(a=t.head(),!_.isBase64Char(a))return _.done(i.bind());t.step(),r=a,s=3}if(3===s)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(a=t.head(),!_.isBase64Char(a))return _.expected("base64 digit",t);t.step(),o=a,s=4}if(4===s)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(a=t.head(),!_.isBase64Char(a)&&61!==a)return _.expected("base64 digit",t);t.step(),s=61!==(n=a)?5:6}if(5===s){if(!t.isEmpty()){if(a=t.head(),_.isBase64Char(a)||61===a){if(t.step(),u.decodeBase64Quantum(r,o,n,a,i),r=o=n=0,61!==a){s=2;continue}return _.done(i.bind())}return _.expected("base64 digit",t)}if(t.isDone())return _.unexpected(t)}else if(6===s){if(!t.isEmpty())return 61===(a=t.head())?(t.step(),u.decodeBase64Quantum(r,o,n,a,i),r=o=n=0,_.done(i.bind())):_.expected("=",t);if(t.isDone())return _.unexpected(t)}break}return new u(e,i,r,o,n,s)},u.parseBase64=function(t,e){return u.parse(t,e,e.dataOutput(),void 0,void 0,void 0,2)},u.decodeBase64Quantum=function(t,e,i,r,o){var n=_.decodeBase64Digit(t),s=_.decodeBase64Digit(e);if(61!==i){var a=_.decodeBase64Digit(i);if(61!==r){var u=_.decodeBase64Digit(r);o.push(n<<2|s>>>4,s<<4|a>>>2,a<<6|u)}else o.push(n<<2|s>>>4,s<<4|a>>>2)}else{if(61!==r)throw"incomplete base64 quantum";o.push(n<<2|s>>>4)}},u}(_),Ue=function(o){function n(t,e,i){var r=o.call(this)||this;return r.lang=t,r.output=e,r.step=i,r}return v(n,o),n.prototype.feed=function(t){return n.parse(t,this.lang,this.output,this.step)},n.parse=function(t,e,i,r){void 0===r&&(r=1);var o=0;if(1===r)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(o=t.head(),!ri.isIdentStartChar(o))return _.expected("identifier",t);t.step(),(i=i||e.textOutput()).push(o),r=2}if(2===r){for(;!t.isEmpty()&&(o=t.head(),ri.isIdentChar(o));)t.step(),i.push(o);if(!t.isEmpty()||t.isDone())return _.done(e.ident(i.bind()))}return new n(e,i,r)},n}(_),Oe=function(s){function a(t,e,i,r,o){var n=s.call(this)||this;return n.lang=t,n.output=e,n.quote=i,n.code=r,n.step=o,n}return v(a,s),a.prototype.feed=function(t){return a.parse(t,this.lang,this.output,this.quote,this.code,this.step)},a.parse=function(t,e,i,r,o,n){void 0===r&&(r=0),void 0===o&&(o=0),void 0===n&&(n=1);var s=0;if(1===n){for(;!t.isEmpty()&&(s=t.head(),_.isWhitespace(s));)t.step();if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(34!==s&&(39!==s||r!==s&&0!==r))return _.expected("string",t);t.step(),i=i||e.textOutput(),r=s,n=2}}t:for(;;){if(i=i,2===n){for(;!t.isEmpty()&&((s=t.head())!==r&&92!==s);)t.step(),i.push(s);if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(s===r)return t.step(),_.done(i.bind());if(92!==s)return _.unexpected(t);t.step(),n=3}}if(3===n)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(34===(s=t.head())||36===s||39===s||47===s||64===s||91===s||92===s||93===s||123===s||125===s){t.step(),i.push(s),n=2;continue}if(98===s){t.step(),i.push(8),n=2;continue}if(102===s){t.step(),i.push(12),n=2;continue}if(110===s){t.step(),i.push(10),n=2;continue}if(114===s){t.step(),i.push(13),n=2;continue}if(116===s){t.step(),i.push(9),n=2;continue}if(117!==s)return _.expected("escape character",t);t.step(),n=4}if(4<=n)for(;;){if(!t.isEmpty()){if(s=t.head(),_.isHexChar(s)){if(t.step(),o=16*o+_.decodeHexChar(s),n<=6){n+=1;continue}i.push(o),o=0,n=2;continue t}return _.expected("hex digit",t)}if(t.isDone())return _.unexpected(t);break}break}return new a(e,i,r,o,n)},a}(_),We=function(s){function u(t,e,i,r,o){var n=s.call(this)||this;return n.lang=t,n.sign=e,n.value=i,n.mode=r,n.step=o,n}return v(u,s),u.prototype.feed=function(t){return u.parse(t,this.lang,this.sign,this.value,this.mode,this.step)},u.parse=function(t,e,i,r,o,n){void 0===i&&(i=1),void 0===r&&(r=0),void 0===o&&(o=2),void 0===n&&(n=1);var s=0;if(1===n){for(;!t.isEmpty()&&(s=t.head(),_.isWhitespace(s));)t.step();if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else 45===s&&(t.step(),i=-1),n=2}if(2===n)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else if(48===(s=t.head()))t.step(),n=4;else{if(!(49<=s&&s<=57))return _.expected("digit",t);t.step(),r=i*(s-48),n=3}if(3===n){for(;!t.isEmpty()&&(48<=(s=t.head())&&s<=57);)t.step(),r=10*r+i*(s-48);if(t.isEmpty()){if(t.isDone())return _.done(e.number(r))}else n=4}if(4===n){if(!t.isEmpty()){if(s=t.head(),0<o&&(46===s||69===s||101===s)){var a=new g;return i<0&&0===r?a.push(45,48):a.push(r.toString()),Be.parse(t,e,a,o)}return 120===s&&0<i&&0===r?(t.step(),qe.parse(t,e)):_.done(e.number(r))}if(t.isDone())return _.done(e.number(r))}return new u(e,i,r,o,n)},u.parseInteger=function(t,e){return this.parse(t,e,void 0,void 0,0)},u.parseDecimal=function(t,e){return this.parse(t,e,void 0,void 0,1)},u}(_),Be=function(n){function s(t,e,i,r){var o=n.call(this)||this;return o.lang=t,o.output=e,o.mode=i,o.step=r,o}return v(s,n),s.prototype.feed=function(t){return s.parse(t,this.lang,this.output,this.mode,this.step)},s.parse=function(t,e,i,r,o){void 0===r&&(r=2),void 0===o&&(o=1);var n=0;if(1===o)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else if(46===(n=t.head()))t.step(),i.push(n),o=2;else{if(!(1<r)||69!==n&&101!==n)return _.expected("fraction or exponent",t);t.step(),i.push(n),o=5}if(2===o)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(!(48<=(n=t.head())&&n<=57))return _.expected("digit",t);t.step(),i.push(n),o=3}if(3===o){for(;!t.isEmpty()&&(48<=(n=t.head())&&n<=57);)t.step(),i.push(n);if(t.isEmpty()){if(t.isDone())return _.done(e.number(i.bind()))}else{if(!(1<r))return _.done(e.number(i.bind()));o=4}}if(4===o){if(69!==(n=t.head())&&101!==n)return _.done(e.number(i.bind()));t.step(),i.push(n),o=5}if(5===o)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else 43!==(n=t.head())&&45!==n||(t.step(),i.push(n)),o=6;if(6===o)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(!(48<=(n=t.head())&&n<=57))return _.expected("digit",t);t.step(),i.push(n),o=7}if(7===o){for(;!t.isEmpty()&&(48<=(n=t.head())&&n<=57);)t.step(),i.push(n);if(!t.isEmpty()||t.isDone())return _.done(e.number(i.bind()))}return new s(e,i,r,o)},s}(_),qe=function(o){function n(t,e,i){var r=o.call(this)||this;return r.lang=t,r.value=e,r.size=i,r}return v(n,o),n.prototype.feed=function(t){return n.parse(t,this.lang,this.value,this.size)},n.parse=function(t,e,i,r){void 0===i&&(i=0),void 0===r&&(r=0);for(var o=0;!t.isEmpty()&&(o=t.head(),_.isHexChar(o));)t.step(),i=16*i+_.decodeHexChar(o),r+=1;return!t.isEmpty()||t.isDone()?0<r?_.done(e.number(i)):_.expected("hex number",t):new n(e,i,r)},n}(_),Ge=function(s){function a(t,e,i,r,o){var n=s.call(this)||this;return n.recon=t,n.builder=e,n.selector=i,n.valueParser=r,n.step=o,n}return v(a,s),a.prototype.feed=function(t){return a.parse(t,this.recon,this.builder,this.selector,this.valueParser,this.step)},a.parse=function(t,e,i,r,o,n){void 0===r&&(r=e.selector()),void 0===n&&(n=1);var s=0;if(1===n){for(;!t.isEmpty()&&(s=t.head(),_.isSpace(s));)t.step();if(t.isEmpty()||36!==s){if(t.isDone())return _.unexpected(t)}else t.step(),n=2}if(2===n)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else 91===(s=t.head())?(t.step(),n=7):64===s?(t.step(),n=6):42===s?(t.step(),n=5):35===s?(t.step(),n=4):n=3;for(;;){if(3===n){for(o||(o=e.parseLiteral(t,e.valueBuilder()));o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone())r=e.get(r,o.bind()),o=void 0,n=9;else if(o.isError())return o.asError()}if(4===n){for(o||(o=e.parseInteger(t));o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone())r=e.value(e.getItem(r,o.bind())),o=void 0,n=9;else if(o.isError())return o.asError()}if(5===n&&(t.isEmpty()?t.isDone()&&(r=e.children(r),n=9):(58===(s=t.head())?(t.step(),r=e.keys(r)):42===s?(t.step(),r=e.descendants(r)):r=e.children(r),n=9)),6===n){for(o||(o=e.parseIdent(t));o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone())r=e.getAttr(r,o.bind()),o=void 0,n=9;else if(o.isError())return o.asError()}if(7===n){for(o||(o=e.parseBlockExpr(t));o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone())n=8;else if(o.isError())return o.asError()}if(8===n){for(;!t.isEmpty()&&(s=t.head(),_.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(93!==s)return _.expected("]",t);t.step(),r=e.filter(r,o.bind()),o=void 0,n=9}}if(9===n)if(t.isEmpty()){if(t.isDone())return i?(i.push(e.item(r)),_.done(i.bind())):_.done(r)}else{if(91===(s=t.head())){t.step(),n=7;continue}if(42===s){t.step(),n=5;continue}if(35===s){t.step(),n=4;continue}if(46!==s)return i?(i.push(e.item(r)),_.done(i.bind())):_.done(r);t.step(),n=10}if(10===n)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(64!==(s=t.head())){if(42===s){t.step(),n=5;continue}n=3;continue}t.step(),n=6}break}return new a(e,i,r,o,n)},a}(_),Ne=function(n){function s(t,e,i,r){var o=n.call(this)||this;return o.recon=t,o.builder=e,o.valueParser=i,o.step=r,o}return v(s,n),s.prototype.feed=function(t){return s.parse(t,this.recon,this.builder,this.valueParser,this.step)},s.parse=function(t,e,i,r,o){void 0===o&&(o=1);var n=0;if(1===o){for(;!t.isEmpty()&&(n=t.head(),_.isSpace(n));)t.step();if(t.isEmpty()){if(t.isDone())return i?_.done(i.bind()):_.done(e.extant())}else if(40===n)t.step(),o=5;else if(123===n)i=i||e.recordBuilder(),r=e.parseRecord(t,i),o=4;else if(91===n)i=i||e.recordBuilder(),r=e.parseMarkup(t,i),o=4;else if(ri.isIdentStartChar(n))r=e.parseIdent(t),o=2;else if(34===n||39===n)r=e.parseString(t),o=2;else if(45===n||48<=n&&n<=57)r=e.parseNumber(t),o=2;else if(37===n)r=e.parseData(t),o=2;else{if(36!==n)return i?_.done(i.bind()):_.done(e.extant());r=e.parseSelector(t),o=2}}if(2===o){for(r=r;r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())return(i=i||e.valueBuilder()).push(e.item(r.bind())),_.done(i.bind());if(r.isError())return r.asError()}if(4===o){for(r=r;r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())return _.done(i.bind());if(r.isError())return r.asError()}if(5===o){for(r||(r=e.parseBlockExpr(t));r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())o=6;else if(r.isError())return r.asError()}if(6===o){for(;!t.isEmpty()&&(n=t.head(),_.isSpace(n));)t.step();if(!t.isEmpty())return 41===n?(t.step(),(i=i||e.valueBuilder()).push(e.item(r.bind())),_.done(i.bind())):_.expected(")",t);if(t.isDone())return _.unexpected(t)}return new s(e,i,r,o)},s}(_),He=function(a){function p(t,e,i,r,o,n){var s=a.call(this)||this;return s.recon=t,s.builder=e,s.predParser=i,s.thenParser=r,s.elseParser=o,s.step=n,s}return v(p,a),p.prototype.feed=function(t){return p.parse(t,this.recon,this.builder,this.predParser,this.thenParser,this.elseParser,this.step)},p.parse=function(t,e,i,r,o,n,s){void 0===s&&(s=1);var a=0;if(1===s){for(r||(r=e.parseLorExpr(t,i));r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())s=2;else if(r.isError())return r.asError()}if(2===s){for(;!t.isEmpty()&&(a=t.head(),_.isSpace(a));)t.step();if(t.isEmpty()){if(t.isDone())return r}else{if(63!==a)return r;t.step(),s=3}}if(3===s){for(o||(o=e.parseCondExpr(t,i));o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone())s=4;else if(o.isError())return o.asError()}if(4===s){for(;!t.isEmpty()&&(a=t.head(),_.isSpace(a));)t.step();if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(58!==a)return _.expected(":",t);t.step(),s=5}}if(5===s){for(n||(n=e.parseCondExpr(t,i));n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone()){var u=r.bind(),h=o.bind(),l=n.bind();return _.done(e.cond(u,h,l))}if(n.isError())return n.asError()}return new p(e,i,r,o,n,s)},p}(_),je=function(s){function u(t,e,i,r,o){var n=s.call(this)||this;return n.recon=t,n.builder=e,n.lhsParser=i,n.rhsParser=r,n.step=o,n}return v(u,s),u.prototype.feed=function(t){return u.parse(t,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)},u.parse=function(t,e,i,r,o,n){void 0===n&&(n=1);for(;;){if(1===n){for(r||(r=e.parseLandExpr(t,i));r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())n=2;else if(r.isError())return r.asError()}if(2===n)if(t.isEmpty()){if(t.isDone())return r}else{if(124!==t.head())return r;t.step(),n=3}if(3===n){for(o||(o=e.parseLandExpr(t,i));o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone()){var s=r.bind(),a=o.bind();r=_.done(e.or(s,a)),o=void 0,n=2;continue}if(o.isError())return o.asError()}break}return new u(e,i,r,o,n)},u}(_),Ke=function(s){function u(t,e,i,r,o){var n=s.call(this)||this;return n.recon=t,n.builder=e,n.lhsParser=i,n.rhsParser=r,n.step=o,n}return v(u,s),u.prototype.feed=function(t){return u.parse(t,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)},u.parse=function(t,e,i,r,o,n){void 0===n&&(n=1);for(;;){if(1===n){for(r||(r=e.parseBorExpr(t,i));r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())n=2;else if(r.isError())return r.asError()}if(2===n)if(t.isEmpty()){if(t.isDone())return r}else{if(38!==t.head())return r;t.step(),n=3}if(3===n){for(o||(o=e.parseBorExpr(t,i));o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone()){var s=r.bind(),a=o.bind();r=_.done(e.and(s,a)),o=void 0,n=2;continue}if(o.isError())return o.asError()}break}return new u(e,i,r,o,n)},u}(_),Ye=function(s){function h(t,e,i,r,o){var n=s.call(this)||this;return n.recon=t,n.builder=e,n.lhsParser=i,n.rhsParser=r,n.step=o,n}return v(h,s),h.prototype.feed=function(t){return h.parse(t,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)},h.parse=function(t,e,i,r,o,n){void 0===n&&(n=1);for(var s=0;;){if(1===n){for(r||(r=e.parseBxorExpr(t,i));r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())n=2;else if(r.isError())return r.asError()}if(2===n){for(;!t.isEmpty()&&(s=t.head(),_.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return r}else{if(124!==s)return r;t.step(),n=3}}if(3===n)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(124===(s=t.head()))return r;n=4}if(4===n){for(o||(o=e.parseBxorExpr(t,i));o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone()){var a=r.bind(),u=o.bind();r=_.done(e.bor(a,u)),o=void 0,n=2;continue}if(o.isError())return o.asError()}break}return new h(e,i,r,o,n)},h}(_),Xe=function(s){function h(t,e,i,r,o){var n=s.call(this)||this;return n.recon=t,n.builder=e,n.lhsParser=i,n.rhsParser=r,n.step=o,n}return v(h,s),h.prototype.feed=function(t){return h.parse(t,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)},h.parse=function(t,e,i,r,o,n){void 0===n&&(n=1);for(var s=0;;){if(1===n){for(r||(r=e.parseBandExpr(t,i));r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())n=2;else if(r.isError())return r.asError()}if(2===n){for(;!t.isEmpty()&&(s=t.head(),_.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return r}else{if(94!==s)return r;t.step(),n=3}}if(3===n){for(o||(o=e.parseBandExpr(t,i));o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone()){var a=r.bind(),u=o.bind();r=_.done(e.bxor(a,u)),o=void 0,n=2;continue}if(o.isError())return o.asError()}break}return new h(e,i,r,o,n)},h}(_),Qe=function(s){function h(t,e,i,r,o){var n=s.call(this)||this;return n.recon=t,n.builder=e,n.lhsParser=i,n.rhsParser=r,n.step=o,n}return v(h,s),h.prototype.feed=function(t){return h.parse(t,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)},h.parse=function(t,e,i,r,o,n){void 0===n&&(n=1);for(var s=0;;){if(1===n){for(r||(r=e.parseCompExpr(t,i));r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())n=2;else if(r.isError())return r.asError()}if(2===n){for(;!t.isEmpty()&&(s=t.head(),_.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return r}else{if(38!==s)return r;t.step(),n=3}}if(3===n)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(38===(s=t.head()))return r;n=4}if(4===n){for(o||(o=e.parseCompExpr(t,i));o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone()){var a=r.bind(),u=o.bind();r=_.done(e.band(a,u)),o=void 0,n=2;continue}if(o.isError())return o.asError()}break}return new h(e,i,r,o,n)},h}(_),Ze=function(a){function l(t,e,i,r,o,n){var s=a.call(this)||this;return s.recon=t,s.builder=e,s.lhsParser=i,s.operator=r,s.rhsParser=o,s.step=n,s}return v(l,a),l.prototype.feed=function(t){return l.parse(t,this.recon,this.builder,this.lhsParser,this.operator,this.rhsParser,this.step)},l.parse=function(t,e,i,r,o,n,s){void 0===s&&(s=1);var a=0;if(1===s){for(r||(r=e.parseAttrExpr(t,i));r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())s=2;else if(r.isError())return r.asError()}if(2===s){for(;!t.isEmpty()&&(a=t.head(),_.isSpace(a));)t.step();if(t.isEmpty()){if(t.isDone())return r}else if(33===a)t.step(),s=3;else if(60===a)t.step(),s=4;else if(62===a)t.step(),s=5;else{if(61!==a)return r;t.step(),s=6}}if(3===s)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else 61===(a=t.head())?(t.step(),o="!="):o="!",s=7;if(4===s)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else 61===(a=t.head())?(t.step(),o="<="):o="<",s=7;if(5===s)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else 61===(a=t.head())?(t.step(),o=">="):o=">",s=7;if(6===s)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else 61===(a=t.head())?(t.step(),o="=="):o="=",s=7;if(7===s){for(n||(n=e.parseAttrExpr(t,i));n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone()){var u=r.bind(),h=n.bind();return"<"===o?_.done(e.lt(u,h)):"<="===o?_.done(e.le(u,h)):"=="===o?_.done(e.eq(u,h)):"!="===o?_.done(e.ne(u,h)):">="===o?_.done(e.ge(u,h)):">"===o?_.done(e.gt(u,h)):_.error(o)}if(n.isError())return n.asError()}return new l(e,i,r,o,n,s)},l}(_),Je=function(s){function a(t,e,i,r,o){var n=s.call(this)||this;return n.recon=t,n.builder=e,n.fieldParser=i,n.valueParser=r,n.step=o,n}return v(a,s),a.prototype.feed=function(t){return a.parse(t,this.recon,this.builder,this.fieldParser,this.valueParser,this.step)},a.parse=function(t,e,i,r,o,n){void 0===n&&(n=1);for(var s=0;;){if(1===n){for(;!t.isEmpty()&&(s=t.head(),_.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return i?_.done(i.bind()):_.done(e.extant())}else if(64===s)n=2;else if(123===s||91===s)i=i||e.recordBuilder(),n=5;else{if(!(33===s||34===s||36===s||37===s||39===s||40===s||43===s||45===s||48<=s&&s<=57||126===s||ri.isIdentStartChar(s)))return i?_.done(i.bind()):_.done(e.extant());n=4}}if(2===n){for(r||(r=e.parseAttr(t));r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())(i=i||e.valueBuilder()).push(r.bind()),r=void 0,n=3;else if(r.isError())return r.asError()}if(3===n){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();if(!t.isEmpty()){n=1;continue}if(t.isDone())return _.done(i.bind())}if(4===n){for(o||(o=e.parseAddRingExpr(t));o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone())(i=i||e.valueBuilder()).push(e.item(o.bind())),o=void 0,n=6;else if(o.isError())return o.asError()}if(5===n){for(o||(o=e.parseAddRingExpr(t,i));o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone())o=void 0,n=6;else if(o.isError())return o.asError()}if(6===n){for(;!t.isEmpty()&&(s=t.head(),_.isSpace(s));)t.step();if(!t.isEmpty()){if(64===s){n=1;continue}return _.done(i.bind())}if(t.isDone())return _.done(i.bind())}break}return new a(e,i,r,o,n)},a}(_),$e=function(a){function l(t,e,i,r,o,n){var s=a.call(this)||this;return s.recon=t,s.builder=e,s.lhsParser=i,s.operator=r,s.rhsParser=o,s.step=n,s}return v(l,a),l.prototype.feed=function(t){return l.parse(t,this.recon,this.builder,this.lhsParser,this.operator,this.rhsParser,this.step)},l.parse=function(t,e,i,r,o,n,s){void 0===s&&(s=1);for(var a=0;;){if(1===s){for(r||(r=e.parseMulRingExpr(t,i));r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())s=2;else if(r.isError())return r.asError()}if(2===s){for(;!t.isEmpty()&&(a=t.head(),_.isSpace(a));)t.step();if(t.isEmpty()){if(t.isDone())return r}else if(43===a)t.step(),o="+",s=3;else{if(45!==a)return r;t.step(),o="-",s=3}}if(3===s){for(n||(n=e.parseMulRingExpr(t,i));n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone()){var u=r.bind(),h=n.bind();if("+"===o)r=_.done(e.add(u,h));else{if("-"!==o)return _.error(o);r=_.done(e.sub(u,h))}o=n=void 0,s=2;continue}if(n.isError())return n.asError()}break}return new l(e,i,r,o,n,s)},l}(_),ti=function(a){function l(t,e,i,r,o,n){var s=a.call(this)||this;return s.recon=t,s.builder=e,s.lhsParser=i,s.operator=r,s.rhsParser=o,s.step=n,s}return v(l,a),l.prototype.feed=function(t){return l.parse(t,this.recon,this.builder,this.lhsParser,this.operator,this.rhsParser,this.step)},l.parse=function(t,e,i,r,o,n,s){void 0===s&&(s=1);for(var a=0;;){if(1===s){for(r||(r=e.parsePrefixExpr(t,i));r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())s=2;else if(r.isError())return r.asError()}if(2===s){for(;!t.isEmpty()&&(a=t.head(),_.isSpace(a));)t.step();if(t.isEmpty()){if(t.isDone())return r}else if(42===a)t.step(),o="*",s=3;else if(47===a)t.step(),o="/",s=3;else{if(37!==a)return r;t.step(),o="%",s=3}}if(3===s){for(n||(n=e.parsePrefixExpr(t,i));n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone()){var u=r.bind(),h=n.bind();if("*"===o)r=_.done(e.mul(u,h));else if("/"===o)r=_.done(e.div(u,h));else{if("%"!==o)return _.error(o);r=_.done(e.mod(u,h))}o=n=void 0,s=2;continue}if(n.isError())return n.asError()}break}return new l(e,i,r,o,n,s)},l}(_),ei=function(s){function u(t,e,i,r,o){var n=s.call(this)||this;return n.recon=t,n.builder=e,n.operator=i,n.rhsParser=r,n.step=o,n}return v(u,s),u.prototype.feed=function(t){return u.parse(t,this.recon,this.builder,this.operator,this.rhsParser,this.step)},u.parse=function(t,e,i,r,o,n){void 0===n&&(n=1);var s=0;if(1===n){for(;!t.isEmpty()&&(s=t.head(),_.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return e.parsePrimaryExpr(t,i)}else{if(33===s)t.step(),r="!";else if(126===s)t.step(),r="~";else if(45===s)t.step(),r="-";else{if(43!==s)return e.parsePrimaryExpr(t,i);t.step(),r="+"}n=2}}if(2===n){for(o||(o=e.parsePrefixExpr(t,i));o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone()){var a=o.bind();return e.isDistinct(a)?"!"===r?_.done(e.not(a)):"~"===r?_.done(e.bnot(a)):"-"===r?_.done(e.neg(a)):"+"===r?_.done(e.pos(a)):_.error(r):_.expected("value",t)}if(o.isError())return o.asError()}return new u(e,i,r,o,n)},u}(_),ii=function(s){function h(t,e,i,r,o){var n=s.call(this)||this;return n.recon=t,n.builder=e,n.exprParser=i,n.argsParser=r,n.step=o,n}return v(h,s),h.prototype.feed=function(t){return h.parse(t,this.recon,this.builder,this.exprParser,this.argsParser,this.step)},h.parse=function(t,e,i,r,o,n){void 0===n&&(n=1);var s=0;if(1===n){for(;!t.isEmpty()&&(s=t.head(),_.isSpace(s));)t.step();t.isEmpty()?t.isDone()&&(n=2):40===s?(t.step(),n=3):n=2}if(2===n){for(r||(r=e.parseLiteral(t,i));r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())n=5;else if(r.isError())return r.asError()}if(3===n){for(r||(r=e.parseBlockExpr(t));r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())n=4;else if(r.isError())return r.asError()}if(4===n){for(;!t.isEmpty()&&(s=t.head(),_.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(41!==s)return _.expected(")",t);t.step(),n=5}}for(;;){if(5===n){for(;!t.isEmpty()&&(s=t.head(),_.isSpace(s));)t.step();if(t.isEmpty()){if(t.isDone())return r}else{if(40!==s)return r;t.step(),n=6}}if(6===n){for(;!t.isEmpty()&&(s=t.head(),_.isWhitespace(s));)t.step();if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(41===s){t.step();var a=r.bind();r=_.done(e.invoke(a,e.extant())),n=5;continue}n=7}}if(7===n){for(o||(o=e.parseBlock(t));o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone())n=8;else if(o.isError())return o.asError()}if(8===n){for(;!t.isEmpty()&&(s=t.head(),_.isSpace(s));)t.step();if(!t.isEmpty()){if(41===s){t.step();a=r.bind();var u=o.bind();r=_.done(e.invoke(a,u)),o=void 0,n=5;continue}return _.expected(")",t)}if(t.isDone())return _.unexpected(t)}break}return new h(e,i,r,o,n)},h}(_),ri=function(){function t(){}return t.prototype.parseRecon=function(t){for("string"==typeof t&&(t=new m(t));!t.isEmpty()&&_.isWhitespace(t.head());)t.step();var e=this.parseBlock(t);if(e.isDone()){for(;!t.isEmpty()&&_.isWhitespace(t.head());)t.step();t.isEmpty()||(e=_.unexpected(t))}return e.bind()},t.prototype.parseAttr=function(t){return Re.parse(t,this)},t.prototype.parseBlock=function(t){return Pe.parse(t,this)},t.prototype.parseBlockValue=function(t){return Te.parse(t,this)},t.prototype.parseInlineValue=function(t){return Le.parse(t,this)},t.prototype.parseRecord=function(t,e){return Fe.parse(t,this,e)},t.prototype.parseMarkup=function(t,e){return Ie.parse(t,this,e)},t.prototype.parseData=function(t){return ze.parse(t,this)},t.prototype.parseBase64=function(t){return ze.parseBase64(t,this)},t.prototype.parseIdent=function(t){return Ue.parse(t,this)},t.prototype.parseString=function(t){return Oe.parse(t,this)},t.prototype.parseNumber=function(t){return We.parse(t,this)},t.prototype.parseInteger=function(t){return We.parseInteger(t,this)},t.prototype.parseDecimal=function(t){return We.parseDecimal(t,this)},t.prototype.parseBlockExpr=function(t,e){return this.parseCondExpr(t,e)},t.prototype.parseCondExpr=function(t,e){return He.parse(t,this,e)},t.prototype.parseLorExpr=function(t,e){return je.parse(t,this,e)},t.prototype.parseLandExpr=function(t,e){return Ke.parse(t,this,e)},t.prototype.parseBorExpr=function(t,e){return Ye.parse(t,this,e)},t.prototype.parseBxorExpr=function(t,e){return Xe.parse(t,this,e)},t.prototype.parseBandExpr=function(t,e){return Qe.parse(t,this,e)},t.prototype.parseCompExpr=function(t,e){return Ze.parse(t,this,e)},t.prototype.parseAttrExpr=function(t,e){return Je.parse(t,this,e)},t.prototype.parseAddRingExpr=function(t,e){return $e.parse(t,this,e)},t.prototype.parseMulRingExpr=function(t,e){return ti.parse(t,this,e)},t.prototype.parsePrefixExpr=function(t,e){return ei.parse(t,this,e)},t.prototype.parsePrimaryExpr=function(t,e){return ii.parse(t,this,e)},t.prototype.parseLiteral=function(t,e){return Ne.parse(t,this,e)},t.prototype.parseSelector=function(t,e){return Ge.parse(t,this,e)},t.prototype.blockParser=function(){return new Pe(this)},t.isIdentStartChar=function(t){return 65<=t&&t<=90||95===t||97<=t&&t<=122||192<=t&&t<=214||216<=t&&t<=246||248<=t&&t<=767||880<=t&&t<=893||895<=t&&t<=8191||8204<=t&&t<=8205||8304<=t&&t<=8591||11264<=t&&t<=12271||12289<=t&&t<=55295||63744<=t&&t<=64975||65008<=t&&t<=65533||65536<=t&&t<=983039},t.isIdentChar=function(t){return 45===t||48<=t&&t<=57||65<=t&&t<=90||95===t||97<=t&&t<=122||183===t||192<=t&&t<=214||216<=t&&t<=246||248<=t&&t<=893||895<=t&&t<=8191||8204<=t&&t<=8205||8255<=t&&t<=8256||8304<=t&&t<=8591||11264<=t&&t<=12271||12289<=t&&t<=55295||63744<=t&&t<=64975||65008<=t&&t<=65533||65536<=t&&t<=983039},t.Factory=void 0,t}(),oi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.isDistinct=function(t){return t.isDistinct()},e.prototype.item=function(t){return t},e.prototype.value=function(t){return t.toValue()},e.prototype.attr=function(t,e){return new P(t,e)},e.prototype.slot=function(t,e){return new R(t,e)},e.prototype.valueBuilder=function(){return new Me},e.prototype.recordBuilder=function(){return F.empty()},e.prototype.dataOutput=function(){return A.empty()},e.prototype.textOutput=function(){return O.empty()},e.prototype.ident=function(t){if(t instanceof O){if("true"===t.value)return z.True;if("false"===t.value)return z.False}return t},e.prototype.number=function(t){if("number"==typeof t)return W.valueOf(t);if("string"==typeof t)return W.valueOf(+t);throw new TypeError(""+t)},e.prototype.boolean=function(t){return z.valueOf(t)},e.prototype.selector=function(){return q.Identity},e.prototype.extant=function(){return w.Extant},e.prototype.absent=function(){return w.Absent},e.prototype.cond=function(t,e,i){return t.cond(e,i)},e.prototype.or=function(t,e){return t.or(e)},e.prototype.and=function(t,e){return t.and(e)},e.prototype.bor=function(t,e){return t.bor(e)},e.prototype.bxor=function(t,e){return t.bxor(e)},e.prototype.band=function(t,e){return t.band(e)},e.prototype.lt=function(t,e){return t.lt(e)},e.prototype.le=function(t,e){return t.le(e)},e.prototype.eq=function(t,e){return t.eq(e)},e.prototype.ne=function(t,e){return t.ne(e)},e.prototype.ge=function(t,e){return t.ge(e)},e.prototype.gt=function(t,e){return t.gt(e)},e.prototype.add=function(t,e){return t.plus(e)},e.prototype.sub=function(t,e){return t.minus(e)},e.prototype.mul=function(t,e){return t.times(e)},e.prototype.div=function(t,e){return t.divide(e)},e.prototype.mod=function(t,e){return t.modulo(e)},e.prototype.not=function(t){return t.not()},e.prototype.bnot=function(t){return t.bnot()},e.prototype.neg=function(t){return t.neg()},e.prototype.pos=function(t){return t.pos()},e.prototype.invoke=function(t,e){return q.literal(t).invoke(e)},e.prototype.get=function(t,e){return t.get(e)},e.prototype.getAttr=function(t,e){return t.getAttr(O.of(e))},e.prototype.getItem=function(t,e){return t.getItem(W.of(e))},e.prototype.children=function(t){return q.literal(t).children()},e.prototype.descendants=function(t){return q.literal(t).descendants()},e.prototype.keys=function(t){return q.literal(t).keys()},e.prototype.filter=function(t,e){return t.filter(e)},e}(b.Recon=ri);ri.Factory=new oi;var ni=function(i){function t(t){void 0===t&&(t=F.empty());var e=i.call(this)||this;return e._record=t,e}return v(t,i),Object.defineProperty(t.prototype,"record",{get:function(){return this._record},set:function(t){(this._record=t).forEach(function(t,e){this.didChange(t,b.Absent,e)},this)},enumerable:!0,configurable:!0}),t.prototype.isEmpty=function(){var t;return this._record.isEmpty()&&(!(t=this.parentScope)||t.isEmpty())},t.prototype.isArray=function(){var t;return this._record.isArray()&&(!(t=this.parentScope)||t.isArray())},t.prototype.isObject=function(){var t;return this._record.isObject()&&(!(t=this.parentScope)||t.isObject())},Object.defineProperty(t.prototype,"length",{get:function(){var t;return this._record.length+((t=this.parentScope)?t.length:0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){var t;return this._record.size+((t=this.parentScope)?t.size:0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fieldCount",{get:function(){var t;return this._record.fieldCount+((t=this.parentScope)?t.fieldCount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valueCount",{get:function(){var t;return this._record.valueCount+((t=this.parentScope)?t.valueCount:0)},enumerable:!0,configurable:!0}),t.prototype.has=function(t){var e;return t=w.of(t),this._record.has(t)||!!(e=this.parentScope)&&e.has(t)},t.prototype.get=function(t){t=w.of(t);var e,i=this._record.get(t);return!i.isDefined()&&(e=this.parentScope)&&(i=e.get(t)),i},t.prototype.getAttr=function(t){t=O.of(t);var e,i=this._record.getAttr(t);return!i.isDefined()&&(e=this.parentScope)&&(i=e.getAttr(t)),i},t.prototype.getField=function(t){t=w.of(t);var e,i=this._record.getField(t);return void 0===i&&(e=this.parentScope)&&(i=e.getField(t)),i},t.prototype.getItem=function(t){t instanceof W&&(t=t.value),t<0&&(t=this.length+t),t=Math.max(0,t);var e,i=this._record.length;return t<i?this._record.getItem(t):(e=this.parentScope)&&t<i+e.length?e.getItem(t-i):b.Absent},t.prototype.set=function(t,e){var i,r=this._record.getField(t);if(void 0!==r){this._record.set(t,e);var o=this._record.getField(t);this.didChange(o,r)}else if((i=this.parentScope)&&i.get(t).isDefined())i.set(t,e);else{this._record.set(t,e);o=this._record.getField(t);this.didChange(o,b.Absent)}return this},t.prototype.setAttr=function(t,e){var i,r=this._record.getField(t);if(void 0!==r&&r instanceof P){this._record.set(t,e);var o=this._record.getField(t);this.didChange(o,r)}else if((i=this.parentScope)&&i.getAttr(t).isDefined())i.set(t,e);else{this._record.set(t,e);o=this._record.getField(t);this.didChange(o,b.Absent)}return this},t.prototype.setItem=function(t,e){t instanceof W&&(t=t.value),t<0&&(t=this.length+t),t=Math.max(0,t);var i,r=this._record.length;if(t<r){var o=this._record.getItem(t);this._record.setItem(t,e);var n=this._record.getItem(t);this.didChange(n,o,t)}else(i=this.parentScope)&&t<r+i.length&&i.setItem(t-r,e);return this},t.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=this._record.length,r=this._record.push.apply(this._record,arguments);i<r;){var o=this._record.get(i);this.didChange(o,b.Absent,i),i+=1}return r},t.prototype.splice=function(t,e){void 0===e&&(e=0);for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];t<0&&(t=this.length+t),t=Math.max(0,t);var o,n,s=this._record.length;if(e=Math.max(0,e),t<s){o=this._record.splice.apply(this._record,arguments);for(var a=0;a<o.length;a+=1)this.didChange(b.Absent,o[a],t+a);for(a=t;a<t+i.length;a+=1)this.didChange(this._record.get(a),b.Absent,a);if(s<t+e&&(n=this.parentScope)){var u=n.splice(s,t+e-s);o.push.apply(o,u)}}else(n=this.parentScope)&&(o=n.splice.apply(n,[t-s,e].concat(i)));return o},t.prototype.delete=function(t){var e,i=this._record.delete(t);return i.isDefined()?this.didChange(b.Absent,i):(e=this.parentScope)&&(i=e.delete(t)),i},t.prototype.clear=function(){var t=this._record.branch();this._record.clear(),t.forEach(function(t,e){this.didChange(b.Absent,t,e)},this);var e=this.parentScope;e&&e.clear()},t.prototype.withField=function(t,e){var i,r=this._record.getField(t);if(void 0!==r){this._record=this._record.withField(t,e);var o=this._record.getField(t);this.didChange(o,r)}else if((i=this.parentScope)&&i.has(t))i.set(t,e);else{this._record=this._record.withField(t,e);o=this._record.getField(t);this.didChange(o,b.Absent)}return this},t.prototype.withAttr=function(t,e){var i,r=this._record.getField(t);if(void 0!==r){this._record=this._record.withAttr(t,e);var o=this._record.getField(t);this.didChange(o,r)}else if((i=this.parentScope)&&i.has(t))i.set(t,e);else{this._record=this._record.withAttr(t,e);o=this._record.getField(t);this.didChange(o,b.Absent)}return this},t.prototype.withSlot=function(t,e){var i,r=this._record.getField(t);if(void 0!==r){this._record=this._record.withSlot(t,e);var o=this._record.getField(t);this.didChange(o,r)}else if((i=this.parentScope)&&i.has(t))i.set(t,e);else{this._record=this._record.withSlot(t,e);o=this._record.getField(t);this.didChange(o,b.Absent)}return this},t.prototype.forEach=function(t,e){var i=this._record.forEach(t,e);if(void 0===i){var r=this.parentScope;r&&(i=r.forEach(t,e))}return i},t.prototype.indexOf=function(t,e){void 0===e&&(e=0),e<0&&(e=this.length+e),e=Math.max(0,e);var i,r=this._record.length,o=-1;return e<r?(this._record.indexOf(t,e),e=0):e-=r,o<0&&(i=this.parentScope)&&0<=(o=i.indexOf(t,e))&&(o+=r),o},t.prototype.lastIndexOf=function(t,e){void 0===e&&(e=0),e<0&&(e=this.length+e),e=Math.max(0,e);var i,r=this._record.length,o=-1;return r<=e&&(i=this.parentScope)&&0<=(o=i.lastIndexOf(t,e-r))&&(o+=r),o<0&&(o=this._record.lastIndexOf(t,e)),o},t.prototype.isAliased=function(){return this._record.isAliased()},t.prototype.isMutable=function(){return this._record.isMutable()},t.prototype.alias=function(){this._record.alias();var t=this.parentScope;t&&t.alias()},t.prototype.branch=function(){return this._record=this._record.branch(),this},t.prototype.commit=function(){this._record.commit();var t=this.parentScope;return t&&t.commit(),this},t.prototype.didChange=function(t,e,i){},t.prototype.stack=function(){return D.of(b.GlobalScope,this)},t}(F),si=function(){function i(t){void 0===t&&(t=ai.Empty),this.root=t}return Object.defineProperty(i.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),i.prototype.isEmpty=function(){return this.root.isEmpty()},i.prototype.has=function(t){return this.root.has(t,this)},i.prototype.get=function(t){return this.root.get(t,this)},i.prototype.getEntry=function(t){return this.root.getEntry(t)},i.prototype.firstKey=function(){var t=this.root.firstEntry();return t?t[0]:void 0},i.prototype.firstValue=function(){var t=this.root.firstEntry();return t?t[1]:void 0},i.prototype.firstEntry=function(){return this.root.firstEntry()},i.prototype.lastKey=function(){var t=this.root.lastEntry();return t?t[0]:void 0},i.prototype.lastValue=function(){var t=this.root.lastEntry();return t?t[1]:void 0},i.prototype.lastEntry=function(){return this.root.lastEntry()},i.prototype.nextKey=function(t){var e=this.root.nextEntry(t,this);return e?e[0]:void 0},i.prototype.nextValue=function(t){var e=this.root.nextEntry(t,this);return e?e[1]:void 0},i.prototype.nextEntry=function(t){return this.root.nextEntry(t,this)},i.prototype.previousKey=function(t){var e=this.root.previousEntry(t,this);return e?e[0]:void 0},i.prototype.previousValue=function(t){var e=this.root.previousEntry(t,this);return e?e[1]:void 0},i.prototype.previousEntry=function(t){return this.root.previousEntry(t,this)},i.prototype.set=function(t,e){var i=this.root,r=this.root.updated(t,e,this);return i!==r&&(r.size>i.size&&(r=r.balanced(this)),this.root=r),this},i.prototype.delete=function(t){var e=this.root,i=this.root.removed(t,this);return e!==i&&(this.root=i,!0)},i.prototype.drop=function(t){return 0<t&&0<this.root.size&&(t<this.root.size?this.root=this.root.drop(t,this):this.root=ai.Empty),this},i.prototype.take=function(t){return t<this.root.size&&0<this.root.size&&(this.root=0<t?this.root.take(t,this):ai.Empty),this},i.prototype.clear=function(){this.root=ai.Empty},i.prototype.updated=function(t,e){var i=this.root,r=i.updated(t,e,this);return i!==r?(r.size>i.size&&(r=r.balanced(this)),this.copy(r)):this},i.prototype.removed=function(t){var e=this.root,i=e.removed(t,this);return e!==i?this.copy(i):this},i.prototype.cleared=function(){return this.root.isEmpty()?this:this.copy(ai.Empty)},i.prototype.forEach=function(t,e){return this.root.forEach(t,e,this)},i.prototype.keys=function(){return this.root.keys()},i.prototype.values=function(){return this.root.values()},i.prototype.entries=function(){return this.root.entries()},i.prototype.reverseKeys=function(){return this.root.reverseKeys()},i.prototype.reverseValues=function(){return this.root.reverseValues()},i.prototype.reverseEntries=function(){return this.root.reverseEntries()},i.prototype.clone=function(){return this.copy(this.root)},i.prototype.copy=function(t){var e=new i(t);return e.compare!==this.compare&&(e.compare=this.compare),e.pageSplitSize!==this.pageSplitSize&&(e.pageSplitSize=this.pageSplitSize),e},i.prototype.toValue=function(){return this.root.toValue()},i.prototype.toRecon=function(){return this.toValue().toRecon()},i.prototype.compare=function(t,e){return V(t,e)},i.prototype.pageShouldSplit=function(t){return t.arity>this.pageSplitSize},i.prototype.pageShouldMerge=function(t){return t.arity<this.pageSplitSize>>>1},i}();si.prototype.pageSplitSize=32;var ai=function(){function t(){}return t.prototype.keys=function(){return new h(this.entries())},t.prototype.values=function(){return new c(this.entries())},t.prototype.reverseKeys=function(){return new h(this.reverseEntries())},t.prototype.reverseValues=function(){return new c(this.reverseEntries())},t.prototype.toRecon=function(){return this.toValue().toRecon()},t.Empty=void 0,t}(),ui=function(i){function s(t){var e=i.call(this)||this;return e.slots=t,e}return v(s,i),Object.defineProperty(s.prototype,"arity",{get:function(){return this.slots.length},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"size",{get:function(){return this.slots.length},enumerable:!0,configurable:!0}),s.prototype.isEmpty=function(){return 0===this.slots.length},s.prototype.minKey=function(){return this.slots[0][0]},s.prototype.maxKey=function(){return this.slots[this.slots.length-1][0]},s.prototype.has=function(t,e){return 0<=this.lookup(t,e)},s.prototype.get=function(t,e){var i=this.lookup(t,e);return 0<=i?this.slots[i][1]:void 0},s.prototype.getEntry=function(t){return this.slots[t]},s.prototype.firstEntry=function(){return this.slots.length?this.slots[0]:void 0},s.prototype.lastEntry=function(){return this.slots.length?this.slots[this.slots.length-1]:void 0},s.prototype.nextEntry=function(t,e){var i=this.lookup(t,e);return 0<=i?i+=1:i=-(i+1),this.slots[i]},s.prototype.previousEntry=function(t,e){var i=this.lookup(t,e);return 0<=i?i-=1:i=-(i+2),this.slots[i]},s.prototype.updated=function(t,e,i){var r=this.lookup(t,i);return 0<=r?this.updatedSlot(r,t,e):(r=-(r+1),this.insertedSlot(r,t,e))},s.prototype.updatedSlot=function(t,e,i){var r=this.slots;if(i!==r[t][1]){var o=r.slice(0);return o[t]=[e,i],new s(o)}return this},s.prototype.insertedSlot=function(t,e,i){for(var r=this.slots,o=new Array(r.length+1),n=0;n<t;n+=1)o[n]=r[n];o[t]=[e,i];for(n=t;n<r.length;n+=1)o[n+1]=r[n];return new s(o)},s.prototype.removed=function(t,e){var i=this.lookup(t,e);return 0<=i?1<this.slots.length?this.removedSlot(i):ai.Empty:this},s.prototype.removedSlot=function(t){for(var e=this.slots,i=new Array(e.length-1),r=0;r<t;r+=1)i[r]=e[r];for(r=t;r<i.length;r+=1)i[r]=e[r+1];return new s(i)},s.prototype.drop=function(t,e){var i=this.slots;if(0<t&&0<i.length){if(t<i.length){for(var r=i.length-t,o=new Array(r),n=0;n<r;n+=1)o[n]=i[n+t];return new s(o)}return ai.Empty}return this},s.prototype.take=function(t,e){var i=this.slots;if(t<i.length&&0<i.length){if(0<t){for(var r=new Array(t),o=0;o<t;o+=1)r[o]=i[o];return new s(r)}return ai.Empty}return this},s.prototype.balanced=function(t){var e=this.slots.length;return 1<e&&t.pageShouldSplit(this)?this.split(e>>>1):this},s.prototype.split=function(t){var e=new Array(2),i=this.splitLeft(t),r=this.splitRight(t);e[0]=i,e[1]=r;var o=new Array(1);return o[0]=r.minKey(),new hi(e,o,this.slots.length)},s.prototype.splitLeft=function(t){for(var e=this.slots,i=new Array(t),r=0;r<t;r+=1)i[r]=e[r];return new s(i)},s.prototype.splitRight=function(t){for(var e=this.slots,i=e.length-t,r=new Array(i),o=0;o<i;o+=1)r[o]=e[o+t];return new s(r)},s.prototype.forEach=function(t,e,i){for(var r=0;r<this.slots.length;r+=1){var o=this.slots[r],n=t.call(e,o[0],o[1],i);if(void 0!==n)return n}},s.prototype.entries=function(){return new d(this.slots)},s.prototype.reverseEntries=function(){return new d(this.slots,this.slots.length)},s.prototype.toValue=function(){var t=F.empty(1+this.slots.length);t.attr("bleaf",F.empty(1).slot("size",this.slots.length));for(var e=0;e<this.slots.length;e+=1){var i=this.slots[e];t.slot(w.fromAny(i[0]),w.fromAny(i[1]))}return t},s.prototype.lookup=function(t,e){for(var i=0,r=this.slots.length-1;i<=r;){var o=i+r>>>1,n=e.compare(t,this.slots[o][0]);if(0<n)i=o+1;else{if(!(n<0))return o;r=o-1}}return-(i+1)},s}(ai);ai.Empty=new ui([]);var hi=function(o){function d(t,e,i){var r=o.call(this)||this;return r.pages=t,r.knots=e,r.size=i,r}return v(d,o),Object.defineProperty(d.prototype,"arity",{get:function(){return this.pages.length},enumerable:!0,configurable:!0}),d.prototype.isEmpty=function(){return 0===this.size},d.prototype.minKey=function(){return this.pages[0].minKey()},d.prototype.maxKey=function(){return this.pages[this.pages.length-1].maxKey()},d.prototype.has=function(t,e){var i=this.lookup(t,e);if(0<i)i+=1;else{if(!(i<0))return!0;i=-(i+1)}return this.pages[i].has(t,e)},d.prototype.get=function(t,e){var i=this.lookup(t,e);return 0<=i?i+=1:i=-(i+1),this.pages[i].get(t,e)},d.prototype.getEntry=function(t){for(var e=0;e<this.pages.length;e+=1){var i=this.pages[e];if(t<i.size)return i.getEntry(t);t-=i.size}},d.prototype.firstEntry=function(){return this.pages.length?this.pages[0].firstEntry():void 0},d.prototype.lastEntry=function(){return this.pages.length?this.pages[this.pages.length-1].lastEntry():void 0},d.prototype.nextEntry=function(t,e){var i=this.lookup(t,e);0<=i?i+=1:i=-(i+1);var r=this.pages[i].nextEntry(t,e);return void 0===r&&i+1<this.pages.length&&(r=this.pages[i+1].nextEntry(t,e)),r},d.prototype.previousEntry=function(t,e){var i=this.lookup(t,e);0<=i?i+=1:i=-(i+1);var r=this.pages[i].previousEntry(t,e);return void 0===r&&0<i&&(r=this.pages[i-1].previousEntry(t,e)),r},d.prototype.updated=function(t,e,i){var r=this.lookup(t,i);0<=r?r+=1:r=-(r+1);var o=this.pages[r],n=o.updated(t,e,i);return o!==n?o.size!==n.size&&i.pageShouldSplit(n)?this.updatedPageSplit(r,n,o):this.updatedPage(r,n,o):this},d.prototype.updatedPage=function(t,e,i){var r=this.pages.slice(0);r[t]=e;var o,n=this.knots;return 0<n.length?(o=n.slice(0),0<t&&(o[t-1]=e.minKey())):o=[],new d(r,o,this.size-i.size+e.size)},d.prototype.updatedPageSplit=function(t,e,i){for(var r=this.pages,o=new Array(r.length+1),n=0;n<t;n+=1)o[n]=r[n];var s=e.splitLeft(e.arity>>>1),a=e.splitRight(e.arity>>>1);o[t]=s,o[t+1]=a;for(n=t+1;n<r.length;n+=1)o[n+1]=r[n];var u=this.knots,h=new Array(r.length);if(0<t){for(n=0;n<t-1;n+=1)h[n]=u[n];h[t-1]=s.minKey(),h[t]=a.minKey();for(n=t;n<u.length;n+=1)h[n+1]=u[n]}else{h[0]=a.minKey();for(n=0;n<u.length;n+=1)h[n+1]=u[n]}return new d(o,h,this.size-i.size+e.size)},d.prototype.updatedPageMerge=function(t,e,i){for(var r=this.pages,o=e.pages,n=new Array(r.length+o.length-1),s=0;s<t;s+=1)n[s]=r[s];for(s=0;s<o.length;s+=1)n[s+t]=o[s];for(s=t+1;s<r.length;s+=1)n[s+o.length-1]=r[s];var a=this.knots,u=e.knots,h=new Array(n.length-1);if(0<t){for(s=0;s<t-1;s+=1)h[s]=a[s];h[t-1]=o[0].minKey();for(s=0;s<u.length;s+=1)h[s+t]=u[s];for(s=t;s<a.length;s+=1)h[s+u.length]=a[s]}else{for(s=0;s<u.length;s+=1)h[s]=u[s];h[u.length]=r[1].minKey();for(s=1;s<a.length;s+=1)h[s+u.length]=a[s]}return new d(n,h,this.size-i.size+e.size)},d.prototype.removed=function(t,e){var i=this.lookup(t,e);0<=i?i+=1:i=-(i+1);var r=this.pages[i],o=r.removed(t,e);return r!==o?this.replacedPage(i,o,r,e):this},d.prototype.replacedPage=function(t,e,i,r){return e.isEmpty()?2<this.pages.length?this.removedPage(t,e,i):1<this.pages.length?0===t?this.pages[1]:this.pages[0]:ai.Empty:e instanceof d&&r.pageShouldMerge(e)?this.updatedPageMerge(t,e,i):this.updatedPage(t,e,i)},d.prototype.removedPage=function(t,e,i){for(var r=this.pages,o=new Array(r.length-1),n=0;n<t;n+=1)o[n]=r[n];for(n=t+1;n<r.length;n+=1)o[n-1]=r[n];var s=this.knots,a=new Array(s.length-1);if(0<t){for(n=0;n<t-1;n+=1)a[n]=s[n];for(n=t;n<s.length;n+=1)a[n-1]=s[n]}else for(n=1;n<s.length;n+=1)a[n-1]=s[n];return new d(o,a,this.size-i.size)},d.prototype.drop=function(t,e){if(0<t){var i=this.size;if(t<i){for(var r=this.pages,o=0;o<r.length;){var n=r[o].size;if(!(n<=t))break;i-=n,t-=n,o+=1}var s=r.length-o;if(1<s){var a=void 0;if(0<o){for(var u=new Array(s),h=0;h<s;h+=1)u[h]=r[h+o];var l=new Array(s-1);for(h=0;h<l.length;h+=1)l[h]=this.knots[h+o];a=new d(u,l,i)}else a=this;if(0<t){var p=r[o],c=p.drop(t,e);return a.replacedPage(0,c,p,e)}return a}return r[o].drop(t,e)}return ai.Empty}return this},d.prototype.take=function(t,e){if(t<this.size){if(0<t){for(var i=this.pages,r=0,o=0;o<i.length&&0<t;){var n=i[o].size;if(r+=n,o+=1,!(n<=t))break;t-=n}var s=0===t?o:o+1;if(1<s){var a=void 0;if(o<i.length){for(var u=new Array(s),h=0;h<s;h+=1)u[h]=i[h];var l=new Array(s-1);for(h=0;h<l.length;h+=1)l[h]=this.knots[h];a=new d(u,l,r)}else a=this;if(0<t){var p=i[o-1],c=p.take(t,e);return a.replacedPage(o-1,c,p,e)}return a}return 0<t?i[0].take(t,e):i[0]}return ai.Empty}return this},d.prototype.balanced=function(t){return 1<this.pages.length&&t.pageShouldSplit(this)?this.split(this.knots.length>>>1):this},d.prototype.split=function(t){var e=new Array(2),i=this.splitLeft(t),r=this.splitRight(t);e[0]=i,e[1]=r;var o=new Array(1);return o[0]=r.minKey(),new d(e,o,this.size)},d.prototype.splitLeft=function(t){for(var e=this.pages,i=new Array(t+1),r=0;r<t+1;r+=1)i[r]=e[r];var o=this.knots,n=new Array(t);for(r=0;r<t;r+=1)n[r]=o[r];var s=0;for(r=0;r<=t;r+=1)s+=i[r].size;return new d(i,n,s)},d.prototype.splitRight=function(t){for(var e=this.pages,i=e.length-(t+1),r=new Array(i),o=0;o<i;o+=1)r[o]=e[o+(t+1)];var n=this.knots,s=new Array(i-1);for(o=0;o<s.length;o+=1)s[o]=n[o+(t+1)];var a=0;for(o=0;o<i;o+=1)a+=r[o].size;return new d(r,s,a)},d.prototype.forEach=function(t,e,i){for(var r=0;r<this.pages.length;r+=1){var o=this.pages[r].forEach(t,e,i);if(void 0!==o)return o}},d.prototype.entries=function(){return new li(this.pages)},d.prototype.reverseEntries=function(){return new li(this.pages,this.size,this.pages.length)},d.prototype.toValue=function(){var t=F.empty(1+this.pages.length+this.knots.length);t.attr("bnode",F.empty(1).slot("size",this.size));for(var e=0;e<this.pages.length;e+=1){if(0<e){var i=w.fromAny(this.knots[e-1]);t.push(F.empty(1).attr("knot",F.empty(1).slot("key",i)))}t.push(this.pages[e].toValue())}return t},d.prototype.lookup=function(t,e){for(var i=0,r=this.knots.length-1;i<=r;){var o=i+r>>>1,n=e.compare(t,this.knots[o]);if(0<n)i=o+1;else{if(!(n<0))return o;r=o-1}}return-(i+1)},d}(ai),li=function(o){function t(t,e,i,r){return o.call(this,t,e,i,r)||this}return v(t,o),t.prototype.pageSize=function(t){return t.size},t.prototype.pageCursor=function(t){return t.entries()},t.prototype.reversePageCursor=function(t){return t.reverseEntries()},t}(f),pi=function(){function i(t){void 0===t&&(t=ci.Empty),this.root=t}return Object.defineProperty(i.prototype,"length",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),i.prototype.isEmpty=function(){return this.root.isEmpty()},i.prototype.get=function(t,e){if(!(void 0!==e&&(t=this.lookup(e,t))<0))return this.root.get(t)},i.prototype.getEntry=function(t,e){if(!(void 0!==e&&(t=this.lookup(e,t))<0))return this.root.getEntry(t)},i.prototype.set=function(t,e,i){if(void 0!==i&&(t=this.lookup(i,t))<0)throw new RangeError(""+i);if(t<0||t>=this.root.size)throw new RangeError(""+t);return this.root=this.root.updated(t,e,this),this},i.prototype.insert=function(t,e,i){if(t<0||t>this.root.size)throw new RangeError(""+t);return this.root=this.root.inserted(t,e,i,this).balanced(this),this},i.prototype.remove=function(t,e){if(void 0!==e&&(t=this.lookup(e,t))<0)throw new RangeError(""+e);if(t<0||t>this.root.size)throw new RangeError(""+t);return this.root=this.root.removed(t,this),this},i.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<t.length;i+=1)this.root=this.root.inserted(this.root.size,t[i],void 0,this).balanced(this);return this.root.size},i.prototype.pop=function(){var t=this.root.size-1;if(0<=t){var e=this.root.get(t);return this.root=this.root.removed(t,this),e}},i.prototype.unshift=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=t.length-1;0<=i;i-=1)this.root=this.root.inserted(0,t[i],void 0,this).balanced(this);return this.root.size},i.prototype.shift=function(){if(0<this.root.size){var t=this.root.get(0);return this.root=this.root.removed(0,this),t}},i.prototype.move=function(t,e,i){if(void 0!==i&&(t=this.lookup(i,t))<0)throw new RangeError(""+i);if(t<0||t>=this.root.size)throw new RangeError(""+t);if(e<0||e>=this.root.size)throw new RangeError(""+e);if(t!==e){var r=this.root.getEntry(t);this.root=this.root.removed(t,this).inserted(e,r[1],r[0],this).balanced(this)}return this},i.prototype.splice=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];t<0&&(t=this.root.size+t),t=Math.min(Math.max(0,t),this.root.size),void 0===e&&(e=this.root.size-t);for(var o=[],n=t,s=t+e;n<s;n+=1)o.push(this.root.get(t)),this.root=this.root.removed(t,this);for(n=0;n<i.length;n+=1)this.root=this.root.inserted(t+n,i[n],void 0,this).balanced(this);return o},i.prototype.drop=function(t){return 0<t&&0<this.root.size&&(t<this.root.size?this.root=this.root.drop(t,this):this.root=ci.Empty),this},i.prototype.take=function(t){return t<this.root.size&&0<this.root.size&&(this.root=0<t?this.root.take(t,this):ci.Empty),this},i.prototype.clear=function(){this.root=ci.Empty},i.prototype.forEach=function(t,e){return this.root.forEach(t,e,0,this)},i.prototype.keys=function(){return this.root.keys()},i.prototype.values=function(){return this.root.values()},i.prototype.entries=function(){return this.root.entries()},i.prototype.reverseKeys=function(){return this.root.reverseKeys()},i.prototype.reverseValues=function(){return this.root.reverseValues()},i.prototype.reverseEntries=function(){return this.root.reverseEntries()},i.prototype.clone=function(){return this.copy(this.root)},i.prototype.copy=function(t){var e=new i(t);return e.identify!==this.identify&&(e.identify=this.identify),e.compare!==this.compare&&(e.compare=this.compare),e.pageSplitSize!==this.pageSplitSize&&(e.pageSplitSize=this.pageSplitSize),e},i.prototype.toValue=function(){return this.root.toValue()},i.prototype.toRecon=function(){return this.toValue().toRecon()},i.prototype.identify=function(t){var e=new Uint8Array(6);return C.fillBytes(e),e},i.prototype.compare=function(t,e){return V(t,e)},i.prototype.pageShouldSplit=function(t){return t.arity>this.pageSplitSize},i.prototype.pageShouldMerge=function(t){return t.arity<this.pageSplitSize>>>1},i.prototype.lookup=function(t,e){void 0===e&&(e=0);var i=e=Math.min(Math.max(0,e),this.root.size-1);do{var r=this.root.getEntry(i);if(r&&0===this.compare(r[0],t))return i;i=(i+1)%this.root.size}while(isFinite(i)&&i!==e);return-1},i}();pi.prototype.pageSplitSize=32;var ci=function(){function t(){}return t.prototype.keys=function(){return new h(this.entries())},t.prototype.values=function(){return new c(this.entries())},t.prototype.reverseKeys=function(){return new h(this.reverseEntries())},t.prototype.reverseValues=function(){return new c(this.reverseEntries())},t.prototype.toRecon=function(){return this.toValue().toRecon()},t.Empty=void 0,t}(),di=function(i){function a(t){var e=i.call(this)||this;return e.slots=t,e}return v(a,i),Object.defineProperty(a.prototype,"arity",{get:function(){return this.slots.length},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"size",{get:function(){return this.slots.length},enumerable:!0,configurable:!0}),a.prototype.isEmpty=function(){return 0===this.slots.length},a.prototype.get=function(t){var e=this.slots[t];return e?e[1]:void 0},a.prototype.getEntry=function(t){return this.slots[t]},a.prototype.updated=function(t,e,i){if(t<0||t>=this.slots.length)throw new RangeError(""+t);return this.updatedItem(t,e)},a.prototype.updatedItem=function(t,e){var i=this.slots,r=i[t];if(e!==r[1]){var o=i.slice(0);return o[t]=[r[0],e],new a(o)}return this},a.prototype.inserted=function(t,e,i,r){if(t<0||t>this.slots.length)throw new RangeError(""+t);return this.insertedItem(t,e,i,r)},a.prototype.insertedItem=function(t,e,i,r){void 0===i&&(i=r.identify(e));for(var o=this.slots,n=new Array(o.length+1),s=0;s<t;s+=1)n[s]=o[s];n[t]=[i,e];for(s=t;s<o.length;s+=1)n[s+1]=o[s];return new a(n)},a.prototype.removed=function(t,e){if(t<0||t>=this.slots.length)throw new RangeError(""+t);return 1<this.slots.length?this.removedSlot(t):ci.Empty},a.prototype.removedSlot=function(t){for(var e=this.slots,i=new Array(e.length-1),r=0;r<t;r+=1)i[r]=e[r];for(r=t;r<i.length;r+=1)i[r]=e[r+1];return new a(i)},a.prototype.drop=function(t,e){var i=this.slots;if(0<t&&0<i.length){if(t<i.length){for(var r=i.length-t,o=new Array(r),n=0;n<r;n+=1)o[n]=i[n+t];return new a(o)}return ci.Empty}return this},a.prototype.take=function(t,e){var i=this.slots;if(t<i.length&&0<i.length){if(0<t){for(var r=new Array(t),o=0;o<t;o+=1)r[o]=i[o];return new a(r)}return ci.Empty}return this},a.prototype.balanced=function(t){var e=this.slots.length;return 1<e&&t.pageShouldSplit(this)?this.split(e>>>1):this},a.prototype.split=function(t){var e=new Array(2),i=this.splitLeft(t),r=this.splitRight(t);e[0]=i,e[1]=r;var o=new Array(1);return o[0]=t,new mi(e,o,this.slots.length)},a.prototype.splitLeft=function(t){for(var e=this.slots,i=new Array(t),r=0;r<t;r+=1)i[r]=e[r];return new a(i)},a.prototype.splitRight=function(t){for(var e=this.slots,i=e.length-t,r=new Array(i),o=0;o<i;o+=1)r[o]=e[o+t];return new a(r)},a.prototype.forEach=function(t,e,i,r){for(var o=0;o<this.slots.length;o+=1){var n=this.slots[o],s=t.call(e,n[1],i+o,r,n[0]);if(void 0!==s)return s}},a.prototype.entries=function(){return new d(this.slots)},a.prototype.reverseEntries=function(){return new d(this.slots,this.slots.length)},a.prototype.toValue=function(){var t=F.empty(1+this.slots.length);t.attr("sleaf",F.empty(1).slot("size",this.slots.length));for(var e=0;e<this.slots.length;e+=1){var i=this.slots[e];t.slot(w.of(i[0]),w.of(i[1]))}return t},a}(ci);ci.Empty=new di([]);var fi,yi,mi=function(n){function p(t,e,i){var r=n.call(this)||this;if(r.pages=t,void 0===e||void 0===i){e=new Array(t.length-1);for(var o=i=0;o<e.length;o+=1)i+=t[o].size,e[o]=i;i+=t[e.length].size}return r.knots=e,r.size=i,r}return v(p,n),Object.defineProperty(p.prototype,"arity",{get:function(){return this.pages.length},enumerable:!0,configurable:!0}),p.prototype.isEmpty=function(){return 0===this.size},p.prototype.get=function(t){var e=this.lookup(t);0<=e?e+=1:e=-(e+1);var i=0===e?t:t-this.knots[e-1];return this.pages[e].get(i)},p.prototype.getEntry=function(t){var e=this.lookup(t);0<=e?e+=1:e=-(e+1);var i=0===e?t:t-this.knots[e-1];return this.pages[e].getEntry(i)},p.prototype.updated=function(t,e,i){var r=this.lookup(t);0<=r?r+=1:r=-(r+1);var o=0===r?t:t-this.knots[r-1],n=this.pages[r],s=n.updated(o,e,i);return n!==s?n.size!==s.size&&i.pageShouldSplit(s)?this.updatedPageSplit(r,s,n):this.updatedPage(r,s,n):this},p.prototype.updatedPage=function(t,e,i){var r=this.pages,o=r.slice(0);o[t]=e;var n,s,a=this.knots;if(0<r.length-1){n=a.slice(0),s=0<t?a[t-1]:0;for(var u=t;u<n.length;u+=1)s+=o[u].size,n[u]=s;s+=o[n.length].size}else n=[],s=0;return new p(o,n,s)},p.prototype.updatedPageSplit=function(t,e,i){for(var r=this.pages,o=new Array(r.length+1),n=0;n<t;n+=1)o[n]=r[n];var s=e.splitLeft(e.arity>>>1),a=e.splitRight(e.arity>>>1);o[t]=s,o[t+1]=a;for(n=t+1;n<r.length;n+=1)o[n+1]=r[n];return new p(o)},p.prototype.updatedPageMerge=function(t,e,i){for(var r=this.pages,o=e.pages,n=new Array(r.length+o.length-1),s=0;s<t;s+=1)n[s]=r[s];for(s=0;s<o.length;s+=1)n[s+t]=o[s];for(s=t+1;s<r.length;s+=1)n[s+o.length-1]=r[s];return new p(n)},p.prototype.inserted=function(t,e,i,r){var o=this.lookup(t);0<=o?o+=1:o=-(o+1);var n=0===o?t:t-this.knots[o-1],s=this.pages[o],a=s.inserted(n,e,i,r);return s!==a?r.pageShouldSplit(a)?this.updatedPageSplit(o,a,s):this.updatedPage(o,a,s):this},p.prototype.removed=function(t,e){var i=this.lookup(t);0<=i?i+=1:i=-(i+1);var r=0===i?t:t-this.knots[i-1],o=this.pages[i],n=o.removed(r,e);return o!==n?this.replacedPage(i,n,o,e):this},p.prototype.replacedPage=function(t,e,i,r){return e.isEmpty()?2<this.pages.length?this.removedPage(t,e,i):1<this.pages.length?0===t?this.pages[1]:this.pages[0]:ci.Empty:e instanceof p&&r.pageShouldMerge(e)?this.updatedPageMerge(t,e,i):this.updatedPage(t,e,i)},p.prototype.removedPage=function(t,e,i){for(var r=this.pages,o=new Array(r.length-1),n=0;n<t;n+=1)o[n]=r[n];for(n=t+1;n<r.length;n+=1)o[n-1]=r[n];var s,a=this.knots,u=new Array(a.length-1);if(0<t){for(n=0;n<t;n+=1)u[n]=a[n];s=a[t-1]}else s=0;for(n=t;n<u.length;n+=1)s+=o[n].size,u[n]=s;return new p(o,u,s+=o[u.length].size)},p.prototype.drop=function(t,e){if(0<t){if(t<this.size){var i=this.lookup(t);0<=i?i+=1:i=-(i+1),t=0===i?t:t-this.knots[i-1];var r=this.pages,o=r.length-i;if(1<o){var n=void 0;if(0<i){for(var s=new Array(o),a=0;a<o;a+=1)s[a]=r[a+i];n=new p(s)}else n=this;if(0<t){var u=r[i],h=u.drop(t,e);return n.replacedPage(0,h,u,e)}return n}return r[i].drop(t,e)}return ci.Empty}return this},p.prototype.take=function(t,e){if(t<this.size){if(0<t){var i=this.lookup(t);0<=i?i+=1:i=-(i+1),t=0===i?t:t-this.knots[i-1];var r=this.pages,o=0===t?i:i+1;if(1<o){var n=void 0;if(i<r.length){for(var s=new Array(o),a=0;a<o;a+=1)s[a]=r[a];var u=new Array(o-1);for(a=0;a<u.length;a+=1)u[a]=this.knots[a];n=new p(s,u,u[o-2]+s[o-1].size)}else n=this;if(0<t){var h=r[i],l=h.take(t,e);return n.replacedPage(i,l,h,e)}return n}return 0<t?r[0].take(t,e):r[0]}return ci.Empty}return this},p.prototype.balanced=function(t){return 1<this.pages.length&&t.pageShouldSplit(this)?this.split(this.knots.length>>>1):this},p.prototype.split=function(t){var e=new Array(2),i=this.splitLeft(t),r=this.splitRight(t);e[0]=i,e[1]=r;var o=new Array(1);return o[0]=i.size,new p(e,o,this.size)},p.prototype.splitLeft=function(t){for(var e=this.pages,i=new Array(t+1),r=0;r<t+1;r+=1)i[r]=e[r];var o=this.knots,n=new Array(t);for(r=0;r<t;r+=1)n[r]=o[r];var s=0;for(r=0;r<=t;r+=1)s+=i[r].size;return new p(i,n,s)},p.prototype.splitRight=function(t){for(var e=this.pages,i=e.length-(t+1),r=new Array(i),o=0;o<i;o+=1)r[o]=e[o+(t+1)];var n,s=new Array(i-1);if(0<i){n=r[0].size;for(o=1;o<i;o+=1)s[o-1]=n,n+=r[o].size}else n=0;return new p(r,s,n)},p.prototype.forEach=function(t,e,i,r){for(var o=0;o<this.pages.length;o+=1){var n=this.pages[o],s=n.forEach(t,e,i,r);if(void 0!==s)return s;i+=n.size}},p.prototype.entries=function(){return new vi(this.pages)},p.prototype.reverseEntries=function(){return new vi(this.pages,this.size,this.pages.length)},p.prototype.toValue=function(){var t=F.empty(1+this.pages.length+this.knots.length);t.attr("snode",F.empty(1).slot("size",this.size));for(var e=0;e<this.pages.length;e+=1)0<e&&t.push(F.empty(1).attr("knot",F.empty(1).slot("index",this.knots[e-1]))),t.push(this.pages[e].toValue());return t},p.prototype.lookup=function(t){for(var e=0,i=this.knots.length-1;e<=i;){var r=e+i>>>1;if(t>this.knots[r])e=r+1;else{if(!(t<this.knots[r]))return r;i=r-1}}return-(e+1)},p}(ci),vi=function(o){function t(t,e,i,r){return o.call(this,t,e,i,r)||this}return v(t,o),t.prototype.pageSize=function(t){return t.size},t.prototype.pageCursor=function(t){return t.entries()},t.prototype.reversePageCursor=function(t){return t.reverseEntries()},t}(f),gi=function(){function t(t,e){void 0===e&&(e=32),this.base=t,this.resolveCache=new qt(e),this.unresolveCache=new qt(e)}return t.prototype.resolve=function(t){t=ee.fromAny(t);var e=this.resolveCache.get(t);return void 0===e&&(e=this.base.resolve(t),this.resolveCache.set(t,e)),e},t.prototype.unresolve=function(t){t=ee.fromAny(t);var e=this.unresolveCache.get(t);return void 0===e&&(e=this.base.unresolve(t),this.unresolveCache.set(t,e)),e},t}(),bi=function(){function e(){}return Object.defineProperty(e.prototype,"tag",{get:function(){return this.constructor.tag},enumerable:!0,configurable:!0}),e.prototype.prio=function(t){return void 0===t?0:this},e.prototype.rate=function(t){return void 0===t?0:this},e.prototype.toRecon=function(){return this.toValue().toRecon()},Object.defineProperty(e,"tag",{get:function(){return""},enumerable:!0,configurable:!0}),e.fromValue=function(t){switch(t.tag){case"event":return ki.fromValue(t);case"command":return Ai.fromValue(t);case"link":return Ei.fromValue(t);case"linked":return Ci.fromValue(t);case"sync":return Si.fromValue(t);case"synced":return Vi.fromValue(t);case"unlink":return Di.fromValue(t);case"unlinked":return Mi.fromValue(t);case"auth":return Pi.fromValue(t);case"authed":return Ri.fromValue(t);case"deauth":return Ti.fromValue(t);case"deauthed":return Li.fromValue(t);default:return}},e.parseRecon=function(t){return e.fromValue(w.parseRecon(t))},e}(),wi=function(i){function t(t){var e=i.call(this)||this;return e._body=t,e}return v(t,i),t.prototype.node=function(t){return void 0===t?ee.Empty:this},t.prototype.lane=function(t){return void 0===t?ee.Empty:this},t.prototype.body=function(t){return void 0===t?this._body:(t=w.fromAny(t),this.copy(t))},t.prototype.toValue=function(){return P.of(this.tag).concat(this._body)},t.fromValue=function(t,e){if(t.header(e.tag).isDefined())return new e(t.body())},t}(bi),_i=function(o){function t(t,e,i){var r=o.call(this)||this;return r._node=t,r._lane=e,r._body=i,r}return v(t,o),t.prototype.node=function(t){return void 0===t?this._node:(t=ee.fromAny(t),this.copy(t,this._lane,this._body))},t.prototype.lane=function(t){return void 0===t?this._lane:(t=ee.fromAny(t),this.copy(this._node,t,this._body))},t.prototype.body=function(t){return void 0===t?this._body:(t=w.fromAny(t),this.copy(this._node,this._lane,t))},t.prototype.toValue=function(){var t=F.empty(2).slot("node",this._node.toUri()).slot("lane",this._lane.toUri());return P.of(this.tag,t).concat(this._body)},t.fromValue=function(t,e){var r,o;if(t.header(e.tag).forEach(function(t,e){if(t.key instanceof O){var i=t.key.value;"node"===i?r=t.cast(_e.Uri,r):"lane"===i&&(o=t.cast(_e.Uri,o))}else t instanceof w&&(0===e?r=t.cast(_e.Uri,r):1===e&&(o=t.cast(_e.Uri,o)))},this),r&&o){var i=t.body();return new e(r,o,i)}},t}(bi),xi=function(s){function t(t,e,i,r,o){var n=s.call(this)||this;return n._node=t,n._lane=e,n._prio=i,n._rate=r,n._body=o,n}return v(t,s),t.prototype.node=function(t){return void 0===t?this._node:(t=ee.fromAny(t),this.copy(t,this._lane,this._prio,this._rate,this._body))},t.prototype.lane=function(t){return void 0===t?this._lane:(t=ee.fromAny(t),this.copy(this._node,t,this._prio,this._rate,this._body))},t.prototype.prio=function(t){return void 0===t?this._prio:this.copy(this._node,this._lane,t,this._rate,this._body)},t.prototype.rate=function(t){return void 0===t?this._rate:this.copy(this._node,this._lane,this._prio,t,this._body)},t.prototype.body=function(t){return void 0===t?this._body:(t=w.fromAny(t),this.copy(this._node,this._lane,this._prio,this._rate,t))},t.prototype.toValue=function(){var t=F.empty(4).slot("node",this._node.toUri()).slot("lane",this._lane.toUri());return this._prio&&t.slot("prio",this._prio),this._rate&&t.slot("rate",this._rate),P.of(this.tag,t).concat(this._body)},t.fromValue=function(t,e){var r,o,n=0,s=0;if(t.header(e.tag).forEach(function(t,e){if(t.key instanceof O){var i=t.key.value;"node"===i?r=t.cast(_e.Uri,r):"lane"===i?o=t.cast(_e.Uri,o):"prio"===i?n=t.numberValue(n):"rate"===i&&(s=t.numberValue(s))}else t instanceof w&&(0===e?r=t.cast(_e.Uri,r):1===e&&(o=t.cast(_e.Uri,o)))},this),r&&o){var i=t.body();return new e(r,o,n,s,i)}},t}(bi),ki=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.copy=function(t,e,i){return new o(t,e,i)},o.fromValue=function(t){return _i.fromValue(t,o)},Object.defineProperty(o,"tag",{get:function(){return"event"},enumerable:!0,configurable:!0}),o.of=function(t,e,i){return void 0===i&&(i=w.Absent),new o(t=ee.fromAny(t),e=ee.fromAny(e),i=w.fromAny(i))},o}(_i),Ai=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.copy=function(t,e,i){return new o(t,e,i)},o.fromValue=function(t){return _i.fromValue(t,o)},Object.defineProperty(o,"tag",{get:function(){return"command"},enumerable:!0,configurable:!0}),o.of=function(t,e,i){return void 0===i&&(i=w.Absent),new o(t=ee.fromAny(t),e=ee.fromAny(e),i=w.fromAny(i))},o}(_i),Ei=function(n){function s(t,e,i,r,o){return n.call(this,t,e,i,r,o)||this}return v(s,n),s.prototype.copy=function(t,e,i,r,o){return new s(t,e,i,r,o)},s.fromValue=function(t){return xi.fromValue(t,s)},Object.defineProperty(s,"tag",{get:function(){return"link"},enumerable:!0,configurable:!0}),s.of=function(t,e,i,r,o){return void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=w.Absent),new s(t=ee.fromAny(t),e=ee.fromAny(e),i,r,o=w.fromAny(o))},s}(xi),Ci=function(n){function s(t,e,i,r,o){return n.call(this,t,e,i,r,o)||this}return v(s,n),s.prototype.copy=function(t,e,i,r,o){return new s(t,e,i,r,o)},s.fromValue=function(t){return xi.fromValue(t,s)},Object.defineProperty(s,"tag",{get:function(){return"linked"},enumerable:!0,configurable:!0}),s.of=function(t,e,i,r,o){return void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=w.Absent),new s(t=ee.fromAny(t),e=ee.fromAny(e),i,r,o=w.fromAny(o))},s}(xi),Si=function(n){function s(t,e,i,r,o){return n.call(this,t,e,i,r,o)||this}return v(s,n),s.prototype.copy=function(t,e,i,r,o){return new s(t,e,i,r,o)},s.fromValue=function(t){return xi.fromValue(t,s)},Object.defineProperty(s,"tag",{get:function(){return"sync"},enumerable:!0,configurable:!0}),s.of=function(t,e,i,r,o){return void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=w.Absent),new s(t=ee.fromAny(t),e=ee.fromAny(e),i,r,o=w.fromAny(o))},s}(xi),Vi=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.copy=function(t,e,i){return new o(t,e,i)},o.fromValue=function(t){return _i.fromValue(t,o)},Object.defineProperty(o,"tag",{get:function(){return"synced"},enumerable:!0,configurable:!0}),o.of=function(t,e,i){return void 0===i&&(i=w.Absent),new o(t=ee.fromAny(t),e=ee.fromAny(e),i=w.fromAny(i))},o}(_i),Di=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.copy=function(t,e,i){return new o(t,e,i)},o.fromValue=function(t){return _i.fromValue(t,o)},Object.defineProperty(o,"tag",{get:function(){return"unlink"},enumerable:!0,configurable:!0}),o.of=function(t,e,i){return void 0===i&&(i=w.Absent),new o(t=ee.fromAny(t),e=ee.fromAny(e),i=w.fromAny(i))},o}(_i),Mi=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.copy=function(t,e,i){return new o(t,e,i)},o.fromValue=function(t){return _i.fromValue(t,o)},Object.defineProperty(o,"tag",{get:function(){return"unlinked"},enumerable:!0,configurable:!0}),o.of=function(t,e,i){return void 0===i&&(i=w.Absent),new o(t=ee.fromAny(t),e=ee.fromAny(e),i=w.fromAny(i))},o}(_i),Pi=function(e){function i(t){return e.call(this,t)||this}return v(i,e),i.prototype.copy=function(t){return new i(t)},i.fromValue=function(t){return wi.fromValue(t,i)},Object.defineProperty(i,"tag",{get:function(){return"auth"},enumerable:!0,configurable:!0}),i.of=function(t){return void 0===t&&(t=w.Absent),new i(t=w.fromAny(t))},i}(wi),Ri=function(e){function i(t){return e.call(this,t)||this}return v(i,e),i.prototype.copy=function(t){return new i(t)},i.fromValue=function(t){return wi.fromValue(t,i)},Object.defineProperty(i,"tag",{get:function(){return"authed"},enumerable:!0,configurable:!0}),i.of=function(t){return void 0===t&&(t=w.Absent),new i(t=w.fromAny(t))},i}(wi),Ti=function(e){function i(t){return e.call(this,t)||this}return v(i,e),i.prototype.copy=function(t){return new i(t)},i.fromValue=function(t){return wi.fromValue(t,i)},Object.defineProperty(i,"tag",{get:function(){return"deauth"},enumerable:!0,configurable:!0}),i.of=function(t){return void 0===t&&(t=w.Absent),new i(t=w.fromAny(t))},i}(wi),Li=function(e){function i(t){return e.call(this,t)||this}return v(i,e),i.prototype.copy=function(t){return new i(t)},i.fromValue=function(t){return wi.fromValue(t,i)},Object.defineProperty(i,"tag",{get:function(){return"deauthed"},enumerable:!0,configurable:!0}),i.of=function(t){return void 0===t&&(t=w.Absent),new i(t=w.fromAny(t))},i}(wi),Fi=function(){function t(t,e,i){void 0===i&&(i={}),this._context=t,this._hostUri=e,this._options=i,this._downlinks=new si,this._downlinkCount=0,this._authenticated=!1,this._session=w.Absent,this._uriCache=new gi(e),this._sendBuffer=[],this._reconnectTimer=0,this._reconnectTimeout=0,this._idleTimer=0,this.open=this.open.bind(this),this.checkIdle=this.checkIdle.bind(this)}return Object.defineProperty(t.prototype,"hostUri",{get:function(){return this._hostUri},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"credentials",{get:function(){return this._options.credentials||w.Absent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxReconnectTimeout",{get:function(){return this._options.maxReconnectTimeout||3e4},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idleTimeout",{get:function(){return this._options.idleTimeout||1e3},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sendBufferSize",{get:function(){return this._options.sendBufferSize||1024},enumerable:!0,configurable:!0}),t.prototype.isAuthenticated=function(){return this._authenticated},Object.defineProperty(t.prototype,"session",{get:function(){return this._session},enumerable:!0,configurable:!0}),t.prototype.isIdle=function(){return!this._sendBuffer.length&&!this._downlinkCount},t.prototype.resolve=function(t){return this._uriCache.resolve(t)},t.prototype.unresolve=function(t){return this._uriCache.unresolve(t)},t.prototype.authenticate=function(t){if(!(t=w.fromAny(t)).equals(this._options.credentials))if(this._options.credentials=t,this.isConnected()){var e=Pi.of(t);this.push(e)}else this.open()},t.prototype.openDownlink=function(t){this.clearIdle();var e=this.resolve(t.nodeUri()),i=t.laneUri();this._downlinkCount||this.open();var r=this._downlinks.get(e);if(r||(r=new si,this._downlinks.set(e,r)),r.get(i))throw new Error("duplicate downlink");r.set(i,t),this._downlinkCount+=1,t.openUp(this),this.isConnected()&&t.hostDidConnect(this)},t.prototype.unlinkDownlink=function(t){var e=this.resolve(t.nodeUri()),i=t.laneUri(),r=this._downlinks.get(e);if(r&&r.get(i)&&this.isConnected()){var o=Di.of(this.unresolve(e),i);t.onUnlinkRequest(o,this),this.push(o)}},t.prototype.closeDownlink=function(t){var e=this.resolve(t.nodeUri()),i=t.laneUri(),r=this._downlinks.get(e);r&&r.get(i)&&(this._downlinkCount-=1,r.delete(i),r.isEmpty()&&this._downlinks.delete(e),this._downlinkCount||this.watchIdle(),t.closeUp(this))},t.prototype.command=function(t,e,i){t=ee.fromAny(t),t=this.resolve(t),e=ee.fromAny(e),i=w.fromAny(i);var r=Ai.of(this.unresolve(t),e,i);this.push(r)},t.prototype.onEnvelope=function(t){t instanceof ki?this.onEventMessage(t):t instanceof Ai?this.onCommandMessage(t):t instanceof Ei?this.onLinkRequest(t):t instanceof Ci?this.onLinkedResponse(t):t instanceof Si?this.onSyncRequest(t):t instanceof Vi?this.onSyncedResponse(t):t instanceof Di?this.onUnlinkRequest(t):t instanceof Mi?this.onUnlinkedResponse(t):t instanceof Pi?this.onAuthRequest(t):t instanceof Ri?this.onAuthedResponse(t):t instanceof Ti?this.onDeauthRequest(t):t instanceof Li?this.onDeauthedResponse(t):this.onUnknownEnvelope(t)},t.prototype.onEventMessage=function(t){var e=this.resolve(t.node()),i=t.lane(),r=this._downlinks.get(e);if(r){var o=r.get(i);if(o){var n=t.node(e);o.onEventMessage(n,this)}}},t.prototype.onCommandMessage=function(t){},t.prototype.onLinkRequest=function(t){},t.prototype.onLinkedResponse=function(t){var e=this.resolve(t.node()),i=t.lane(),r=this._downlinks.get(e);if(r){var o=r.get(i);if(o){var n=t.node(e);o.onLinkedResponse(n,this)}}},t.prototype.onSyncRequest=function(t){},t.prototype.onSyncedResponse=function(t){var e=this.resolve(t.node()),i=t.lane(),r=this._downlinks.get(e);if(r){var o=r.get(i);if(o){var n=t.node(e);o.onSyncedResponse(n,this)}}},t.prototype.onUnlinkRequest=function(t){},t.prototype.onUnlinkedResponse=function(t){var e=this.resolve(t.node()),i=t.lane(),r=this._downlinks.get(e);if(r){var o=r.get(i);if(o){var n=t.node(e);o.onUnlinkedResponse(n,this)}}},t.prototype.onAuthRequest=function(t){},t.prototype.onAuthedResponse=function(t){this._authenticated=!0,this._session=t.body(),this._context.hostDidAuthenticate(t.body(),this)},t.prototype.onDeauthRequest=function(t){},t.prototype.onDeauthedResponse=function(t){this._authenticated=!1,this._session=w.Absent,this._context.hostDidDeauthenticate(t.body(),this)},t.prototype.onUnknownEnvelope=function(t){},t.prototype.onConnect=function(){this._reconnectTimeout=0,this._context.hostDidConnect(this),this._downlinks.forEach(function(t,e){e.forEach(function(t,e){e.hostDidConnect(this)},this)},this)},t.prototype.onDisconnect=function(){this._authenticated=!1,this._session=w.Absent,this._context.hostDidDisconnect(this),this._downlinks.forEach(function(t,e){e.forEach(function(t,e){e.hostDidDisconnect(this)},this)},this)},t.prototype.onError=function(i){this._context.hostDidFail(i,this),this._downlinks.forEach(function(t,e){e.forEach(function(t,e){e.hostDidFail(i,this)},this)},this)},t.prototype.reconnect=function(){this._reconnectTimer||(this._reconnectTimeout?this._reconnectTimeout=Math.min(Math.floor(1.8*this._reconnectTimeout),this.maxReconnectTimeout):this._reconnectTimeout=Math.floor(500+1e3*Math.random()),this._reconnectTimer=setTimeout(this.open,this._reconnectTimeout))},t.prototype.clearReconnect=function(){this._reconnectTimer&&(clearTimeout(this._reconnectTimer),this._reconnectTimer=0)},t.prototype.watchIdle=function(){!this._idleTimer&&this.isConnected()&&this.isIdle()&&(this._idleTimer=setTimeout(this.checkIdle,this.idleTimeout))},t.prototype.clearIdle=function(){this._idleTimer&&(clearTimeout(this._idleTimer),this._idleTimer=0)},t.prototype.checkIdle=function(){this.isConnected()&&this.isIdle()&&this.close()},t.prototype.close=function(){this._context.closeHost(this)},t.prototype.closeUp=function(){this._downlinks.forEach(function(t,e){e.forEach(function(t,e){e.closeUp(this)},this)},this)},t}();(yi=fi||(fi={}))[yi.KeepLinked=1]="KeepLinked",yi[yi.KeepSynced=2]="KeepSynced",yi[yi.KeepLinkedSynced=3]="KeepLinkedSynced";var Ii=function(){function t(t,e,i,r,o,n,s){void 0===o&&(o=0),void 0===n&&(n=0),void 0===s&&(s=w.Absent),this._context=t,this._hostUri=e,this._nodeUri=i,this._laneUri=r,this._prio=o,this._rate=n,this._body=s,this._views=[],this._host=null,this._status=0}return t.prototype.hostUri=function(){return this._hostUri},t.prototype.nodeUri=function(){return this._nodeUri},t.prototype.laneUri=function(){return this._laneUri},t.prototype.prio=function(){return this._prio},t.prototype.rate=function(){return this._rate},t.prototype.body=function(){return this._body},t.prototype.keepLinked=function(){for(var t=0;t<this._views.length;t+=1)if(this._views[t].keepLinked())return!0;return!1},t.prototype.keepSynced=function(){for(var t=0;t<this._views.length;t+=1)if(this._views[t].keepSynced())return!0;return!1},t.prototype.isConnected=function(){return!(!this._host||!this._host.isConnected())},t.prototype.isAuthenticated=function(){return!(!this._host||!this._host.isAuthenticated())},t.prototype.isLinked=function(){return 0!=(2&this._status)},t.prototype.isSynced=function(){return 0!=(8&this._status)},Object.defineProperty(t.prototype,"session",{get:function(){return this._host?this._host.session:w.Absent},enumerable:!0,configurable:!0}),t.prototype.addDownlink=function(t){this._views.push(t)},t.prototype.removeDownlink=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e]===t&&(this._views.splice(e,1),t.closeUp());0===this._views.length&&this.unlink()},t.prototype.onEventMessage=function(t,e){for(var i=0;i<this._views.length;i+=1)this._views[i].onEventMessage(t)},t.prototype.onCommandMessage=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].onCommandMessage(t)},t.prototype.onLinkRequest=function(t){this._status|=1;for(var e=0;e<this._views.length;e+=1)this._views[e].onLinkRequest(t)},t.prototype.onLinkedResponse=function(t,e){this._status=-2&this._status|2;for(var i=0;i<this._views.length;i+=1)this._views[i].onLinkedResponse(t)},t.prototype.onSyncRequest=function(t){this._status|=4;for(var e=0;e<this._views.length;e+=1)this._views[e].onSyncRequest(t)},t.prototype.onSyncedResponse=function(t,e){this._status=-5&this._status|8;for(var i=0;i<this._views.length;i+=1)this._views[i].onSyncedResponse(t)},t.prototype.onUnlinkRequest=function(t,e){this._status=-6&this._status|16;for(var i=0;i<this._views.length;i+=1)this._views[i].onUnlinkRequest(t)},t.prototype.onUnlinkedResponse=function(t,e){this._status&=-17;for(var i=0;i<this._views.length;i+=1)this._views[i].onUnlinkedResponse(t);0===this._status&&this.close()},t.prototype.hostDidConnect=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].hostDidConnect();var i,r=this._host.unresolve(this._nodeUri);this.keepSynced()?(i=Si.of(r,this._laneUri,this._prio,this._rate,this._body),this.onSyncRequest(i)):(i=Ei.of(r,this._laneUri,this._prio,this._rate,this._body),this.onLinkRequest(i)),this._host.push(i)},t.prototype.hostDidDisconnect=function(t){for(var e=!1,i=this._status=0;i<this._views.length;i+=1){var r=this._views[i];r.hostDidDisconnect(),e=e||r.keepLinked()}e||this.close()},t.prototype.hostDidFail=function(t,e){for(var i=0;i<this._views.length;i+=1)this._views[i].hostDidFail(t)},t.prototype.command=function(t){t=w.fromAny(t),this.onCommandMessage(t),this._host.command(this._nodeUri,this._laneUri,t)},t.prototype.unlink=function(){this._status=16,this._context.unlinkDownlink(this)},t.prototype.close=function(){this._context.closeDownlink(this)},t.prototype.openUp=function(t){this._host=t;for(var e=0;e<this._views.length;e+=1)this._views[e].openUp(t)},t.prototype.closeUp=function(){var t=this._views;this._views=[];for(var e=0;e<t.length;e+=1)t[e].closeUp()},t}(),zi=function(){function t(t,e,i,r,o,n,s,a,u,h,l){void 0===r&&(r=ee.Empty),void 0===o&&(o=ee.Empty),void 0===n&&(n=ee.Empty),void 0===s&&(s=0),void 0===a&&(a=0),void 0===u&&(u=w.Absent),void 0===h&&(h=0),void 0===l&&(l={}),i&&(r=void 0!==i.hostUri?ee.fromAny(i.hostUri):r,o=void 0!==i.nodeUri?ee.fromAny(i.nodeUri):o,n=void 0!==i.laneUri?ee.fromAny(i.laneUri):n,s=void 0!==i.prio?i.prio:s,a=void 0!==i.rate?i.rate:a,u=void 0!==i.body?w.fromAny(i.body):u,l.onEvent=i.onEvent||l.onEvent,l.onCommand=i.onCommand||l.onCommand,l.willLink=i.willLink||l.willLink,l.didLink=i.didLink||l.didLink,l.willSync=i.willSync||l.willSync,l.didSync=i.didSync||l.didSync,l.willUnlink=i.willUnlink||l.willUnlink,l.didUnlink=i.didUnlink||l.didUnlink,l.didConnect=i.didConnect||l.didConnect,l.didDisconnect=i.didDisconnect||l.didDisconnect,l.didClose=i.didClose||l.didClose,l.didFail=i.didFail||l.didFail),this._context=t,this._owner=e,this._hostUri=r,this._nodeUri=o,this._laneUri=n,this._prio=s,this._rate=a,this._body=u,this._flags=h,this._model=void 0,this.delegate=l}return t.prototype.hostUri=function(t){return void 0===t?this._hostUri:(t=ee.fromAny(t),this.copy(this._context,this._owner,t,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this.delegate))},t.prototype.nodeUri=function(t){return void 0===t?this._nodeUri:(t=ee.fromAny(t),this.copy(this._context,this._owner,this._hostUri,t,this._laneUri,this._prio,this._rate,this._body,this._flags,this.delegate))},t.prototype.laneUri=function(t){return void 0===t?this._laneUri:(t=ee.fromAny(t),this.copy(this._context,this._owner,this._hostUri,this._nodeUri,t,this._prio,this._rate,this._body,this._flags,this.delegate))},t.prototype.prio=function(t){return void 0===t?this._prio:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,t,this._rate,this._body,this._flags,this.delegate)},t.prototype.rate=function(t){return void 0===t?this._rate:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,t,this._body,this._flags,this.delegate)},t.prototype.body=function(t){return void 0===t?this._body:(t=w.fromAny(t),this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,t,this._flags,this.delegate))},t.prototype.keepLinked=function(t){if(void 0===t)return 0!=(1&this._flags);var e=t?1|this._flags:-2&this._flags;return this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,e,this.delegate)},t.prototype.keepSynced=function(t){if(void 0===t)return 0!=(2&this._flags);var e=t?2|this._flags:-3&this._flags;return this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,e,this.delegate)},t.prototype.onEvent=function(t){return void 0===t?this.delegate.onEvent||null:(this.delegate.onEvent=t||void 0,this)},t.prototype.onCommand=function(t){return void 0===t?this.delegate.onCommand||null:(this.delegate.onCommand=t||void 0,this)},t.prototype.willLink=function(t){return void 0===t?this.delegate.willLink||null:(this.delegate.willLink=t||void 0,this)},t.prototype.didLink=function(t){return void 0===t?this.delegate.didLink||null:(this.delegate.didLink=t||void 0,this)},t.prototype.willSync=function(t){return void 0===t?this.delegate.willSync||null:(this.delegate.willSync=t||void 0,this)},t.prototype.didSync=function(t){return void 0===t?this.delegate.didSync||null:(this.delegate.didSync=t||void 0,this)},t.prototype.willUnlink=function(t){return void 0===t?this.delegate.willUnlink||null:(this.delegate.willUnlink=t||void 0,this)},t.prototype.didUnlink=function(t){return void 0===t?this.delegate.didUnlink||null:(this.delegate.didUnlink=t||void 0,this)},t.prototype.didConnect=function(t){return void 0===t?this.delegate.didConnect||null:(this.delegate.didConnect=t||void 0,this)},t.prototype.didDisconnect=function(t){return void 0===t?this.delegate.didDisconnect||null:(this.delegate.didDisconnect=t||void 0,this)},t.prototype.didClose=function(t){return void 0===t?this.delegate.didClose||null:(this.delegate.didClose=t||void 0,this)},t.prototype.didFail=function(t){return void 0===t?this.delegate.didFail||null:(this.delegate.didFail=t||void 0,this)},t.prototype.isConnected=function(){return!!this._model&&this._model.isConnected()},t.prototype.isAuthenticated=function(){return!!this._model&&this._model.isAuthenticated()},t.prototype.isLinked=function(){return!!this._model&&this._model.isLinked()},t.prototype.isSynced=function(){return!!this._model&&this._model.isSynced()},t.prototype.session=function(){return this._model?this._model.session:w.Absent},t.prototype.onEventMessage=function(t){this.delegate.onEvent&&this.delegate.onEvent(t.body(),this)},t.prototype.onCommandMessage=function(t){this.delegate.onCommand&&this.delegate.onCommand(t,this)},t.prototype.onLinkRequest=function(t){this.delegate.willLink&&this.delegate.willLink(this)},t.prototype.onLinkedResponse=function(t){this.delegate.didLink&&this.delegate.didLink(this)},t.prototype.onSyncRequest=function(t){this.delegate.willSync&&this.delegate.willSync(this)},t.prototype.onSyncedResponse=function(t){this.delegate.didSync&&this.delegate.didSync(this)},t.prototype.onUnlinkRequest=function(t){this.delegate.willUnlink&&this.delegate.willUnlink(this)},t.prototype.onUnlinkedResponse=function(t){this.delegate.didUnlink&&this.delegate.didUnlink(this)},t.prototype.hostDidConnect=function(){this.delegate.didConnect&&this.delegate.didConnect(this)},t.prototype.hostDidDisconnect=function(){this.delegate.didDisconnect&&this.delegate.didDisconnect(this)},t.prototype.hostDidFail=function(t){this.delegate.didFail&&this.delegate.didFail(t,this)},t.prototype.command=function(t){this._model.command(t)},t.prototype.close=function(){this._owner&&this._owner.removeDownlink(this),this._model&&this._model.removeDownlink(this)},t.prototype.openUp=function(t){},t.prototype.closeUp=function(){this.delegate.didClose&&this.delegate.didClose(this)},t.InitForm=void 0,t}(),Ui=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"tag",{get:function(){return"link"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unit",{get:function(){},enumerable:!0,configurable:!0}),e.prototype.mold=function(t){if(t){var e=F.empty();return void 0!==t.hostUri&&e.slot("host",ee.fromAny(t.hostUri).toUri()),void 0!==t.nodeUri&&e.slot("node",ee.fromAny(t.nodeUri).toUri()),void 0!==t.laneUri&&e.slot("lane",ee.fromAny(t.laneUri).toUri()),void 0!==t.prio&&e.slot("prio",t.prio),void 0!==t.rate&&e.slot("rate",t.rate),void 0!==t.body&&e.slot("body",t.body),void 0!==t.type&&e.slot("type",t.type),F.of(P.of("link",e))}return w.Absent},e.prototype.cast=function(t){var e=t.get("link");if(e.isDefined()){var i={},r=e.get("host");r.isDefined()&&(i.hostUri=r.cast(_e.Uri));var o=e.get("node");o.isDefined()&&(i.nodeUri=o.cast(_e.Uri));var n=e.get("lane");n.isDefined()&&(i.laneUri=n.cast(_e.Uri));var s=e.get("prio");s.isDefined()&&(i.prio=s.numberValue());var a=e.get("rate");a.isDefined()&&(i.rate=a.numberValue());var u=e.get("body");u.isDefined()&&(i.body=u);var h=e.get("type");return h.isDefined()&&(i.type=h.stringValue()),i}},e}(_e);zi.InitForm=new Ui;var Oi=function(a){function t(t,e,i,r,o,n,s){return a.call(this,t,e,i,r,o,n,s)||this}return v(t,a),t.prototype.type=function(){return"event"},t}(Ii),Wi=function(p){function l(t,e,i,r,o,n,s,a,u,h,l){return void 0===h&&(h=1),void 0===l&&(l={}),p.call(this,t,e,i,r,o,n,s,a,u,h,l)||this}return v(l,p),l.prototype.copy=function(t,e,i,r,o,n,s,a,u,h){return new l(t,e,void 0,i,r,o,n,s,a,u,h)},l.prototype.type=function(){return"event"},l.prototype.open=function(){var t=this._laneUri;if(t.isEmpty())throw new Error("no lane");var e=this._nodeUri;if(e.isEmpty())throw new Error("no node");var i=this._hostUri;i.isEmpty()&&(i=e.base(),e=ee.unresolve(i,e));var r=this._context.getDownlink(i,e,t);if(r){if(!(r instanceof Oi))throw new Error("downlink type mismatch");r.addDownlink(this)}else(r=new Oi(this._context,i,e,t,this._prio,this._rate,this._body)).addDownlink(this),this._context.openDownlink(r);return this._model=r,this._owner&&this._owner.addDownlink(this),this},l}(zi),Bi=function(h){function t(t,e,i,r,o,n,s,a){void 0===a&&(a=new pi);var u=h.call(this,t,e,i,r,o,n,s)||this;return u._state=a,u}return v(t,h),t.prototype.type=function(){return"list"},t.prototype.isEmpty=function(){return this._state.isEmpty()},Object.defineProperty(t.prototype,"length",{get:function(){return this._state.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t,e){return this._state.get(t,e)||w.Absent},t.prototype.getEntry=function(t,e){return this._state.getEntry(t,e)},t.prototype.set=function(t,e,i){if(void 0!==i&&(t=this._state.lookup(i,t))<0)throw new RangeError(""+i);if(t<0||t>=this._state.length)throw new RangeError(""+t);e=this.listWillUpdate(t,e);var r=this._state.getEntry(t);this._state.set(t,e),this.listDidUpdate(t,e,r[1]);var o=F.empty(2).slot("id",r[0]).slot("index",t);return this.command(P.of("update",o).concat(e)),this},t.prototype.insert=function(t,e,i){if(t<0||t>this._state.length)throw new RangeError(""+t);e=this.listWillInsert(t,e),this._state.insert(t,e,i);var r=this._state.getEntry(t);this.listDidInsert(t,e);var o=F.empty(2).slot("id",r[0]).slot("index",t);return this.command(P.of("insert",o).concat(e)),this},t.prototype.remove=function(t,e){if(void 0!==e&&(t=this._state.lookup(e,t))<0)throw new RangeError(""+e);if(t<0||t>this._state.length)throw new RangeError(""+t);this.listWillRemove(t);var i=this._state.getEntry(t);this._state.remove(t),this.listDidRemove(t,i[1]);var r=F.empty(2).slot("id",i[0]).slot("index",t);return this.command(F.empty(1).attr("remove",r)),this},t.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<t.length;i+=1){var r=this._state.length+i,o=this.listWillInsert(r,t[i]);this._state.insert(r,o);var n=this._state.getEntry(r);this.listDidInsert(r,o);var s=F.empty(2).slot("id",n[0]).slot("index",r);this.command(P.of("insert",s).concat(o))}return this._state.length},t.prototype.pop=function(){var t=this._state.length-1;if(0<=t){this.listWillRemove(t);var e=this._state.getEntry(t);this._state.remove(t),this.listDidRemove(t,e[1]);var i=F.empty(2).slot("id",e[0]).slot("index",t);return this.command(F.empty(1).attr("remove",i)),e[1]}return w.Absent},t.prototype.unshift=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=t.length-1;0<=i;i-=1){var r=this.listWillInsert(0,t[i]);this._state.insert(0,r);var o=this._state.getEntry(0);this.listDidInsert(0,r);var n=F.empty(2).slot("id",o[0]).slot("index",0);this.command(P.of("insert",n).concat(r))}return this._state.length},t.prototype.shift=function(){if(0<this._state.length){this.listWillRemove(0);var t=this._state.getEntry(0);this._state.remove(0),this.listDidRemove(0,t[1]);var e=F.empty(2).slot("id",t[0]).slot("index",0);return this.command(F.empty(1).attr("remove",e)),t[1]}return w.Absent},t.prototype.move=function(t,e,i){if(void 0!==i&&(t=this._state.lookup(i,t))<0)throw new RangeError(""+i);if(t<0||t>=this._state.length)throw new RangeError(""+t);if(e<0||e>=this._state.length)throw new RangeError(""+e);if(t!==e){var r=this._state.getEntry(t);this.listWillMove(t,e,r[1]),this._state.remove(t).insert(e,r[1],r[0]),this.listDidMove(t,e,r[1]);var o=F.empty(2).slot("id",r[0]).slot("from",t).slot("to",e);this.command(F.empty(1).attr("move",o))}return this},t.prototype.splice=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];t<0&&(t=this._state.length+t),t=Math.min(Math.max(0,t),this._state.length),void 0===e&&(e=this._state.length-t);for(var o=[],n=t,s=t+e;n<s;n+=1){this.listWillRemove(t);var a=this._state.getEntry(t);o.push(a[1]),this._state.remove(t),this.listDidRemove(t,a[1]);var u=F.empty(2).slot("id",a[0]).slot("index",t);this.command(F.empty(1).attr("remove",u))}for(n=0;n<i.length;n+=1){var h=t+n,l=this.listWillInsert(h,i[n]);this._state.insert(h,l);var p=this._state.getEntry(h);this.listDidInsert(h,l);u=F.empty(2).slot("id",p[0]).slot("index",h);this.command(P.of("insert",u).concat(l))}return o},t.prototype.clear=function(){this.listWillClear(),this._state.clear(),this.listDidClear(),this.command(F.empty(1).attr("clear"))},t.prototype.forEach=function(o,n){return this._state.forEach(function(t,e,i,r){return o.call(n,t,e,this,r)},this)},t.prototype.values=function(){return this._state.values()},t.prototype.keys=function(){return this._state.keys()},t.prototype.entries=function(){return this._state.entries()},t.prototype.snapshot=function(){return this._state.clone()},t.prototype.setState=function(t){this._state=t},t.prototype.onEventMessage=function(t,e){h.prototype.onEventMessage.call(this,t,e);var i=t.body(),r=i.tag;if("update"===r){var o=i.head().toValue();0<=(n=this._state.lookup(o.get("id"),o.get("index").numberValue()))?this.onUpdateEvent(n,i.body(),o.get("id")):this.onInsertEvent(o.get("index").numberValue(0),i.body(),o.get("id"))}else if("insert"===r){o=i.head().toValue();(n=this._state.lookup(o.get("id"),o.get("index").numberValue()))<0?this.onInsertEvent(o.get("index").numberValue(0),i.body(),o.get("id")):this.onUpdateEvent(n,i.body(),o.get("id"))}else if("move"===r){o=i.head().toValue();0<=(n=this._state.lookup(o.get("id"),o.get("from").numberValue()))&&this.onMoveEvent(n,o.get("to").numberValue(0),o.get("id"))}else if("remove"===r){var n;o=i.head().toValue();0<=(n=this._state.lookup(o.get("id"),o.get("index").numberValue()))&&this.onRemoveEvent(n,o.get("id"))}else if("drop"===r){o=i.head();this.onDropEvent(o.numberValue(0))}else if("take"===r){o=i.head();this.onTakeEvent(o.numberValue(0))}else"clear"===r&&this.onClearEvent()},t.prototype.onUpdateEvent=function(t,e,i){e=this.listWillUpdate(t,e);var r=this._state.get(t)||w.Absent;this._state.set(t,e),this.listDidUpdate(t,e,r)},t.prototype.onInsertEvent=function(t,e,i){e=this.listWillInsert(t,e),this._state.insert(t,e,i),this.listDidInsert(t,e)},t.prototype.onMoveEvent=function(t,e,i){if(t!==(e=Math.min(Math.max(0,e),this._state.length))){var r=this._state.get(t)||w.Absent;this.listWillMove(t,e,r),this._state.remove(t).insert(e,r,i),this.listDidMove(t,e,r)}},t.prototype.onRemoveEvent=function(t,e){this.listWillRemove(t);var i=this._state.get(t)||w.Absent;this._state.remove(t),this.listDidRemove(t,i)},t.prototype.onDropEvent=function(t){this.listWillDrop(t),this._state.drop(t),this.listDidDrop(t)},t.prototype.onTakeEvent=function(t){this.listWillTake(t),this._state.take(t),this.listDidTake(t)},t.prototype.onClearEvent=function(){this.listWillClear(),this._state.clear(),this.listDidClear()},t.prototype.listWillInsert=function(t,e){for(var i=0;i<this._views.length;i+=1)e=this._views[i].listWillInsert(t,e);return e},t.prototype.listDidInsert=function(t,e){for(var i=0;i<this._views.length;i+=1)this._views[i].listDidInsert(t,e)},t.prototype.listWillUpdate=function(t,e){for(var i=0;i<this._views.length;i+=1)e=this._views[i].listWillUpdate(t,e);return e},t.prototype.listDidUpdate=function(t,e,i){for(var r=0;r<this._views.length;r+=1)this._views[r].listDidUpdate(t,e,i)},t.prototype.listWillMove=function(t,e,i){for(var r=0;r<this._views.length;r+=1)this._views[r].listWillMove(t,e,i)},t.prototype.listDidMove=function(t,e,i){for(var r=0;r<this._views.length;r+=1)this._views[r].listDidMove(t,e,i)},t.prototype.listWillRemove=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].listWillRemove(t)},t.prototype.listDidRemove=function(t,e){for(var i=0;i<this._views.length;i+=1)this._views[i].listDidRemove(t,e)},t.prototype.listWillDrop=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].listWillDrop(t)},t.prototype.listDidDrop=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].listDidDrop(t)},t.prototype.listWillTake=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].listWillTake(t)},t.prototype.listDidTake=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].listDidTake(t)},t.prototype.listWillClear=function(){for(var t=0;t<this._views.length;t+=1)this._views[t].listWillClear()},t.prototype.listDidClear=function(){for(var t=0;t<this._views.length;t+=1)this._views[t].listDidClear()},t}(Ii),qi=function(f){function c(t,e,i,r,o,n,s,a,u,h,l,p,c){void 0===h&&(h=3),void 0===l&&(l={});var d=f.call(this,t,e,i,r,o,n,s,a,u,h,l)||this;return i&&(l.willInsert=i.willInsert||l.willInsert,l.didInsert=i.didInsert||l.didInsert,l.willUpdate=i.willUpdate||l.willUpdate,l.didUpdate=i.didUpdate||l.didUpdate,l.willMove=i.willMove||l.willMove,l.didMove=i.didMove||l.didMove,l.willRemove=i.willRemove||l.willRemove,l.didRemove=i.didRemove||l.didRemove,l.willDrop=i.willDrop||l.willDrop,l.didDrop=i.didDrop||l.didDrop,l.willTake=i.willTake||l.willTake,l.didTake=i.didTake||l.didTake,l.willClear=i.willClear||l.willClear,l.didClear=i.didClear||l.didClear,p=i.valueForm?i.valueForm:p),d._valueForm=p||_e.Value,d._state0=c,d}return v(c,f),c.prototype.copy=function(t,e,i,r,o,n,s,a,u,h,l,p){return 10===arguments.length&&(l=this._valueForm,p=this._state0),new c(t,e,void 0,i,r,o,n,s,a,u,h,l,p)},c.prototype.type=function(){return"list"},c.prototype.valueForm=function(t){return void 0===t?this._valueForm:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this.delegate,t,this._state0)},c.prototype.isEmpty=function(){return this._model.isEmpty()},Object.defineProperty(c.prototype,"length",{get:function(){return this._model.length},enumerable:!0,configurable:!0}),c.prototype.get=function(t,e){return this._model.get(t,e).coerce(this._valueForm)},c.prototype.getEntry=function(t,e){var i=this._model.getEntry(t,e);if(i)return[i[0].coerce(this._valueForm),i[1]]},c.prototype.set=function(t,e,i){var r=this._valueForm.mold(e);return this._model.set(t,r,i),this},c.prototype.insert=function(t,e,i){var r=this._valueForm.mold(e);return this._model.insert(t,r,i),this},c.prototype.remove=function(t,e){return this._model.remove(t,e),this},c.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=new Array(t.length),r=0;r<t.length;r+=1)i[r]=this._valueForm.mold(t[r]);return this._model.push.apply(this._model,i)},c.prototype.pop=function(){return this._model.pop().coerce(this._valueForm)},c.prototype.unshift=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=new Array(t.length),r=0;r<t.length;r+=1)i[r]=this._valueForm.mold(t[r]);return this._model.unshift.apply(this._model,i)},c.prototype.shift=function(){return this._model.shift().coerce(this._valueForm)},c.prototype.move=function(t,e,i){return this._model.move(t,e,i),this},c.prototype.splice=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];for(var o=new Array(i.length),n=0;n<i.length;n+=1)o[n]=this._valueForm.mold(i[n]);var s,a=(s=this._model).splice.apply(s,[t,e].concat(o)),u=new Array(a.length);for(n=0;n<a.length;n+=1)u[n]=a[n].coerce(this._valueForm);return u},c.prototype.clear=function(){this._model.clear()},c.prototype.forEach=function(n,s){return this._valueForm===_e.Value?this._model._state.forEach(n,s):this._model._state.forEach(function(t,e,i,r){var o=t.coerce(this._valueForm);return n.call(s,o,e,this,r)},this)},c.prototype.values=function(){var t=this._model.values();return this._valueForm===_e.Value?t:new Ve(t,this._valueForm)},c.prototype.keys=function(){return this._model.keys()},c.prototype.entries=function(){var t=this._model.entries();return this._valueForm===_e.Value?t:new De(t,_e.Value,this._valueForm)},c.prototype.snapshot=function(){return this._model.snapshot()},c.prototype.setState=function(t){this._model.setState(t)},c.prototype.willInsert=function(t){return void 0===t?this.delegate.willInsert||null:(this.delegate.willInsert=t||void 0,this)},c.prototype.didInsert=function(t){return void 0===t?this.delegate.didInsert||null:(this.delegate.didInsert=t||void 0,this)},c.prototype.willUpdate=function(t){return void 0===t?this.delegate.willUpdate||null:(this.delegate.willUpdate=t||void 0,this)},c.prototype.didUpdate=function(t){return void 0===t?this.delegate.didUpdate||null:(this.delegate.didUpdate=t||void 0,this)},c.prototype.willMove=function(t){return void 0===t?this.delegate.willMove||null:(this.delegate.willMove=t||void 0,this)},c.prototype.didMove=function(t){return void 0===t?this.delegate.didMove||null:(this.delegate.didMove=t||void 0,this)},c.prototype.willRemove=function(t){return void 0===t?this.delegate.willRemove||null:(this.delegate.willRemove=t||void 0,this)},c.prototype.didRemove=function(t){return void 0===t?this.delegate.didRemove||null:(this.delegate.didRemove=t||void 0,this)},c.prototype.willDrop=function(t){return void 0===t?this.delegate.willDrop||null:(this.delegate.willDrop=t||void 0,this)},c.prototype.didDrop=function(t){return void 0===t?this.delegate.didDrop||null:(this.delegate.didDrop=t||void 0,this)},c.prototype.willTake=function(t){return void 0===t?this.delegate.willTake||null:(this.delegate.willTake=t||void 0,this)},c.prototype.didTake=function(t){return void 0===t?this.delegate.didTake||null:(this.delegate.didTake=t||void 0,this)},c.prototype.willClear=function(t){return void 0===t?this.delegate.willClear||null:(this.delegate.willClear=t||void 0,this)},c.prototype.didClear=function(t){return void 0===t?this.delegate.didClear||null:(this.delegate.didClear=t||void 0,this)},c.prototype.listWillInsert=function(t,e){if(this.delegate.willInsert){var i=e.coerce(this._valueForm);void 0!==(i=this.delegate.willInsert(t,i,this))&&(e=this._valueForm.mold(i))}return e},c.prototype.listDidInsert=function(t,e){if(this.delegate.didInsert){var i=e.coerce(this._valueForm);this.delegate.didInsert(t,i,this)}},c.prototype.listWillUpdate=function(t,e){if(this.delegate.willUpdate){var i=e.coerce(this._valueForm);void 0!==(i=this.delegate.willUpdate(t,i,this))&&(e=this._valueForm.mold(i))}return e},c.prototype.listDidUpdate=function(t,e,i){if(this.delegate.didUpdate){var r=e.coerce(this._valueForm),o=i.coerce(this._valueForm);this.delegate.didUpdate(t,r,o,this)}},c.prototype.listWillMove=function(t,e,i){if(this.delegate.willMove){var r=i.coerce(this._valueForm);this.delegate.willMove(t,e,r,this)}},c.prototype.listDidMove=function(t,e,i){if(this.delegate.didMove){var r=i.coerce(this._valueForm);this.delegate.didMove(t,e,r,this)}},c.prototype.listWillRemove=function(t){this.delegate.willRemove&&this.delegate.willRemove(t,this)},c.prototype.listDidRemove=function(t,e){if(this.delegate.didRemove){var i=e.coerce(this._valueForm);this.delegate.didRemove(t,i,this)}},c.prototype.listWillDrop=function(t){this.delegate.willDrop&&this.delegate.willDrop(t,this)},c.prototype.listDidDrop=function(t){this.delegate.didDrop&&this.delegate.didDrop(t,this)},c.prototype.listWillTake=function(t){this.delegate.willTake&&this.delegate.willTake(t,this)},c.prototype.listDidTake=function(t){this.delegate.didTake&&this.delegate.didTake(t,this)},c.prototype.listWillClear=function(){this.delegate.willClear&&this.delegate.willClear(this)},c.prototype.listDidClear=function(){this.delegate.didClear&&this.delegate.didClear(this)},c.prototype.initialState=function(t){return void 0===t?this._state0||null:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this.delegate,this._valueForm,t||void 0)},c.prototype.didAliasModel=function(){this.onLinkedResponse(),this._model._state.forEach(function(t,e){this.listDidInsert(e,t)},this),this.onSyncedResponse()},c.prototype.open=function(){var t=this._laneUri;if(t.isEmpty())throw new Error("no lane");var e=this._nodeUri;if(e.isEmpty())throw new Error("no node");var i=this._hostUri;i.isEmpty()&&(i=e.base(),e=ee.unresolve(i,e));var r=this._context.getDownlink(i,e,t);if(r){if(!(r instanceof Bi))throw new Error("downlink type mismatch");r.addDownlink(this),this._model=r,this.didAliasModel()}else(r=new Bi(this._context,i,e,t,this._prio,this._rate,this._body,this._state0)).addDownlink(this),this._context.openDownlink(r),this._model=r;return this._owner&&this._owner.addDownlink(this),this},c}(zi),Gi=function(i){function t(t){var e=i.call(this)||this;return e._downlink=t,e}return v(t,i),Object.defineProperty(t.prototype,"downlink",{get:function(){return this._downlink},enumerable:!0,configurable:!0}),t.prototype.isEmpty=function(){return this._downlink.isEmpty()},t.prototype.isArray=function(){return!0},t.prototype.isObject=function(){return this._downlink.isEmpty()},Object.defineProperty(t.prototype,"length",{get:function(){return this._downlink.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._downlink.length},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return!1},t.prototype.get=function(t){return w.Absent},t.prototype.getAttr=function(t){return w.Absent},t.prototype.getItem=function(t){t instanceof W&&(t=t.value);var e=this._downlink.length;return t<0&&(t=e+t),0<=(t=Math.min(Math.max(0,t),e-1))?this._downlink.get(t):b.Absent},t.prototype.set=function(t,e){throw new Error("unsupported")},t.prototype.setAttr=function(t,e){throw new Error("unsupported")},t.prototype.setItem=function(t,e){t instanceof W&&(t=t.value);var i=this._downlink.length;return t<0&&(t=i+t),0<=(t=Math.min(Math.max(0,t),i-1))&&this._downlink.set(t,w.fromAny(e)),this},t.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._downlink.push.apply(this._downlink,arguments)},t.prototype.splice=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return this._downlink.splice.apply(this._downlink,arguments)},t.prototype.delete=function(t){return b.Absent},t.prototype.clear=function(){this._downlink.clear()},t.prototype.forEach=function(i,r){return this._downlink.forEach(function(t,e){return i.call(r,t,e)})},t}(F),Ni=function(h){function t(t,e,i,r,o,n,s,a){void 0===a&&(a=new si);var u=h.call(this,t,e,i,r,o,n,s)||this;return u._state=a,u}return v(t,h),t.prototype.type=function(){return"map"},Object.defineProperty(t.prototype,"size",{get:function(){return this._state.size},enumerable:!0,configurable:!0}),t.prototype.isEmpty=function(){return this._state.isEmpty()},t.prototype.has=function(t){return this._state.has(t)},t.prototype.get=function(t){return this._state.get(t)||w.Absent},t.prototype.getEntry=function(t){return this._state.getEntry(t)},t.prototype.set=function(t,e){e=this.mapWillUpdate(t,e);var i=this._state.get(t)||w.Absent;this._state.set(t,e),this.mapDidUpdate(t,e,i);var r=F.empty(1).slot("key",t);return this.command(P.of("update",r).concat(e)),this},t.prototype.delete=function(t){if(this._state.has(t)){this.mapWillRemove(t);var e=this._state.get(t)||w.Absent;this._state.delete(t),this.mapDidRemove(t,e);var i=F.empty(1).slot("key",t);return this.command(F.empty(1).attr("remove",i)),!0}return!1},t.prototype.drop=function(t){return this.mapWillDrop(t),this._state.drop(t),this.mapDidDrop(t),this.command(F.empty(1).attr("drop",t)),this},t.prototype.take=function(t){return this.mapWillTake(t),this._state.take(t),this.mapDidTake(t),this.command(F.empty(1).attr("take",t)),this},t.prototype.clear=function(){this.mapWillClear(),this._state.clear(),this.mapDidClear(),this.command(F.empty(1).attr("clear"))},t.prototype.forEach=function(i,r){return this._state.forEach(function(t,e){return i.call(r,t,e,this)},this)},t.prototype.keys=function(){return this._state.keys()},t.prototype.values=function(){return this._state.values()},t.prototype.entries=function(){return this._state.entries()},t.prototype.snapshot=function(){return this._state.clone()},t.prototype.setState=function(t){this._state=t},t.prototype.onEventMessage=function(t,e){h.prototype.onEventMessage.call(this,t,e);var i=t.body(),r=i.tag;if("update"===r){var o=i.head().toValue();this.onUpdateEvent(o.get("key"),i.body())}else if("remove"===r){o=i.head().toValue();this.onRemoveEvent(o.get("key"))}else if("drop"===r){o=i.head().toValue();this.onDropEvent(o.numberValue(0))}else if("take"===r){o=i.head().toValue();this.onTakeEvent(o.numberValue(0))}else"clear"===r&&this.onClearEvent()},t.prototype.onUpdateEvent=function(t,e){e=this.mapWillUpdate(t,e);var i=this._state.get(t)||w.Absent;this._state.set(t,e),this.mapDidUpdate(t,e,i)},t.prototype.onRemoveEvent=function(t){this.mapWillRemove(t);var e=this._state.get(t)||w.Absent;this._state.delete(t),this.mapDidRemove(t,e)},t.prototype.onDropEvent=function(t){this.mapWillDrop(t),this._state.drop(t),this.mapDidDrop(t)},t.prototype.onTakeEvent=function(t){this.mapWillTake(t),this._state.take(t),this.mapDidTake(t)},t.prototype.onClearEvent=function(){this.mapWillClear(),this._state.clear(),this.mapDidClear()},t.prototype.mapWillUpdate=function(t,e){for(var i=0;i<this._views.length;i+=1)e=this._views[i].mapWillUpdate(t,e);return e},t.prototype.mapDidUpdate=function(t,e,i){for(var r=0;r<this._views.length;r+=1)this._views[r].mapDidUpdate(t,e,i)},t.prototype.mapWillRemove=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].mapWillRemove(t)},t.prototype.mapDidRemove=function(t,e){for(var i=0;i<this._views.length;i+=1)this._views[i].mapDidRemove(t,e)},t.prototype.mapWillDrop=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].mapWillDrop(t)},t.prototype.mapDidDrop=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].mapDidDrop(t)},t.prototype.mapWillTake=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].mapWillTake(t)},t.prototype.mapDidTake=function(t){for(var e=0;e<this._views.length;e+=1)this._views[e].mapDidTake(t)},t.prototype.mapWillClear=function(){for(var t=0;t<this._views.length;t+=1)this._views[t].mapWillClear()},t.prototype.mapDidClear=function(){for(var t=0;t<this._views.length;t+=1)this._views[t].mapDidClear()},t}(Ii),Hi=function(y){function d(t,e,i,r,o,n,s,a,u,h,l,p,c,d){void 0===h&&(h=3),void 0===l&&(l={});var f=y.call(this,t,e,i,r,o,n,s,a,u,h,l)||this;return i&&(l.willUpdate=i.willUpdate||l.willUpdate,l.didUpdate=i.didUpdate||l.didUpdate,l.willRemove=i.willRemove||l.willRemove,l.didRemove=i.didRemove||l.didRemove,l.willDrop=i.willDrop||l.willDrop,l.didDrop=i.didDrop||l.didDrop,l.willTake=i.willTake||l.willTake,l.didTake=i.didTake||l.didTake,l.willClear=i.willClear||l.willClear,l.didClear=i.didClear||l.didClear,p=i.keyForm?i.keyForm:p,c=i.valueForm?i.valueForm:c),f._keyForm=p||_e.Value,f._valueForm=c||_e.Value,f._state0=d,f}return v(d,y),d.prototype.copy=function(t,e,i,r,o,n,s,a,u,h,l,p,c){return 10===arguments.length&&(c=this._state0,l=this._keyForm,p=this._valueForm),new d(t,e,void 0,i,r,o,n,s,a,u,h,l,p,c)},d.prototype.type=function(){return"map"},d.prototype.keyForm=function(t){return void 0===t?this._keyForm:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this.delegate,t,this._valueForm,this._state0)},d.prototype.valueForm=function(t){return void 0===t?this._valueForm:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this.delegate,this._keyForm,t,this._state0)},Object.defineProperty(d.prototype,"size",{get:function(){return this._model.size},enumerable:!0,configurable:!0}),d.prototype.isEmpty=function(){return this._model.isEmpty()},d.prototype.has=function(t){var e=this._keyForm.mold(t);return this._model.has(e)},d.prototype.get=function(t){var e=this._keyForm.mold(t);return this._model.get(e).coerce(this._valueForm)},d.prototype.getEntry=function(t){var e=this._model.getEntry(t);if(e)return[e[0].coerce(this._keyForm),e[1].coerce(this._valueForm)]},d.prototype.set=function(t,e){var i=this._keyForm.mold(t),r=this._valueForm.mold(e);return this._model.set(i,r),this},d.prototype.delete=function(t){var e=this._keyForm.mold(t);return this._model.delete(e)},d.prototype.drop=function(t){return this._model.drop(t),this},d.prototype.take=function(t){return this._model.take(t),this},d.prototype.clear=function(){this._model.clear()},d.prototype.forEach=function(o,n){return this._keyForm===_e.Value&&this._valueForm===_e.Value?this._model._state.forEach(o,n):this._model._state.forEach(function(t,e){var i=t.coerce(this._keyForm),r=e.coerce(this._valueForm);return o.call(n,i,r,this)},this)},d.prototype.keys=function(){var t=this._model.keys();return this._keyForm===_e.Value?t:new Ve(t,this._keyForm)},d.prototype.values=function(){var t=this._model.values();return this._valueForm===_e.Value?t:new Ve(t,this._valueForm)},d.prototype.entries=function(){var t=this._model.entries();return this._keyForm===_e.Value&&this._valueForm===_e.Value?t:new De(t,this._keyForm,this._valueForm)},d.prototype.snapshot=function(){return this._model.snapshot()},d.prototype.setState=function(t){this._model.setState(t)},d.prototype.willUpdate=function(t){return void 0===t?this.delegate.willUpdate||null:(this.delegate.willUpdate=t||void 0,this)},d.prototype.didUpdate=function(t){return void 0===t?this.delegate.didUpdate||null:(this.delegate.didUpdate=t||void 0,this)},d.prototype.willRemove=function(t){return void 0===t?this.delegate.willRemove||null:(this.delegate.willRemove=t||void 0,this)},d.prototype.didRemove=function(t){return void 0===t?this.delegate.didRemove||null:(this.delegate.didRemove=t||void 0,this)},d.prototype.willDrop=function(t){return void 0===t?this.delegate.willDrop||null:(this.delegate.willDrop=t||void 0,this)},d.prototype.didDrop=function(t){return void 0===t?this.delegate.didDrop||null:(this.delegate.didDrop=t||void 0,this)},d.prototype.willTake=function(t){return void 0===t?this.delegate.willTake||null:(this.delegate.willTake=t||void 0,this)},d.prototype.didTake=function(t){return void 0===t?this.delegate.didTake||null:(this.delegate.didTake=t||void 0,this)},d.prototype.willClear=function(t){return void 0===t?this.delegate.willClear||null:(this.delegate.willClear=t||void 0,this)},d.prototype.didClear=function(t){return void 0===t?this.delegate.didClear||null:(this.delegate.didClear=t||void 0,this)},d.prototype.mapWillUpdate=function(t,e){if(this.delegate.willUpdate){var i=t.coerce(this._keyForm),r=e.coerce(this._valueForm);void 0!==(r=this.delegate.willUpdate(i,r,this))&&(e=this._valueForm.mold(r))}return e},d.prototype.mapDidUpdate=function(t,e,i){if(this.delegate.didUpdate){var r=t.coerce(this._keyForm),o=e.coerce(this._valueForm),n=i.coerce(this._valueForm);this.delegate.didUpdate(r,o,n,this)}},d.prototype.mapWillRemove=function(t){if(this.delegate.willRemove){var e=t.coerce(this._keyForm);this.delegate.willRemove(e,this)}},d.prototype.mapDidRemove=function(t,e){if(this.delegate.didRemove){var i=t.coerce(this._keyForm),r=e.coerce(this._valueForm);this.delegate.didRemove(i,r,this)}},d.prototype.mapWillDrop=function(t){this.delegate.willDrop&&this.delegate.willDrop(t,this)},d.prototype.mapDidDrop=function(t){this.delegate.didDrop&&this.delegate.didDrop(t,this)},d.prototype.mapWillTake=function(t){this.delegate.willTake&&this.delegate.willTake(t,this)},d.prototype.mapDidTake=function(t){this.delegate.didTake&&this.delegate.didTake(t,this)},d.prototype.mapWillClear=function(){this.delegate.willClear&&this.delegate.willClear(this)},d.prototype.mapDidClear=function(){this.delegate.didClear&&this.delegate.didClear(this)},d.prototype.initialState=function(t){return void 0===t?this._state0||null:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this.delegate,this._keyForm,this._valueForm,t||void 0)},d.prototype.didAliasModel=function(){this.onLinkedResponse(),this._model._state.forEach(function(t,e){this.mapDidUpdate(e,t,void 0)},this),this.onSyncedResponse()},d.prototype.open=function(){var t=this._laneUri;if(t.isEmpty())throw new Error("no lane");var e=this._nodeUri;if(e.isEmpty())throw new Error("no node");var i=this._hostUri;i.isEmpty()&&(i=e.base(),e=ee.unresolve(i,e));var r=this._context.getDownlink(i,e,t);if(r){if(!(r instanceof Ni))throw new Error("downlink type mismatch");r.addDownlink(this),this._model=r,this.didAliasModel()}else(r=new Ni(this._context,i,e,t,this._prio,this._rate,this._body,this._state0)).addDownlink(this),this._context.openDownlink(r),this._model=r;return this._owner&&this._owner.addDownlink(this),this},d}(zi),ji=function(i){function t(t){var e=i.call(this)||this;return e._downlink=t,e}return v(t,i),Object.defineProperty(t.prototype,"downlink",{get:function(){return this._downlink},enumerable:!0,configurable:!0}),t.prototype.isEmpty=function(){return this._downlink.isEmpty()},t.prototype.isArray=function(){return this._downlink.isEmpty()},t.prototype.isObject=function(){return!0},Object.defineProperty(t.prototype,"length",{get:function(){return this._downlink.size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._downlink.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._downlink.has(t)},t.prototype.get=function(t){return this._downlink.get(t)},t.prototype.getAttr=function(t){return w.Absent},t.prototype.getItem=function(t){t instanceof W&&(t=t.value);var e=this._downlink.size;if(t<0&&(t=e+t),0<=(t=Math.min(Math.max(0,t),e-1))){var i=this._downlink.getEntry(t);return R.of(i[0],i[1])}return b.Absent},t.prototype.set=function(t,e){return this._downlink.set(t,e),this},t.prototype.setAttr=function(t,e){throw new Error("unsupported")},t.prototype.setItem=function(t,e){throw new Error("unsupported")},t.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];throw new Error("unsupported")},t.prototype.splice=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];throw new Error("unsupported")},t.prototype.delete=function(t){t=w.fromAny(t);var e=this._downlink.get(t);return this._downlink.delete(t)?R.of(t,e):b.Absent},t.prototype.clear=function(){this._downlink.clear()},t.prototype.forEach=function(r,o){var n=0;return this._downlink.forEach(function(t,e){var i=r.call(o,R.of(t,e),n);return n+=1,i})},t}(F),Ki=function(h){function t(t,e,i,r,o,n,s,a){void 0===a&&(a=w.Absent);var u=h.call(this,t,e,i,r,o,n,s)||this;return u._state=a,u}return v(t,h),t.prototype.type=function(){return"value"},t.prototype.get=function(){return this._state},t.prototype.set=function(t){t=this.valueWillSet(t);var e=this._state;this.setState(t),this.valueDidSet(t,e),this.command(t)},t.prototype.setState=function(t){this._state=t},t.prototype.onEventMessage=function(t,e){h.prototype.onEventMessage.call(this,t,e),this.onSetEvent(t.body())},t.prototype.onSetEvent=function(t){t=this.valueWillSet(t);var e=this._state;this.setState(t),this.valueDidSet(t,e)},t.prototype.valueWillSet=function(t){for(var e=0;e<this._views.length;e+=1)t=this._views[e].valueWillSet(t);return t},t.prototype.valueDidSet=function(t,e){for(var i=0;i<this._views.length;i+=1)this._views[i].valueDidSet(t,e)},t}(Ii),Yi=function(f){function c(t,e,i,r,o,n,s,a,u,h,l,p,c){void 0===h&&(h=3),void 0===l&&(l={}),void 0===c&&(c=w.Absent);var d=f.call(this,t,e,i,r,o,n,s,a,u,h,l)||this;return i&&(l.willSet=i.willSet||l.willSet,l.didSet=i.didSet||l.didSet,p=i.valueForm?i.valueForm:p),d._valueForm=p||_e.Value,d._state0=c,d}return v(c,f),c.prototype.copy=function(t,e,i,r,o,n,s,a,u,h,l,p){return 10===arguments.length&&(p=this._state0,l=this._valueForm),new c(t,e,void 0,i,r,o,n,s,a,u,h,l,p)},c.prototype.type=function(){return"value"},c.prototype.valueForm=function(t){return void 0===t?this._valueForm:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this.delegate,t,this._state0)},c.prototype.get=function(){return this._model.get()},c.prototype.set=function(t){var e=this._valueForm.mold(t);this._model.set(e)},c.prototype.setState=function(t){this._model.setState(t)},c.prototype.willSet=function(t){return void 0===t?this.delegate.willSet||null:(this.delegate.willSet=t||void 0,this)},c.prototype.didSet=function(t){return void 0===t?this.delegate.didSet||null:(this.delegate.didSet=t||void 0,this)},c.prototype.valueWillSet=function(t){if(this.delegate.willSet){var e=t.coerce(this._valueForm);void 0!==(e=this.delegate.willSet(e,this))&&(t=this._valueForm.mold(e))}return t},c.prototype.valueDidSet=function(t,e){if(this.delegate.didSet){var i=t.coerce(this._valueForm),r=e.coerce(this._valueForm);this.delegate.didSet(i,r,this)}},c.prototype.initialState=function(t){return void 0===t?this._state0:this.copy(this._context,this._owner,this._hostUri,this._nodeUri,this._laneUri,this._prio,this._rate,this._body,this._flags,this.delegate,this._valueForm,t)},c.prototype.didAliasModel=function(){this.onLinkedResponse(),this.valueDidSet(this.get(),w.Absent),this.onSyncedResponse()},c.prototype.open=function(){var t=this._laneUri;if(t.isEmpty())throw new Error("no lane");var e=this._nodeUri;if(e.isEmpty())throw new Error("no node");var i=this._hostUri;i.isEmpty()&&(i=e.base(),e=ee.unresolve(i,e));var r=this._context.getDownlink(i,e,t);if(r){if(!(r instanceof Ki))throw new Error("downlink type mismatch");r.addDownlink(this),this._model=r,this.didAliasModel()}else(r=new Ki(this._context,i,e,t,this._prio,this._rate,this._body,this._state0)).addDownlink(this),this._context.openDownlink(r),this._model=r;return this._owner&&this._owner.addDownlink(this),this},c}(zi),Xi=function(i){function t(t){var e=i.call(this)||this;return e._downlink=t,e}return v(t,i),Object.defineProperty(t.prototype,"downlink",{get:function(){return this._downlink},enumerable:!0,configurable:!0}),t.prototype.isEmpty=function(){var t=this._downlink.get();return t instanceof F?t.isEmpty():!t.isDefined()},t.prototype.isArray=function(){var t=this._downlink.get();return t instanceof F?t.isArray():!t.isDefined()||t instanceof w},t.prototype.isObject=function(){var t=this._downlink.get();return t instanceof F?t.isObject():!t.isDefined()||t instanceof M},Object.defineProperty(t.prototype,"length",{get:function(){var t=this._downlink.get();return t instanceof F?t.length:t.isDefined()?1:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){var t=this._downlink.get();return t instanceof F?t.size:t.isDefined()?1:0},enumerable:!0,configurable:!0}),t.prototype.has=function(t){var e=this._downlink.get();return e instanceof F&&e.has(t)},t.prototype.get=function(t){var e=this._downlink.get();return e instanceof F?e.get(t):w.Absent},t.prototype.getAttr=function(t){var e=this._downlink.get();return e instanceof F?e.getAttr(t):w.Absent},t.prototype.getItem=function(t){var e=this._downlink.get();return e instanceof F?e.getItem(t):e},t.prototype.set=function(t,e){var i=this._downlink.get();if(!(i instanceof F))throw new Error("unsupported");return i.set(t,e),this},t.prototype.setAttr=function(t,e){var i=this._downlink.get();if(!(i instanceof F))throw new Error("unsupported");return i.setAttr(t,e),this},t.prototype.setItem=function(t,e){var i=this._downlink.get();return i instanceof F?i.setItem(t,e):this._downlink.set(w.fromAny(e)),this},t.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this._downlink.get();if(i instanceof F)return i.push.apply(i,arguments);throw new Error("unsupported")},t.prototype.splice=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];var o=this._downlink.get();if(o instanceof F)return o.splice.apply(o,arguments);throw new Error("unsupported")},t.prototype.delete=function(t){var e=this._downlink.get();return e instanceof F?e.delete(t):w.Absent},t.prototype.clear=function(){var t=this._downlink.get();if(!(t instanceof F))throw new Error("unsupported");t.clear()},t.prototype.forEach=function(t,e){return this._downlink.get().forEach(t,e)},t}(F),Qi=function(){function t(t){this._context=t,this._remote=void 0,this._downlinks=[],this.delegate={}}return t.prototype.isConnected=function(){return!!this._remote&&this._remote.isConnected()},t.prototype.isAuthenticated=function(){return!!this._remote&&this._remote.isAuthenticated()},Object.defineProperty(t.prototype,"session",{get:function(){return this._remote?this._remote.session:w.Absent},enumerable:!0,configurable:!0}),t.prototype.authenticate=function(t){this._context.authenticate(this.hostUri(),t)},t.prototype.addDownlink=function(t){0===this._downlinks.length&&this.open(),this._downlinks.push(t)},t.prototype.removeDownlink=function(t){var e=this._downlinks.indexOf(t);0<=e&&(this._downlinks.splice(e,1),0===this._downlinks.length&&this.close())},t.prototype.open=function(){this._context.openRef(this)},t.prototype.close=function(){this._context.closeRef(this)},t.prototype.closeUp=function(){var t=this._downlinks;this._downlinks=[];for(var e=0,i=t.length;e<i;e+=1)t[e].close()},t.prototype.didConnect=function(t){return void 0===t?this.delegate.didConnect||null:(this.delegate.didConnect=t||void 0,this)},t.prototype.didAuthenticate=function(t){return void 0===t?this.delegate.didAuthenticate||null:(this.delegate.didAuthenticate=t||void 0,this)},t.prototype.didDeauthenticate=function(t){return void 0===t?this.delegate.didDeauthenticate||null:(this.delegate.didDeauthenticate=t||void 0,this)},t.prototype.didDisconnect=function(t){return void 0===t?this.delegate.didDisconnect||null:(this.delegate.didDisconnect=t||void 0,this)},t.prototype.didFail=function(t){return void 0===t?this.delegate.didFail||null:(this.delegate.didFail=t||void 0,this)},t.prototype.hostDidConnect=function(t){this._remote=t,this.delegate.didConnect&&this.delegate.didConnect(t,this)},t.prototype.hostDidAuthenticate=function(t,e){this.delegate.didAuthenticate&&this.delegate.didAuthenticate(t,e,this)},t.prototype.hostDidDeauthenticate=function(t,e){this.delegate.didDeauthenticate&&this.delegate.didDeauthenticate(t,e,this)},t.prototype.hostDidDisconnect=function(t){this._remote=void 0,this.delegate.didDisconnect&&this.delegate.didDisconnect(t,this)},t.prototype.hostDidFail=function(t,e){this.delegate.didFail&&this.delegate.didFail(t,e,this)},t}(),Zi=function(r){function t(t,e){var i=r.call(this,t)||this;return i._hostUri=e,i}return v(t,r),t.prototype.hostUri=function(){return this._hostUri},t.prototype.nodeRef=function(t){return t=ee.fromAny(t),new Ji(this._context,this._hostUri,t)},t.prototype.laneRef=function(t,e){return t=ee.fromAny(t),e=ee.fromAny(e),new $i(this._context,this._hostUri,t,e)},t.prototype.downlink=function(t){return new Wi(this._context,this,t,this._hostUri)},t.prototype.downlinkList=function(t){return new qi(this._context,this,t,this._hostUri)},t.prototype.downlinkMap=function(t){return new Hi(this._context,this,t,this._hostUri)},t.prototype.downlinkValue=function(t){return new Yi(this._context,this,t,this._hostUri)},t.prototype.command=function(t,e,i){this._context.command(this._hostUri,t,e,i)},t}(Qi),Ji=function(o){function t(t,e,i){var r=o.call(this,t)||this;return r._hostUri=e,r._nodeUri=i,r}return v(t,o),t.prototype.hostUri=function(){return this._hostUri},t.prototype.nodeUri=function(){return this._nodeUri},t.prototype.laneRef=function(t){return t=ee.fromAny(t),new $i(this._context,this._hostUri,this._nodeUri,t)},t.prototype.downlink=function(t){return new Wi(this._context,this,t,this._hostUri,this._nodeUri)},t.prototype.downlinkList=function(t){return new qi(this._context,this,t,this._hostUri,this._nodeUri)},t.prototype.downlinkMap=function(t){return new Hi(this._context,this,t,this._hostUri,this._nodeUri)},t.prototype.downlinkValue=function(t){return new Yi(this._context,this,t,this._hostUri,this._nodeUri)},t.prototype.command=function(t,e){this._context.command(this._hostUri,this._nodeUri,t,e)},t}(Qi),$i=function(n){function t(t,e,i,r){var o=n.call(this,t)||this;return o._hostUri=e,o._nodeUri=i,o._laneUri=r,o}return v(t,n),t.prototype.hostUri=function(){return this._hostUri},t.prototype.nodeUri=function(){return this._nodeUri},t.prototype.laneUri=function(){return this._laneUri},t.prototype.downlink=function(t){return new Wi(this._context,this,t,this._hostUri,this._nodeUri,this._laneUri)},t.prototype.downlinkList=function(t){return new qi(this._context,this,t,this._hostUri,this._nodeUri,this._laneUri)},t.prototype.downlinkMap=function(t){return new Hi(this._context,this,t,this._hostUri,this._nodeUri,this._laneUri)},t.prototype.downlinkValue=function(t){return new Yi(this._context,this,t,this._hostUri,this._nodeUri,this._laneUri)},t.prototype.command=function(t){this._context.command(this._hostUri,this._nodeUri,this._laneUri,t)},t}(Qi),tr=function(i){function t(t){var e=i.call(this,t)||this;return e._downlinks=[],e}return v(t,i),t.prototype.addDownlink=function(t){this._downlinks.push(t)},t.prototype.removeDownlink=function(t){var e=this._downlinks.indexOf(t);0<=e&&this._downlinks.splice(e,1)},t.prototype.initDownlink=function(t,e){return t},t.prototype.downlink=function(t,e){return void 0===e&&(e=this.stack()),new Wi(this.downlinkContext,this,this.initDownlink(t,e))},t.prototype.downlinkList=function(t,e){return void 0===e&&(e=this.stack()),new qi(this.downlinkContext,this,this.initDownlink(t,e))},t.prototype.downlinkMap=function(t,e){return void 0===e&&(e=this.stack()),new Hi(this.downlinkContext,this,this.initDownlink(t,e))},t.prototype.downlinkValue=function(t,e){return void 0===e&&(e=this.stack()),new Yi(this.downlinkContext,this,this.initDownlink(t,e))},t.prototype.importDownlink=function(t,e){var i,r;if(er(t)){var o=t,n=o.downlink;if(i=t.declaration,!(r=this.initDownlink(zi.InitForm.cast(i.evaluate(e).toValue()),e)))return n.close(),o.declaration;if(n.hostUri().equals(r.hostUri)&&n.nodeUri().equals(r.nodeUri)&&n.laneUri().equals(r.laneUri))return o;n.close()}else i=t,r=zi.InitForm.cast(i.evaluate(e).toValue());if(r)try{if("list"===r.type)return new ir(this,this.downlinkList(r).open(),i);if("map"===r.type)return new rr(this,this.downlinkMap(r).open(),i);if("value"===r.type)return new or(this,this.downlinkValue(r).open(),i)}catch(t){}return t},t.prototype.materializeValue=function(t,e){if("link"===t.tag||er(t)){var i=this.importDownlink(t,e);if(er(i))return i}return t},t.prototype.materializeItem=function(t,e){if(t instanceof M){if((i=t.value)!==(r=this.materializeValue(i,e)))return t.withValue(r)}else if(t instanceof w){var i,r;if((i=t)!==(r=this.materializeValue(i,e)))return r}return t},t.prototype.materializeScope=function(t){void 0===t&&(t=this.stack());for(var e=this._record,i=e.length,r=0;r<i;){var o=e.getItem(r),n=this.materializeItem(o,t);n.isDefined()?(o!==n&&e.setItem(r,n),r+=1):e.splice(r,1)}},t.prototype.close=function(){var t=this._downlinks;this._downlinks=[];for(var e=0,i=t.length;e<i;e+=1)t[e].close()},t}(ni);function er(t){return!!(t instanceof F&&t.declaration)}var ir=function(o){function t(t,e,i){var r=o.call(this,e)||this;return r._scope=t,r._declaration=i.commit(),r.downlink.delegate=r}return v(t,o),Object.defineProperty(t.prototype,"declaration",{get:function(){return this._declaration},enumerable:!0,configurable:!0}),t.prototype.didInsert=function(t,e){this._scope.didChange(e,w.Absent,t)},t.prototype.didUpdate=function(t,e,i){this._scope.didChange(e,i,t)},t.prototype.didMove=function(t,e,i){this._scope.didChange(i,i,e)},t.prototype.didRemove=function(t,e){this._scope.didChange(w.Absent,e,t)},t.prototype.didDrop=function(t){this._scope.didChange()},t.prototype.didTake=function(t){this._scope.didChange()},t.prototype.didClear=function(){this._scope.didChange()},t}(Gi),rr=function(o){function t(t,e,i){var r=o.call(this,e)||this;return r._scope=t,r._declaration=i.commit(),r.downlink.delegate=r}return v(t,o),Object.defineProperty(t.prototype,"declaration",{get:function(){return this._declaration},enumerable:!0,configurable:!0}),t.prototype.didUpdate=function(t,e,i){this._scope.didChange(R.of(t,e),R.of(t,i))},t.prototype.didRemove=function(t,e){this._scope.didChange(b.Absent,R.of(t,e))},t.prototype.didDrop=function(t){this._scope.didChange()},t.prototype.didTake=function(t){this._scope.didChange()},t.prototype.didClear=function(){this._scope.didChange()},t}(ji),or=function(o){function t(t,e,i){var r=o.call(this,e)||this;return r._scope=t,r._declaration=i.commit(),r.downlink.delegate=r}return v(t,o),Object.defineProperty(t.prototype,"declaration",{get:function(){return this._declaration},enumerable:!0,configurable:!0}),t.prototype.didSet=function(t,e){this._scope.didChange(t,e)},t}(Xi),nr=function(o){function t(t,e,i){void 0===i&&(i={});var r=o.call(this,t,e,i)||this;return r.onWebSocketOpen=r.onWebSocketOpen.bind(r),r.onWebSocketMessage=r.onWebSocketMessage.bind(r),r.onWebSocketClose=r.onWebSocketClose.bind(r),r.onWebSocketError=r.onWebSocketError.bind(r),r}return v(t,o),Object.defineProperty(t.prototype,"WebSocket",{get:function(){return this._options.WebSocket||"undefined"!=typeof WebSocket&&WebSocket||"function"==typeof require&&require("ws")||void 0},enumerable:!0,configurable:!0}),t.prototype.isConnected=function(){return!!this._socket&&this._socket.readyState===this._socket.OPEN},t.prototype.open=function(){if(this.clearReconnect(),!this._socket){var t=this.WebSocket;if(!t)throw new Error("undefined WebSocket");var e=this._hostUri;"swim"===e.scheme().name?e=e.scheme("ws"):"swims"===e.scheme().name&&(e=e.scheme("wss")),this._options.protocols?this._socket=new t(e.toUri(),this._options.protocols):this._socket=new t(e.toUri()),this._socket.onopen=this.onWebSocketOpen,this._socket.onmessage=this.onWebSocketMessage,this._socket.onclose=this.onWebSocketClose,this._socket.onerror=this.onWebSocketError}},t.prototype.close=function(){this.clearReconnect(),this.clearIdle(),this._socket?(this._socket.close(),this._context.isOnline()||this.onWebSocketClose()):o.prototype.close.call(this)},t.prototype.push=function(t){if(this.isConnected()){this.clearIdle();var e=t.toRecon();this._socket.send(e),this.watchIdle()}else if(t instanceof Ai){if(!(this._sendBuffer.length<this.sendBufferSize))throw new Error("send buffer overflow");this._sendBuffer.push(t),this.open()}},t.prototype.onWebSocketOpen=function(){if(this.isConnected()){var t=this.credentials;if(t.isDefined()){var e=new Pi(t);this.push(e)}this.onConnect();for(var i=void 0;(i=this._sendBuffer.shift())&&this.isConnected();)this.push(i);this.watchIdle()}else this.close()},t.prototype.onWebSocketMessage=function(t){var e=t.data;if("string"==typeof e){var i=bi.parseRecon(e);i?this.onEnvelope(i):this.onUnknownEnvelope(e)}},t.prototype.onWebSocketClose=function(){this._socket&&(this._socket.onopen=void 0,this._socket.onmessage=void 0,this._socket.onclose=void 0,this._socket.onerror=void 0,this._socket=void 0),this.onDisconnect(),this.clearIdle(),this.isIdle()?this.close():this._context.isOnline()&&this.reconnect()},t.prototype.onWebSocketError=function(){this.onError(),this._socket&&this._socket.close()},t}(Fi),sr=function(){function t(t){void 0===t&&(t={}),this._options=t,this._hosts=new si,this._downlinks=new si,this._downlinkCount=0,this._refs=[],this._online=!0,this.delegate={},this.onOnline=this.onOnline.bind(this),this.onOffline=this.onOffline.bind(this),this.watchOnline(!!t.keepOnline)}return t.prototype.isOnline=function(i){return void 0===i?this._online:(this._online!==i&&(this._online=i,this._hosts.forEach(function(t,e){i?e.open():e.close()},this)),this)},t.prototype.keepOnline=function(t){return void 0===t?!!this._options.keepOnline:(this._options.keepOnline!==t&&(this._options.keepOnline=t,this.watchOnline(t)),this)},t.prototype.watchOnline=function(t){"object"==typeof window&&(t?(window.addEventListener("online",this.onOnline),window.addEventListener("offline",this.onOffline)):(window.removeEventListener("online",this.onOnline),window.removeEventListener("offline",this.onOffline)))},t.prototype.onOnline=function(t){this.isOnline(!0)},t.prototype.onOffline=function(t){this.isOnline(!1)},t.prototype.getHost=function(t){return t=ee.fromAny(t),this._hosts.get(t)},t.prototype.openHost=function(t){t=ee.fromAny(t);var e=this._hosts.get(t);return e||(e=new nr(this,t,this._options),this._hosts.set(t,e)),e},t.prototype.closeHost=function(t){this._hosts.get(t._hostUri)&&(this._hosts.delete(t._hostUri),t.closeUp())},t.prototype.getDownlink=function(t,e,i){var r=this._downlinks.get(t);if(r){var o=r.get(e);if(o)return o.get(i)}},t.prototype.openDownlink=function(t){var e=t.hostUri(),i=t.nodeUri(),r=t.laneUri(),o=this._downlinks.get(e);o||(o=new si,this._downlinks.set(e,o));var n=o.get(i);if(n||(n=new si,o.set(i,n)),n.has(r))throw new Error("duplicate downlink");n.set(r,t),this._downlinkCount+=1,this.openHost(e).openDownlink(t)},t.prototype.unlinkDownlink=function(t){var e=t.hostUri(),i=this.getHost(e);i&&i.unlinkDownlink(t)},t.prototype.closeDownlink=function(t){var e=t.hostUri(),i=t.nodeUri(),r=t.laneUri(),o=this._downlinks.get(e);if(o){var n=o.get(i);if(n&&n.get(r)){this._downlinkCount-=1,n.delete(r),n.isEmpty()&&(o.delete(i),o.isEmpty()&&this._downlinks.delete(e));var s=this.getHost(e);s&&s.closeDownlink(t)}}},t.prototype.downlink=function(t){return new Wi(this,void 0,t)},t.prototype.downlinkList=function(t){return new qi(this,void 0,t)},t.prototype.downlinkMap=function(t){return new Hi(this,void 0,t)},t.prototype.downlinkValue=function(t){return new Yi(this,void 0,t)},t.prototype.openRef=function(t){this._refs.push(t)},t.prototype.closeRef=function(t){var e=this._refs.indexOf(t);0<=e&&(this._refs.splice(e,1),t.closeUp())},t.prototype.hostRef=function(t){return t=ee.fromAny(t),new Zi(this,t)},t.prototype.nodeRef=function(t,e){return t=ee.fromAny(t),e=void 0===e?(t=(e=t).base()).unresolve(e):ee.fromAny(e),new Ji(this,t,e)},t.prototype.laneRef=function(t,e,i){return t=ee.fromAny(t),e=ee.fromAny(e),void 0===i?(i=e,e=(t=(e=t).base()).unresolve(e)):i=ee.fromAny(i),new $i(this,t,e,i)},t.prototype.authenticate=function(t,e){t=ee.fromAny(t),e=w.fromAny(e),this.openHost(t).authenticate(e)},t.prototype.command=function(t,e,i,r){t=ee.fromAny(t),e=ee.fromAny(e),3===arguments.length?(r=i,i=e,e=(t=(e=t).base()).unresolve(e)):i=ee.fromAny(i),r=w.fromAny(r),this.openHost(t).command(e,i,r)},t.prototype.close=function(){var t=this._refs;this._refs=[];for(var e=0;e<t.length;e+=1)t[e].closeUp();var i=this._downlinks.clone();this._downlinks.clear(),this._downlinkCount=0,i.forEach(function(r,t){t.forEach(function(t,e){e.forEach(function(t,e){e.closeUp();var i=this.getHost(r);i&&i.closeDownlink(e)},this)},this)},this);var r=this._hosts.clone();this._hosts.clear(),r.forEach(function(t,e){e.closeUp()},this)},t.prototype.didConnect=function(t){return void 0===t?this.delegate.didConnect||null:(this.delegate.didConnect=t||void 0,this)},t.prototype.didAuthenticate=function(t){return void 0===t?this.delegate.didAuthenticate||null:(this.delegate.didAuthenticate=t||void 0,this)},t.prototype.didDeauthenticate=function(t){return void 0===t?this.delegate.didDeauthenticate||null:(this.delegate.didDeauthenticate=t||void 0,this)},t.prototype.didDisconnect=function(t){return void 0===t?this.delegate.didDisconnect||null:(this.delegate.didDisconnect=t||void 0,this)},t.prototype.didFail=function(t){return void 0===t?this.delegate.didFail||null:(this.delegate.didFail=t||void 0,this)},t.prototype.hostDidConnect=function(t){this.delegate.didConnect&&this.delegate.didConnect(t,this);for(var e=0;e<this._refs.length;e+=1){var i=this._refs[e];i.hostUri().equals(t._hostUri)&&i.hostDidConnect(t)}},t.prototype.hostDidAuthenticate=function(t,e){this.delegate.didAuthenticate&&this.delegate.didAuthenticate(t,e,this);for(var i=0;i<this._refs.length;i+=1){var r=this._refs[i];r.hostUri().equals(e._hostUri)&&r.hostDidAuthenticate(t,e)}},t.prototype.hostDidDeauthenticate=function(t,e){this.delegate.didDeauthenticate&&this.delegate.didDeauthenticate(t,e,this);for(var i=0;i<this._refs.length;i+=1){var r=this._refs[i];r.hostUri().equals(e._hostUri)&&r.hostDidDeauthenticate(t,e)}},t.prototype.hostDidDisconnect=function(t){this.delegate.didDisconnect&&this.delegate.didDisconnect(t,this);for(var e=0;e<this._refs.length;e+=1){var i=this._refs[e];i.hostUri().equals(t._hostUri)&&i.hostDidDisconnect(t)}},t.prototype.hostDidFail=function(t,e){this.delegate.didFail&&this.delegate.didFail(t,e,this);for(var i=0;i<this._refs.length;i+=1){var r=this._refs[i];r.hostUri().equals(e._hostUri)&&r.hostDidFail(t,e)}},t}(),ar=new sr,ur=ar.isOnline.bind(ar),hr=ar.keepOnline.bind(ar),lr=ar.downlink.bind(ar),pr=ar.downlinkList.bind(ar),cr=ar.downlinkMap.bind(ar),dr=ar.downlinkValue.bind(ar),fr=ar.hostRef.bind(ar),yr=ar.nodeRef.bind(ar),mr=ar.laneRef.bind(ar),vr=ar.authenticate.bind(ar),gr=ar.command.bind(ar),br={linear:function(t){return t},quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quadInOut:function(t){return(t*=2)<=1?t*=t:(t-=1,t*=2-t,t+=1),t/=2},cubicIn:function(t){return t*t*t},cubicOut:function(t){return t-=1,t*=t*t,t+=1},cubicInOut:function(t){return(t*=2)<=1?t*=t*t:(t-=2,t*=t*t,t+=2),t/=2},quartIn:function(t){return t*t*t*t},quartOut:function(t){return 1-(t-=1)*t*t*t},quartInOut:function(t){var e=t-1;return t<.5?8*t*t*t*t:1-8*e*e*e*e},expoIn:function(t){return 0===t?0:Math.pow(2,10*(t-1))},expoOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},expoInOut:function(t){return 1===t||0===t?t:(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1)))},circIn:function(t){return-1*(Math.sqrt(1-t/1*t)-1)},circOut:function(t){return t-=1,Math.sqrt(1-t*t)},circInOut:function(t){if((t*=2)<1)return-.5*(Math.sqrt(1-t*t)-1);var e=t-2;return.5*(Math.sqrt(1-e*e)+1)},backIn:function(t){return t*t*(2.70158*t-1.70158)},backOut:function(t){var e=t/1-1;return e*e*6.2985344964+1},backInOut:function(t){var e=2.5949095;if((t*=2)<1)return.5*t*t*((e+1)*t-e);var i=t-2;return.5*(i*i*((e+1)*i+e)+2)},elasticIn:function(t){if(0===t||1===t)return t;var e=t/1-1,i=(1-.7)/2*Math.PI*Math.asin(1);return-Math.pow(2,10*e)*Math.sin(2*(e-i)*Math.PI/(1-.7))},elasticOut:function(t){if(0===t||1===t)return t;var e=(1-.7)/(2*Math.PI)*Math.asin(1);return t*=2,Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/(1-.7))+1},elasticInOut:function(t){if(0===t||1===t)return t;var e=.35/(2*Math.PI)*Math.asin(1),i=2*t,r=i-1;return i<1?Math.pow(2,10*r)*Math.sin(2*(r-e)*Math.PI/.35)*-.5:Math.pow(2,-10*r)*Math.sin(2*(r-e)*Math.PI/.35)*.5+1},bounceIn:function(t){var e=7.5625;return(t=1-t)<1/2.75?1-e*t*t:t<2/2.75?1-(e*(t-=1.5/2.75)*t+.75):t<2.5/2.75?1-(e*(t-=2.25/2.75)*t+.9375):1-(e*(t-=2.625/2.75)*t+.984375)},bounceOut:function(t){var e=7.5625;return t<1/2.75?e*t*t:t<2/2.75?e*(t-=1.5/2.75)*t+.75:t<2.5/2.75?e*(t-=2.25/2.75)*t+.9375:e*(t-=2.625/2.75)*t+.984375},bounceInOut:function(t){var e=t<.5,i=7.5625;return(t=e?1-2*t:2*t-1)<1/2.75?t*=i*t:t=t<2/2.75?i*(t-=1.5/2.75)*t+.75:t<2.5/2.75?i*(t-=2.25/2.75)*t+.9375:i*(t-=2.625/2.75)*t+.984375,e?.5*(1-t):.5*t+.5},Form:void 0,form:function(t){return void 0!==t?new wr(br.fromAny(t)):br.Form},fromAny:function(t){if("function"==typeof t)return t;if("string"==typeof t)switch(t){case"linear":return br.linear;case"quad-in":return br.quadIn;case"quad-out":return br.quadOut;case"quad-in-out":return br.quadInOut;case"cubic-in":return br.cubicIn;case"cubic-out":return br.cubicOut;case"cubic-in-out":return br.cubicInOut;case"quart-in":return br.quartIn;case"quart-out":return br.quartOut;case"quart-in-out":return br.quartInOut;case"expo-in":return br.expoIn;case"expo-out":return br.expoOut;case"expo-in-out":return br.expoInOut;case"circ-in":return br.circIn;case"circ-out":return br.circOut;case"circ-in-out":return br.circInOut;case"back-in":return br.backIn;case"back-out":return br.backOut;case"back-in-out":return br.backInOut;case"elastic-in":return br.elasticIn;case"elastic-out":return br.elasticOut;case"elastic-in-out":return br.elasticInOut;case"bounce-in":return br.bounceIn;case"bounce-out":return br.bounceOut;case"bounce-in-out":return br.bounceInOut}throw new Error(t)}};br.linear.type="linear",br.quadIn.type="quad-in",br.quadOut.type="quad-out",br.quadInOut.type="quad-in-out",br.cubicIn.type="cubic-in",br.cubicOut.type="cubic-out",br.cubicInOut.type="cubic-in-out",br.quartIn.type="quart-in",br.quartOut.type="quart-out",br.quartInOut.type="quart-in-out",br.expoIn.type="expo-in",br.expoOut.type="expo-out",br.expoInOut.type="expo-in-out",br.circIn.type="circ-in",br.circOut.type="circ-out",br.circInOut.type="circ-in-out",br.backIn.type="back-in",br.backOut.type="back-out",br.backInOut.type="back-in-out",br.elasticIn.type="elastic-in",br.elasticOut.type="elastic-out",br.elasticInOut.type="elastic-in-out",br.bounceIn.type="bounce-in",br.bounceOut.type="bounce-out",br.bounceInOut.type="bounce-in-out";var wr=function(i){function t(t){void 0===t&&(t=br.linear);var e=i.call(this)||this;return e.unit=t,e}return v(t,i),t.prototype.mold=function(t){return t=br.fromAny(t),O.valueOf(t.type)},t.prototype.cast=function(t){var e=t.stringValue();if(void 0!==e)try{return br.fromAny(e)}catch(t){}},t}(_e);br.Form=new wr;var _r=function(){function n(t,e,i,r,o){void 0===t&&(t=n.Periods),void 0===e&&(e=n.Weekdays),void 0===i&&(i=n.ShortWeekdays),void 0===r&&(r=n.Months),void 0===o&&(o=n.ShortMonths),this.periods=t,this.weekdays=e,this.shortWeekdays=i,this.months=r,this.shortMonths=o}return n.Periods=["AM","PM"],n.Weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],n.ShortWeekdays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],n.Months=["January","February","March","April","May","June","July","August","September","October","November","December"],n.ShortMonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n.Default=new n,n}(),xr=function(){function e(t){this._offset=t}return Object.defineProperty(e.prototype,"name",{get:function(){if(0===this._offset)return"UTC"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return this._offset},enumerable:!0,configurable:!0}),e.prototype.equals=function(t){return this===t||t instanceof e&&this._offset===t._offset},e.prototype.hashCode=function(){return this._offset},e.forName=function(t){if("UTC"===t)return e.UTC;throw new Error("unknown time zone: "+t)},e.forOffset=function(t){return 0===t?e.UTC:new e(t)},e.fromAny=function(t){if(t instanceof e)return t;if("string"==typeof t)return e.forName(t);if("number"==typeof t)return e.forOffset(t);throw new TypeError(""+t)},e.UTC=new e(0),e.Form=void 0,e.Local=e.forOffset(-(new Date).getTimezoneOffset()),e}(),kr=function(i){function t(t){void 0===t&&(t=xr.UTC);var e=i.call(this)||this;return e.unit=t,e}return v(t,i),t.prototype.mold=function(t){return t=xr.fromAny(t),W.valueOf(t._offset)},t.prototype.cast=function(t){var e=t.numberValue();if(void 0!==e)return xr.forOffset(e);var i=t.stringValue();return void 0!==i?xr.forName(i):void 0},t}(_e);xr.Form=new kr;var Ar=function(){function i(){}return i.prototype.format=function(t){t=ro.fromAny(t);var e=new g;return this.writeDate(t,e),e.bind()},i.prototype.parse=function(t){for("string"==typeof t&&(t=new m(t));!t.isEmpty()&&_.isSpace(t.head());)t.step();var e=this.parseDate(t);if(e.isDone()){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();t.isEmpty()||(e=_.unexpected(t))}return e.bind()},i.prototype.parseDate=function(t,e){var i=this.parseDateTime(t,e);return i.isDone()?_.done(ro.fromAny(i.bind())):i.isError()?i.asError():new io(i)},i.formats=function(t){var e;return void 0===t&&(t=_r.Default),t===_r.Default&&(e=i.Formats),e||(e={Y:i.YearFormat,m:i.MonthNumberFormat,B:new Rr(t),b:new Lr(t),d:i.DayOfMonthFormat,A:new Ur(t),a:new Wr(t),H:i.Hour24Format,I:i.Hour12Format,p:new jr(t),M:i.MinuteFormat,S:i.SecondFormat,L:i.MillisecondFormat}),e},i.pattern=function(t,e){return(!e||e instanceof _r)&&(e=i.formats(e)),new to(t,e)},i.iso8601=function(t){return(!t||t instanceof _r)&&(t=i.formats(t)),t===i.Formats&&i.Iso8601?i.Iso8601:new to("%Y-%m-%dT%H:%M:%S.%LZ",t)},i.YearFormat=void 0,i.MonthNumberFormat=void 0,i.DayOfMonthFormat=void 0,i.Hour24Format=void 0,i.Hour12Format=void 0,i.MinuteFormat=void 0,i.SecondFormat=void 0,i.MillisecondFormat=void 0,i.Formats=void 0,i.Iso8601=void 0,i}();function Er(t,e){var i=48+t%10,r=48+(t/=10)%10;e.push(r,i)}function Cr(t,e,i,r,o,n,s,a){void 0===s&&(s=0),void 0===a&&(a=0);for(var u=0;a<r;){if(!o.isEmpty()){if(u=o.head(),_.isDigit(u)){o.step(),s=10*s+_.decodeDigit(u),a+=1;continue}return _.expected(e,o)}if(o.isDone())return _.unexpected(o);break}return(!o.isEmpty()||o.isDone())&&i<=a?t.bind(s,n):t.cont(n,s,a)}function Sr(t,e,i,r,o){void 0===o&&(o=new g);for(var n=0;;){if(i.isEmpty()||(n=i.head(),!ri.isIdentStartChar(n))){if(!i.isEmpty()||i.isDone())return t.bind(e,o.bind(),r);break}i.step(),o.push(n)}return t.cont(e,r,o)}var Vr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.writeDate=function(t,e){var i,r,o,n,s;i=t.year(),r=48+i%10,o=48+(i/=10)%10,n=48+(i/=10)%10,s=48+(i/=10)%10,e.push(s,n,o,r)},e.prototype.parseDateTime=function(t,e){return Dr.parse(t,e)},e}(Ar);Ar.YearFormat=new Vr;var Dr=function(o){function n(t,e,i){var r=o.call(this)||this;return r.date=t,r.year=e,r.step=i,r}return v(n,o),n.prototype.feed=function(t){return n.parse(t,this.date,this.year,this.step)},n.parse=function(t,e,i,r){return Cr(n,"full year",4,4,t,e,i,r)},n.bind=function(t,e){return void 0===e&&(e={}),e.year=t,_.done(e)},n.cont=function(t,e,i){return new n(t,e,i)},n}(_),Mr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.writeDate=function(t,e){Er(t.month()+1,e)},e.prototype.parseDateTime=function(t,e){return Pr.parse(t,e)},e}(Ar);Ar.MonthNumberFormat=new Mr;var Pr=function(o){function n(t,e,i){var r=o.call(this)||this;return r.date=t,r.month=e,r.step=i,r}return v(n,o),n.prototype.feed=function(t){return n.parse(t,this.date,this.month,this.step)},n.parse=function(t,e,i,r){return Cr(n,"month number",2,2,t,e,i,r)},n.bind=function(t,e){return void 0===e&&(e={}),e.month=t-1,_.done(e)},n.cont=function(t,e,i){return new n(t,e,i)},n}(_),Rr=function(i){function t(t){var e=i.call(this)||this;return e.locale=t,e}return v(t,i),t.prototype.writeDate=function(t,e){e.push(this.locale.months[t.month()])},t.prototype.parseDateTime=function(t,e){return Tr.parse(t,this.locale,e)},t}(Ar),Tr=function(o){function n(t,e,i){var r=o.call(this)||this;return r.locale=t,r.date=e,r.output=i,r}return v(n,o),n.prototype.feed=function(t){return n.parse(t,this.locale,this.date,this.output)},n.parse=function(t,e,i,r){return Sr(n,e,t,i,r)},n.bind=function(t,e,i){void 0===i&&(i={});var r=t.months.indexOf(e);return 0<=r?(i.month=r,_.done(i)):_.error("expected month, but found "+e)},n.cont=function(t,e,i){return new n(t,e,i)},n}(_),Lr=function(i){function t(t){var e=i.call(this)||this;return e.locale=t,e}return v(t,i),t.prototype.writeDate=function(t,e){e.push(this.locale.shortMonths[t.month()])},t.prototype.parseDateTime=function(t,e){return Fr.parse(t,this.locale,e)},t}(Ar),Fr=function(o){function n(t,e,i){var r=o.call(this)||this;return r.locale=t,r.date=e,r.output=i,r}return v(n,o),n.prototype.feed=function(t){return n.parse(t,this.locale,this.date,this.output)},n.parse=function(t,e,i,r){return Sr(n,e,t,i,r)},n.bind=function(t,e,i){void 0===i&&(i={});var r=t.shortMonths.indexOf(e);return 0<=r?(i.month=r,_.done(i)):_.error("expected short month, but found "+e)},n.cont=function(t,e,i){return new n(t,e,i)},n}(_),Ir=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.writeDate=function(t,e){Er(t.day(),e)},e.prototype.parseDateTime=function(t,e){return zr.parse(t,e)},e}(Ar);Ar.DayOfMonthFormat=new Ir;var zr=function(o){function n(t,e,i){var r=o.call(this)||this;return r.date=t,r.day=e,r.step=i,r}return v(n,o),n.prototype.feed=function(t){return n.parse(t,this.date,this.day,this.step)},n.parse=function(t,e,i,r){return Cr(n,"day of month",2,2,t,e,i,r)},n.bind=function(t,e){return void 0===e&&(e={}),e.day=t,_.done(e)},n.cont=function(t,e,i){return new n(t,e,i)},n}(_),Ur=function(i){function t(t){var e=i.call(this)||this;return e.locale=t,e}return v(t,i),t.prototype.writeDate=function(t,e){e.push(this.locale.weekdays[t.weekday()])},t.prototype.parseDateTime=function(t,e){return Or.parse(t,this.locale,e)},t}(Ar),Or=function(o){function n(t,e,i){var r=o.call(this)||this;return r.locale=t,r.date=e,r.output=i,r}return v(n,o),n.prototype.feed=function(t){return n.parse(t,this.locale,this.date,this.output)},n.parse=function(t,e,i,r){return Sr(n,e,t,i,r)},n.bind=function(t,e,i){return void 0===i&&(i={}),0<=t.weekdays.indexOf(e)?_.done(i):_.error("expected weekday, but found "+e)},n.cont=function(t,e,i){return new n(t,e,i)},n}(_),Wr=function(i){function t(t){var e=i.call(this)||this;return e.locale=t,e}return v(t,i),t.prototype.writeDate=function(t,e){e.push(this.locale.shortWeekdays[t.weekday()])},t.prototype.parseDateTime=function(t,e){return Br.parse(t,this.locale,e)},t}(Ar),Br=function(o){function n(t,e,i){var r=o.call(this)||this;return r.locale=t,r.date=e,r.output=i,r}return v(n,o),n.prototype.feed=function(t){return n.parse(t,this.locale,this.date,this.output)},n.parse=function(t,e,i,r){return Sr(n,e,t,i,r)},n.bind=function(t,e,i){return void 0===i&&(i={}),0<=t.shortWeekdays.indexOf(e)?_.done(i):_.error("expected short weekday, but found "+e)},n.cont=function(t,e,i){return new n(t,e,i)},n}(_),qr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.writeDate=function(t,e){Er(t.hour(),e)},e.prototype.parseDateTime=function(t,e){return Gr.parse(t,e)},e}(Ar);Ar.Hour24Format=new qr;var Gr=function(o){function n(t,e,i){var r=o.call(this)||this;return r.date=t,r.hour=e,r.step=i,r}return v(n,o),n.prototype.feed=function(t){return n.parse(t,this.date,this.hour,this.step)},n.parse=function(t,e,i,r){return Cr(n,"hour (24)",2,2,t,e,i,r)},n.bind=function(t,e){return void 0===e&&(e={}),e.hour=t,_.done(e)},n.cont=function(t,e,i){return new n(t,e,i)},n}(_),Nr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.writeDate=function(t,e){Er(t.hour()%12||12,e)},e.prototype.parseDateTime=function(t,e){return Hr.parse(t,e)},e}(Ar);Ar.Hour12Format=new Nr;var Hr=function(o){function n(t,e,i){var r=o.call(this)||this;return r.date=t,r.hour=e,r.step=i,r}return v(n,o),n.prototype.feed=function(t){return n.parse(t,this.date,this.hour,this.step)},n.parse=function(t,e,i,r){return Cr(n,"hour (12)",2,2,t,e,i,r)},n.bind=function(t,e){return void 0===e&&(e={}),e.hour=(e.hour||0)+t,_.done(e)},n.cont=function(t,e,i){return new n(t,e,i)},n}(_),jr=function(i){function t(t){var e=i.call(this)||this;return e.locale=t,e}return v(t,i),t.prototype.writeDate=function(t,e){e.push(this.locale.periods[+(12<=t.hour())])},t.prototype.parseDateTime=function(t,e){return Kr.parse(t,this.locale,e)},t}(Ar),Kr=function(o){function n(t,e,i){var r=o.call(this)||this;return r.locale=t,r.date=e,r.output=i,r}return v(n,o),n.prototype.feed=function(t){return n.parse(t,this.locale,this.date,this.output)},n.parse=function(t,e,i,r){return Sr(n,e,t,i,r)},n.bind=function(t,e,i){void 0===i&&(i={});var r=t.months.indexOf(e);return 0<=r?(i.hour=(i.hour||0)+12*r,_.done(i)):_.error("expected hour period, but found "+e)},n.cont=function(t,e,i){return new n(t,e,i)},n}(_),Yr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.writeDate=function(t,e){Er(t.minute(),e)},e.prototype.parseDateTime=function(t,e){return Xr.parse(t,e)},e}(Ar);Ar.MinuteFormat=new Yr;var Xr=function(o){function n(t,e,i){var r=o.call(this)||this;return r.date=t,r.minute=e,r.step=i,r}return v(n,o),n.prototype.feed=function(t){return n.parse(t,this.date,this.minute,this.step)},n.parse=function(t,e,i,r){return Cr(n,"minute",2,2,t,e,i,r)},n.bind=function(t,e){return void 0===e&&(e={}),e.minute=t,_.done(e)},n.cont=function(t,e,i){return new n(t,e,i)},n}(_),Qr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.writeDate=function(t,e){Er(t.second(),e)},e.prototype.parseDateTime=function(t,e){return Zr.parse(t,e)},e}(Ar);Ar.SecondFormat=new Qr;var Zr=function(o){function n(t,e,i){var r=o.call(this)||this;return r.date=t,r.second=e,r.step=i,r}return v(n,o),n.prototype.feed=function(t){return n.parse(t,this.date,this.second,this.step)},n.parse=function(t,e,i,r){return Cr(n,"second",2,2,t,e,i,r)},n.bind=function(t,e){return void 0===e&&(e={}),e.second=t,_.done(e)},n.cont=function(t,e,i){return new n(t,e,i)},n}(_),Jr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.writeDate=function(t,e){var i,r,o,n;i=t.millisecond(),r=48+i%10,o=48+(i/=10)%10,n=48+(i/=10)%10,e.push(n,o,r)},e.prototype.parseDateTime=function(t,e){return $r.parse(t,e)},e}(Ar);Ar.MillisecondFormat=new Jr;var $r=function(o){function n(t,e,i){var r=o.call(this)||this;return r.date=t,r.millisecond=e,r.step=i,r}return v(n,o),n.prototype.feed=function(t){return n.parse(t,this.date,this.millisecond,this.step)},n.parse=function(t,e,i,r){return Cr(n,"millisecond",1,3,t,e,i,r)},n.bind=function(t,e){return void 0===e&&(e={}),e.millisecond=t,_.done(e)},n.cont=function(t,e,i){return new n(t,e,i)},n}(_),to=function(r){function t(t,e){var i=r.call(this)||this;return i.pattern=t,i.formats=e,i}return v(t,r),t.prototype.writeDate=function(t,e){for(var i=this.pattern,r=this.formats,o=0,n=0,s=i.length;n<s;)if(37===i.charCodeAt(n)){o!==n&&e.push(i.slice(o,n));var a=r[i.charAt(n+1)];a&&a.writeDate(t,e),o=n+=2}else n+=1;o!==n&&e.push(i.slice(o,n))},t.prototype.parseDateTime=function(t,e){return eo.parse(t,this.pattern,this.formats,e)},t}(Ar),eo=function(s){function l(t,e,i,r,o){var n=s.call(this)||this;return n.pattern=t,n.formats=e,n.date=i,n.dateParser=r,n.step=o,n}return v(l,s),l.prototype.feed=function(t){return l.parse(t,this.pattern,this.formats,this.date,this.dateParser,this.step)},l.parse=function(t,e,i,r,o,n){void 0===n&&(n=0);for(var s=e.length;n<s;){var a=e.charCodeAt(n);if(37===a){if(!o){var u=e.charAt(n+1),h=i[u];if(!h)return _.error("unknown format specifier: "+u);o=h.parseDateTime(t,r)}for(;o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone()){r=o.bind(),o=void 0,n+=2;continue}if(o.isError())return o.asError()}else{if(!t.isEmpty()){if(t.head()===a){t.step(),n+=1;continue}return _.expected(a,t)}if(t.isDone())return _.unexpected(t)}break}return n===s?(r=r||{},_.done(r)):new l(e,i,r,o,n)},l}(_),io=function(i){function r(t){var e=i.call(this)||this;return e.dateParser=t,e}return v(r,i),r.prototype.feed=function(t){return r.parse(t,this.dateParser)},r.parse=function(t,e){for(;e.isCont()&&(!t.isEmpty()||t.isDone());)e=e.feed(t);return e.isDone()?_.done(ro.fromAny(e.bind())):e.isError()?e.asError():new r(e)},r}(_);Ar.Formats=Ar.formats(),Ar.Iso8601=Ar.iso8601();var ro=function(){function u(t,e){void 0===e&&(e=xr.UTC),this._time=t,this._zone=e}return u.prototype.time=function(t){return void 0===t?this._time:new u(t,this._zone)},u.prototype.zone=function(t){return void 0===t?this._zone:new u(this._time,t)},u.prototype.year=function(t,e,i,r,o,n,s){var a=this.toUTCLocalDate();return void 0===t?a.getUTCFullYear():(a.setUTCFullYear(t),void 0!==e&&a.setUTCMonth(e),void 0!==i&&a.setUTCDate(i),void 0!==r&&a.setUTCHours(r),void 0!==o&&a.setUTCMinutes(o),void 0!==n&&a.setUTCSeconds(n),void 0!==s&&a.setUTCMilliseconds(s),u.fromUTCLocalDate(a,this._zone))},u.prototype.month=function(t,e,i,r,o,n){var s=this.toUTCLocalDate();return void 0===t?s.getUTCMonth():(s.setUTCMonth(t),void 0!==e&&s.setUTCDate(e),void 0!==i&&s.setUTCHours(i),void 0!==r&&s.setUTCMinutes(r),void 0!==o&&s.setUTCSeconds(o),void 0!==n&&s.setUTCMilliseconds(n),u.fromUTCLocalDate(s,this._zone))},u.prototype.day=function(t,e,i,r,o){var n=this.toUTCLocalDate();return void 0===t?n.getUTCDate():(n.setUTCDate(t),void 0!==e&&n.setUTCHours(e),void 0!==i&&n.setUTCMinutes(i),void 0!==r&&n.setUTCSeconds(r),void 0!==o&&n.setUTCMilliseconds(o),u.fromUTCLocalDate(n,this._zone))},u.prototype.hour=function(t,e,i,r){var o=this.toUTCLocalDate();return void 0===t?o.getUTCHours():(o.setUTCHours(t),void 0!==e&&o.setUTCMinutes(e),void 0!==i&&o.setUTCSeconds(i),void 0!==r&&o.setUTCMilliseconds(r),u.fromUTCLocalDate(o,this._zone))},u.prototype.minute=function(t,e,i){var r=this.toUTCLocalDate();return void 0===t?r.getUTCMinutes():(r.setUTCMinutes(t),void 0!==e&&r.setUTCSeconds(e),void 0!==i&&r.setUTCMilliseconds(i),u.fromUTCLocalDate(r,this._zone))},u.prototype.second=function(t,e){var i=this.toUTCLocalDate();return void 0===t?i.getUTCSeconds():(i.setUTCSeconds(t),void 0!==e&&i.setUTCMilliseconds(e),u.fromUTCLocalDate(i,this._zone))},u.prototype.millisecond=function(t){var e=this.toUTCLocalDate();return void 0===t?e.getUTCMilliseconds():(e.setUTCMilliseconds(t),u.fromUTCLocalDate(e,this._zone))},u.prototype.weekday=function(){return this.toUTCLocalDate().getDay()},u.prototype.toUTCLocalDate=function(){return new Date(this._time+6e4*this._zone._offset)},u.prototype.toDate=function(){return new Date(this._time)},u.prototype.valueOf=function(){return this._time},u.prototype.equals=function(t){return this===t||t instanceof u&&(this._time===t._time&&this._zone.equals(t._zone))},u.prototype.compare=function(t){var e=this._time,i=+t;return e<i?-1:i<e?1:e===i?0:NaN},u.prototype.hashCode=function(){return p.mash(p.mix(p.mix(2544170115,this._time),this._zone.hashCode()))},u.prototype.toString=function(){return Ar.Iso8601.format(this)},u.fromUTCLocalDate=function(t,e){return new u(t.getTime()-6e4*e._offset,e)},u.current=function(t){return t=void 0!==t?xr.fromAny(t):xr.Local,new u(Date.now(),t)},u.time=function(t){if(t instanceof u)return t._time;if(t instanceof Date)return t.getTime();if("number"==typeof t)return t;if("string"==typeof t)return u.parse(t).time();throw t&&"object"==typeof t&&u.fromObject(t).time(),new TypeError(""+t)},u.fromAny=function(t,e){if(t instanceof u)return t;if(t instanceof Date)return e=void 0!==e?xr.fromAny(e):xr.UTC,new u(t.getTime(),e);if("number"==typeof t)return new u(t,e=void 0!==e?xr.fromAny(e):xr.UTC);if("string"==typeof t)return u.parse(t,e);if(t&&"object"==typeof t)return u.fromObject(t,e);throw new TypeError(""+t)},u.fromObject=function(t,e){var i=Date.UTC(t.year||1970,t.month||0,t.day,t.hour,t.minute,t.second,t.millisecond);return void 0!==t.zone&&(e=xr.fromAny(t.zone)),void 0!==e?i+=6e4*(e=xr.fromAny(e))._offset:e=xr.UTC,new u(i,e)},u.fromValue=function(t){var r,e=t.header("date");e.isDefined()?(t=e,r=!0):r=!1;var o={};if(t.forEach(function(t,e){var i=t.key.stringValue();void 0!==i?"year"===i?o.year=t.toValue().numberValue(o.year):"month"===i?o.month=t.toValue().numberValue(o.month):"day"===i?o.day=t.toValue().numberValue(o.day):"hour"===i?o.hour=t.toValue().numberValue(o.hour):"minute"===i?o.minute=t.toValue().numberValue(o.minute):"second"===i?o.second=t.toValue().numberValue(o.second):"millisecond"===i?o.millisecond=t.toValue().numberValue(o.millisecond):"zone"===i&&(o.zone=t.toValue().cast(xr.Form,o.zone)):t instanceof w&&r&&(0===e?o.year=t.numberValue(o.year):1===e?o.month=t.numberValue(o.month):2===e?o.day=t.numberValue(o.day):3===e?o.hour=t.numberValue(o.hour):4===e?o.minute=t.numberValue(o.minute):5===e?o.second=t.numberValue(o.second):6===e?o.millisecond=t.numberValue(o.millisecond):7===e&&(o.zone=t.cast(xr.Form,o.zone)))}),u.isInit(o))return u.fromObject(o)},u.parse=function(t,e){return Ar.Iso8601.parse(t)},u.isInit=function(t){if(t&&"object"==typeof t){var e=t;return void 0!==e.year||void 0!==e.month||void 0!==e.day||void 0!==e.hour||void 0!==e.minute||void 0!==e.second||void 0!==e.millisecond}return!1},u.Form=void 0,u}(),oo=function(i){function t(t){void 0===t&&(t=new ro(0));var e=i.call(this)||this;return e.unit=t,e}return v(t,i),t.prototype.mold=function(t){return t=ro.fromAny(t),O.valueOf(Ar.Iso8601.format(t))},t.prototype.cast=function(t){var e;try{if(!(e=ro.fromValue(t))){var i=t.numberValue();if(void 0!==i)e=new ro(i);else{var r=t.stringValue();void 0!==r&&(e=ro.parse(r))}}}catch(t){}return e},t}(_e);ro.Form=new oo;var no=1e3,so=6e4,ao=36e5,uo=function(){function r(){}return r.prototype.next=function(t,e){return this.floor(this.offset(t,e))},r.prototype.ceil=function(t){return t=t instanceof ro?t.time(t.time()-1):ro.time(t)-1,this.next(this.floor(t),1)},r.prototype.round=function(t){t=ro.fromAny(t);var e=this.floor(t),i=this.ceil(t);return t.time()-e.time()<i.time()-t.time()?e:i},r.prototype.range=function(t,e,i){t=this.ceil(t),e=ro.time(e);var r=[];if(0<(i="number"==typeof i?Math.floor(i):1))for(;t.time()<e;)r.push(t),t=this.next(t,i);return r},r.prototype.filter=function(t){return new ho(this,t)},r.years=function(t,e,i){return void 0===t?r.Years:void 0===e?r.Years.every(t):r.Years.range(t,e,i)},r.months=function(t,e,i){return void 0===t?r.Months:void 0===e?r.Months.every(t):r.Months.range(t,e,i)},r.weeks=function(t,e,i){return void 0===t?r.Weeks:r.Weeks.range(t,e,i)},r.days=function(t,e,i){return void 0===t?r.Days:void 0===e?r.Days.every(t):r.Days.range(t,e,i)},r.hours=function(t,e,i){return void 0===t?r.Hours:void 0===e?r.Hours.every(t):r.Hours.range(t,e,i)},r.minutes=function(t,e,i){return void 0===t?r.Minutes:void 0===e?r.Minutes.every(t):r.Minutes.range(t,e,i)},r.seconds=function(t,e,i){return void 0===t?r.Seconds:void 0===e?r.Seconds.every(t):r.Seconds.range(t,e,i)},r.milliseconds=function(t,e,i){return void 0===t?r.Milliseconds:void 0===e?r.Milliseconds.every(t):r.Milliseconds.range(t,e,i)},r.Years=void 0,r.Months=void 0,r.Weeks=void 0,r.Days=void 0,r.Hours=void 0,r.Minutes=void 0,r.Seconds=void 0,r.Milliseconds=void 0,r}(),ho=function(r){function t(t,e){var i=r.call(this)||this;return i.unit=t,i.predicate=e,i}return v(t,r),t.prototype.offset=function(t,e){for(t=ro.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1);e<0;){for(;t=this.unit.offset(t,-1),!this.predicate(t););e+=1}for(;0<e;){for(;t=this.unit.offset(t,1),!this.predicate(t););e-=1}return t},t.prototype.floor=function(t){for(t=ro.fromAny(t);t=this.unit.floor(t),!this.predicate(t);)t=t.time(t.time()-1);return t},t}(uo),lo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e}(uo),po=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.offset=function(t,e){return t=ro.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t=t.year(t.year()+e)},e.prototype.next=function(t,e){return t=ro.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.year(t.year()+e).month(0,1).hour(0,0,0,0)},e.prototype.floor=function(t){return(t=ro.fromAny(t)).month(0,1).hour(0,0,0,0)},e.prototype.ceil=function(t){return(t=(t=(t=(t=ro.fromAny(t)).time(t.time()-1)).month(0,1).hour(0,0,0,0)).year(t.year()+1)).month(0,1).hour(0,0,0,0)},e.prototype.every=function(t){if(1===t)return this;if(isFinite(t)&&1<=t)return new co(t);throw new Error(""+t)},e}(lo);uo.Years=new po;var co=function(i){function t(t){var e=i.call(this)||this;return e.stride=t||1,e}return v(t,i),t.prototype.offset=function(t,e){return t=ro.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.year(t.year()+e*this.stride)},t.prototype.next=function(t,e){return t=ro.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),(t=t.year(Math.floor((t.year()+e*this.stride)/this.stride)*this.stride)).month(0,1).hour(0,0,0,0)},t.prototype.floor=function(t){return(t=(t=ro.fromAny(t)).year(Math.floor(t.year()/this.stride)*this.stride)).month(0,1).hour(0,0,0,0)},t.prototype.ceil=function(t){return(t=(t=(t=(t=(t=ro.fromAny(t)).time(t.time()-1)).year(Math.floor(t.year()/this.stride)*this.stride)).month(0,1).hour(0,0,0,0)).year(Math.floor((t.year()+this.stride)/this.stride)*this.stride)).month(0,1).hour(0,0,0,0)},t}(uo),fo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.offset=function(t,e){return t=ro.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.month(t.month()+e)},e.prototype.next=function(t,e){return t=ro.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),(t=t.month(t.month()+e)).day(1).hour(0,0,0,0)},e.prototype.floor=function(t){return(t=ro.fromAny(t)).day(1).hour(0,0,0,0)},e.prototype.ceil=function(t){return(t=(t=(t=(t=ro.fromAny(t)).time(t.time()-1)).day(1).hour(0,0,0,0)).month(t.month()+1)).day(1).hour(0,0,0,0)},e.prototype.every=function(t){if(1===t)return this;if(isFinite(t)&&1<=t)return new ho(this,e.modulo.bind(null,t));throw new Error(""+t)},e.modulo=function(t,e){return e.month()%t==0},e}(lo);uo.Months=new fo;var yo=function(i){function t(t){void 0===t&&(t=0);var e=i.call(this)||this;return e.day=t,e}return v(t,i),t.prototype.offset=function(t,e){return t=ro.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.day(t.day()+7*e)},t.prototype.next=function(t,e){return t=ro.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),(t=(t=t.day(t.day()+7*e)).day(t.day()-(t.weekday()+7-this.day)%7)).hour(0,0,0,0)},t.prototype.floor=function(t){return(t=(t=ro.fromAny(t)).day(t.day()-(t.weekday()+7-this.day)%7)).hour(0,0,0,0)},t.prototype.ceil=function(t){return(t=(t=(t=(t=(t=(t=ro.fromAny(t)).time(t.time()-1)).day(t.day()-(t.weekday()+7-this.day)%7)).hour(0,0,0,0)).day(t.day()+7)).day(t.day()-(t.weekday()+7-this.day)%7)).hour(0,0,0,0)},t}(uo);uo.Weeks=new yo;var mo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.offset=function(t,e){return t=ro.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.day(t.day()+e)},e.prototype.next=function(t,e){return t=ro.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),(t=t.day(t.day()+e)).hour(0,0,0,0)},e.prototype.floor=function(t){return(t=ro.fromAny(t)).hour(0,0,0,0)},e.prototype.ceil=function(t){return(t=(t=(t=(t=ro.fromAny(t)).time(t.time()-1)).hour(0,0,0,0)).day(t.day()+1)).hour(0,0,0,0)},e.prototype.every=function(t){if(1===t)return this;if(isFinite(t)&&1<=t)return new ho(this,e.modulo.bind(null,t));throw new Error(""+t)},e.modulo=function(t,e){return e.day()%t==0},e}(lo);uo.Days=new mo;var vo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.offset=function(t,e){return t=ro.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.time(t.time()+e*ao)},e.prototype.next=function(t,e){t=ro.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1);var i=(t=t.time(t.time()+e*ao)).zone().offset*so%ao;return i<0&&(i+=ao),t.time(Math.floor((t.time()-i)/ao)*ao+i)},e.prototype.floor=function(t){var e=(t=ro.fromAny(t)).zone().offset*so%ao;return e<0&&(e+=ao),t.time(Math.floor((t.time()-e)/ao)*ao+e)},e.prototype.ceil=function(t){var e=(t=(t=ro.fromAny(t)).time(t.time()-1)).zone().offset*so%ao;return e<0&&(e+=ao),(e=(t=t.time(Math.floor((t.time()-e)/ao)*ao+e+ao)).zone().offset*so%ao)<0&&(e+=ao),t.time(Math.floor((t.time()-e)/ao)*ao+e)},e.prototype.every=function(t){if(1===t)return this;if(isFinite(t)&&1<=t)return new ho(this,e.modulo.bind(null,t));throw new Error(""+t)},e.modulo=function(t,e){return e.hour()%t==0},e}(lo);uo.Hours=new vo;var go=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.offset=function(t,e){return t=ro.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.time(t.time()+e*so)},e.prototype.next=function(t,e){return t=ro.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.time(Math.floor((t.time()+e*so)/so)*so)},e.prototype.floor=function(t){return(t=ro.fromAny(t)).time(Math.floor(t.time()/so)*so)},e.prototype.ceil=function(t){return(t=ro.fromAny(t)).time(Math.floor((Math.floor((t.time()-1)/so)*so+so)/so)*so)},e.prototype.every=function(t){if(1===t)return this;if(isFinite(t)&&1<=t)return new ho(this,e.modulo.bind(null,t));throw new Error(""+t)},e.modulo=function(t,e){return e.minute()%t==0},e}(lo);uo.Minutes=new go;var bo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.offset=function(t,e){return t=ro.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.time(t.time()+e*no)},e.prototype.next=function(t,e){return t=ro.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.time(Math.floor((t.time()+e*no)/no)*no)},e.prototype.floor=function(t){return(t=ro.fromAny(t)).time(Math.floor(t.time()/no)*no)},e.prototype.ceil=function(t){return(t=ro.fromAny(t)).time(Math.floor((Math.floor((t.time()-1)/no)*no+no)/no)*no)},e.prototype.every=function(t){if(1===t)return this;if(isFinite(t)&&1<=t)return new ho(this,e.modulo.bind(null,t));throw new Error(""+t)},e.modulo=function(t,e){return e.second()%t==0},e}(lo);uo.Seconds=new bo;var wo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.offset=function(t,e){return t=ro.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.time(t.time()+e)},e.prototype.next=function(t,e){return t=ro.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.time(t.time()+e)},e.prototype.floor=function(t){return ro.fromAny(t)},e.prototype.ceil=function(t){return ro.fromAny(t)},e.prototype.every=function(t){if(1===t)return this;if(isFinite(t)&&1<=t)return new _o(t);throw new Error(""+t)},e}(lo);uo.Milliseconds=new wo;var _o=function(i){function t(t){var e=i.call(this)||this;return e.stride=t||1,e}return v(t,i),t.prototype.offset=function(t,e){return t=ro.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t.time(t.time()+e*this.stride)},t.prototype.next=function(t,e){t=ro.fromAny(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1);var i=this.stride;return t.time(Math.floor((t.time()+e*i)/i)*i)},t.prototype.floor=function(t){t=ro.fromAny(t);var e=this.stride;return t.time(Math.floor(t.time()/e)*e)},t.prototype.ceil=function(t){t=ro.fromAny(t);var e=this.stride;return t.time(Math.floor((Math.floor((t.time()-1)/e)*e+e)/e)*e)},t}(uo),xo=Math.PI,ko=2*xo,Ao=function(){function i(){}return i.prototype.isDefined=function(){return 0!==this.value},i.prototype.plus=function(t,e){return void 0===e&&(e=this.units),i.fromAny(this.toValue(e)+i.fromAny(t).toValue(e),e)},i.prototype.neg=function(t){return void 0===t&&(t=this.units),i.fromAny(-this.toValue(t),t)},i.prototype.minus=function(t,e){return void 0===e&&(e=this.units),i.fromAny(this.toValue(e)-i.fromAny(t).toValue(e),e)},i.prototype.times=function(t,e){return void 0===e&&(e=this.units),i.fromAny(this.toValue(e)*t,e)},i.prototype.divide=function(t,e){return void 0===e&&(e=this.units),i.fromAny(this.toValue(e)/t,e)},i.prototype.norm=function(t,e){return void 0===e&&(e=this.units),i.fromAny(this.toValue(e)/i.fromAny(t).toValue(e),e)},i.prototype.deg=function(){return new Eo(this.degValue())},i.prototype.grad=function(){return new Co(this.gradValue())},i.prototype.rad=function(){return new So(this.radValue())},i.prototype.turn=function(){return new Vo(this.turnValue())},i.prototype.toValue=function(t){switch(t){case"deg":return this.degValue();case"grad":return this.gradValue();case"rad":return this.radValue();case"turn":return this.turnValue();default:throw new TypeError(t)}},i.prototype.to=function(t){switch(t){case"deg":return this.deg();case"grad":return this.grad();case"rad":return this.rad();case"turn":return this.turn();default:throw new TypeError(t)}},i.prototype.equals=function(t){return t instanceof i&&(this.value===t.value&&this.units===t.units)},i.prototype.toString=function(){return this.value+this.units},i.form=function(t){return void 0!==t?new Mo(t):i.Form},i.zero=function(t){switch(t=t||"rad"){case"deg":return new Eo(0);case"grad":return new Co(0);case"rad":return new So(0);case"turn":return new Vo(0);default:throw new TypeError(t)}},i.deg=function(t){return new Eo(t)},i.grad=function(t){return new Co(t)},i.rad=function(t){return new So(t)},i.turn=function(t){return new Vo(t)},i.fromAny=function(t,e){if(t instanceof i)return t;if("number"!=typeof t){if("string"==typeof t)return i.parse(t);throw new Error}if("string"!=typeof e)return new So(t);switch(e){case"deg":return new Eo(t);case"grad":return new Co(t);case"":case"rad":return new So(t);case"turn":return new Vo(t);default:throw new Error(e)}},i.fromValue=function(t){if(2===t.length){var e=t.getItem(0).numberValue(),i=t.getItem(1);if(void 0!==e&&isFinite(e)&&i instanceof P&&i.value===w.Extant)switch(i.key.value){case"deg":return new Eo(e);case"grad":return new Co(e);case"rad":return new So(e);case"turn":return new Vo(e)}}},i.parse=function(t,e){for(var i=new m(t);!i.isEmpty()&&_.isSpace(i.head());)i.step();var r=Do.parse(i,e);if(r.isDone()){for(;!i.isEmpty()&&_.isSpace(i.head());)i.step();i.isEmpty()||(r=_.unexpected(i))}return r.bind()},i.Form=void 0,i}(),Eo=function(i){function t(t){var e=i.call(this)||this;return e.value=t,e}return v(t,i),Object.defineProperty(t.prototype,"units",{get:function(){return"deg"},enumerable:!0,configurable:!0}),t.prototype.degValue=function(){return this.value},t.prototype.gradValue=function(){return 10*this.value/9},t.prototype.radValue=function(){return this.value*xo/180},t.prototype.turnValue=function(){return this.value/360},t.prototype.deg=function(){return this},t}(Ao),Co=function(i){function t(t){var e=i.call(this)||this;return e.value=t,e}return v(t,i),Object.defineProperty(t.prototype,"units",{get:function(){return"grad"},enumerable:!0,configurable:!0}),t.prototype.degValue=function(){return.9*this.value},t.prototype.gradValue=function(){return this.value},t.prototype.radValue=function(){return this.value*xo/200},t.prototype.turnValue=function(){return this.value/400},t.prototype.grad=function(){return this},t}(Ao),So=function(i){function t(t){var e=i.call(this)||this;return e.value=t,e}return v(t,i),Object.defineProperty(t.prototype,"units",{get:function(){return"rad"},enumerable:!0,configurable:!0}),t.prototype.degValue=function(){return 180*this.value/xo},t.prototype.gradValue=function(){return 200*this.value/xo},t.prototype.radValue=function(){return this.value},t.prototype.turnValue=function(){return this.value/ko},t.prototype.rad=function(){return this},t}(Ao),Vo=function(i){function t(t){var e=i.call(this)||this;return e.value=t,e}return v(t,i),Object.defineProperty(t.prototype,"units",{get:function(){return"turn"},enumerable:!0,configurable:!0}),t.prototype.degValue=function(){return 360*this.value},t.prototype.gradValue=function(){return 400*this.value},t.prototype.radValue=function(){return this.value*ko},t.prototype.turnValue=function(){return this.value},t.prototype.turn=function(){return this},t}(Ao),Do=function(n){function u(t,e,i,r){var o=n.call(this)||this;return o.defaultUnits=t,o.valueParser=e,o.unitsOutput=i,o.step=r,o}return v(u,n),u.prototype.feed=function(t){return u.parse(t,this.defaultUnits,this.valueParser,this.unitsOutput,this.step)},u.parse=function(t,e,i,r,o){void 0===e&&(e=""),void 0===o&&(o=1);var n=0;if(1===o){for(i||(i=ri.Factory.parseDecimal(t));i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())o=2;else if(i.isError())return i.asError()}if(2===o){for(r=r||new g;!t.isEmpty()&&(n=t.head(),_.isAlpha(n));)t.step(),r.push(n);if(!t.isEmpty()||t.isDone()){var s=i.bind().numberValue(),a=r.bind()||e;switch(a){case"deg":return _.done(new Eo(s));case"grad":return _.done(new Co(s));case"":case"rad":return _.done(new So(s));case"turn":return _.done(new Vo(s));default:return _.error(a)}}}return new u(e,i,r,o)},u}(_),Mo=function(i){function t(t){var e=i.call(this)||this;return e.units=t,e}return v(t,i),Object.defineProperty(t.prototype,"unit",{get:function(){return Ao.zero(this.units)},enumerable:!0,configurable:!0}),t.prototype.mold=function(t){return t=Ao.fromAny(t),O.valueOf(t.toString())},t.prototype.cast=function(t){var e;try{if(!(e=Ao.fromValue(t))){var i=t.stringValue();void 0!==i&&(e=Ao.parse(i))}}catch(t){}return e},t}(_e);function Po(t){for(;t;){if(t instanceof HTMLElement&&t.offsetParent instanceof HTMLElement)return t.offsetParent.offsetWidth;t=t.parentNode||void 0}return 0}function Ro(t){for(;t;){if(t instanceof Element){var e=getComputedStyle(t).fontSize;if(null!==e)return parseFloat(e)}t=t.parentNode||void 0}return 0}function To(){var t=getComputedStyle(document.documentElement).fontSize;return null!==t?parseFloat(t):0}Ao.Form=new Mo;var Lo=function(){function r(){}return r.prototype.isDefined=function(){return 0!==this.value},Object.defineProperty(r.prototype,"unitValue",{get:function(){return 0},enumerable:!0,configurable:!0}),r.prototype.emValue=function(){return this.pxValue()/Ro(this.node)},r.prototype.remValue=function(){return this.pxValue()/To()},r.prototype.pctValue=function(){return this.px().value/this.unitValue},r.prototype.px=function(){return new Fo(this.pxValue(),this.node)},r.prototype.em=function(){return new Io(this.emValue(),this.node)},r.prototype.rem=function(){return new zo(this.remValue(),this.node)},r.prototype.pct=function(){return new Uo(this.pctValue(),this.node)},r.prototype.toValue=function(t){switch(t){case"px":return this.pxValue();case"em":return this.emValue();case"rem":return this.remValue();case"%":return this.pctValue();default:throw new TypeError(t)}},r.prototype.to=function(t){switch(t){case"px":return this.px();case"em":return this.em();case"rem":return this.rem();case"%":return this.pct();default:throw new TypeError(t)}},r.prototype.equals=function(t){return t instanceof r&&(this.value===t.value&&this.units===t.units&&this.node===t.node)},r.prototype.toString=function(){return this.value+this.units},r.form=function(t){return t?new Bo(t):r.Form},r.zero=function(t){return new Fo(0,t)},r.px=function(t,e){return new Fo(t,e)},r.em=function(t,e){return new Io(t,e)},r.rem=function(t,e){return new zo(t,e)},r.pct=function(t,e){return new Uo(t,e)},r.unitless=function(t,e){return new Oo(t,e)},r.fromAny=function(t,e,i){if(t instanceof r)return t;if("number"!=typeof t){if("string"==typeof t&&"string"!=typeof e)return r.parse(t,e);throw new Error}if("string"!=typeof e)return void 0!==e&&(i=e),new Fo(t,i);switch(e){case"px":return new Fo(t,i);case"em":return new Io(t,i);case"rem":return new zo(t,i);case"%":return new Uo(t,i);case"":return new Oo(t,i);default:throw new Error(e)}},r.fromValue=function(t,e){if(2===t.length){var i=t.getItem(0).numberValue(),r=t.getItem(1);if(void 0!==i&&isFinite(i)&&r instanceof P&&r.value===w.Extant)switch(r.key.value){case"px":return new Fo(i,e);case"em":return new Io(i,e);case"rem":return new zo(i,e);case"pct":return new Uo(i,e)}}},r.parse=function(t,e){for(var i=new m(t);!i.isEmpty()&&_.isSpace(i.head());)i.step();var r=Wo.parse(i,e);if(r.isDone()){for(;!i.isEmpty()&&_.isSpace(i.head());)i.step();i.isEmpty()||(r=_.unexpected(i))}return r.bind()},r.widthUnit=function(){return Po(this.node)},r.emUnit=function(){return Ro(this.node)},r.Form=void 0,r}(),Fo=function(r){function t(t,e){var i=r.call(this)||this;return i.value=t,i.node=e,i}return v(t,r),Object.defineProperty(t.prototype,"units",{get:function(){return"px"},enumerable:!0,configurable:!0}),t.prototype.pxValue=function(){return this.value},t.prototype.px=function(){return this},t}(Lo),Io=function(r){function t(t,e){var i=r.call(this)||this;return i.value=t,i.node=e,i}return v(t,r),Object.defineProperty(t.prototype,"units",{get:function(){return"em"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unitValue",{get:function(){return Ro(this.node)},enumerable:!0,configurable:!0}),t.prototype.pxValue=function(){return this.unitValue*this.value},t.prototype.em=function(){return this},t}(Lo),zo=function(r){function t(t,e){var i=r.call(this)||this;return i.value=t,i.node=e,i}return v(t,r),Object.defineProperty(t.prototype,"units",{get:function(){return"rem"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unitValue",{get:function(){return To()},enumerable:!0,configurable:!0}),t.prototype.pxValue=function(){return this.unitValue*this.value},t.prototype.rem=function(){return this},t}(Lo),Uo=function(r){function t(t,e){var i=r.call(this)||this;return i.value=t,i.node=e,i}return v(t,r),Object.defineProperty(t.prototype,"units",{get:function(){return"%"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unitValue",{get:function(){return Po(this.node)},enumerable:!0,configurable:!0}),t.prototype.pxValue=function(t){return void 0===t&&(t=this.unitValue),t*this.value/100},t.prototype.pct=function(){return this},t}(Lo),Oo=function(r){function t(t,e){var i=r.call(this)||this;return i.value=t,i.node=e,i}return v(t,r),Object.defineProperty(t.prototype,"units",{get:function(){return""},enumerable:!0,configurable:!0}),t.prototype.pxValue=function(){return this.value},t}(Lo),Wo=function(n){function u(t,e,i,r){var o=n.call(this)||this;return o.node=t,o.valueParser=e,o.unitsOutput=i,o.step=r,o}return v(u,n),u.prototype.feed=function(t){return u.parse(t,this.node,this.valueParser,this.unitsOutput,this.step)},u.parse=function(t,e,i,r,o){void 0===o&&(o=1);var n=0;if(1===o){for(i||(i=ri.Factory.parseDecimal(t));(!t.isEmpty()||t.isDone())&&i.isCont();)i=i.feed(t);if(i.isDone())o=2;else if(i.isError())return i.asError()}if(2===o){for(r=r||new g;!t.isEmpty()&&(n=t.head(),_.isAlpha(n)||37===n);)t.step(),r.push(n);if(!t.isEmpty()||t.isDone()){var s=i.bind().numberValue(),a=r.bind();switch(a){case"px":return _.done(new Fo(s,e));case"em":return _.done(new Io(s,e));case"rem":return _.done(new zo(s,e));case"%":return _.done(new Uo(s,e));case"":return _.done(new Oo(s,e));default:return _.error(a)}}}return new u(e,i,r,o)},u}(_),Bo=function(i){function t(t){var e=i.call(this)||this;return e.node=t,e}return v(t,i),Object.defineProperty(t.prototype,"unit",{get:function(){return Lo.zero(this.node)},enumerable:!0,configurable:!0}),t.prototype.mold=function(t){return t=Lo.fromAny(t),O.valueOf(t.toString())},t.prototype.cast=function(t){var e;try{if(!(e=Lo.fromValue(t))){var i=t.stringValue();void 0!==i&&(e=Lo.parse(i))}}catch(t){}return e},t}(_e);Lo.Form=new Bo;var qo=function(){function o(){}return o.prototype.contrast=function(t){return this.lightness()<.67?this.brighter(t):this.darker(t)},o.form=function(t){return void 0!==t?new Jo(o.fromAny(t)):o.Form},o.transparent=function(t){return Go.transparent(t)},o.black=function(){return Go.black()},o.white=function(){return Go.white()},o.rgb=function(t,e,i,r){return 1===arguments.length?o.fromAny(t).rgb():new Go(t,e,i,r)},o.hsl=function(t,e,i,r){return 1===arguments.length?o.fromAny(t).hsl():(t="number"==typeof t?t:Ao.fromAny(t).degValue(),new No(t,e,i,r))},o.fromAny=function(t){if(t instanceof o)return t;if("string"==typeof t)return o.parse(t);if(t&&"object"==typeof t){var e=t;if(void 0!==e.r&&void 0!==e.g&&void 0!==e.b)return new Go(e.r,e.g,e.b,e.a);var i=t;if(void 0!==i.h&&void 0!==i.s&&void 0!==i.l){var r="number"==typeof i.h?i.h:Ao.fromAny(i.h).degValue();return new No(r,i.s,i.l,i.a)}}throw new TypeError(""+t)},o.fromValue=function(t){var e;return(e=Go.fromValue(t))||(e=No.fromValue(t)),e},o.parse=function(t){for(var e=new m(t);!e.isEmpty()&&_.isSpace(e.head());)e.step();var i=Zo.parse(e);if(i.isDone()){for(;!e.isEmpty()&&_.isSpace(e.head());)e.step();e.isEmpty()||(i=_.unexpected(e))}return i.bind()},o.isInit=function(t){return Go.isInit(t)||No.isInit(t)},o.Form=void 0,o}(),Go=function(n){function o(t,e,i,r){void 0===r&&(r=1);var o=n.call(this)||this;return o.r=t,o.g=e,o.b=i,o.a=r,o}return v(o,n),o.prototype.isDefined=function(){return 0!==this.r||0!==this.g||0!==this.b||1!==this.a},o.prototype.alpha=function(t){return void 0===t?this.a:new o(this.r,this.g,this.b,t)},o.prototype.lightness=function(){var t=this.r/255,e=this.g/255,i=this.b/255,r=Math.min(t,e,i);return(Math.max(t,e,i)+r)/2},o.prototype.brighter=function(t){return t=void 0===t?1/.7:Math.pow(1/.7,t),new o(this.r*t,this.g*t,this.b*t,this.a)},o.prototype.darker=function(t){return t=void 0===t?.7:Math.pow(.7,t),new o(this.r*t,this.g*t,this.b*t,this.a)},o.prototype.rgb=function(){return this},o.prototype.hsl=function(){var t=this.r/255,e=this.g/255,i=this.b/255,r=Math.min(t,e,i),o=Math.max(t,e,i),n=NaN,s=o-r,a=(o+r)/2;return s?(n=t===o?(e-i)/s+6*+(e<i):e===o?(i-t)/s+2:(t-e)/s+4,s/=a<.5?o+r:2-(o+r),n*=60):s=0<a&&a<1?0:n,new No(n,s,a,this.a)},o.prototype.equals=function(t){return t instanceof o&&(this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a)},o.prototype.toHexString=function(){var t=Math.min(Math.max(0,Math.round(this.r||0)),255),e=Math.min(Math.max(0,Math.round(this.g||0)),255),i=Math.min(Math.max(0,Math.round(this.b||0)),255),r="#";return r+=o.Base16Alphabet.charAt(t>>>4&15),r+=o.Base16Alphabet.charAt(15&t),r+=o.Base16Alphabet.charAt(e>>>4&15),r+=o.Base16Alphabet.charAt(15&e),r+=o.Base16Alphabet.charAt(i>>>4&15),r+=o.Base16Alphabet.charAt(15&i)},o.prototype.toString=function(){var t=this.a;if(1===(t=isNaN(t)?1:Math.max(0,Math.min(this.a,1))))return this.toHexString();var e="rgba";return e+="(",e+=Math.max(0,Math.min(Math.round(this.r)||0,255)),e+=",",e+=Math.max(0,Math.min(Math.round(this.g)||0,255)),e+=",",e+=Math.max(0,Math.min(Math.round(this.b)||0,255)),1!==t&&(e+=",",e+=t),e+=")"},o.transparent=function(t){return void 0===t&&(t=0),new o(0,0,0,t)},o.black=function(){return new o(0,0,0,1)},o.white=function(){return new o(255,255,255,1)},o.fromValue=function(t){var r,o,n,s,a,e=t.tag;if("rgb"===e||"rgba"===e?(t=t.header(e),r=!0):r=!1,t.forEach(function(t,e){var i=t.key.stringValue();void 0!==i?"r"===i?o=t.toValue().numberValue(o):"g"===i?n=t.toValue().numberValue(n):"b"===i?s=t.toValue().numberValue(s):"a"===i&&(a=t.toValue().numberValue(a)):t instanceof w&&r&&(0===e?o=t.numberValue(o):1===e?n=t.numberValue(n):2===e?s=t.numberValue(s):3===e&&(a=t.numberValue(a)))}),void 0!==o&&void 0!==n&&void 0!==s)return qo.rgb(o,n,s,a)},o.parse=function(t){return qo.parse(t).rgb()},o.isInit=function(t){if(t&&"object"==typeof t){var e=t;return void 0!==e.r&&void 0!==e.g&&void 0!==e.b}return!1},o.Base16Alphabet="0123456789abcdef",o}(qo),No=function(n){function s(t,e,i,r){void 0===r&&(r=1);var o=n.call(this)||this;return o.h=t,o.s=e,o.l=i,o.a=r,o}return v(s,n),s.prototype.isDefined=function(){return 0!==this.h||0!==this.s||0!==this.l||1!==this.a},s.prototype.alpha=function(t){return void 0===t?this.a:new s(this.h,this.s,this.l,t)},s.prototype.lightness=function(){return this.l},s.prototype.brighter=function(t){return t=void 0===t?1/.7:Math.pow(1/.7,t),new s(this.h,this.s,this.l*t,this.a)},s.prototype.darker=function(t){return t=void 0===t?.7:Math.pow(.7,t),new s(this.h,this.s,this.l*t,this.a)},s.toRgb=function(t,e,i){return 255*(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)},s.prototype.rgb=function(){var t=this.h%360+360*+(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,r=i+(i<.5?i:1-i)*e,o=2*i-r;return new Go(s.toRgb(240<=t?t-240:t+120,o,r),s.toRgb(t,o,r),s.toRgb(t<120?t+240:t-120,o,r),this.a)},s.prototype.hsl=function(){return this},s.prototype.equals=function(t){return t instanceof s&&(this.h===t.h&&this.s===t.s&&this.l===t.l&&this.a===t.a)},s.prototype.toHexString=function(){return this.rgb().toHexString()},s.prototype.toString=function(){var t=this.a,e=1===(t=isNaN(t)?1:Math.max(0,Math.min(this.a,1)))?"hsl":"hsla";return e+="(",e+=Math.max(0,Math.min(Math.round(this.h)||0,360)),e+=",",e+=Math.max(0,Math.min(100*Math.round(this.s)||0,100))+"%",e+=",",e+=Math.max(0,Math.min(100*Math.round(this.l)||0,100))+"%",1!==t&&(e+=",",e+=t),e+=")"},s.transparent=function(t){return void 0===t&&(t=0),new s(0,0,0,t)},s.black=function(){return new s(0,0,0,1)},s.white=function(){return new s(0,1,1,1)},s.fromValue=function(t){var r,o,n,s,a,e=t.tag;if("hsl"===e||"hsla"===e?(t=t.header(e),r=!0):r=!1,t.forEach(function(t,e){var i=t.key.stringValue();void 0!==i?"h"===i?o=t.toValue().cast(Ao.Form,o):"s"===i?n=t.toValue().numberValue(n):"l"===i?s=t.toValue().numberValue(s):"a"===i&&(a=t.toValue().numberValue(a)):t instanceof w&&r&&(0===e?o=t.cast(Ao.Form,o):1===e?n=t.numberValue(n):2===e?s=t.numberValue(s):3===e&&(a=t.numberValue(a)))}),void 0!==o&&void 0!==n&&void 0!==s)return qo.hsl(o,n,s,a)},s.parse=function(t){return qo.parse(t).hsl()},s.isInit=function(t){if(t&&"object"==typeof t){var e=t;return void 0!==e.h&&void 0!==e.s&&void 0!==e.l}return!1},s}(qo),Ho=function(){function t(t,e){void 0===e&&(e=""),this.value=t,this.units=e}return t.prototype.scale=function(t){return"%"===this.units?this.value*t/100:this.value},t}(),jo=function(r){function o(t,e){var i=r.call(this)||this;return i.valueParser=t,i.step=e,i}return v(o,r),o.prototype.feed=function(t){return o.parse(t,this.valueParser,this.step)},o.parse=function(t,e,i){if(void 0===i&&(i=1),1===i){for(e||(e=ri.Factory.parseNumber(t));e.isCont()&&(!t.isEmpty()||t.isDone());)e=e.feed(t);if(e.isDone())i=2;else if(e.isError())return e.asError()}if(2===i){if(!t.isEmpty()&&37===t.head())return t.step(),_.done(new Ho(e.bind().numberValue(),"%"));if(!t.isEmpty()||t.isDone())return _.done(new Ho(e.bind().numberValue()))}return new o(e,i)},o}(_);function Ko(t,e,i,r,o,n,s){void 0===s&&(s=1);var a=0;if(1===s){for(e||(e=ri.Factory.parseIdent(t));e.isCont()&&(!t.isEmpty()||t.isDone());)e=e.feed(t);if(e.isDone())s=2;else if(e.isError())return e.asError()}if(2===s)if(t.isEmpty()||40!==t.head()){if(!t.isEmpty()||t.isDone())return _.expected("(",t)}else t.step(),s=3;if(3===s){if(!i){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();t.isEmpty()||(i=this.parseX(t))}if(i){for(;i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())s=4;else if(i.isError())return i.asError()}else if(t.isDone())return _.unexpected(t)}if(4===s){for(;!t.isEmpty()&&(a=t.head(),_.isSpace(a));)t.step();if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else 44===a&&t.step(),s=5}if(5===s){if(!r){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();t.isEmpty()||(r=this.parseY(t))}if(r){for(;r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())s=6;else if(r.isError())return r.asError()}else if(t.isDone())return _.unexpected(t)}if(6===s){for(;!t.isEmpty()&&(a=t.head(),_.isSpace(a));)t.step();if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else 44===a&&t.step(),s=7}if(7===s){if(!o){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();t.isEmpty()||(o=this.parseZ(t))}if(o){for(;o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone())s=8;else if(o.isError())return o.asError()}else if(t.isDone())return _.unexpected(t)}if(8===s){for(;!t.isEmpty()&&(a=t.head(),_.isSpace(a));)t.step();if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(41===a){t.step();try{return _.done(this.decode(e.bind().stringValue(),i.bind(),r.bind(),o.bind()))}catch(t){return _.error(t)}}else 44===a&&t.step();s=9}}if(9===s){if(!n){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();t.isEmpty()||(n=this.parseA(t))}if(n){for(;n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())s=10;else if(n.isError())return n.asError()}else if(t.isDone())return _.unexpected(t)}if(10===s){for(;!t.isEmpty()&&(a=t.head(),_.isSpace(a));)t.step();if(t.isEmpty()||41!==a){if(!t.isEmpty()||t.isDone())return _.expected(")",t)}else{t.step();try{return _.done(this.decode(e.bind().stringValue(),i.bind(),r.bind(),o.bind(),n.bind()))}catch(t){return _.error(t)}}}return this.cont(e,i,r,o,n,s)}var Yo=function(r){function o(t,e){var i=r.call(this)||this;return i.value=t,i.step=e,i}return v(o,r),o.prototype.feed=function(t){return o.parse(t,this.value,this.step)},o.parse=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=1);var r=0;if(1===i)if(t.isEmpty()||35!==t.head()){if(!t.isEmpty()||t.isDone())return _.expected("#",t)}else t.step(),i=2;if(2<=i){for(;i<=9&&!t.isEmpty()&&(r=t.head(),_.isHexChar(r));)t.step(),e=e<<4|_.decodeHexChar(r),i+=1;if(!t.isEmpty()||t.isDone())return 5===i?_.done(new Go(e>>8&15|e>>4&240,e>>4&15|240&e,e<<4&240|15&e)):6===i?_.done(new Go(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,(e<<4&240|15&e)/255)):8===i?_.done(new Go(e>>16&255,e>>8&255,255&e)):10===i?_.done(new Go(e>>24&255,e>>16&255,e>>8&255,(255&e)/255)):_.unexpected(t)}return new o(e,i)},o}(_),Xo=function(a){function u(t,e,i,r,o,n){var s=a.call(this)||this;return s.identParser=t,s.rParser=e,s.gParser=i,s.bParser=r,s.aParser=o,s.step=n,s}return v(u,a),u.prototype.feed=function(t){return u.parse(t,this.identParser,this.rParser,this.gParser,this.bParser,this.aParser,this.step)},u.parse=function(t,e,i,r,o,n,s){return Ko.call(u,t,e,i,r,o,n,s)},u.parseRest=function(t,e){return u.parse(t,e,void 0,void 0,void 0,void 0,2)},u.decode=function(t,e,i,r,o){if("rgb"===t||"rgba"===t)return new Go(e.scale(255),i.scale(255),r.scale(255),o&&o.scale(1));throw new Error(t)},u.parseX=function(t){return jo.parse(t)},u.parseY=function(t){return jo.parse(t)},u.parseZ=function(t){return jo.parse(t)},u.parseA=function(t){return jo.parse(t)},u.cont=function(t,e,i,r,o,n){return new u(t,e,i,r,o,n)},u}(_),Qo=function(a){function u(t,e,i,r,o,n){var s=a.call(this)||this;return s.identParser=t,s.hParser=e,s.sParser=i,s.lParser=r,s.aParser=o,s.step=n,s}return v(u,a),u.prototype.feed=function(t){return u.parse(t,this.identParser,this.hParser,this.sParser,this.lParser,this.aParser,this.step)},u.parse=function(t,e,i,r,o,n,s){return Ko.call(u,t,e,i,r,o,n,s)},u.parseRest=function(t,e){return u.parse(t,e,void 0,void 0,void 0,void 0,2)},u.decode=function(t,e,i,r,o){if("hsl"===t||"hsla"===t)return new No(e.deg().value,i.scale(1),r.scale(1),o&&o.scale(1));throw new Error(t)},u.parseX=function(t){return Do.parse(t,"deg")},u.parseY=function(t){return jo.parse(t)},u.parseZ=function(t){return jo.parse(t)},u.parseA=function(t){return jo.parse(t)},u.cont=function(t,e,i,r,o,n){return new u(t,e,i,r,o,n)},u}(_),Zo=function(r){function o(t,e){var i=r.call(this)||this;return i.identParser=t,i.step=e,i}return v(o,r),o.prototype.feed=function(t){return o.parse(t,this.identParser,this.step)},o.parse=function(t,e,i){if(void 0===i&&(i=1),1===i)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(35===t.head())return Yo.parse(t);i=2}if(2===i){for(e||(e=ri.Factory.parseIdent(t));e.isCont()&&(!t.isEmpty()||t.isDone());)e=e.feed(t);if(e.isDone()){var r=e.bind().stringValue();switch(r){case"rgb":case"rgba":return Xo.parseRest(t,e);case"hsl":case"hsla":return Qo.parseRest(t,e);case"transparent":return _.done(qo.transparent());case"black":return _.done(qo.black());case"white":return _.done(qo.white());default:return _.error(r)}}else if(e.isError())return e.asError()}return new o(e,i)},o}(_),Jo=function(i){function t(t){void 0===t&&(t=qo.transparent());var e=i.call(this)||this;return e.unit=t,e}return v(t,i),t.prototype.mold=function(t){return t=qo.fromAny(t),O.valueOf(t.toString())},t.prototype.cast=function(t){var e;try{if(!(e=qo.fromValue(t))){var i=t.stringValue();void 0!==i&&(e=qo.parse(i))}}catch(t){}return e},t}(_e);qo.Form=new Jo;var $o=function(){function i(){}return i.prototype.transform=function(t){return t instanceof tn?this:new hn([this,t])},i.prototype.translate=function(t,e){return this.transform(i.translate(t,e))},i.prototype.translateX=function(t){return this.transform(i.translateX(t))},i.prototype.translateY=function(t){return this.transform(i.translateY(t))},i.prototype.scale=function(t,e){return this.transform(i.scale(t,e))},i.prototype.scaleX=function(t){return this.transform(i.scaleX(t))},i.prototype.scaleY=function(t){return this.transform(i.scaleY(t))},i.prototype.rotate=function(t){return this.transform(i.rotate(t))},i.prototype.skew=function(t,e){return this.transform(i.skew(t,e))},i.prototype.skewX=function(t){return this.transform(i.skewX(t))},i.prototype.skewY=function(t){return this.transform(i.skewY(t))},i.prototype.toAttributeString=function(){return this.toString()},i.from=function(t){return void 0!==t?new vn(i.fromAny(t)):i.Form},i.translate=function(t,e){return new on(t,e)},i.translateX=function(t){return new on(t,0)},i.translateY=function(t){return new on(0,t)},i.scale=function(t,e){return new nn(t,e)},i.scaleX=function(t){return new nn(t,1)},i.scaleY=function(t){return new nn(1,t)},i.rotate=function(t){return new sn(t)},i.skew=function(t,e){return new an(t,e)},i.skewX=function(t){return new an(t,1)},i.skewY=function(t){return new an(1,t)},i.matrix=function(t,e,i,r,o,n){return new un(t,e,i,r,o,n)},i.fromAny=function(t){if(t instanceof i)return t;if("string"==typeof t)return i.parse(t);throw new Error(t)},i.fromValue=function(t){var e=t.tag;return"identity"===e?tn.fromValue(t):"translate"===e?on.fromValue(t):"scale"===e?nn.fromValue(t):"rotate"===e?sn.fromValue(t):"skew"===e?an.fromValue(t):"matrix"===e?un.fromValue(t):hn.fromValue(t)},i.parse=function(t){for(var e=new m(t);!e.isEmpty()&&_.isSpace(e.head());)e.step();var i=mn.parse(e);if(i.isDone()){for(;!e.isEmpty()&&_.isSpace(e.head());)e.step();e.isEmpty()||(i=_.unexpected(e))}return i.bind()},i.Identity=void 0,i.Form=void 0,i}(),tn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){return t},e.prototype.toMatrix=function(){return new un(1,0,0,1,0,0)},e.prototype.toValue=function(){return F.of(P.of("identity"))},e.prototype.conformsTo=function(t){return t instanceof e},e.prototype.equals=function(t){return t instanceof e},e.prototype.toString=function(){return"none"},e.fromValue=function(t){if("identity"===t.tag)return $o.Identity},e}($o);$o.Identity=new tn;var en,rn,on=function(r){function i(t,e){var i=r.call(this)||this;return i.x=Lo.fromAny(t),i.y=Lo.fromAny(e),i}return v(i,r),i.prototype.toMatrix=function(){return new un(1,0,0,1,this.x.px().value,this.y.px().value)},i.prototype.toValue=function(){return F.of(P.of("translate",F.of(R.of("x",this.x.toString()),R.of("y",this.y.toString()))))},i.prototype.conformsTo=function(t){return t instanceof i},i.prototype.equals=function(t){return t instanceof i&&(this.x.equals(t.x)&&this.y.equals(t.y))},i.prototype.toString=function(){return this.x.value&&!this.y.value?"translate("+this.x+",0)":!this.x.value&&this.y.value?"translate(0,"+this.y+")":"translate("+this.x+","+this.y+")"},i.prototype.toAttributeString=function(){return this.x.value&&!this.y.value?"translate("+this.x.px().value+",0)":!this.x.value&&this.y.value?"translate(0,"+this.y.px().value+")":"translate("+this.x.px().value+","+this.y.px().value+")"},i.fromAny=function(t){if(t instanceof i)return t;if("string"==typeof t)return i.parse(t);throw new Error(t)},i.fromValue=function(t){var e=t.header("translate");if(e.isDefined()){var r=Lo.zero(),o=Lo.zero();return e.forEach(function(t,e){var i=t.key.stringValue();void 0!==i?"x"===i?r=t.toValue().cast(Lo.Form,r):"y"===i&&(o=t.toValue().cast(Lo.Form,o)):t instanceof w&&(0===e?r=t.cast(Lo.Form,r):1===e&&(o=t.cast(Lo.Form,o)))},this),new i(r,o)}},i.parse=function(t){for(var e=new m(t);!e.isEmpty()&&_.isSpace(e.head());)e.step();var i=ln.parse(e);if(i.isDone()){for(;!e.isEmpty()&&_.isSpace(e.head());)e.step();e.isEmpty()||(i=_.unexpected(e))}return i.bind()},i}($o),nn=function(r){function i(t,e){var i=r.call(this)||this;return i.x=+t,i.y=+e,i}return v(i,r),i.prototype.toMatrix=function(){return new un(this.x,0,0,this.y,0,0)},i.prototype.toValue=function(){return F.of(P.of("scale",F.of(R.of("x",this.x),R.of("y",this.y))))},i.prototype.conformsTo=function(t){return t instanceof i},i.prototype.equals=function(t){return t instanceof i&&(this.x===t.x&&this.y===t.y)},i.prototype.toString=function(){return this.x&&!this.y?"scaleX("+this.x+")":!this.x&&this.y?"scaleY("+this.y+")":"scale("+this.x+","+this.y+")"},i.fromAny=function(t){if(t instanceof i)return t;if("string"==typeof t)return i.parse(t);throw new Error(t)},i.fromValue=function(t){var e=t.header("scale");if(e.isDefined()){var r=0,o=0;return e.forEach(function(t,e){var i=t.key.stringValue();void 0!==i?"x"===i?r=t.toValue().numberValue(r):"y"===i&&(o=t.toValue().numberValue(o)):t instanceof w&&(0===e?r=t.numberValue(r):1===e&&(o=t.numberValue(o)))},this),new i(r,o)}},i.parse=function(t){for(var e=new m(t);!e.isEmpty()&&_.isSpace(e.head());)e.step();var i=pn.parse(e);if(i.isDone()){for(;!e.isEmpty()&&_.isSpace(e.head());)e.step();e.isEmpty()||(i=_.unexpected(e))}return i.bind()},i}($o),sn=function(i){function r(t){var e=i.call(this)||this;return e.a=Ao.fromAny(t),e}return v(r,i),r.prototype.toMatrix=function(){var t=this.a.rad().value;return new un(Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),0,0)},r.prototype.toValue=function(){return F.of(P.of("rotate",this.a.toString()))},r.prototype.conformsTo=function(t){return t instanceof r},r.prototype.equals=function(t){return t instanceof r&&this.a.equals(t.a)},r.prototype.toString=function(){return"rotate("+this.a+")"},r.fromAny=function(t){if(t instanceof r)return t;if("string"==typeof t)return r.parse(t);throw new Error(t)},r.fromValue=function(t){var e=t.header("rotate");if(e.isDefined()){var i=Ao.zero();return e.forEach(function(t,e){"a"===t.key.stringValue()?i=t.toValue().cast(Ao.Form,i):t instanceof w&&0===e&&(i=t.cast(Ao.Form,i))},this),new r(i)}},r.parse=function(t){for(var e=new m(t);!e.isEmpty()&&_.isSpace(e.head());)e.step();var i=cn.parse(e);if(i.isDone()){for(;!e.isEmpty()&&_.isSpace(e.head());)e.step();e.isEmpty()||(i=_.unexpected(e))}return i.bind()},r}($o),an=function(r){function i(t,e){var i=r.call(this)||this;return i.x=Ao.fromAny(t),i.y=Ao.fromAny(e),i}return v(i,r),i.prototype.toMatrix=function(){var t=this.x.rad().value,e=this.y.rad().value;return new un(1,Math.tan(e),Math.tan(t),1,0,0)},i.prototype.toValue=function(){return F.of(P.of("skew",F.of(R.of("x",this.x.toString()),R.of("y",this.y.toString()))))},i.prototype.conformsTo=function(t){return t instanceof i},i.prototype.equals=function(t){return t instanceof i&&(this.x.equals(t.x)&&this.y.equals(t.y))},i.prototype.toString=function(){return this.x.value&&!this.y.value?"skewX("+this.x+")":!this.x.value&&this.y.value?"skewY("+this.y+")":"skew("+this.x+","+this.y+")"},i.fromAny=function(t){if(t instanceof i)return t;if("string"==typeof t)return i.parse(t);throw new Error(t)},i.fromValue=function(t){var e=t.header("skew");if(e.isDefined()){var r=Ao.zero(),o=Ao.zero();return e.forEach(function(t,e){var i=t.key.stringValue();void 0!==i?"x"===i?r=t.toValue().cast(Ao.Form,r):"y"===i&&(o=t.toValue().cast(Ao.Form,o)):t instanceof w&&(0===e?r=t.cast(Ao.Form,r):1===e&&(o=t.cast(Ao.Form,o)))},this),new i(r,o)}},i.parse=function(t){for(var e=new m(t);!e.isEmpty()&&_.isSpace(e.head());)e.step();var i=dn.parse(e);if(i.isDone()){for(;!e.isEmpty()&&_.isSpace(e.head());)e.step();e.isEmpty()||(i=_.unexpected(e))}return i.bind()},i}($o),un=function(a){function i(t,e,i,r,o,n){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===o&&(o=0),void 0===n&&(n=0);var s=a.call(this)||this;return s.x0=+t,s.y0=+e,s.x1=+i,s.y1=+r,s.tx=+o,s.ty=+n,s}return v(i,a),i.prototype.multiply=function(t){return new i(this.x0*t.x0+this.x1*t.y0,this.y0*t.x0+this.y1*t.y0,this.x0*t.x1+this.x1*t.y1,this.y0*t.x1+this.y1*t.y1,this.x0*t.tx+this.x1*t.ty,this.y0*t.tx+this.y1*t.ty)},i.prototype.transform=function(t){return this.multiply(t.toMatrix())},i.prototype.toMatrix=function(){return this},i.prototype.toValue=function(){return F.of(P.of("matrix",F.of(this.x0,this.y0,this.x1,this.y1,this.tx,this.ty)))},i.prototype.conformsTo=function(t){return t instanceof i},i.prototype.equals=function(t){return t instanceof i&&(this.x0===t.x0&&this.y0===t.y0&&this.x1===t.x1&&this.y1===t.y1&&this.tx===t.tx&&this.ty===t.ty)},i.prototype.toString=function(){return"matrix("+this.x0+","+this.y0+","+this.x1+","+this.y1+","+this.tx+","+this.ty+")"},i.fromAny=function(t){if(t instanceof i)return t;if("string"==typeof t)return i.parse(t);throw new Error(t)},i.fromValue=function(t){var e=t.header("matrix");if(e.isDefined()){var r=0,o=0,n=0,s=0,a=0,u=0;return e.forEach(function(t,e){var i=t.key.stringValue();if(void 0!==i)"x0"===i?r=t.toValue().numberValue(r):"y0"===i?o=t.toValue().numberValue(o):"x1"===i?n=t.toValue().numberValue(n):"y1"===i?s=t.toValue().numberValue(s):"tx"===i?a=t.toValue().numberValue(a):"ty"===i&&(u=t.toValue().numberValue(u));else if(t instanceof w)switch(e){case 0:r=t.numberValue(r);break;case 1:o=t.numberValue(o);break;case 2:n=t.numberValue(n);break;case 3:s=t.numberValue(s);break;case 4:a=t.numberValue(a);break;case 5:u=t.numberValue(u)}},this),new i(r,o,n,s,a,u)}},i.parse=function(t){for(var e=new m(t);!e.isEmpty()&&_.isSpace(e.head());)e.step();var i=fn.parse(e);if(i.isDone()){for(;!e.isEmpty()&&_.isSpace(e.head());)e.step();e.isEmpty()||(i=_.unexpected(e))}return i.bind()},i.Identity=new i,i}($o),hn=function(n){function s(t){var e,i=n.call(this)||this;i.transforms=[];for(var r=0;r<t.length;r+=1){var o=t[r];o instanceof s?(e=i.transforms).push.apply(e,o.transforms):!o||o instanceof tn||i.transforms.push(o)}return i}return v(s,n),s.prototype.toMatrix=function(){for(var t=un.Identity,e=0;e<this.transforms.length;e+=1)t=t.multiply(this.transforms[e].toMatrix());return t},s.prototype.toValue=function(){for(var t=this.transforms.length,e=F.empty(t),i=0;i<t;i+=1)e.push(this.transforms[i].toValue());return e},s.prototype.conformsTo=function(t){if(t instanceof s){var e=this.transforms.length;if(e===t.transforms.length){for(var i=0;i<e;i+=1)if(!this.transforms[i].conformsTo(t.transforms[i]))return!1;return!0}}return!1},s.prototype.equals=function(t){if(t instanceof s){var e=this.transforms.length;if(e===t.transforms.length){for(var i=0;i<e;i+=1)if(!this.transforms[i].equals(t.transforms[i]))return!1;return!0}}return!1},s.prototype.toString=function(){for(var t="",e=0;e<this.transforms.length;e+=1)0<e&&(t+=" "),t+=this.transforms[e].toString();return t},s.prototype.toAttributeString=function(){for(var t="",e=0;e<this.transforms.length;e+=1)0<e&&(t+=" "),t+=this.transforms[e].toAttributeString();return t},s.fromAny=function(t){if(t instanceof s)return t;if("string"==typeof t)return s.parse(t);throw new Error(t)},s.fromValue=function(t){var i=[];if(t.forEach(function(t){var e=$o.fromValue(t.toValue());e&&i.push(e)},this),i.length)return new s(i)},s.parse=function(t){var e=$o.parse(t);return e instanceof s?e:new s([e])},s}($o),ln=function(n){function a(t,e,i,r){var o=n.call(this)||this;return o.identParser=t,o.xParser=e,o.yParser=i,o.step=r,o}return v(a,n),a.prototype.feed=function(t){return a.parse(t,this.identParser,this.xParser,this.yParser,this.step)},a.parse=function(t,e,i,r,o){void 0===o&&(o=1);var n=0;if(1===o){for(e||(e=ri.Factory.parseIdent(t));e.isCont()&&(!t.isEmpty()||t.isDone());)e=e.feed(t);if(e.isDone())o=2;else if(e.isError())return e.asError()}if(2===o)if(t.isEmpty()||40!==t.head()){if(!t.isEmpty()||t.isDone())return _.expected("(",t)}else t.step(),o=3;if(3===o){if(!i){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();t.isEmpty()||(i=Wo.parse(t))}for(;i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())o=4;else if(i.isError())return i.asError()}if(4===o){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(41===(n=t.head()))return t.step(),"translateX"===(s=e.bind().stringValue())?_.done($o.translateX(i.bind())):"translateY"===s?_.done($o.translateY(i.bind())):_.error(s);if(44!==n)return _.expected(",",t);t.step(),o=5}}if(5===o){if(!r){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();t.isEmpty()||(r=Wo.parse(t))}for(;r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())o=6;else if(r.isError())return r.asError()}if(6===o){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();var s;if(!t.isEmpty()&&41===t.head())return t.step(),"translate"===(s=e.bind().stringValue())?_.done($o.translate(i.bind(),r.bind())):_.error(s);if(!t.isEmpty()||t.isDone())return _.expected(")",t)}return new a(e,i,r,o)},a.parseRest=function(t,e){return a.parse(t,e,void 0,void 0,2)},a}(_),pn=function(n){function h(t,e,i,r){var o=n.call(this)||this;return o.identParser=t,o.xParser=e,o.yParser=i,o.step=r,o}return v(h,n),h.prototype.feed=function(t){return h.parse(t,this.identParser,this.xParser,this.yParser,this.step)},h.parse=function(t,e,i,r,o){void 0===o&&(o=1);var n=0;if(1===o){for(e||(e=ri.Factory.parseIdent(t));e.isCont()&&(!t.isEmpty()||t.isDone());)e=e.feed(t);if(e.isDone())o=2;else if(e.isError())return e.asError()}if(2===o)if(t.isEmpty()||40!==t.head()){if(!t.isEmpty()||t.isDone())return _.expected("(",t)}else t.step(),o=3;if(3===o){if(!i){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();t.isEmpty()||(i=ri.Factory.parseNumber(t))}for(;i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())o=4;else if(i.isError())return i.asError()}if(4===o){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(41===(n=t.head()))return t.step(),"scaleX"===(s=e.bind().stringValue())?_.done($o.scaleX(i.bind().numberValue())):"scaleY"===s?_.done($o.scaleY(i.bind().numberValue())):_.error(s);if(44!==n)return _.expected(",",t);t.step(),o=5}}if(5===o){if(!r){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();t.isEmpty()||(r=ri.Factory.parseNumber(t))}for(;r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())o=6;else if(r.isError())return r.asError()}if(6===o){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();if(!t.isEmpty()&&41===t.head()){var s;if(t.step(),"scale"===(s=e.bind().stringValue())){var a=i.bind().numberValue(),u=r.bind().numberValue();return _.done($o.scale(a,u))}return _.error(s)}if(!t.isEmpty()||t.isDone())return _.expected(")",t)}return new h(e,i,r,o)},h.parseRest=function(t,e){return h.parse(t,e,void 0,void 0,2)},h}(_),cn=function(o){function n(t,e,i){var r=o.call(this)||this;return r.identParser=t,r.aParser=e,r.step=i,r}return v(n,o),n.prototype.feed=function(t){return n.parse(t,this.identParser,this.aParser,this.step)},n.parse=function(t,e,i,r){if(void 0===r&&(r=1),1===r){for(e||(e=ri.Factory.parseIdent(t));e.isCont()&&(!t.isEmpty()||t.isDone());)e=e.feed(t);if(e.isDone())r=2;else if(e.isError())return e.asError()}if(2===r)if(t.isEmpty()||40!==t.head()){if(!t.isEmpty()||t.isDone())return _.expected("(",t)}else t.step(),r=3;if(3===r){if(!i){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();t.isEmpty()||(i=Do.parse(t))}for(;i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())r=4;else if(i.isError())return i.asError()}if(4===r){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();if(!t.isEmpty()&&41===t.head()){t.step();var o=e.bind().stringValue();return"rotate"===o?_.done($o.rotate(i.bind())):_.error(o)}if(!t.isEmpty()||t.isDone())return _.expected(")",t)}return new n(e,i,r)},n.parseRest=function(t,e){return n.parse(t,e,void 0,2)},n}(_),dn=function(n){function a(t,e,i,r){var o=n.call(this)||this;return o.identParser=t,o.xParser=e,o.yParser=i,o.step=r,o}return v(a,n),a.prototype.feed=function(t){return a.parse(t,this.identParser,this.xParser,this.yParser,this.step)},a.parse=function(t,e,i,r,o){void 0===o&&(o=1);var n=0;if(1===o){for(e||(e=ri.Factory.parseIdent(t));e.isCont()&&(!t.isEmpty()||t.isDone());)e=e.feed(t);if(e.isDone())o=2;else if(e.isError())return e.asError()}if(2===o)if(t.isEmpty()||40!==t.head()){if(!t.isEmpty()||t.isDone())return _.expected("(",t)}else t.step(),o=3;if(3===o){if(!i){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();t.isEmpty()||(i=Do.parse(t))}for(;i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())o=4;else if(i.isError())return i.asError()}if(4===o){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(41===(n=t.head()))return t.step(),"skewX"===(s=e.bind().stringValue())?_.done($o.skewX(i.bind())):"skewY"===s?_.done($o.skewY(i.bind())):_.error(s);if(44!==n)return _.expected(",",t);t.step(),o=5}}if(5===o){if(!r){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();t.isEmpty()||(r=Do.parse(t))}for(;r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())o=6;else if(r.isError())return r.asError()}if(6===o){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();var s;if(!t.isEmpty()&&41===t.head())return t.step(),"skew"===(s=e.bind().stringValue())?_.done($o.skew(i.bind(),r.bind())):_.error(s);if(!t.isEmpty()||t.isDone())return _.expected(")",t)}return new a(e,i,r,o)},a.parseRest=function(t,e){return a.parse(t,e,void 0,void 0,2)},a}(_),fn=function(n){function a(t,e,i,r){var o=n.call(this)||this;return o.identParser=t,o.entryParser=e,o.entries=i,o.step=r,o}return v(a,n),a.prototype.feed=function(t){return a.parse(t,this.identParser,this.entryParser,this.entries,this.step)},a.parse=function(t,e,i,r,o){void 0===r&&(r=[]),void 0===o&&(o=1);var n=0;if(1===o){for(e||(e=ri.Factory.parseIdent(t));e.isCont()&&(!t.isEmpty()||t.isDone());)e=e.feed(t);if(e.isDone())o=2;else if(e.isError())return e.asError()}if(2===o)if(t.isEmpty()||40!==t.head()){if(!t.isEmpty()||t.isDone())return _.expected("(",t)}else t.step(),o=3;for(;;){if(3===o){if(!i){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();t.isEmpty()||(i=ri.Factory.parseNumber(t))}for(;i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())r.push(i.bind().numberValue()),i=void 0,o=4;else if(i.isError())return i.asError()}if(4===o){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();if(!t.isEmpty()){if(41===(n=t.head())){t.step();var s=e.bind().stringValue();return"matrix"===s?_.done($o.matrix.apply($o,r)):_.error(s)}if(6<=r.length)return _.expected(")",t);if(44===n){t.step(),o=3;continue}return _.expected(",",t)}if(t.isDone())return _.unexpected(t)}break}return new a(e,i,r,o)},a.parseRest=function(t,e){return a.parse(t,e,void 0,void 0,2)},a}(_),yn=function(i){function r(t){var e=i.call(this)||this;return e.identParser=t,e}return v(r,i),r.prototype.feed=function(t){return r.parse(t,this.identParser)},r.parse=function(t,e){for(e||(e=ri.Factory.parseIdent(t));e.isCont()&&(!t.isEmpty()||t.isDone());)e=e.feed(t);if(e.isDone()){var i=e.bind().stringValue();switch(i){case"translateX":case"translateY":case"translate":return ln.parseRest(t,e);case"scaleX":case"scaleY":case"scale":return pn.parseRest(t,e);case"rotate":return cn.parseRest(t,e);case"skewX":case"skewY":case"skew":return dn.parseRest(t,e);case"matrix":return fn.parseRest(t,e);case"none":return _.done($o.Identity);default:return _.error(i)}}else if(e.isError())return e.asError();return new r(e)},r}(_),mn=function(r){function o(t,e){var i=r.call(this)||this;return i.transformParser=t,i.transform=e,i}return v(o,r),o.prototype.feed=function(t){return o.parse(t,this.transformParser,this.transform)},o.parse=function(t,e,i){for(void 0===i&&(i=$o.Identity);;){if(!e){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();t.isEmpty()||(e=yn.parse(t))}for(;e.isCont()&&(!t.isEmpty()||t.isDone());)e=e.feed(t);if(!e.isDone()){if(e.isError())return e.asError();break}i=i.transform(e.bind())}return new o(e)},o}(_),vn=function(i){function t(t){void 0===t&&(t=$o.Identity);var e=i.call(this)||this;return e.unit=t,e}return v(t,i),t.prototype.mold=function(t){return(t=$o.fromAny(t)).toValue()},t.prototype.cast=function(t){try{if(t instanceof F)return $o.fromValue(t);var e=t.stringValue();if(void 0!==e)return $o.parse(e)}catch(t){}},t}(_e),gn=function(){function t(){}return t.of=function(t,e,i,r){if("time"===t){r=i,i=e;var o=ro.current();t=(e=o).time(o.time()-864e5)}else"linear"===t&&(r=i,i=e,e=1,t=0);if(t instanceof ro||t instanceof Date||e instanceof ro||e instanceof Date)return new _n(t,e,i instanceof kn?i:kn.interpolate(i,r));if("number"==typeof t&&"number"==typeof e)return new wn(t,e,i instanceof kn?i:kn.interpolate(i,r));throw new TypeError(""+arguments)},t.linear=function(t,e,i,r){return Array.isArray(t)?e instanceof kn?new wn(t[0],t[1],e):(e=e,new wn(t[0],t[1],kn.interpolate(e[0],e[1]))):(t=t,e=e,i instanceof kn?new wn(t,e,i):(i=i,r=r,new wn(t,e,kn.interpolate(i,r))))},t.time=function(t,e,i,r){return Array.isArray(t)?e instanceof kn?new _n(t[0],t[1],e):(e=e,new _n(t[0],t[1],kn.interpolate(e[0],e[1]))):(t=t,e=e,i instanceof kn?new _n(t,e,i):(i=i,r=r,new _n(t,e,kn.interpolate(i,r))))},t.Form=void 0,t}(),bn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Form=void 0,e}(gn),wn=function(o){function p(t,e,i){var r=o.call(this)||this;return r.x0=t,r.dx=e-r.x0,r.fx=i,r}return v(p,o),p.prototype.norm=function(t){return this.dx?(t-this.x0)/this.dx:this.dx},p.prototype.scale=function(t){var e=this.norm(t);return this.fx.map(e)},p.prototype.unscale=function(t){return this.x0+this.dx*this.fx.unmap(t)},p.prototype.clampScale=function(t){var e=Math.min(Math.max(0,this.norm(t)),1);return this.fx.map(e)},p.prototype.domain=function(t,e){return void 0===t?[this.x0,this.x0+this.dx]:void 0===e?new p((t=t)[0],t[1],this.fx):new p(t,e,this.fx)},p.prototype.range=function(t,e){return void 0===t?this.fx.range():new p(this.x0,this.x0+this.dx,void 0===e?this.fx.range(t):this.fx.range(t,e))},p.prototype.interpolate=function(t){return void 0===t?this.fx:(t=kn.fromAny(t),new p(this.x0,this.x0+this.dx,t))},p.prototype.clampDomain=function(t,e,i,r){var o=this.x0,n=this.x0+this.dx;void 0!==t&&(o<n&&o<t?o=t:n<o&&n<t&&(n=t)),void 0!==e&&(o<n&&e<n?n=e:n<o&&e<o&&(n=e));var s=+this.scale(o),a=+this.scale(n)-s,u=Math.abs(a/(n-o));if(void 0!==i&&u<1/i)o=((l=o+n)-(h=a*i))/2,n=(l+h)/2;else if(void 0!==r&&1/r<u){var h,l;o=((l=o+n)-(h=a*r))/2,n=(l+h)/2}return o!==this.x0||n-o!==this.dx?new p(o,n,this.fx):this},p.prototype.solveDomain=function(t,e,i,r){var o,n=this.fx.range(),s=+n[0],a=+n[1],u=+e-(o=void 0===i||void 0===r||t===i||e===r?(a-s)/this.dx:(+r-+e)/(i-t))*t;return new p((s-u)/o,(a-u)/o,this.fx)},p.prototype.equals=function(t){return this===t||t instanceof p&&(this.x0===t.x0&&this.dx===t.dx&&this.fx.equals(t.fx))},p}(bn),_n=function(n){function p(t,e,i,r){var o=n.call(this)||this;return t=ro.fromAny(t),e=ro.fromAny(e),o.t0=t.time(),o.dt=e.time()-o.t0,o.zone=r||t.zone(),o.ft=i,o}return v(p,n),p.prototype.norm=function(t){return t=ro.time(t),this.dt?(t-this.t0)/this.dt:this.dt},p.prototype.scale=function(t){var e=this.norm(t);return this.ft.map(e)},p.prototype.unscale=function(t){return new ro(this.t0+this.dt*this.ft.unmap(t))},p.prototype.clampScale=function(t){var e=Math.min(Math.max(0,this.norm(t)),1);return this.ft.map(e)},p.prototype.domain=function(t,e){return void 0===t?[new ro(this.t0,this.zone),new ro(this.t0+this.dt,this.zone)]:void 0===e?new p((t=t)[0],t[1],this.ft,this.zone):new p(t,e,this.ft,this.zone)},p.prototype.range=function(t,e){return void 0===t?this.ft.range():new p(this.t0,this.t0+this.dt,void 0===e?this.ft.range(t):this.ft.range(t,e),this.zone)},p.prototype.interpolate=function(t){return void 0===t?this.ft:(t=kn.fromAny(t),new p(this.t0,this.t0+this.dt,t,this.zone))},p.prototype.clampDomain=function(t,e,i,r){var o=this.t0,n=this.t0+this.dt;void 0!==t&&(o<n&&o<+t?o=+t:n<o&&n<+t&&(n=+t)),void 0!==e&&(o<n&&+e<n?n=+e:n<o&&+e<o&&(n=+e));var s=+this.scale(o),a=+this.scale(n)-s,u=Math.abs(a/(n-o));if(void 0!==i&&u<1/i)o=((l=o+n)-(h=a*i))/2,n=(l+h)/2;else if(void 0!==r&&1/r<u){var h,l;o=((l=o+n)-(h=a*r))/2,n=(l+h)/2}return o!==this.t0||n-o!==this.dt?new p(o,n,this.ft,this.zone):this},p.prototype.solveDomain=function(t,e,i,r){var o,n=this.ft.range(),s=+n[0],a=+n[1],u=+e-(o=void 0===i||void 0===r||t===i||e===r?(a-s)/this.dt:(+r-+e)/(+i-+t))*+t;return new p((s-u)/o,(a-u)/o,this.ft,this.zone)},p.prototype.equals=function(t){return this===t||t instanceof p&&(this.t0===t.t0&&this.dt===t.dt&&this.ft.equals(t.ft))},p}(bn),xn=function(o){function t(t,e,i){var r=o.call(this)||this;return r.domainForm=t,r.interpolatorForm=e,r.unit=i,r}return v(t,o),t.prototype.mold=function(t){if(t instanceof bn){var e=t.domain(),i=this.domainForm.mold(e[0]),r=this.domainForm.mold(e[1]),o=F.of(i,r),n=F.of(P.of("scale",o)),s=this.interpolatorForm.mold(t.interpolate());return s.isDefined()&&(n=n.concat(s)),n}return w.Absent},t.prototype.cast=function(t){var e=t.header("scale");if(2<=e.length){var i,r;e.forEach(function(t,e){t instanceof w&&(0===e?i=t.cast(this.domainForm,i):1===e&&(r=t.cast(this.domainForm,r)))},this);var o=this.interpolatorForm.cast(t.body());if(void 0!==i&&void 0!==r&&o)return gn.of(i,r,o)}},t}(_e),kn=function(){function i(){}return i.form=function(t,e){return new Hn(t,e)},i.step=function(t,e){return new An(t,e)},i.number=function(t,e){return new En(t,e)},i.date=function(t,e){return new Cn(t,e)},i.angle=function(t,e){return new Sn(t,e)},i.len=function(t,e){return new Vn(t,e)},i.color=function(t,e){return void 0===t&&void 0===e?new Dn:(void 0!==t&&(t=qo.fromAny(t)),void 0!==e&&(e=qo.fromAny(e)),t||e?e?t||(t=e):e=t:e=t=qo.transparent(),t instanceof No&&e instanceof No?new Pn(t,e):new Mn(t.rgb(),e.rgb()))},i.rgb=function(t,e){return new Mn(t,e)},i.hsl=function(t,e){return new Pn(t,e)},i.transform=function(t,e){return void 0===t&&void 0===e?new Rn:(void 0!==t&&(t=$o.fromAny(t)),void 0!==e&&(e=$o.fromAny(e)),t||e?e?t||(t=e):e=t:e=t=$o.Identity,t instanceof on&&e instanceof on?new Tn(t,e):t instanceof nn&&e instanceof nn?new Ln(t,e):t instanceof sn&&e instanceof sn?new Fn(t,e):t instanceof an&&e instanceof an?new In(t,e):t instanceof hn&&e instanceof hn&&t.conformsTo(e)?new Un(t,e):new zn(t.toMatrix(),e.toMatrix()))},i.scale=function(t,e){if(void 0===t&&void 0===e)return new Wn;if(e?t||(t=e):e=t,t instanceof wn&&e instanceof wn)return new Bn(t,e);if(t instanceof _n&&e instanceof _n)return new qn(t,e);throw new TypeError(t+", "+e)},i.array=function(t,e){return new Gn(t,e)},i.interpolate=function(t,e){return t instanceof i&&e instanceof i?new Nn(t,e):t instanceof ro||t instanceof Date||e instanceof ro||e instanceof Date?new Cn(t,e):t instanceof Ao||e instanceof Ao?new Sn(t,e):t instanceof Lo||e instanceof Lo?new Vn(t,e):t instanceof qo||e instanceof qo?i.color(t,e):t instanceof $o||e instanceof $o?i.transform(t,e):t instanceof bn||e instanceof bn?i.scale(t,e):t instanceof b||e instanceof b?i.recon(t,e):"number"==typeof t||"number"==typeof e?new En(t,e):Array.isArray(t)||Array.isArray(e)?new Gn(t,e):new An(t,e)},i.fromAny=function(t){if(t instanceof i)return t;if("string"==typeof t)switch(t){case"step":return i.step();case"number":return i.number();case"angle":return i.angle();case"length":return i.len();case"color":return i.color();case"rgb":return i.rgb();case"hsl":return i.hsl();case"transform":case"translate":case"scale":case"rotate":case"skew":case"matrix":case"transform-list":return i.transform();case"scale":return i.scale();case"array":return i.array()}throw new Error(t)},i.Form=void 0,i.recon=void 0,i}(),An=function(r){function i(t,e){var i=r.call(this)||this;return void 0===e?e=t:void 0===t&&(t=e),i.y0=t,i.y1=e,i}return v(i,r),i.prototype.map=function(t){var e=t<1?this.y0:this.y1;if(void 0===e)throw new TypeError;return e},i.prototype.unmap=function(t){return t===this.y1?1:0},i.prototype.range=function(t,e){if(void 0===t){if(void 0===this.y0||void 0===this.y1)throw new TypeError;return[this.y0,this.y1]}return void 0===e?new i((t=t)[0],t[1]):new i(t,e)},i.prototype.equals=function(t){return this===t||t instanceof i&&(this.y0===t.y0&&this.y1===t.y1)},i}(kn),En=function(r){function i(t,e){var i=r.call(this)||this;return void 0===t&&void 0===e?e=t=0:void 0===e?e=t:void 0===t&&(t=e),i.y0=+t,i.dy=+e-i.y0,i}return v(i,r),i.prototype.map=function(t){return this.y0+this.dy*t},i.prototype.unmap=function(t){return this.dy?(t-this.y0)/this.dy:this.dy},i.prototype.range=function(t,e){return void 0===t?[this.y0,this.y0+this.dy]:void 0===e?new i((t=t)[0],t[1]):new i(t,e)},i.prototype.equals=function(t){return this===t||t instanceof i&&(this.y0===t.y0&&this.dy===t.dy)},i}(kn),Cn=function(o){function i(t,e,i){var r=o.call(this)||this;return void 0===t&&void 0===e?e=t=0:void 0===e?e=t:void 0===t&&(t=e),t=ro.fromAny(t),e=ro.fromAny(e),r.t0=t.time(),r.dt=e.time()-r.t0,r.zone=i||t.zone(),r}return v(i,o),i.prototype.map=function(t){return new ro(this.t0+this.dt*t,this.zone)},i.prototype.unmap=function(t){return t=ro.time(t),this.dt?(t-this.t0)/this.dt:this.dt},i.prototype.range=function(t,e){return void 0===t?[new ro(this.t0,this.zone),new ro(this.t0+this.dt,this.zone)]:void 0===e?new i((t=t)[0],t[1],this.zone):new i(t,e,this.zone)},i.prototype.equals=function(t){return this===t||t instanceof i&&(this.t0===t.t0&&this.dt===t.dt)},i}(kn),Sn=function(r){function i(t,e){var i=r.call(this)||this;return void 0!==t&&(t=Ao.fromAny(t)),void 0!==e&&(e=Ao.fromAny(e)),t||e?e?t=t?t.to(e.units):e:e=t:e=t=Ao.zero(),i.v0=t.value,i.dv=e.value-i.v0,i.units=e.units,i}return v(i,r),i.prototype.map=function(t){return Ao.fromAny(this.v0+this.dv*t,this.units)},i.prototype.unmap=function(t){var e=Ao.fromAny(t).to(this.units).value;return this.dv?(e-this.v0)/this.dv:this.dv},i.prototype.range=function(t,e){return void 0===t?[Ao.fromAny(this.v0,this.units),Ao.fromAny(this.v0+this.dv,this.units)]:void 0===e?new i((t=t)[0],t[1]):new i(t,e)},i.prototype.equals=function(t){return this===t||t instanceof i&&(this.v0===t.v0&&this.dv===t.dv&&this.units===t.units)},i}(kn),Vn=function(r){function i(t,e){var i=r.call(this)||this;return void 0!==t&&(t=Lo.fromAny(t)),void 0!==e&&(e=Lo.fromAny(e)),e||e?e?t=t?t.to(e.units):e:e=t:e=t=Lo.zero(),i.v0=t.value,i.dv=e.value-i.v0,i.units=e.units,i}return v(i,r),i.prototype.map=function(t){return Lo.fromAny(this.v0+this.dv*t,this.units)},i.prototype.unmap=function(t){var e=Lo.fromAny(t).to(this.units).value;return this.dv?(e-this.v0)/this.dv:this.dv},i.prototype.range=function(t,e){return void 0===t?[Lo.fromAny(this.v0,this.units),Lo.fromAny(this.v0+this.dv,this.units)]:void 0===e?new i((t=t)[0],t[1]):new i(t,e)},i.prototype.equals=function(t){return this===t||t instanceof i&&(this.v0===t.v0&&this.dv===t.dv&&this.units===t.units)},i}(kn),Dn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.map=function(t){return qo.transparent()},e.prototype.unmap=function(t){return 0},e.prototype.range=function(t,e){return void 0===t?[this.map(0),this.map(1)]:void 0===e?(t=t,kn.color(t[0],t[1])):kn.color(t,e)},e.prototype.equals=function(t){return this===t},e}(kn),Mn=function(r){function e(t,e){var i=r.call(this)||this;return void 0!==t&&(t=qo.rgb(t)),void 0!==e&&(e=qo.rgb(e)),t||e?e?t||(t=e):e=t:e=t=Go.transparent(),i.r0=t.r,i.dr=e.r-i.r0,i.g0=t.g,i.dg=e.g-i.g0,i.b0=t.b,i.db=e.b-i.b0,i.a0=t.a,i.da=e.a-i.a0,i}return v(e,r),e.prototype.map=function(t){var e=this.r0+this.dr*t,i=this.g0+this.dg*t,r=this.b0+this.db*t,o=this.a0+this.da*t;return new Go(e,i,r,o)},e.prototype.unmap=function(t){var e=(t=qo.rgb(t)).r-this.r0,i=t.g-this.g0,r=t.b-this.b0,o=t.a-this.a0,n=e*this.dr+i*this.dg+r*this.db+o*this.da,s=Math.sqrt(e*e+i*i+r*r+o*o);return s?n/s:s},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.r0===t.r0&&this.dr===t.dr&&this.g0===t.g0&&this.dg===t.dg&&this.b0===t.b0&&this.db===t.db&&this.a0===t.a0&&this.da===t.da)},e}(Dn),Pn=function(r){function e(t,e){var i=r.call(this)||this;return void 0!==t&&(t=qo.hsl(t)),void 0!==e&&(e=qo.hsl(e)),t||e?e?t||(t=e):e=t:e=t=No.transparent(),i.h0=t.h,i.dh=e.h-i.h0,i.s0=t.s,i.ds=e.s-i.s0,i.l0=t.l,i.dl=e.l-i.l0,i.a0=t.a,i.da=e.a-i.a0,i}return v(e,r),e.prototype.map=function(t){var e=this.h0+this.dh*t,i=this.s0+this.ds*t,r=this.l0+this.dl*t,o=this.a0+this.da*t;return new No(e,i,r,o)},e.prototype.unmap=function(t){var e=(t=qo.hsl(t)).h-this.h0,i=t.s-this.s0,r=t.l-this.l0,o=t.a-this.a0,n=e*this.dh+i*this.ds+r*this.dl+o*this.da,s=Math.sqrt(e*e+i*i+r*r+o*o);return s?n/s:s},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.h0===t.h0&&this.dh===t.dh&&this.s0===t.s0&&this.ds===t.ds&&this.l0===t.l0&&this.dl===t.dl&&this.a0===t.a0&&this.da===t.da)},e}(Dn),Rn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.map=function(t){return $o.Identity},e.prototype.unmap=function(t){return 0},e.prototype.range=function(t,e){return void 0===t?[this.map(0),this.map(1)]:void 0===e?(t=t,kn.transform(t[0],t[1])):kn.transform(t,e)},e.prototype.equals=function(t){return this===t},e}(kn),Tn=function(a){function e(t,e){var i,r,o,n,s=a.call(this)||this;return void 0!==t?(i=(t=on.fromAny(t)).x,r=t.y):r=i=void 0,void 0!==e?(o=(e=on.fromAny(e)).x,n=e.y):n=o=void 0,i||o?o?i=i?i.to(o.units):o:o=i:o=i=Lo.zero(),r||n?n?r=r?r.to(n.units):n:n=r:n=r=Lo.zero(),s.x0=i.value,s.dx=o.value-s.x0,s.xUnits=o.units,s.y0=r.value,s.dy=n.value-s.y0,s.yUnits=n.units,s}return v(e,a),e.prototype.map=function(t){var e=Lo.fromAny(this.x0+this.dx*t,this.xUnits),i=Lo.fromAny(this.y0+this.dy*t,this.yUnits);return new on(e,i)},e.prototype.unmap=function(t){var e=(t=on.fromAny(t)).x.units,i=Lo.fromAny(this.x0,this.xUnits).to(e).value,r=Lo.fromAny(this.y0,this.yUnits).to(e).value,o=Lo.fromAny(this.dx,this.xUnits).to(e).value,n=Lo.fromAny(this.dy,this.yUnits).to(e).value,s=t.x.to(e).value-i,a=t.y.to(e).value-r,u=s*o+a*n,h=Math.sqrt(s*s+a*a);return h?u/h:h},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.x0===t.x0&&this.dx===t.dx&&this.xUnits===t.xUnits&&this.y0===t.y0&&this.dy===t.dy&&this.yUnits===t.yUnits)},e}(Rn),Ln=function(a){function e(t,e){var i,r,o,n,s=a.call(this)||this;return void 0!==t?(i=(t=nn.fromAny(t)).x,r=t.y):r=i=void 0,void 0!==e?(o=(e=nn.fromAny(e)).x,n=e.y):n=o=void 0,void 0!==i||o?void 0===o?o=i:void 0===i&&(i=o):o=i=1,void 0===r&&void 0===n?n=r=1:void 0===n?n=r:void 0===r&&(r=n),s.x0=i,s.dx=o-s.x0,s.y0=r,s.dy=n-s.y0,s}return v(e,a),e.prototype.map=function(t){var e=this.x0+this.dx*t,i=this.y0+this.dy*t;return new nn(e,i)},e.prototype.unmap=function(t){var e=(t=nn.fromAny(t)).x-this.x0,i=t.y-this.y0,r=e*this.dx+i*this.dy,o=Math.sqrt(e*e+i*i);return o?r/o:o},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.x0===t.x0&&this.dx===t.dx&&this.y0===t.y0&&this.dy===t.dy)},e}(Rn),Fn=function(n){function e(t,e){var i,r,o=n.call(this)||this;return i=void 0!==t?(t=sn.fromAny(t)).a:void 0,r=void 0!==e?(e=sn.fromAny(e)).a:void 0,i||r?r?i=i?i.to(r.units):r:r=i:r=i=Ao.zero(),o.v0=i.value,o.dv=r.value-o.v0,o.units=r.units,o}return v(e,n),e.prototype.map=function(t){var e=Ao.fromAny(this.v0+this.dv*t,this.units);return new sn(e)},e.prototype.unmap=function(t){var e=sn.fromAny(t).a.to(this.units).value;return this.dv?(e-this.v0)/this.dv:this.dv},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.v0===t.v0&&this.dv===t.dv&&this.units===t.units)},e}(Rn),In=function(a){function e(t,e){var i,r,o,n,s=a.call(this)||this;return void 0!==t?(i=(t=an.fromAny(t)).x,r=t.y):r=i=void 0,void 0!==e?(o=(e=an.fromAny(e)).x,n=e.y):n=o=void 0,i||o?o?i=i?i.to(o.units):o:o=i:o=i=Ao.zero(),r||n?n?r=r?r.to(n.units):n:n=r:n=r=Ao.zero(),s.x0=i.value,s.dx=o.value-s.x0,s.xUnits=o.units,s.y0=r.value,s.dy=n.value-s.y0,s.yUnits=n.units,s}return v(e,a),e.prototype.map=function(t){var e=Ao.fromAny(this.x0+this.dx*t,this.xUnits),i=Ao.fromAny(this.y0+this.dy*t,this.yUnits);return new an(e,i)},e.prototype.unmap=function(t){var e=(t=an.fromAny(t)).x.units,i=Ao.fromAny(this.x0,this.xUnits).to(e).value,r=Ao.fromAny(this.y0,this.yUnits).to(e).value,o=Ao.fromAny(this.dx,this.xUnits).to(e).value,n=Ao.fromAny(this.dy,this.yUnits).to(e).value,s=t.x.to(e).value-i,a=t.y.to(e).value-r,u=s*o+a*n,h=Math.sqrt(s*s+a*a);return h?u/h:h},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.x0===t.x0&&this.dx===t.dx&&this.xUnits===t.xUnits&&this.y0===t.y0&&this.dy===t.dy&&this.yUnits===t.yUnits)},e}(Rn),zn=function(r){function e(t,e){var i=r.call(this)||this;return void 0!==t&&(t=un.fromAny(t)),void 0!==e&&(e=un.fromAny(e)),t||e?e?t||(t=e):e=t:e=t=new un,i.f0=t,i.f1=e,i}return v(e,r),e.prototype.map=function(t){return this.f1},e.prototype.unmap=function(t){return 0},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.f0.equals(t.f0)&&this.f1.equals(t.f1))},e}(Rn),Un=function(n){function r(t,e){var i=n.call(this)||this;void 0!==t&&(t=hn.fromAny(t)),void 0!==e&&(e=hn.fromAny(e)),t||e?e?t||(t=e):e=t:e=t=new hn([]),i.interpolators=[];for(var r=Math.min(t.transforms.length,e.transforms.length),o=0;o<r;o+=1)i.interpolators.push(kn.transform(t.transforms[o],e.transforms[o]));return i}return v(r,n),r.prototype.map=function(t){for(var e=[],i=0;i<this.interpolators.length;i+=1)e.push(this.interpolators[i].map(t));return new hn(e)},r.prototype.unmap=function(t){return 0},r.prototype.equals=function(t){if(this===t)return!0;if(t instanceof r){var e=this.interpolators.length;if(e===t.interpolators.length){for(var i=0;i<e;i+=1)if(!this.interpolators[i].equals(t.interpolators[i]))return!1;return!0}}return!1},r}(Rn),On=function(r){function e(t){var e=r.call(this)||this;if(t instanceof SVGPathElement)e.path=t;else{var i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d",""+t),e.path=i}return e}return v(e,r),e.prototype.map=function(t){var e=this.path.getPointAtLength(t*this.path.getTotalLength());return $o.translate(e.x,e.y)},e.prototype.unmap=function(t){return 0},e.prototype.equals=function(t){return this===t||t instanceof e&&this.path===t.path},e}(Rn),Wn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.map=function(t){throw new Error},e.prototype.unmap=function(t){return 0},e.prototype.range=function(t,e){return void 0===t?[this.map(0),this.map(1)]:void 0===e?(t=t,kn.scale(t[0],t[1])):kn.scale(t,e)},e.prototype.equals=function(t){return this===t},e}(kn),Bn=function(r){function e(t,e){var i=r.call(this)||this;if(!t&&!e)throw new Error;return e?t||(t=e):e=t,i.x0=new En(t.x0,e.x0),i.dx=new En(t.dx,e.dx),i.fx=new Nn(t.fx,e.fx),i}return v(e,r),e.prototype.map=function(t){var e=this.x0.map(t),i=this.dx.map(t),r=this.fx.map(t);return new wn(e,e+i,r)},e.prototype.unmap=function(t){return 0},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.x0.equals(t.x0)&&this.dx.equals(t.dx)&&this.fx.equals(t.fx))},e}(Wn),qn=function(r){function e(t,e){var i=r.call(this)||this;if(!t&&!e)throw new Error;return e?t||(t=e):e=t,i.t0=new En(t.t0,e.t0),i.dt=new En(t.dt,e.dt),i.ft=new Nn(t.ft,e.ft),i}return v(e,r),e.prototype.map=function(t){var e=this.t0.map(t),i=this.dt.map(t),r=this.ft.map(t);return new _n(e,e+i,r)},e.prototype.unmap=function(t){return 0},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.t0.equals(t.t0)&&this.dt.equals(t.dt)&&this.ft.equals(t.ft))},e}(Wn),Gn=function(n){function r(t,e){var i=n.call(this)||this;t||e?e?t||(t=e):e=t:e=t=[],i.interpolators=[];for(var r=Math.min(t.length,e.length),o=0;o<r;o+=1)i.interpolators.push(kn.interpolate(t[o],e[o]));return i}return v(r,n),r.prototype.map=function(t){for(var e=this.interpolators.length,i=new Array(e),r=0;r<this.interpolators.length;r+=1)i[r]=this.interpolators[r].map(t);return i},r.prototype.unmap=function(t){return 0},r.prototype.range=function(t,e){return void 0===t?[this.map(0),this.map(1)]:void 0===e?new r((t=t)[0],t[1]):new r(t,e)},r.prototype.equals=function(t){if(this===t)return!0;if(t instanceof r){var e=this.interpolators.length;if(e===t.interpolators.length){for(var i=0;i<e;i+=1)if(!this.interpolators[i].equals(t.interpolators[i]))return!1;return!0}}return!1},r}(kn),Nn=function(r){function i(t,e){var i=r.call(this)||this;if(!t&&!e)throw new Error;return e?t||(t=e):e=t,i.i0=t,i.i1=e,i.i00=i.i1.range(i.i0.map(0),i.i1.map(0)),i.i11=i.i1.range(i.i0.map(1),i.i1.map(1)),i}return v(i,r),i.prototype.map=function(t){return 0===t?this.i0:1===t?this.i1:this.i1.range(this.i00.map(t),this.i11.map(t))},i.prototype.unmap=function(t){return 0},i.prototype.range=function(t,e){return void 0===t?[this.i0,this.i1]:void 0===e?new i((t=t)[0],t[1]):new i(t,e)},i.prototype.equals=function(t){return this===t||t instanceof i&&(this.i0.equals(t.i0)&&this.i1.equals(t.i1))},i}(kn),Hn=function(r){function t(t,e){var i=r.call(this)||this;return i.form=t,i.unit=e,i}return v(t,r),t.prototype.mold=function(t){if(void 0!==t){t=kn.fromAny(t);var e=this.form.mold(t.map(0)),i=this.form.mold(t.map(1));if(e.isDefined()&&i.isDefined())return F.of(P.of("interpolate",F.of(e,i)))}return w.Absent},t.prototype.cast=function(t){var e=t.header("interpolate");if(2<=e.length){var i=this.form.cast(e.getItem(0).toValue()),r=this.form.cast(e.getItem(1).toValue());if(void 0!==i&&void 0!==r)return kn.interpolate(i,r)}},t}(_e),jn=function(){function o(t,e,i,r,o,n){this.dt=t,this.ft=e?br.fromAny(e):void 0,this.f=i?kn.fromAny(i):void 0,this.f0=r,this.f1=o,this.fi=n}return o.prototype.duration=function(t){return arguments.length?new o(t,this.ft,this.f,this.f0,this.f1,this.fi):this.dt},o.prototype.ease=function(t){return arguments.length?new o(this.dt,t,this.f,this.f0,this.f1,this.fi):this.ft},o.prototype.interpolate=function(t){return arguments.length?new o(this.dt,this.ft,t,this.f0,this.f1,this.fi):this.f},o.prototype.range=function(t,e){if(void 0===t)return this.f&&this.f.range();var i=void 0;return i=this.f?this.f.range(t,e):kn.interpolate(t,e),new o(this.dt,this.ft,i,this.f0,this.f1,this.fi)},o.prototype.onStart=function(t){return arguments.length?new o(this.dt,this.ft,this.f,t,this.f1,this.fi):this.f0},o.prototype.onEnd=function(t){return arguments.length?new o(this.dt,this.ft,this.f,this.f0,t,this.fi):this.f1},o.prototype.onInterrupt=function(t){return arguments.length?new o(this.dt,this.ft,this.f,this.f0,this.f1,t):this.fi},o.prototype.equals=function(t){return this===t||t instanceof o&&(this.dt===t.dt&&this.ft===t.ft&&(void 0===this.f?void 0===t.f:this.f.equals(t.f)))},o.form=function(t,e){return new Kn(t,e)},o.duration=function(t,e,i){return new o(t,e,i)},o.ease=function(t,e){return new o(void 0,t,e)},o.interpolate=function(t){return new o(void 0,void 0,t)},o.range=function(t,e){var i;return void 0===e?(t=t,i=kn.interpolate(t[0],t[1])):i=kn.interpolate(t,e),new o(void 0,void 0,i)},o.fromAny=function(t,e,i,r){return t instanceof o?t:"object"==typeof t?new o(t.duration,t.ease,t.interpolate,t.onStart,t.onEnd,t.onInterrupt):!0===t?new o(i,r,kn.interpolate(e)):void 0},o.isInit=function(t){if(t&&"object"==typeof t){var e=t;return void 0!==e.duration||void 0!==e.ease||void 0!==e.interpolate}return!1},o.Form=void 0,o}(),Kn=function(r){function t(t,e){var i=r.call(this)||this;return i.interpolatorForm=t,i.unit=e,i}return v(t,r),t.prototype.mold=function(t){if(void 0!==t){t=jn.fromAny(t);var e=F.empty();void 0!==t.dt&&e.slot("dt",t.dt),void 0!==t.ft&&e.slot("ease",br.Form.mold(t.ft));var i=F.of(P.of("transition",e)),r=this.interpolatorForm.mold(t.f);return r.isDefined()&&(i=i.concat(r)),i}return w.Absent},t.prototype.cast=function(t){var e=t.header("transition");if(2<=e.length){var r,o;e.forEach(function(t,e){var i=t.key.stringValue();void 0!==i?"dt"===i?r=t.toValue().numberValue(r):"ease"===i&&(o=t.toValue().cast(br.Form,o)):t instanceof w&&(0===e?r=t.numberValue(r):1===e&&(o=t.cast(br.Form,o)))},this);var i=this.interpolatorForm.cast(t.body());return new jn(r,o,i)}},t}(_e),Yn=function(){function t(t){this.callback=t,this.observationTargets=[],this.activeTargets=[],this.skippedTargets=[],ts.addObserver(this)}return t.prototype.observe=function(t){for(var e=0;e<this.observationTargets.length;e+=1)if(t===this.observationTargets[e].target)return;var i=new Zn(t);this.observationTargets.push(i),ts.redetect()},t.prototype.unobserve=function(t){for(var e=0;e<this.observationTargets.length;e+=1)t===this.observationTargets[e].target&&this.observationTargets.splice(e,1);this.observationTargets.length||ts.removeObserver(this)},t.prototype.gatherActive=function(t){this.clearActive(),this.clearSkipped();for(var e=0;e<this.observationTargets.length;e+=1){var i=this.observationTargets[e];if(i.isActive())t<es(i.target)?this.activeTargets.push(i):this.skippedTargets.push(i)}},t.prototype.broadcastActive=function(t){if(this.hasActive()){for(var e=[],i=0;i<this.activeTargets.length;i+=1){var r=this.observationTargets[i],o=new Qn(r.target);e.push(o),r.broadcastWidth=o.contentRect.width,r.broadcastHeight=o.contentRect.height;var n=es(r.target);n<t&&(t=n)}this.callback(e,this),this.clearActive()}return t},t.prototype.hasActive=function(){return 0<this.activeTargets.length},t.prototype.hasSkipped=function(){return 0<this.skippedTargets.length},t.prototype.clearActive=function(){this.activeTargets.length=0},t.prototype.clearSkipped=function(){this.skippedTargets.length=0},t.prototype.disconnect=function(){this.clearActive(),this.observationTargets.length=0,ts.removeObserver(this)},t}(),Xn="undefined"!=typeof window&&void 0!==window.ResizeObserver?window.ResizeObserver:Yn,Qn=function(t,e){this.target=t,this.contentRect=e||is(t)},Zn=function(){function t(t){this.target=t,this.broadcastWidth=0,this.broadcastHeight=0}return t.prototype.isActive=function(){var t=is(this.target);return!!t&&(Math.round(t.width)!==Math.round(this.broadcastWidth)||Math.round(t.height)!==Math.round(this.broadcastHeight))},t}(),Jn=function(){function t(){this.resizeObservers=[],this.mutationObserver=void 0,this.detectAnimationFrame=0,this.connected=!1,this.onResize=this.onResize.bind(this),this.onTransitionEnd=this.onTransitionEnd.bind(this),this.onMutation=this.onMutation.bind(this),this.onSubtreeModified=void 0,this.onDetectAnimationFrame=this.onDetectAnimationFrame.bind(this)}return t.prototype.addObserver=function(t){this.resizeObservers.indexOf(t)<0&&this.resizeObservers.push(t),this.connect()},t.prototype.removeObserver=function(t){var e=this.resizeObservers.indexOf(t);0<=e&&this.resizeObservers.splice(e,1),this.resizeObservers.length||this.disconnect()},t.prototype.gatherActive=function(t){for(var e=0;e<this.resizeObservers.length;e+=1)this.resizeObservers[e].gatherActive(t)},t.prototype.hasActive=function(){for(var t=0;t<this.resizeObservers.length;t+=1)if(this.resizeObservers[t].hasActive())return!0;return!1},t.prototype.hasSkipped=function(){for(var t=0;t<this.resizeObservers.length;t+=1)if(this.resizeObservers[t].hasSkipped())return!0;return!1},t.prototype.broadcastActive=function(){for(var t=Number.POSITIVE_INFINITY,e=0;e<this.resizeObservers.length;e+=1)t=this.resizeObservers[e].broadcastActive(t);return t},t.prototype.detect=function(){var t=0;for(this.gatherActive(t);t=this.broadcastActive(),this.gatherActive(t),this.hasActive(););this.hasSkipped()&&window.dispatchEvent(new ErrorEvent("ResizeObserver loop completed with undelivered notifications."))},t.prototype.redetect=function(){this.detectAnimationFrame||(this.detectAnimationFrame=requestAnimationFrame(this.onDetectAnimationFrame))},t.prototype.onDetectAnimationFrame=function(t){this.detectAnimationFrame=0,this.detect()},t.prototype.onResize=function(t){this.redetect()},t.prototype.onTransitionEnd=function(t){for(var e=!1,i=0;i<$n.length;i+=1)if(0<=t.propertyName.indexOf($n[i])){e=!0;break}e&&this.redetect()},t.prototype.onMutation=function(t){for(var e=0;e<t.length;e+=1){var i=t[e];if("childList"===i.type&&i.addedNodes&&0<i.addedNodes.length)for(var r=0;r<i.addedNodes.length;r+=1)this.addShadows(i.addedNodes[r])}this.redetect()},t.prototype.addShadows=function(t){if(t instanceof Element){for(var e=0;e<t.childNodes.length;e+=1)this.addShadows(t.childNodes[e]);t.shadowRoot&&(this.observe(t.shadowRoot),this.addShadows(t.shadowRoot))}},t.prototype.observe=function(t){this.mutationObserver.observe(t,{attributes:!0,childList:!0,characterData:!0,subtree:!0})},t.prototype.connect=function(){if(!this.connected){window.addEventListener("resize",this.onResize),document.addEventListener("transitionend",this.onTransitionEnd);var t="undefined"!=typeof navigator&&/Trident\/.*rv:11/.test(navigator.userAgent);"undefined"==typeof MutationObserver||t?(this.onSubtreeModified=this.onResize,document.addEventListener("DOMSubtreeModified",this.onSubtreeModified)):(this.mutationObserver=new MutationObserver(this.onMutation),this.observe(document),this.addShadows(document)),this.connected=!0}},t.prototype.disconnect=function(){this.connected&&(window.removeEventListener("resize",this.onResize),document.removeEventListener("transitionend",this.onTransitionEnd),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=void 0),this.onSubtreeModified&&(document.removeEventListener("DOMSubtreeModified",this.onSubtreeModified),this.onSubtreeModified=void 0),this.detectAnimationFrame&&(cancelAnimationFrame(this.detectAnimationFrame),this.detectAnimationFrame=0),this.connected=!1)},t}(),$n=["top","right","bottom","left","width","height","size","weight"],ts=new Jn;function es(t){for(var e=0;t.parentNode;)t=t.parentNode,e+=1;return e}function is(t){return t instanceof HTMLElement?function(t){if(!t.clientWidth&&!t.clientHeight)return os(0,0,0,0);var e=getComputedStyle(t),i=rs(e.getPropertyValue("padding-left")),r=rs(e.getPropertyValue("padding-top")),o=i+rs(e.getPropertyValue("padding-right")),n=r+rs(e.getPropertyValue("padding-bottom")),s=rs(e.getPropertyValue("width")),a=rs(e.getPropertyValue("height"));"border-box"===e.getPropertyValue("box-sizing")&&(Math.round(s+o)!==t.clientWidth&&(s-=o+rs(e.getPropertyValue("border-left-width"))+rs(e.getPropertyValue("border-right-width"))),Math.round(a+n)!==t.clientHeight&&(a-=n+rs(e.getPropertyValue("border-top-width"))+rs(e.getPropertyValue("border-bottom-width"))));if(t!==document.documentElement){var u=Math.round(s+o)-t.clientWidth,h=Math.round(a+n)-t.clientHeight;1!==Math.abs(u)&&(s-=u),1!==Math.abs(h)&&(a-=h)}return os(i,r,s,a)}(t):(i=t,("undefined"!=typeof SVGGraphicsElement?i instanceof SVGGraphicsElement:i instanceof SVGElement&&"function"==typeof i.getBBox)?os(0,0,(e=t.getBBox()).width,e.height):os(0,0,0,0));var e,i}function rs(t){return parseFloat(t)||0}function os(t,e,i,r){return{x:t,y:e,width:i,height:r,top:e,right:t+i,bottom:e+r,left:t}}function ns(t){return t&&"object"==typeof t&&"function"==typeof t.toAttributeString?t.toAttributeString():""+t}function ss(t){return t&&"object"==typeof t&&"function"==typeof t.toStyleString?t.toStyleString():""+t}(rn=en||(en={}))[rn.Quiesced=0]="Quiesced",rn[rn.Diverged=1]="Diverged",rn[rn.Tracking=2]="Tracking",rn[rn.Converged=3]="Converged",rn[rn.Interrupt=4]="Interrupt";var as=function(){function t(){}return t.DISABLED=1,t.REQUIRES_RESIZE=16,t}(),us=function(e){function t(){var t=e.call(this)||this;return t.flags=0,t.animationFrame=0,t.onAnimationFrame=t.onAnimationFrame.bind(t),t}return v(t,e),t.prototype.enabled=function(t){return void 0===t?0==(this.flags&as.DISABLED):(t&&0!=(this.flags&as.DISABLED)?(this.flags&=~as.DISABLED,this.animate()):t||0!=(this.flags&as.DISABLED)||(this.flags|=as.DISABLED),this)},t.prototype.animate=function(){this.animationFrame||0!=(this.flags&as.DISABLED)||(this.animationFrame=requestAnimationFrame(this.onAnimationFrame))},t.prototype.cancel=function(){this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=0)},t.prototype.onAnimationFrame=function(t){this.animationFrame=0,this.onFrame(t)},t}(as),hs=function(i){function t(t){var e=i.call(this)||this;return e.parent=t,e}return v(t,i),t.prototype.animate=function(){this.parent.animate()},t}(as),ls=function(o){function t(t,e,i){void 0===i&&(i=0);var r=o.call(this)||this;if(!e.f)throw new Error("no interpolator");return r.dt=void 0!==e.dt?e.dt:0,r.ft=e.ft||br.linear,r.f=e.f,r.f0=e.f0,r.f1=e.f1,r.fi=e.fi,r.fl=void 0,r.v=t,r.v1=t,r.t0=0,r.flags=i,r.tweenState=0,r}return v(t,o),t.prototype.enabled=function(t){return void 0===t?0==(this.flags&as.DISABLED):(t&&0!=(this.flags&as.DISABLED)?(this.flags&=~as.DISABLED,this.animate()):t||0!=(this.flags&as.DISABLED)||(this.flags|=as.DISABLED),this)},t.prototype.transition=function(t){return t?(void 0!==t.dt&&(this.dt=t.dt),t.ft&&(this.ft=t.ft),t.f&&(this.f=t.f),void 0!==t.f0&&(this.f0=t.f0),void 0!==t.f1&&(this.f1=t.f1),void 0!==t.fi&&(this.fi=t.fi),this):new jn(this.dt,this.ft,this.f)},t.prototype.duration=function(t){return void 0===t?this.dt:(this.dt=Math.max(0,t),this)},t.prototype.ease=function(t){return t?(this.ft=br.fromAny(t),this):this.ft},t.prototype.get=function(){return this.v},t.prototype.set=function(t,e){var i=this.fi;this.fi=void 0,e&&this.transition(e),this.f=this.f.range(this.v,t),this.fl=i,this.v1=t,this.t0=0,2===this.tweenState?this.tweenState=4:this.tweenState=1,e?this.animate():this.onFrame(0)},t.prototype.onFrame=function(t){if(0!==this.tweenState&&0==(this.flags&as.DISABLED)){if(4===this.tweenState&&(this.onInterrupt(this.v),this.fl&&(this.fl(this.v),this.fl=void 0),this.tweenState=1),1===this.tweenState&&(S(this.v,this.v1)?this.tween(1):(this.t0=t,this.onStart(this.v),this.f0&&(this.f0(this.v),this.f0=void 0),this.tweenState=2)),2===this.tweenState){var e=this.dt?Math.min(Math.max(0,(t-this.t0)/this.dt),1):1;this.tween(e)}3===this.tweenState?(this.onEnd(this.v),this.f1&&(this.f1(this.v),this.f1=void 0),this.fi=void 0,this.t0=0,this.tweenState=0):this.animate()}},t.prototype.map=function(t){return this.f.map(t)},t.prototype.tween=function(t){t=this.ft(t),this.v=this.map(t),this.update(this.v),1===t&&(this.tweenState=3)},t.prototype.updateTarget=function(t){var e=t.view;e&&0!=(this.flags&as.REQUIRES_RESIZE)&&e.requireResize()},t.prototype.onStart=function(t){},t.prototype.onEnd=function(t){},t.prototype.onInterrupt=function(t){},t}(as),ps=function(n){function t(t,e,i,r){var o=n.call(this,e,i,r)||this;return o.parent=t,o}return v(t,n),t.prototype.animate=function(){0==(this.flags&as.DISABLED)&&this.parent.animate()},t}(ls),cs=function(o){function t(t,e,i){var r=o.call(this,t,e,i)||this;return r.animationFrame=0,r.onAnimationFrame=r.onAnimationFrame.bind(r),r}return v(t,o),t.prototype.animate=function(){this.animationFrame||0!=(this.flags&as.DISABLED)||(this.animationFrame=requestAnimationFrame(this.onAnimationFrame))},t.prototype.cancel=function(){this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=0)},t.prototype.onAnimationFrame=function(t){this.animationFrame=0,this.onFrame(t)},t}(ls),ds=function(s){function t(t,e,i,r,o){var n=s.call(this,i,r,o)||this;return n.target=t,n.name=e,n}return v(t,s),t.prototype.update=function(t){var e=this.target.getAttribute(this.name),i=ns(t);e!==i&&(this.target.setAttribute(this.name,i),this.updateTarget(this.target))},t.prototype.animate=function(){s.prototype.animate.call(this)},t}(cs),fs=function(a){function t(t,e,i,r,o,n){var s=a.call(this,i,r,n)||this;return s.target=t,s.name=e,s.priority=o,s}return v(t,a),t.prototype.update=function(t){var e=this.target.style.getPropertyValue(this.name),i=ss(t);e!==i&&(this.target.style.setProperty(this.name,i,this.priority),this.updateTarget(this.target))},t.prototype.animate=function(){a.prototype.animate.call(this)},t}(cs),ys=function(s){function t(t,e,i,r,o){var n=s.call(this,e,i,o)||this;return n.target=t,n.format=r,n}return v(t,s),t.prototype.update=function(t){var e,i=this.format;if("object"==typeof i&&(i=i.format),"function"==typeof i)e=i(t);else if(t instanceof b){var r=void 0;r=this.target.view?this.target.view.stack():D.of(b.GlobalScope),e=t.evaluate(r).stringValue("")}else e=""+t;this.target instanceof Text?this.target.nodeValue=e:this.target instanceof HTMLElement?this.target.innerText=e:this.target.textContent=e},t.prototype.animate=function(){s.prototype.animate.call(this)},t}(cs),ms=function(){function e(t){this.node=t,this._backgroundColor=qo.white(),this._borderRadius=Lo.zero(),this._arrowWidth=Lo.fromAny(10),this._arrowHeight=Lo.fromAny(8),this._placement=[],this._viewportTop=Lo.fromAny(-1/0),this._viewportRight=Lo.fromAny(-1/0),this._viewportBottom=Lo.fromAny(-1/0),this._viewportLeft=Lo.fromAny(-1/0),this._sourceLeft=Lo.fromAny(NaN),this._sourceTop=Lo.fromAny(NaN),this._sourceWidth=Lo.zero(),this._sourceHeight=Lo.zero(),this.dirty=!0,this.observers=[],this.arrow=document.createElement("div"),this.arrow.setAttribute("class","popover-arrow"),this.arrow.style.setProperty("display","none"),this.arrow.style.setProperty("position","absolute"),this.arrow.style.setProperty("width","0"),this.arrow.style.setProperty("height","0")}return e.prototype.backgroundColor=function(t){return void 0===t?this._backgroundColor:(t=qo.fromAny(t),this._backgroundColor.equals(t)||(this._backgroundColor=t,this.dirty=!0),this)},e.prototype.borderRadius=function(t){return void 0===t?this._borderRadius:(t=Lo.fromAny(t),this._borderRadius.equals(t)||(this._borderRadius=t,this.dirty=!0),this)},e.prototype.arrowWidth=function(t){return void 0===t?this._arrowWidth:(t=Lo.fromAny(t),this._arrowWidth.equals(t)||(this._arrowWidth=t,this.dirty=!0),this)},e.prototype.arrowHeight=function(t){return void 0===t?this._arrowHeight:(t=Lo.fromAny(t),this._arrowHeight.equals(t)||(this._arrowHeight=t,this.dirty=!0),this)},e.prototype.placement=function(t){return void 0===t?this._placement.slice(0):(this._placement=t.slice(0),this.dirty=!0,this)},e.prototype.viewportLeft=function(t){return void 0===t?this._viewportLeft:(t=Lo.fromAny(t),this._viewportLeft.equals(t)||(this._viewportLeft=t,this.dirty=!0),this)},e.prototype.viewportRight=function(t){return void 0===t?this._viewportRight:(t=Lo.fromAny(t),this._viewportRight.equals(t)||(this._viewportRight=t,this.dirty=!0),this)},e.prototype.viewportTop=function(t){return void 0===t?this._viewportTop:(t=Lo.fromAny(t),this._viewportTop.equals(t)||(this._viewportTop=t,this.dirty=!0),this)},e.prototype.viewportBottom=function(t){return void 0===t?this._viewportBottom:(t=Lo.fromAny(t),this._viewportBottom.equals(t)||(this._viewportBottom=t,this.dirty=!0),this)},e.prototype.sourceLeft=function(t){return void 0===t?this._sourceLeft:(t=Lo.fromAny(t),this._sourceLeft.equals(t)||(this._sourceLeft=t,this.dirty=!0),this)},e.prototype.sourceTop=function(t){return void 0===t?this._sourceTop:(t=Lo.fromAny(t),this._sourceTop.equals(t)||(this._sourceTop=t,this.dirty=!0),this)},e.prototype.sourceWidth=function(t){return void 0===t?this._sourceWidth:(t=Lo.fromAny(t),this._sourceWidth.equals(t)||(this._sourceWidth=t,this.dirty=!0),this)},e.prototype.sourceHeight=function(t){return void 0===t?this._sourceHeight:(t=Lo.fromAny(t),this._sourceHeight.equals(t)||(this._sourceHeight=t,this.dirty=!0),this)},e.prototype.place=function(){if(this._placement.length){this.node.style.setProperty("position","absolute");for(var t,e=this._sourceWidth.pxValue(),i=this._sourceHeight.pxValue(),r=this._sourceLeft.pxValue(),o=r+e,n=this._sourceTop.pxValue(),s=n+i,a=r+e/2,u=n+i/2,h=this._arrowHeight.pxValue(),l=this.node.offsetWidth,p=this.node.offsetHeight,c=this.node.getBoundingClientRect(),d=Math.max(0,this._viewportLeft.pxValue()),f=document.body.clientWidth-Math.max(0,this._viewportRight.pxValue()),y=Math.max(0,this._viewportTop.pxValue()),m=document.body.clientHeight-Math.max(0,this._viewportBottom.pxValue()),v=d+(this.node.offsetLeft-c.left),g=f+(this.node.offsetLeft-c.left),b=y+(this.node.offsetTop-c.top),w=m+(this.node.offsetTop-c.top),_=d+r,x=document.body.clientWidth-(_+e),k=y+n,A=document.body.clientHeight-(k+i),E=0;E<this._placement.length;E+=1){if("top"===(C=this._placement[E])&&p+h<=k){t="top";break}if("bottom"===C&&p+h<=A){t="bottom";break}if("left"===C&&l+h<=_){t="left";break}if("right"===C&&l+h<=x){t="right";break}}if(!t)for(E=0;E<this._placement.length;E+=1){var C;if("over"===(C=this._placement[E])){t="over";break}if("top"===C&&A<=k){t="top";break}if("bottom"===C&&k<=A){t="bottom";break}if("left"===C&&x<=_){t="left";break}if("right"===C&&_<=x){t="right";break}}var S=Lo.fromAny(this.node.style.getPropertyValue("max-width")||0).pxValue(),V=Lo.fromAny(this.node.style.getPropertyValue("max-height")||0).pxValue(),D=S,M=V,P=this.node.offsetLeft,R=this.node.offsetTop;if("over"===t?(P=v,R=b,D=Math.max(0,f-d),M=Math.max(0,m-y)):"top"===t?(P=a-l/2<=v?v:g<=a+l/2?g-l:a-l/2,R=Math.max(b,n-(p+h)),D=Math.max(0,f-d),M=Math.max(0,s-b)):"bottom"===t?(P=a-l/2<=v?v:g<=a+l/2?g-l:a-l/2,R=Math.max(b,s+h),D=Math.max(0,f-d),M=Math.max(0,w-n)):"left"===t?(P=Math.max(v,r-(l+h)),R=u-p/2<=b?b:w<=u+p/2?w-p:u-p/2,D=Math.max(0,o-v),M=Math.max(0,m-y)):"right"===t&&(P=Math.max(v,o+h),R=u-p/2<=b?b:w<=u+p/2?w-p:u-p/2,D=Math.max(0,g-r),M=Math.max(0,m-y)),P!==this.node.offsetLeft||R!==this.node.offsetTop||D!==S||M!==V){for(E=0;E<this.observers.length;E+=1){(T=this.observers[E]).popoverWillPlace&&T.popoverWillPlace(t,this)}this.node.style.setProperty("left",P+"px"),this.node.style.setProperty("top",R+"px"),this.node.style.setProperty("max-width",D+"px"),this.node.style.setProperty("max-height",M+"px"),this.dirty=!0;for(E=0;E<this.observers.length;E+=1){var T;(T=this.observers[E]).popoverDidPlace&&T.popoverDidPlace(t,this)}}}},e.prototype.render=function(){this.dirty&&(this.dirty=!1,this.renderPopover())},e.prototype.renderPopover=function(){this.arrow.parentNode||this.node.insertBefore(this.arrow,this.node.firstChild);var t=this._sourceWidth.pxValue(),e=this._sourceHeight.pxValue(),i=this._sourceLeft.pxValue(),r=i+t,o=this._sourceTop.pxValue(),n=o+e,s=i+t/2,a=o+e/2,u=this.node.offsetLeft,h=u+this.node.offsetWidth,l=this.node.offsetTop,p=l+this.node.offsetHeight,c=this._borderRadius.pxValue(),d=this._arrowWidth.pxValue(),f=this._arrowHeight.pxValue(),y=u+c+d/2,m=h-c-d/2,v=l+c+d/2,g=p-c-d/2;this.node.style.setProperty("position","absolute"),this.node.style.setProperty("background-color",this._backgroundColor.toString()),this.node.style.setProperty("border-radius",this._borderRadius.toString()),this.arrow.style.removeProperty("top"),this.arrow.style.removeProperty("right"),this.arrow.style.removeProperty("bottom"),this.arrow.style.removeProperty("left"),this.arrow.style.removeProperty("border-left-width"),this.arrow.style.removeProperty("border-left-style"),this.arrow.style.removeProperty("border-left-color"),this.arrow.style.removeProperty("border-right-width"),this.arrow.style.removeProperty("border-right-style"),this.arrow.style.removeProperty("border-right-color"),this.arrow.style.removeProperty("border-top-width"),this.arrow.style.removeProperty("border-top-style"),this.arrow.style.removeProperty("border-top-color"),this.arrow.style.removeProperty("border-bottom-width"),this.arrow.style.removeProperty("border-bottom-style"),this.arrow.style.removeProperty("border-bottom-color"),a<=l-f&&y<=i&&r<=m?(this.arrow.style.setProperty("display","block"),this.arrow.style.setProperty("top",-f+"px"),this.arrow.style.setProperty("left",s-u-d/2+"px"),this.arrow.style.setProperty("border-left-width",d/2+"px"),this.arrow.style.setProperty("border-left-style","solid"),this.arrow.style.setProperty("border-left-color","transparent"),this.arrow.style.setProperty("border-right-width",d/2+"px"),this.arrow.style.setProperty("border-right-style","solid"),this.arrow.style.setProperty("border-right-color","transparent"),this.arrow.style.setProperty("border-bottom-width",f+"px"),this.arrow.style.setProperty("border-bottom-style","solid"),this.arrow.style.setProperty("border-bottom-color",this._backgroundColor.toString())):p+f<=a&&y<=i&&r<=m?(this.arrow.style.setProperty("display","block"),this.arrow.style.setProperty("bottom",-f+"px"),this.arrow.style.setProperty("left",s-u-d/2+"px"),this.arrow.style.setProperty("border-left-width",d/2+"px"),this.arrow.style.setProperty("border-left-style","solid"),this.arrow.style.setProperty("border-left-color","transparent"),this.arrow.style.setProperty("border-right-width",d/2+"px"),this.arrow.style.setProperty("border-right-style","solid"),this.arrow.style.setProperty("border-right-color","transparent"),this.arrow.style.setProperty("border-top-width",f+"px"),this.arrow.style.setProperty("border-top-style","solid"),this.arrow.style.setProperty("border-top-color",this._backgroundColor.toString())):s<=u-f&&v<=o&&n<=g?(this.arrow.style.setProperty("display","block"),this.arrow.style.setProperty("left",-f+"px"),this.arrow.style.setProperty("top",a-l-d/2+"px"),this.arrow.style.setProperty("border-top-width",d/2+"px"),this.arrow.style.setProperty("border-top-style","solid"),this.arrow.style.setProperty("border-top-color","transparent"),this.arrow.style.setProperty("border-bottom-width",d/2+"px"),this.arrow.style.setProperty("border-bottom-style","solid"),this.arrow.style.setProperty("border-bottom-color","transparent"),this.arrow.style.setProperty("border-right-width",f+"px"),this.arrow.style.setProperty("border-right-style","solid"),this.arrow.style.setProperty("border-right-color",this._backgroundColor.toString())):h+f<=s&&v<=o&&n<=g?(this.arrow.style.setProperty("display","block"),this.arrow.style.setProperty("right",-f+"px"),this.arrow.style.setProperty("top",a-l-d/2+"px"),this.arrow.style.setProperty("border-top-width",d/2+"px"),this.arrow.style.setProperty("border-top-style","solid"),this.arrow.style.setProperty("border-top-color","transparent"),this.arrow.style.setProperty("border-bottom-width",d/2+"px"),this.arrow.style.setProperty("border-bottom-style","solid"),this.arrow.style.setProperty("border-bottom-color","transparent"),this.arrow.style.setProperty("border-left-width",f+"px"),this.arrow.style.setProperty("border-left-style","solid"),this.arrow.style.setProperty("border-left-color",this._backgroundColor.toString())):this.arrow.style.setProperty("display","none")},e.prototype.addObserver=function(t){this.observers.indexOf(t)<0&&this.observers.push(t)},e.prototype.removeObserver=function(t){var e=this.observers.indexOf(t);0<=e&&this.observers.splice(e,1)},e.prototype.willShow=function(){for(var t=0;t<this.observers.length;t+=1){var e=this.observers[t];e.popoverWillShow&&e.popoverWillShow(this)}},e.prototype.didShow=function(){for(var t=0;t<this.observers.length;t+=1){var e=this.observers[t];e.popoverDidShow&&e.popoverDidShow(this)}},e.prototype.willHide=function(){for(var t=0;t<this.observers.length;t+=1){var e=this.observers[t];e.popoverWillHide&&e.popoverWillHide(this)}},e.prototype.didHide=function(){for(var t=0;t<this.observers.length;t+=1){var e=this.observers[t];e.popoverDidHide&&e.popoverDidHide(this)}},e.prototype.sourceWillChange=function(t,e){for(var i=0;i<this.observers.length;i+=1){var r=this.observers[i];r.popoverSourceWillChange&&r.popoverSourceWillChange(t,e,this)}},e.prototype.sourceDidChange=function(t,e){for(var i=0;i<this.observers.length;i+=1){var r=this.observers[i];r.popoverSourceDidChange&&r.popoverSourceDidChange(t,e,this)}},e.create=function(t){return void 0===t&&(t="div"),new e(document.createElement(t))},e}(),vs=function(){function p(t,e,i,r,o,n,s){this.inset=t,this.offsetX=e,this.offsetY=i,this.blurRadius=r,this.spreadRadius=o,this.color=n,this.next=s}return p.prototype.isDefined=function(){return this.inset||this.offsetX.isDefined()||this.offsetY.isDefined()||this.blurRadius.isDefined()||this.spreadRadius.isDefined()||this.color.isDefined()||!!this.next&&this.next.isDefined()},p.prototype.and=function(t,e,i,r,o,n){var s=this.next?this.next.and.apply(this.next,arguments):p.of.apply(void 0,arguments);return new p(this.inset,this.offsetX,this.offsetY,this.blurRadius,this.spreadRadius,this.color,s)},p.prototype.equals=function(t){return this===t||t instanceof p&&(this.inset===t.inset&&this.offsetX.equals(t.offsetX)&&this.offsetY.equals(t.offsetY)&&this.blurRadius.equals(t.blurRadius)&&this.spreadRadius.equals(t.spreadRadius)&&this.color.equals(t.color)&&(null===this.next?null===t.next:this.next.equals(t.next)))},p.prototype.toString=function(){if(this.isDefined()){for(var t="",e=this;;){if(e.inset&&(t+="inset",t+=" "),t+=e.offsetX.toString(),t+=" ",t+=e.offsetY.toString(),t+=" ",t+=e.blurRadius.toString(),t+=" ",t+=e.spreadRadius.toString(),t+=" ",t+=e.color.toString(),!e.next)break;t+=", ",e=e.next}return t}return"none"},p.form=function(t){return void 0!==t?new bs(p.fromAny(t)):p.Form},p.of=function(t,e,i,r,o,n){if(1===arguments.length)return p.fromAny(t);if("boolean"!=typeof t){if(3===arguments.length)n=qo.fromAny(i),o=Lo.zero(),r=Lo.zero(),i=Lo.fromAny(e),e=Lo.fromAny(t);else if(4===arguments.length)n=qo.fromAny(r),o=Lo.zero(),r=Lo.fromAny(i),i=Lo.fromAny(e),e=Lo.fromAny(t);else{if(5!==arguments.length)throw new TypeError(""+arguments);n=qo.fromAny(o),o=Lo.fromAny(r),r=Lo.fromAny(i),i=Lo.fromAny(e),e=Lo.fromAny(t)}t=!1}else if(4===arguments.length)n=qo.fromAny(r),o=Lo.zero(),r=Lo.zero(),e=Lo.fromAny(e),i=Lo.fromAny(i);else if(5===arguments.length)n=qo.fromAny(o),o=Lo.zero(),r=Lo.fromAny(r),e=Lo.fromAny(e),i=Lo.fromAny(i);else{if(6!==arguments.length)throw new TypeError(""+arguments);n=qo.fromAny(n),o=Lo.fromAny(o),r=Lo.fromAny(r),i=Lo.fromAny(i),e=Lo.fromAny(e)}return new p(t,e,i,r,o,n,null)},p.fromAny=function(){for(var t,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];if((t=0===arguments.length?p.None:1===arguments.length?arguments[0]:arguments)instanceof p)return t;if("string"==typeof t)return p.parse(t);if(t&&"object"==typeof t&&void 0===t.length)return new p((t=t).inset||!1,void 0!==t.offsetX?Lo.fromAny(t.offsetX):Lo.zero(),void 0!==t.offsetY?Lo.fromAny(t.offsetY):Lo.zero(),void 0!==t.blurRadius?Lo.fromAny(t.blurRadius):Lo.zero(),void 0!==t.spreadRadius?Lo.fromAny(t.spreadRadius):Lo.zero(),void 0!==t.color?qo.fromAny(t.color):qo.black(),null);if(t&&"object"==typeof t&&0<t.length){for(var r=p.fromAny((t=t)[0]),o=1;o<t.length;o+=1)r=r.and(t[o]);return r}throw new TypeError(""+t)},p.fromValue=function(t){var l;return t.forEach(function(t,e){var i=t.header("boxShadow");if(i){var r,o,n,s,a,u;i.forEach(function(t,e){var i=t.key.stringValue();void 0!==i?"inset"===i?r=t.toValue().booleanValue(r):"offsetX"===i?o=t.toValue().cast(Lo.Form,o):"offsetY"===i?n=t.toValue().cast(Lo.Form,n):"blurRadius"===i?s=t.toValue().cast(Lo.Form,s):"spreadRadius"===i?a=t.toValue().cast(Lo.Form,a):"color"===i&&(u=t.toValue().cast(qo.Form,u)):t instanceof w&&(0===e&&t instanceof O&&"inset"===t.value?r=!0:0===e||1===e&&void 0!==r?o=t.cast(Lo.Form,o):1===e||2===e&&void 0!==r?n=t.cast(Lo.Form,n):2===e||3===e&&void 0!==r?void 0===(s=t.cast(Lo.Form,s))&&(u=t.cast(qo.Form,u)):(3===e||4===e&&void 0===r)&&void 0===u?void 0===(a=t.cast(Lo.Form,a))&&(u=t.cast(qo.Form,u)):(4===e||5===e&&void 0===r)&&void 0===u&&(u=t.cast(qo.Form,u)))}),r=void 0!==r&&r,o=void 0!==o?o:Lo.zero(),n=void 0!==n?n:Lo.zero(),s=void 0!==s?s:Lo.zero(),a=void 0!==a?a:Lo.zero(),u=void 0!==u?u:qo.black();var h=new p(r||!1,o,n,s,a,u,null);l=l?l.and(h):h}}),l},p.parse=function(t){for(var e=new m(t);!e.isEmpty()&&_.isSpace(e.head());)e.step();var i=gs.parse(e);if(i.isDone()){for(;!e.isEmpty()&&_.isSpace(e.head());)e.step();e.isEmpty()||(i=_.unexpected(e))}return i.bind()},p.isInit=function(t){if(t&&"object"==typeof t){var e=t;return void 0!==e.offsetX&&void 0!==e.offsetY&&void 0!==e.color}return!1},p.None=new p(!1,Lo.zero(),Lo.zero(),Lo.zero(),Lo.zero(),qo.black(),null),p.Form=void 0,p}(),gs=function(h){function g(t,e,i,r,o,n,s,a){var u=h.call(this)||this;return u.boxShadow=t,u.identParser=e,u.offsetXParser=i,u.offsetYParser=r,u.blurRadiusParser=o,u.spreadRadiusParser=n,u.colorParser=s,u.step=a,u}return v(g,h),g.prototype.feed=function(t){return g.parse(t,this.boxShadow,this.identParser,this.offsetXParser,this.offsetYParser,this.blurRadiusParser,this.spreadRadiusParser,this.colorParser,this.step)},g.parse=function(t,e,i,r,o,n,s,a,u){void 0===u&&(u=1);for(var h=0;;){if(1===u){for(;!t.isEmpty()&&(h=t.head(),_.isSpace(h));)t.step();if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else u=ri.isIdentStartChar(h)?2:4}if(2===u){for(i||(i=ri.Factory.parseIdent(t));i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone()){var l=i.bind().stringValue();if("inset"!==l)return"none"!==l||e?_.error("unexpected "+l):_.done(vs.None);u=3}else if(i.isError())return i.asError()}if(3===u)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(!_.isSpace(t.head()))return _.expected("space",t);t.step(),u=4}if(4===u){if(!r){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();t.isEmpty()||(r=Wo.parse(t))}if(r){for(;r.isCont()&&(!t.isEmpty()||t.isDone());)r=r.feed(t);if(r.isDone())u=5;else if(r.isError())return r.asError()}else if(t.isDone())return _.unexpected(t)}if(5===u)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(!_.isSpace(t.head()))return _.expected("space",t);t.step(),u=6}if(6===u){if(!o){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();t.isEmpty()||(o=Wo.parse(t))}if(o){for(;o.isCont()&&(!t.isEmpty()||t.isDone());)o=o.feed(t);if(o.isDone())u=7;else if(o.isError())return o.asError()}else if(t.isDone())return _.unexpected(t)}if(7===u)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(!_.isSpace(t.head()))return _.expected("space",t);t.step(),u=8}if(8===u){if(!n){for(;!t.isEmpty()&&(h=t.head(),_.isSpace(h));)t.step();t.isEmpty()||(45===h||48<=h&&h<=57?n=Wo.parse(t):u=12)}if(n){for(;n.isCont()&&(!t.isEmpty()||t.isDone());)n=n.feed(t);if(n.isDone())u=9;else if(n.isError())return n.asError()}else if(t.isDone())return _.unexpected(t)}if(9===u)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(!_.isSpace(t.head()))return _.expected("space",t);t.step(),u=10}if(10===u){if(!s){for(;!t.isEmpty()&&(h=t.head(),_.isSpace(h));)t.step();t.isEmpty()||(45===h||48<=h&&h<=57?s=Wo.parse(t):u=12)}if(s){for(;s.isCont()&&(!t.isEmpty()||t.isDone());)s=s.feed(t);if(s.isDone())u=11;else if(s.isError())return s.asError()}else if(t.isDone())return _.unexpected(t)}if(11===u)if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(!_.isSpace(t.head()))return _.expected("space",t);t.step(),u=12}if(12===u){if(!a){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();t.isEmpty()||(a=Zo.parse(t))}if(a){for(;a.isCont()&&(!t.isEmpty()||t.isDone());)a=a.feed(t);if(a.isDone()){var p=!!i&&"inset"===i.bind().stringValue(),c=r.bind(),d=o.bind(),f=n?n.bind():Lo.zero(),y=s?s.bind():Lo.zero(),m=a.bind(),v=new vs(p,c,d,f,y,m,null);e=e?e.and(v):v,a=s=n=o=r=i=void 0,u=13}else if(a.isError())return a.asError()}else if(t.isDone())return _.unexpected(t)}if(13===u){for(;!t.isEmpty()&&(h=t.head(),_.isSpace(h));)t.step();if(!t.isEmpty()&&44===h){t.step(),u=1;continue}if(!t.isEmpty()||t.isDone())return _.done(e)}break}return new g(e,i,r,o,n,s,a,u)},g}(_),bs=function(i){function t(t){void 0===t&&(t=vs.None);var e=i.call(this)||this;return e.unit=t,e}return v(t,i),t.prototype.mold=function(t){for(var e=vs.fromAny(t),i=F.empty();;){var r=F.empty(5);if(e.inset&&r.push("inset"),r.push(Lo.Form.mold(e.offsetX)),r.push(Lo.Form.mold(e.offsetY)),r.push(Lo.Form.mold(e.blurRadius)),r.push(Lo.Form.mold(e.spreadRadius)),r.push(qo.Form.mold(e.color)),i.attr("boxShadow",r),!e.next)break;e=e.next}return i},t.prototype.cast=function(t){var e;try{if(!(e=vs.fromValue(t))){var i=t.stringValue();void 0!==i&&(e=vs.parse(i))}}catch(t){}return e},t}(_e);vs.Form=new bs;var ws={Form:void 0,form:function(t){return void 0!==t?new ks(t):ws.Form},fromAny:function(t){if(t instanceof ro||t instanceof Ao||t instanceof Lo||t instanceof qo||t instanceof vs||t instanceof $o||t instanceof kn||t instanceof gn||t instanceof jn||"number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Date||ro.isInit(t))return ro.fromAny(t);if(qo.isInit(t))return qo.fromAny(t);if(vs.isInit(t))return vs.fromAny(t);if(jn.isInit(t))return jn.fromAny(t);if("string"==typeof t)return ws.parse(t);throw new TypeError(""+t)},parse:function(t){for("string"==typeof t&&(t=new m(t));!t.isEmpty()&&_.isSpace(t.head());)t.step();var e=xs.parse(t);if(e.isDone()){for(;!t.isEmpty()&&_.isSpace(t.head());)t.step();t.isEmpty()||(e=_.unexpected(t))}return e.bind()}},_s=Ar.pattern("%m-%dT%H:%M:%S.%LZ"),xs=function(n){function l(t,e,i,r){var o=n.call(this)||this;return o.identParser=t,o.valueParser=e,o.unitsOutput=i,o.step=r,o}return v(l,n),l.prototype.feed=function(t){return l.parse(t,this.identParser,this.valueParser,this.unitsOutput,this.step)},l.parse=function(t,e,i,r,o){void 0===o&&(o=1);var n=0;if(1===o){for(;!t.isEmpty()&&(n=t.head(),_.isSpace(n));)t.step();if(t.isEmpty()){if(t.isDone())return _.unexpected(t)}else{if(35===n)return Yo.parse(t);o=ri.isIdentStartChar(n)?2:3}}if(2===o){for(e||(e=ri.Factory.parseIdent(t));e.isCont()&&(!t.isEmpty()||t.isDone());)e=e.feed(t);if(e.isDone()){var s=e.bind().stringValue();switch(s){case"rgb":case"rgba":return Xo.parseRest(t,e);case"hsl":case"hsla":return Qo.parseRest(t,e);case"translateX":case"translateY":case"translate":return ln.parseRest(t,e);case"scaleX":case"scaleY":case"scale":return pn.parseRest(t,e);case"rotate":return cn.parseRest(t,e);case"skewX":case"skewY":case"skew":return dn.parseRest(t,e);case"matrix":return fn.parseRest(t,e);case"true":return _.done(!0);case"false":return _.done(!1);default:return _.error(s)}}else if(e.isError())return e.asError()}if(3===o){for(i||(i=ri.Factory.parseDecimal(t));i.isCont()&&(!t.isEmpty()||t.isDone());)i=i.feed(t);if(i.isDone())o=4;else if(i.isError())return i.asError()}if(4===o){if(!t.isEmpty()&&45===(n=t.head())){t.step();var a={};return a.year=i.bind().numberValue(),_s.parseDate(t,a)}t.isEmpty()&&!t.isDone()||(o=5)}if(5===o){for(r=r||new g;!t.isEmpty()&&(n=t.head(),_.isAlpha(n)||37===n);)t.step(),r.push(n);if(!t.isEmpty()||t.isDone()){var u=i.bind().numberValue(),h=r.bind();switch(h){case"deg":return _.done(Ao.deg(u));case"grad":return _.done(Ao.grad(u));case"rad":return _.done(Ao.rad(u));case"turn":return _.done(Ao.turn(u));case"px":return _.done(Lo.px(u));case"em":return _.done(Lo.em(u));case"rem":return _.done(Lo.rem(u));case"%":return _.done(Lo.pct(u));case"":return _.done(u);default:return _.error(h)}}}return new l(e,i,r,o)},l}(_),ks=function(i){function t(t){var e=i.call(this)||this;return e.unit=t,e}return v(t,i),t.prototype.mold=function(t){if(void 0!==t){if((t=ws.fromAny(t))instanceof ro)return ro.Form.mold(t);if(t instanceof Ao)return Ao.Form.mold(t);if(t instanceof Lo)return Lo.Form.mold(t);if(t instanceof qo)return qo.Form.mold(t);if(t instanceof vs)return vs.Form.mold(t);if(t instanceof $o)return $o.Form.mold(t);if(t instanceof kn)return kn.Form.mold(t);if(t instanceof gn)return gn.Form.mold(t);if(t instanceof jn)return jn.Form.mold(t);if("number"==typeof t)return W.valueOf(t)}return w.Absent},t.prototype.cast=function(t){if(t instanceof W)return t.numberValue();if(t instanceof z)return t.booleanValue();var e=t.stringValue();if(void 0!==e)try{return ws.parse(e)}catch(t){}if(t instanceof F){var i=ro.fromValue(t);if(i)return i;var r=Ao.fromValue(t);if(r)return r;var o=Lo.fromValue(t);if(o)return o;var n=qo.fromValue(t);if(n)return n;var s=vs.fromValue(t);if(s)return s;var a=$o.fromValue(t);if(a)return a;var u=kn.Form.cast(t);if(u)return u;var h=gn.Form.cast(t);if(h)return h;var l=jn.Form.cast(t);if(l)return l}},t}(_e);ws.Form=new ks,kn.Form=new Hn(ws.Form),gn.Form=new xn(ws.Form,kn.Form),bn.Form=gn.Form,jn.Form=new Kn(kn.Form);var As=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"date"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){var i,r;if(t instanceof U?i=ro.current():2<=t.length?(i=t.getItem(0).evaluate(e).cast(ro.Form),r=t.getItem(1).evaluate(e).toValue().toAny()):t instanceof W?i=t.evaluate(e).cast(ro.Form):(i=ro.current(),r=t.evaluate(e).toValue().toAny()),!i)return b.Absent;if(r&&r.pattern){var o=Ar.pattern(r.pattern).format(i._time);return b.Text.valueOf(o)}return ro.Form.mold(i)},e}(J),Es=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"now"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t){return W.valueOf(Date.now())},e}(J),Cs=function(i){function t(t){var e=i.call(this)||this;return e.interpolator=t,e}return v(t,i),Object.defineProperty(t.prototype,"name",{get:function(){return"interpolator"},enumerable:!0,configurable:!0}),t.prototype.invoke=function(t,e){var i=t.evaluate(e).numberValue();if(void 0!==i){i=Math.min(Math.max(0,i||0),1);var r=this.interpolator.map(i);return ws.Form.mold(r)}return b.Absent},t}(J),Ss=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"inerpolate"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){var i,r;if(2<=t.length?(i=t.getItem(0).evaluate(e).cast(ws.Form),r=t.getItem(1).evaluate(e).cast(ws.Form)):i=t.evaluate(e).cast(ws.Form),void 0!==i||void 0!==r){var o=kn.interpolate(i,r);return new Cs(o)}return b.Absent},e}(J),Vs=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"brighter"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){var i,r;return 2<=t.length?(i=t.getItem(0).evaluate(e).cast(qo.Form),r=t.getItem(1).evaluate(e).numberValue()):i=t.evaluate(e).cast(qo.Form),i?(i=i.brighter(r),qo.Form.mold(i)):b.Absent},e}(J),Ds=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"darker"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){var i,r;return 2<=t.length?(i=t.getItem(0).evaluate(e).cast(qo.Form),r=t.getItem(1).evaluate(e).numberValue()):i=t.evaluate(e).cast(qo.Form),i?(i=i.darker(r),qo.Form.mold(i)):b.Absent},e}(J),Ms=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"contrast"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){var i,r;return 2<=t.length?(i=t.getItem(0).evaluate(e).cast(qo.Form),r=t.getItem(1).evaluate(e).numberValue()):i=t.evaluate(e).cast(qo.Form),i?(i=i.contrast(r),qo.Form.mold(i)):b.Absent},e}(J),Ps=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"opacity"},enumerable:!0,configurable:!0}),e.prototype.invoke=function(t,e){var i,r;return 2<=t.length&&(i=t.getItem(0).evaluate(e).cast(qo.Form),r=t.getItem(1).evaluate(e).numberValue(),i&&void 0!==r)?(i=i.alpha(r),qo.Form.mold(i)):b.Absent},e}(J),Rs={Date:new As,Now:new Es,Brighter:new Vs,Darker:new Ds,Contrast:new Ms,Opacity:new Ps,Interpolate:new Ss,GlobalScope:void 0};Rs.GlobalScope=b.GlobalScope.branch().slot("date",Rs.Date).slot("now",Rs.Now).slot("brighter",Rs.Brighter).slot("darker",Rs.Darker).slot("contrast",Rs.Contrast).slot("opacity",Rs.Opacity).slot("interpolate",Rs.Interpolate).commit();var Ts=function(){function e(){}return Object.defineProperty(e.prototype,"tag",{get:function(){return this.constructor.tag},enumerable:!0,configurable:!0}),e.prototype.toRecon=function(){return this.toValue().toRecon()},Object.defineProperty(e,"tag",{get:function(){return""},enumerable:!0,configurable:!0}),e.fromValue=function(t){switch(t.tag){case"append":return Is.fromValue(t);case"prepend":return zs.fromValue(t);case"insert":return Us.fromValue(t);case"remove":return Os.fromValue(t);case"state":return Ws.fromValue(t);case"model":return Bs.fromValue(t);default:return}},e.parseRecon=function(t){return e.fromValue(w.parseRecon(t))},e}(),Ls=function(n){function t(t,e,i,r){var o=n.call(this)||this;return o._parent=t,o._child=e,o._target=i,o._body=r,o}return v(t,n),t.prototype.parent=function(t){return void 0===t?this._parent:this.copy(t,this._child,this._target,this._body)},t.prototype.child=function(t){return void 0===t?this._child:this.copy(this._parent,t,this._target,this._body)},t.prototype.target=function(t){return void 0===t?this._target:this.copy(this._parent,this._child,t,this._body)},t.prototype.body=function(t){return void 0===t?this._body:(t=w.fromAny(t),this.copy(this._parent,this._child,this._target,t))},t.prototype.toValue=function(){var t=F.empty(this._target?3:2).slot("parent",this._parent).slot("child",this._child);return this._target&&t.slot("target",this._target),P.of(this.tag,t).concat(this._body)},t.fromValue=function(t,e){var r,o,n="";if(t.header(e.tag).forEach(function(t,e){if(t.key instanceof O){var i=t.key.value;"parent"===i?r=t.toValue().stringValue(r):"child"===i?o=t.toValue().stringValue(o):"target"===i&&(n=t.toValue().stringValue(n))}else t instanceof w&&(0===e?r=t.stringValue(r):1===e?o=t.stringValue(o):2===e&&(n=t.stringValue(n)))},this),void 0!==r&&void 0!==o){var i=t.body();return new e(r,o,n,i)}},t}(Ts),Fs=function(r){function t(t,e){var i=r.call(this)||this;return i._child=t,i._body=e,i}return v(t,r),t.prototype.parent=function(t){return void 0===t?"":this},t.prototype.child=function(t){return void 0===t?this._child:this.copy(t,this._body)},t.prototype.target=function(t){return void 0===t?"":this},t.prototype.body=function(t){return void 0===t?this._body:(t=w.fromAny(t),this.copy(this._child,t))},t.prototype.toValue=function(){var t=F.empty(1).slot("child",this._child);return P.of(this.tag,t).concat(this._body)},t.fromValue=function(t,e){var i;if(t.header(e.tag).forEach(function(t,e){t.key instanceof O?"child"===t.key.value&&(i=t.toValue().stringValue(i)):t instanceof w&&0===e&&(i=t.stringValue(i))},this),void 0!==i){var r=t.body();return new e(i,r)}},t}(Ts),Is=function(o){function n(t,e,i,r){return o.call(this,t,e,i,r)||this}return v(n,o),n.prototype.copy=function(t,e,i,r){return new n(t,e,i,r)},n.fromValue=function(t){return Ls.fromValue(t,n)},Object.defineProperty(n,"tag",{get:function(){return"append"},enumerable:!0,configurable:!0}),n.of=function(t,e,i,r){return void 0===r&&(r=w.Absent),new n(t,e,i,r=w.fromAny(r))},n}(Ls),zs=function(o){function n(t,e,i,r){return o.call(this,t,e,i,r)||this}return v(n,o),n.prototype.copy=function(t,e,i,r){return new n(t,e,i,r)},n.fromValue=function(t){return Ls.fromValue(t,n)},Object.defineProperty(n,"tag",{get:function(){return"prepend"},enumerable:!0,configurable:!0}),n.of=function(t,e,i,r){return void 0===r&&(r=w.Absent),new n(t,e,i,r=w.fromAny(r))},n}(Ls),Us=function(o){function n(t,e,i,r){return o.call(this,t,e,i,r)||this}return v(n,o),n.prototype.copy=function(t,e,i,r){return new n(t,e,i,r)},n.fromValue=function(t){return Ls.fromValue(t,n)},Object.defineProperty(n,"tag",{get:function(){return"insert"},enumerable:!0,configurable:!0}),n.of=function(t,e,i,r){return void 0===r&&(r=w.Absent),new n(t,e,i,r=w.fromAny(r))},n}(Ls),Os=function(o){function n(t,e,i,r){return void 0===r&&(r=w.Absent),o.call(this,t,e,i,r)||this}return v(n,o),n.prototype.copy=function(t,e,i,r){return new n(t,e,i,r)},n.fromValue=function(t){return Ls.fromValue(t,n)},Object.defineProperty(n,"tag",{get:function(){return"remove"},enumerable:!0,configurable:!0}),n.of=function(t,e,i,r){return void 0===r&&(r=w.Absent),new n(t,e,i,r=w.fromAny(r))},n}(Ls),Ws=function(i){function r(t,e){return i.call(this,t,e)||this}return v(r,i),r.prototype.copy=function(t,e){return new r(t,e)},r.fromValue=function(t){return Fs.fromValue(t,r)},Object.defineProperty(r,"tag",{get:function(){return"state"},enumerable:!0,configurable:!0}),r.of=function(t,e){return void 0===e&&(e=w.Absent),new r(t,e=w.fromAny(e))},r}(Fs),Bs=function(i){function r(t,e){return i.call(this,t,e)||this}return v(r,i),r.prototype.copy=function(t,e){return new r(t,e)},r.fromValue=function(t){return Fs.fromValue(t,r)},Object.defineProperty(r,"tag",{get:function(){return"model"},enumerable:!0,configurable:!0}),r.of=function(t,e){return void 0===e&&(e=w.Absent),new r(t,e=w.fromAny(e))},r}(Fs),qs=function(){function t(t,e,i){void 0===i&&(i=null),this._name=t,this._selector=e,this._type=i}return t.prototype.getName=function(){return this._name},t.prototype.getType=function(){return this._type},t.prototype.evaluate=function(t,e){var i=this._selector.evaluate(e).toValue();i.isDefined()&&t.slot(this._name,i)},t}(),Gs=function(){function o(t){void 0===t&&(t=C.generateId()),this._id=t,this._parentModel=null,this._childModels=[],this._directives=[],this._appModel=null,this._modelScope=new Ns(this),this._state=w.Absent,this._flags=0}return Object.defineProperty(o.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"parentModel",{get:function(){return this._parentModel},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"childModels",{get:function(){return this._childModels},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"appModel",{get:function(){var t=this._appModel;if(null===t)for(var e=this;e;){if(e instanceof o.AppModel){this._appModel=t=e;break}e=e._parentModel}return t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"directives",{get:function(){return this._directives},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"modelScope",{get:function(){return this._modelScope},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"routeScope",{get:function(){var t=this.appModel;return t?t._routeScope:null},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"parentScope",{get:function(){var t=this._parentModel;return t?t._modelScope:null},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"downlinkContext",{get:function(){for(var t=this;t;){if(t._downlinkContext)return t._downlinkContext;t=t._parentModel}return ar},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"params",{get:function(){return this.constructor.Params},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),o.prototype.setState=function(t){t=w.fromAny(t);var e=this._state;if(t=this.willSetState(t,e),!e.equals(t)){this._state=t.commit(),this.didSetState(t,e);var i=this.appModel;i&&i.setState(t,this)}},o.prototype.willSetState=function(t,e){return t},o.prototype.didSetState=function(t,e){},o.prototype.setParentModel=function(t){var e=this._parentModel;if(t){if(e)throw new Error;this._parentModel=t,(i=this.appModel)&&i.addDescendantModels(this,t),this.requireRestate(),this.didSetParentModel(t)}else if(e){var i;(i=e.appModel)&&i.removeDescendantModels(this,e),this._flags=0,this._appModel=null,this._parentModel=null,this.didSetParentModel(null)}},o.prototype.didSetParentModel=function(t){},o.prototype.setAppModel=function(t){null===(this._appModel=t)&&this._modelScope.close(),this.didSetAppModel(t)},o.prototype.didSetAppModel=function(t){},o.prototype.appendChildModel=function(t){if(!t)throw new TypeError(""+t);if(0<=this._childModels.indexOf(t))throw new Error("duplicate child");if(t._parentModel)throw new Error("duplicate parent");this._childModels.push(t),t.setParentModel(this),this.didInsertChildModel(t)},o.prototype.prependChildModel=function(t){if(!t)throw new TypeError(""+t);if(0<=this._childModels.indexOf(t))throw new Error("duplicate child");if(t._parentModel)throw new Error("duplicate parent");this._childModels.unshift(t),t.setParentModel(this),this.didInsertChildModel(t)},o.prototype.insertChildModel=function(t,e){if(!t)throw new TypeError(""+t);if(0<=this._childModels.indexOf(t))throw new Error("duplicate child");if(t._parentModel)throw new Error("duplicate parent");var i=e?this._childModels.indexOf(e):-1;i<0&&(i=this._childModels.length),this._childModels.splice(i,0,t),t.setParentModel(this),this.didInsertChildModel(t)},o.prototype.removeChildModel=function(t){if(!t)throw new TypeError(""+t);var e=this._childModels.indexOf(t);0<=e&&(t.setParentModel(null),this._childModels.splice(e,1),this.didRemoveChildModel(t))},o.prototype.didInsertChildModel=function(t){for(var e=0,i=this._directives.length;e<i;e+=1)this._directives[e].didInsertChildModel(t);0!=(t._flags&o.REQUEST_RESTATE)&&this.requestRestate()},o.prototype.didRemoveChildModel=function(t){for(var e=0,i=this._directives.length;e<i;e+=1)this._directives[e].didRemoveChildModel(t)},o.prototype.addDirective=function(t){if(!t)throw new TypeError(""+t);if(0<=this._directives.indexOf(t))throw new Error("duplicate directive");if(t._model)throw new Error("duplicate model");this._directives.push(t),t.setModel(this),this.didAddDirective(t)},o.prototype.removeDirective=function(t){if(!t)throw new TypeError(""+t);var e=this._directives.indexOf(t);0<=e&&(t.setModel(null),this._directives.splice(e,1),this.didRemoveDirective(t))},o.prototype.didAddDirective=function(t){},o.prototype.didRemoveDirective=function(t){},o.prototype.appendChildView=function(t,e){var i=this._appModel;i&&i.appendChildView(this._id,t,e)},o.prototype.prependChildView=function(t,e){var i=this._appModel;i&&i.prependChildView(this._id,t,e)},o.prototype.insertChildView=function(t,e,i){var r=this._appModel;r&&r.insertChildView(this._id,t,e,i)},o.prototype.removeChildView=function(t){var e=this._appModel;e&&e.removeChildView(this._id,t)},o.prototype.isSealed=function(t){return void 0===t?0!=(this._flags&o.SEALED):(t?this._flags|=o.SEALED:this._flags&=~o.SEALED,this)},o.prototype.willRemodel=function(t,e){for(var i=0,r=this._directives.length;i<r;i+=1)this._directives[i].willRemodel(t,e)},o.prototype.didRemodel=function(t,e){for(var i=0,r=this._directives.length;i<r;i+=1)this._directives[i].didRemodel(t,e)},o.prototype.remodel=function(t){void 0===t&&(t=this.stack());for(var e=this.params,i=F.empty(e.length),r=0;r<e.length;r+=1)e[r].evaluate(i,t);this.willRemodel(i,t),this.setState(i),this.didRemodel(i,t)},o.prototype.willRestate=function(){for(var t=0,e=this._directives.length;t<e;t+=1)this._directives[t].willRestate()},o.prototype.didRestate=function(){this._modelScope.materializeScope();for(var t=0,e=this._directives.length;t<e;t+=1)this._directives[t].didRestate();this.remodel()},o.prototype.requestRestate=function(){0==(this._flags&o.REQUEST_RESTATE)&&(this._flags|=o.REQUEST_RESTATE,this._parentModel&&this._parentModel.requestRestate())},o.prototype.requireRestate=function(t){if(void 0===t&&(t=this),0==(this._flags&o.REQUIRE_RESTATE)&&(this._flags|=o.REQUIRE_RESTATE,this.requestRestate(),t===this||0==(this._flags&o.SEALED)))for(var e=this._childModels,i=0,r=e.length;i<r;i+=1)e[i].requireRestate(t)},o.prototype.cascadeWillRestate=function(){if(0!=(this._flags&o.REQUEST_RESTATE)){0!=(this._flags&o.REQUIRE_RESTATE)&&this.willRestate();for(var t=this._childModels,e=0,i=t.length;e<i;e+=1)t[e].cascadeWillRestate()}},o.prototype.cascadeDidRestate=function(){if(0!=(this._flags&o.REQUEST_RESTATE)){this._flags&=~o.REQUEST_RESTATE;for(var t=this._childModels,e=0,i=t.length;e<i;e+=1)t[e].cascadeDidRestate();0!=(this._flags&o.REQUIRE_RESTATE)&&(this._flags&=~o.REQUIRE_RESTATE,this.didRestate())}},o.prototype.setData=function(t){"string"==typeof t?t=F.parseRecon(t):t instanceof F||(t=F.of(t));for(var e=0,i=this._directives.length;e<i;e+=1)this._directives[e].setData(t);this._modelScope._record=t,this.requireRestate()},o.prototype.initDownlink=function(t,e){return void 0===e&&(e=this.stack()),t&&void 0!==t.hostUri||((t=t||{}).hostUri=Ks.evaluate(e).cast(_e.Uri)),t&&void 0!==t.nodeUri||((t=t||{}).nodeUri=Ys.evaluate(e).cast(_e.Uri)),t&&void 0!==t.laneUri||((t=t||{}).laneUri=Xs.evaluate(e).cast(_e.Uri)),t&&void 0!==t.prio||((t=t||{}).prio=Qs.evaluate(e).numberValue()),t&&void 0!==t.rate||((t=t||{}).rate=Zs.evaluate(e).numberValue()),t},o.prototype.stack=function(){return D.of(o.GlobalScope,this._modelScope)},o.Params=[],o.GlobalScope=Rs.GlobalScope,o.REQUEST_RESTATE=1,o.REQUIRE_RESTATE=2,o.SEALED=256,o.AppModel=void 0,o}(),Ns=function(r){function t(t){var e=r.call(this)||this;return e._model=t,e}return v(t,r),Object.defineProperty(t.prototype,"parentScope",{get:function(){return this._model.parentScope},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"downlinkContext",{get:function(){return this._model.downlinkContext},enumerable:!0,configurable:!0}),t.prototype.initDownlink=function(t,e){return this._model.initDownlink(t,e)},t.prototype.materializeMutableScope=function(t,e){var i=new js(this._model);return t.header("mutable").forEach(function(t){t instanceof q&&i._dependents.push(t)},this),i._record=t.tail(),i},t.prototype.materializeValue=function(t,e){if("mutable"===t.tag){var i=this.materializeMutableScope(t,e);if(i instanceof js)return i}return r.prototype.materializeValue.call(this,t,e)},t.prototype.didChange=function(t,e,i){this._model.requireRestate()},t.prototype.stack=function(){return D.of(Gs.GlobalScope,this)},t}(tr),Hs=function(i){function t(t){var e=i.call(this)||this;return e._model=t,e}return v(t,i),Object.defineProperty(t.prototype,"parentScope",{get:function(){return null},enumerable:!0,configurable:!0}),t.prototype.didChange=function(t,e,i){this._model.requireRestate()},t.prototype.stack=function(){return D.of(Gs.GlobalScope,this)},t}(ni),js=function(i){function t(t){var e=i.call(this)||this;return e._model=t,e._dependents=F.empty(),e}return v(t,i),Object.defineProperty(t.prototype,"parentScope",{get:function(){return null},enumerable:!0,configurable:!0}),t.prototype.didChange=function(t,e,i){this._model.requireRestate()},t.prototype.stack=function(){return D.of(Gs.GlobalScope,this)},t}(ni),Ks=q.get("host"),Ys=q.get("node"),Xs=q.get("lane"),Qs=q.get("prio"),Zs=q.get("rate"),Js=function(){function t(){this._model=null}return Object.defineProperty(t.prototype,"model",{get:function(){return this._model},enumerable:!0,configurable:!0}),t.prototype.setModel=function(t){var e=this._model;if(t){if(e)throw new Error;this._model=t,this.didSetModel(t)}else e&&(this._model=null,this.didSetModel(null))},t.prototype.didSetModel=function(t){},t.prototype.didInsertChildModel=function(t){},t.prototype.didRemoveChildModel=function(t){},t.prototype.willRestate=function(){},t.prototype.didRestate=function(){},t.prototype.willRemodel=function(t,e){},t.prototype.didRemodel=function(t,e){},t.prototype.setData=function(t){},t.prototype.setStyle=function(t){},t.prototype.stack=function(){return this._model?this._model.stack():D.of(Gs.GlobalScope)},t.prototype.injectStack=function(t){},t}(),$s=function(e){function t(){var t=e.call(this)||this;return t._bindings=F.empty(),t._attrs=F.Empty,t}return v(t,e),t.prototype.reattr=function(t,i){var r=F.empty(this._bindings.length);this._bindings.forEach(function(t){if(t instanceof R&&t.key instanceof O){var e=t.value.evaluate(i).toValue();e.isDefined()&&r.slot(t.key,e)}},this),this._attrs.equals(r)||(this._attrs=r,t.slot("attrs",r))},t.prototype.willRemodel=function(t,e){this.reattr(t,e)},t}(Js),ta=function(){function e(){}return e.addGlobal=function(t){e.Global=e.Global.withDirectiveForm(t)},e.removeGlobal=function(t){e.Global=e.Global.withoutDirectiveForm(t)},e.Global=void 0,e}(),ea=function(i){function n(t){var e=i.call(this)||this;return e._directiveForms=t,e}return v(n,i),Object.defineProperty(n.prototype,"tag",{get:function(){},enumerable:!0,configurable:!0}),n.prototype.directiveForms=function(){return this._directiveForms.slice(0)},n.prototype.withDirectiveForm=function(t){if(this._directiveForms.indexOf(t)<0){var e=this._directiveForms.slice(0);return e.push(t),new n(e)}return this},n.prototype.withDirectiveForms=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=this._directiveForms.slice(0),r=0;r<t.length;r+=1){var o=t[r];i.indexOf(o)<0&&i.push(o)}return this._directiveForms.length!==i.length?new n(i):this},n.prototype.withoutDirectiveForm=function(t){var e=this._directiveForms.indexOf(t);if(0<=e){var i=this._directiveForms.slice(0);return i.splice(e,1),new n(i)}return this},n.prototype.cast=function(t){"string"==typeof t&&(t=w.parseRecon(t));for(var e=0;e<this._directiveForms.length;e+=1){var i=this._directiveForms[e].cast(t);if(void 0!==i)return i}},n}(ta);ta.Global=new ea([]);var ia=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"tag",{get:function(){return"attrs"},enumerable:!0,configurable:!0}),e.prototype.cast=function(t){if(t.tag===this.tag){var e=new $s;return t.forEach(function(t){this.materializeDirectiveParam(e,t)},this),e}},e.prototype.materializeDirectiveParam=function(t,e){e instanceof P&&e.key.value===this.tag||e instanceof M&&t._bindings.push(e)},e.Form=new e,e}(ta);ta.addGlobal(ia.Form);var ra=function(e){function t(){var t=e.call(this)||this;return t._bindings=F.Empty,t._template=F.empty(),t._keySelector=q.Identity,t._childDirectives=new si,t._index=0,t}return v(t,e),Object.defineProperty(t.prototype,"bindings",{get:function(){return this._bindings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"template",{get:function(){return this._template},enumerable:!0,configurable:!0}),t.prototype.createChildDirectives=function(t,r,e){var o=this,n=[];return e.push(r),this._template.forEach(function(t){var e=C.generateId(),i=new oa(e,o._index);o._index++,r.forEach(function(t){t instanceof M&&i._scope.set(t.key,t.value)},o),o._model.appendChildView(e,t.toValue().clone()),n.push(i)},this),e.pop(),n},t.prototype.updateChildDirectives=function(t,i,r,e){for(var o=function(t){var e=r[t];i.forEach(function(t){t instanceof M&&e._scope.set(t.key,t.value)},n),e.updateData()},n=this,s=0;s<r.length;s+=1)o(s)},t.prototype.deleteChildDirectives=function(t,e){for(var i=0;i<e.length;i+=1){var r=e[i];this._model.removeChildView(r._id)}},t.prototype.instantiate=function(e,i,r,o){if(r<this._bindings.length){var t=this._bindings.getItem(r),n=t.key.isDefined()?t.key:W.valueOf(r);o.push(i);var s=t.toValue().evaluate(o);o.pop(),s.forEach(function(t){this.instantiate(e,i.branch().slot(n,t.toValue()),r+1,o)},this)}else{var a=this._keySelector.evaluate(i).toValue(),u=this._childDirectives.get(a);u?this.updateChildDirectives(a,i,u,o):(u=this.createChildDirectives(a,i,o)).length&&this._childDirectives.set(a,u),u.length&&e.set(a,u)}},t.prototype.reinstantiate=function(){var i=new si;this.instantiate(i,F.empty(),0,this.stack()),i.size<this._childDirectives.size&&(this._index=0,this._childDirectives.forEach(function(t,e){i.has(t)?(this._childDirectives.get(t)[0].updateIndex(this._index),this._index++):(this._childDirectives.delete(t),this.deleteChildDirectives(t,e))},this))},t.prototype.willRestate=function(){this.reinstantiate()},t.prototype.didInsertChildModel=function(o){this._childDirectives.forEach(function(t,e){for(var i=0;i<e.length;i+=1){var r=e[i];r._id===o._id&&(o.addDirective(r),r.initData())}})},t}(Js),oa=function(r){function t(t,e){var i=r.call(this)||this;return i._id=t,i._index=e,i._scope=F.empty(),i}return v(t,r),t.prototype.initData=function(){this._model&&(this._model._modelScope._record=this._scope.concat(this._model._modelScope._record),this._model._modelScope._record.set("index",this._index),this._model.requireRestate())},t.prototype.updateIndex=function(t){this._model&&(this._index=t,this._model._modelScope._record.set("index",this._index))},t.prototype.updateData=function(){if(this._model){var r=this._model._modelScope._record,o=!1;this._scope.forEach(function(t){if(t instanceof M){var e=r.get(t.key),i=t.value;e.equals(i)||(r.set(t.key,t.value),o=!0)}},this),o&&this._model.requireRestate()}},t}(Js),na=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"tag",{get:function(){return"each"},enumerable:!0,configurable:!0}),e.prototype.cast=function(t){if(t.tag===this.tag){var e=new ra;return t.forEach(function(t){this.materializeDirectiveParam(e,t)},this),e}},e.prototype.materializeDirectiveParam=function(t,e){if(e instanceof P&&e.key.value===this.tag)e.value instanceof F&&(t._bindings=e.value.commit());else if(e.key instanceof O){"key"===e.key.value&&(t._keySelector=e.toValue())}else e instanceof w&&t._template.push(e)},e.Form=new e,e}(ta);ta.addGlobal(na.Form);var sa=function(e){function t(){var t=e.call(this)||this;return t._type=null,t._expr=null,t._bindings=F.empty(),t._events=F.Empty,t}return v(t,e),t.prototype.setEvent=function(t,e){this._type=t,this._expr=e},t.prototype.updateEvent=function(t,o){var n=F.empty(this._bindings.length);this._bindings.forEach(function(t){if(t instanceof R){var e=t.toValue(),i=e.args.evaluate(o).toValue();if(i.isDefined()){var r=new Wt(e.func,i);n.slot(t.key.toString(),r)}}},this),this._events.equals(n)||(this._events=n,t.slot("events",n))},t.prototype.willRemodel=function(t,e){this.updateEvent(t,e)},t}(Js),aa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"tag",{get:function(){return"events"},enumerable:!0,configurable:!0}),e.prototype.cast=function(t){if(t.tag===this.tag){var e=new sa;return t.forEach(function(t){this.materializeDirectiveParam(e,t)},this),e}},e.prototype.materializeDirectiveParam=function(t,e){e instanceof Attr&&e.key.toString()===this.tag||e instanceof M&&t._bindings.push(e)},e.Form=new e,e}(ta);ta.addGlobal(aa.Form);var ua=function(e){function t(){var t=e.call(this)||this;return t._selector=q.literal(w.Absent),t._bindings=F.empty(),t}return v(t,e),Object.defineProperty(t.prototype,"selector",{get:function(){return this._selector},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bindings",{get:function(){return this._bindings},enumerable:!0,configurable:!0}),t.prototype.reinject=function(o){void 0===o&&(o=this.stack());var n=this._selector.evaluate(o);n instanceof F&&this._bindings.forEach(function(t){var e=t.key.evaluate(o).toValue();if(e.isDefined()){var i=n.get(e),r=t.toValue().evaluate(o).toValue();r.isDefined()?i.equals(r)||n.set(e,r):i.isDefined()&&n.delete(e)}},this)},t.prototype.willRestate=function(){this.reinject()},t}(Js),ha=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"tag",{get:function(){return"inject"},enumerable:!0,configurable:!0}),e.prototype.cast=function(t){if(t.tag===this.tag){var e=new ua;return t.forEach(function(t){this.materializeDirectiveParam(e,t)},this),e}},e.prototype.materializeDirectiveParam=function(t,e){e instanceof P&&e.key.value===this.tag&&e.value instanceof q?t._selector=e.value:e instanceof M&&t._bindings.push(e)},e.Form=new e,e}(ta);ta.addGlobal(ha.Form);var la=function(r){function t(t,e){var i=r.call(this)||this;return i._key=t,i._rhs=e,i._value=w.Absent,i}return v(t,r),t.prototype.reevaluate=function(t){void 0===t&&(t=this.stack());var e=this._value,i=this._rhs.evaluate(t).toValue();i.isDefined()?e.equals(i)||(this._value=i.commit(),this._model._modelScope._record.set(this._key,i),this._model.requireRestate()):e.isDefined()&&(this._value=i.commit(),this._model._modelScope._record.delete(this._key),this._model.requireRestate())},t.prototype.willRestate=function(){this.reevaluate()},t}(Js),pa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"tag",{get:function(){},enumerable:!0,configurable:!0}),e.prototype.cast=function(t){if(t instanceof M){var e=t.key,i=t.value.header("let");if(i.isDefined())return new la(e,i)}},e.Form=new e,e}(ta);ta.addGlobal(pa.Form);var ca=function(e){function t(){var t=e.call(this)||this;return t._bindings=F.empty(),t._style=F.Empty,t}return v(t,e),t.prototype.restyle=function(t,i){var r=F.empty(this._bindings.length);this._bindings.forEach(function(t){if(t instanceof R&&t.key instanceof O){var e=t.value.evaluate(i).toValue();e.isDefined()&&r.slot(t.key,e)}},this),this._style.equals(r)||(this._style=r,t.slot("style",r))},t.prototype.willRemodel=function(t,e){this.restyle(t,e)},t}(Js),da=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"tag",{get:function(){return"style"},enumerable:!0,configurable:!0}),e.prototype.cast=function(t){if(t.tag===this.tag){var e=new ca;return t.forEach(function(t){this.materializeDirectiveParam(e,t)},this),e}},e.prototype.materializeDirectiveParam=function(t,e){e instanceof P&&e.key.value===this.tag||e instanceof M&&t._bindings.push(e)},e.Form=new e,e}(ta);ta.addGlobal(da.Form);var fa=function(i){function t(t){var e=i.call(this)||this;return e._timeout=t,e._deadline=0,e._timer=0,e.onTick=e.onTick.bind(e),e}return v(t,i),t.prototype.reschedule=function(t){var e=this._timeout.evaluate(t).numberValue();if(e){var i=Date.now()+e;16<Math.abs(this._deadline-i)&&(this._timer&&clearTimeout(this._timer),this._deadline=i,this._timer=setTimeout(this.onTick,e))}else this._timer&&(clearTimeout(this._timer),this._deadline=0,this._timer=0)},t.prototype.onTick=function(){this._deadline=0,this._timer=0,this._model.requireRestate(),this.reschedule(this.stack())},t.prototype.didRemodel=function(t,e){i.prototype.didRemodel.call(this,t,e),this.reschedule(e)},t}(Js),ya=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"tag",{get:function(){return"tick"},enumerable:!0,configurable:!0}),e.prototype.cast=function(t){var e=t.header(this.tag);if(e.isDefined())return new fa(e)},e.Form=new e,e}(ta);ta.addGlobal(ya.Form);var ma=function(){function e(){}return Object.defineProperty(e.prototype,"model",{get:function(){return this._model},enumerable:!0,configurable:!0}),e.prototype.materializeView=function(e,t,i,r){var o=F.empty();return t.forEach(function(t){(t=this.materializeViewParam(e,t,i,r))instanceof b&&t.isDefined()&&o.push(t)},this),e._dataForm=this,o},e.prototype.materializeViewParam=function(t,e,i,r){return e},e.prototype.materializeModel=function(e,t,i,r){this._model=e;var o=F.empty();return t.forEach(function(t){(t=this.materializeModelParam(e,t,i,r))instanceof b&&t.isDefined()&&o.push(t)},this),o},e.prototype.materializeModelParam=function(t,e,i,r){if(e instanceof M&&e.key instanceof O&&"sealed"===e.key.value){var o=e.toValue().booleanValue();if(void 0!==o)return t.isSealed(o),e}var n=ta.Global.cast(e);return n?(t.addDirective(n),b.Absent):e},e.addGlobal=function(t){e.Global=e.Global.withUiForm(t)},e.removeGlobal=function(t){e.Global=e.Global.withoutUiForm(t)},e.Global=void 0,e}(),va=function(i){function n(t){var e=i.call(this)||this;return e._uiForms=t,e._uiFormsMap={},e.updateUIFormsMap(),e}return v(n,i),n.prototype.updateUIFormsMap=function(){for(var t=0,e=this._uiForms;t<e.length;t++){var i=e[t];i.tag&&(this._uiFormsMap[i.tag]=i)}},Object.defineProperty(n.prototype,"tag",{get:function(){},enumerable:!0,configurable:!0}),n.prototype.uiForms=function(){return this._uiForms.slice(0)},n.prototype.withUiForm=function(t){if(this._uiForms.indexOf(t)<0){var e=this._uiForms.slice(0);return e.push(t),this.updateUIFormsMap(),new n(e)}return this},n.prototype.withUiForms=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=this._uiForms.slice(0),r=0;r<t.length;r+=1){var o=t[r];i.indexOf(o)<0&&i.push(o)}return this.updateUIFormsMap(),this._uiForms.length!==i.length?new n(i):this},n.prototype.withoutUiForm=function(t){var e=this._uiForms.indexOf(t);if(0<=e){var i=this._uiForms.slice(0);return i.splice(e,1),this.updateUIFormsMap(),new n(i)}return this},n.prototype.castModel=function(t,e,i){if(void 0===i&&(i=this),"string"==typeof t&&(t=w.parseRecon(t)),t.tag){var r=this._uiFormsMap[t.tag];if(r)return r.castModel(t,e,i)}},n.prototype.castView=function(t,e,i){if(void 0===i&&(i=this),"string"==typeof t&&(t=w.parseRecon(t)),t.tag){var r=this._uiFormsMap[t.tag];if(r)return r.castView(t,e,i)}},n.prototype.materializeScripts=function(t){if(t||(t=D.of(b.GlobalScope,ga.GlobalScope)),"undefined"!=typeof document)for(var e=document.querySelectorAll('script[type="text/recon"]'),i=0;i<e.length;i+=1){var r=e[i];r instanceof HTMLElement&&this.materializeScript(r,t)}},n.prototype.materializeScript=function(t,e){var i=t.innerText,r=this.castView(i,e);r instanceof _a&&t.parentNode&&(t.parentNode.replaceChild(r.node,t),r.attachApp())},n}(ma);ma.Global=new va([]);var ga=function(){function r(t){void 0===t&&(t=C.generateId()),this._id=t,this._parentView=null,this._childViews=[],this._appView=null,this._model=w.Absent,this._state=w.Absent,this._flags=0}return r.prototype.propertyKey=function(t,e,i,r){var o=t.animator(this,e);return void 0===i?o?o.get():t.get(this,e):(null===i?t.set(this,null):(r=jn.fromAny(r,i),o||void 0===r||(r.f||(r=r.range(i)),o=t.animator(this,e,i,r)),o?o.set(i,r):t.set(this,e,i)),this)},r.prototype.propertyKeyNumber=function(t,e,i,r){null!=i&&(i=+i);var o=this.propertyKey(t,e,i,r);return"string"==typeof o&&(o=+o),o},r.prototype.propertyKeyColor=function(t,e,i,r){null!=i&&(i=qo.fromAny(i));var o=this.propertyKey(t,e,i,r);return"string"==typeof o&&(o=qo.fromAny(o)),o},r.prototype.property=function(t,e,i){var r=t.animator(this);return void 0===e?r?r.get():t.get(this):(null===e?t.set(this,null):(i=jn.fromAny(i,e),r||void 0===i||(i.f||(i=i.range(e)),r=t.animator(this,e,i)),r?r.set(e,i):t.set(this,e)),this)},r.prototype.propertyNumber=function(t,e,i){null!=e&&(e=+e);var r=this.property(t,e,i);return"string"==typeof r&&(r=+r),r},r.prototype.propertyColor=function(t,e,i){null!=e&&(e=qo.fromAny(e));var r=this.property(t,e,i);return"string"==typeof r&&(r=qo.fromAny(r)),r},Object.defineProperty(r.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"parentView",{get:function(){return this._parentView},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"childViews",{get:function(){return this._childViews},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"appView",{get:function(){var t=this._appView;if(null===t)for(var e=this;e;){if(e instanceof r.AppView){this._appView=t=e;break}e=e.parentView}return t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"model",{get:function(){return this._model},enumerable:!0,configurable:!0}),r.prototype.getModel=function(){return this._model},r.prototype.setModel=function(t){if(t=w.fromAny(t),!this._model.equals(t)){this._model=t.commit(),this.didSetModel(t);var e=this.appView;e&&e.setModel(t,this)}},r.prototype.didSetModel=function(t){this._controller&&this._controller.didSetModel(t,this)},Object.defineProperty(r.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),r.prototype.setState=function(t){t=w.fromAny(t);var e=this._state;e.equals(t)||(this._state=t.commit(),this.didSetState(t,e))},r.prototype.didSetState=function(t,e){this._controller&&this._controller.didSetState(t,e,this),t.forEach(function(t){t instanceof R&&t.key instanceof O&&this.didSetStateParam(t.key.value,t.value)},this)},r.prototype.didSetStateParam=function(t,e){},r.prototype.setParentView=function(t){var e=this._parentView;if(t){if(e)return;this._parentView=t,(i=this.appView)&&i.addDescendantViews(this,t),this.requireResize(),this.didSetParentView(t)}else if(e){var i;e.requireResize(),(i=e.appView)&&i.removeDescendantViews(this,e),this._flags=0,this._appView=null,this._parentView=null,this.didSetParentView(t)}},r.prototype.didSetParentView=function(t){this._controller&&this._controller.didSetParentView(t,this)},r.prototype.setAppView=function(t){this._appView=t,this.didSetAppView(t)},r.prototype.didSetAppView=function(t){},r.prototype.appendChildView=function(t){if(!t)throw new TypeError(""+t);this._childViews.push(t),t.setParentView(this),this.didInsertChildView(t)},r.prototype.prependChildView=function(t){if(!t)throw new TypeError(""+t);if(0<=this._childViews.indexOf(t))throw new Error("duplicate child");if(t._parentView)throw new Error("duplicate parent");this._childViews.unshift(t),t.setParentView(this),this.didInsertChildView(t)},r.prototype.insertChildView=function(t,e){if(!t)throw new TypeError(""+t);if(0<=this._childViews.indexOf(t))throw new Error("duplicate child");if(t._parentView)throw new Error("duplicate parent");var i=e?this._childViews.indexOf(e):-1;i<0&&(i=this._childViews.length),this._childViews.splice(i,0,t),t.setParentView(this),this.didInsertChildView(t)},r.prototype.removeChildView=function(t){if(!t)throw new TypeError(""+t);var e=this._childViews.indexOf(t);0<=e&&(t.setParentView(null),this._childViews.splice(e,1),this.didRemoveChildView(t))},r.prototype.removeAllChildViews=function(){for(;this._childViews.length;){var t=this._childViews[0];t.setParentView(null),this._childViews.splice(0,1),this.didRemoveChildView(t)}},r.prototype.didInsertChildView=function(t){0!=(t._flags&r.REQUEST_RESIZE)&&(this.requestResize(),this._flags|=r.REQUEST_RESIZE),this._controller&&this._controller.didInsertChildView(t,this)},r.prototype.didRemoveChildView=function(t){this._controller&&this._controller.didRemoveChildView(t,this)},r.prototype.controller=function(t){return void 0===t?this._controller||null:(this._controller!==t&&(this._controller&&(this._controller.view=null),this._controller=t||void 0,this._controller&&(this._controller.view=this)),this)},r.prototype.isViewable=function(){return!0},r.prototype.willResize=function(){this._controller&&this._controller.willResize(this)},r.prototype.didResize=function(){this._controller&&this._controller.didResize(this)},r.prototype.willReview=function(t){this._controller&&this._controller.willReview(t,this)},r.prototype.didReview=function(t){this._controller&&this._controller.didReview(t,this)},r.prototype.willRedraw=function(){this._controller&&this._controller.willRedraw(this)},r.prototype.didRedraw=function(){this._controller&&this._controller.didRedraw(this)},r.prototype.requestResize=function(){0==(this._flags&r.REQUEST_RESIZE)&&(this._flags|=r.REQUEST_RESIZE,this._parentView&&this._parentView.requestResize())},r.prototype.requireResize=function(){if(0==(this._flags&r.REQUIRE_RESIZE)){this._flags|=r.REQUIRE_RESIZE,this.requestResize();for(var t=this._childViews,e=0,i=t.length;e<i;e+=1)t[e].requireResize()}},r.prototype.cascadeWillResize=function(){if(0!=(this._flags&r.REQUEST_RESIZE)){0!=(this._flags&r.REQUIRE_RESIZE)&&this.willResize();for(var t=this._childViews,e=0,i=t.length;e<i;e+=1)t[e].cascadeWillResize()}},r.prototype.cascadeDidResize=function(){if(0!=(this._flags&r.REQUEST_RESIZE)){for(var t=this._childViews,e=0,i=t.length;e<i;e+=1)t[e].cascadeDidResize();this._flags&=~r.REQUEST_RESIZE,0!=(this._flags&r.REQUIRE_RESIZE)&&(this._flags&=~r.REQUIRE_RESIZE,this.didResize())}},r.prototype.requestReview=function(){0==(this._flags&r.REQUEST_REVIEW)&&(this._flags|=r.REQUEST_REVIEW,this._parentView&&this._parentView.requestReview())},r.prototype.requireReview=function(){if(0==(this._flags&r.REQUIRE_REVIEW)){this._flags|=r.REQUIRE_REVIEW,this.requestReview();for(var t=this._childViews,e=0,i=t.length;e<i;e+=1)t[e].requireReview()}},r.prototype.cascadeWillReview=function(){if(0!=(this._flags&r.REQUEST_REVIEW)){0!=(this._flags&r.REQUIRE_REVIEW)&&(0==(this._flags&r.VIEWABLE)?this.isViewable()&&this.willReview(!0):0!=(this._flags&r.VIEWABLE)&&(this.isViewable()||this.willReview(!1)));for(var t=this._childViews,e=0,i=t.length;e<i;e+=1)t[e].cascadeWillReview()}},r.prototype.cascadeDidReview=function(){if(0!=(this._flags&r.REQUEST_REVIEW)){this._flags&=~r.REQUEST_REVIEW;for(var t=this._childViews,e=0,i=t.length;e<i;e+=1)t[e].cascadeDidReview();0!=(this._flags&r.REQUIRE_REVIEW)&&(this._flags&=~r.REQUIRE_REVIEW,0==(this._flags&r.VIEWABLE)?this.isViewable()&&(this._flags|=r.VIEWABLE,this.didReview(!0)):0!=(this._flags&r.VIEWABLE)&&(this.isViewable()||(this._flags&=~r.VIEWABLE,this.didReview(!1))))}},r.prototype.requestRedraw=function(){0==(this._flags&r.REQUEST_REDRAW)&&(this._flags|=r.REQUEST_REDRAW,this._parentView&&this._parentView.requestRedraw())},r.prototype.requireRedraw=function(){if(0==(this._flags&r.REQUIRE_REDRAW)){this._flags|=r.REQUIRE_REDRAW,this.requestRedraw();for(var t=this._childViews,e=0,i=t.length;e<i;e+=1)t[e].requireRedraw()}},r.prototype.cascadeWillRedraw=function(){if(0!=(this._flags&r.REQUEST_REDRAW)){0!=(this._flags&r.REQUIRE_REDRAW)&&this.willRedraw();for(var t=this._childViews,e=0,i=t.length;e<i;e+=1)t[e].cascadeWillRedraw()}},r.prototype.cascadeDidRedraw=function(){if(0!=(this._flags&r.REQUEST_REDRAW)){this._flags&=~r.REQUEST_REDRAW;for(var t=this._childViews,e=0,i=t.length;e<i;e+=1)t[e].cascadeDidRedraw();0!=(this._flags&r.REQUIRE_REDRAW)&&(this._flags&=~r.REQUIRE_REDRAW,this.didRedraw())}},r.prototype.stack=function(){return D.of(r.GlobalScope,this._model,this._state)},r.initTheme=function(){var t=F.empty();t.slot("textColor","#555c78"),t.slot("subtextColor","#555c78"),t.slot("primaryColor","#9b9eb1");var e=q.get("primaryColor"),i=q.get("darker").invoke(F.of(e,.2)),r=q.get("brighter").invoke(F.of(e,.2)),o=q.get("interpolate").invoke(F.of(i,r));return t.slot("primaryHue",o),t},r.GlobalScope=Rs.GlobalScope,r.Theme=r.initTheme(),r.REQUEST_RESIZE=1,r.REQUIRE_RESIZE=2,r.REQUEST_REVIEW=4,r.REQUIRE_REVIEW=8,r.REQUEST_REDRAW=16,r.REQUIRE_REDRAW=32,r.VIEWABLE=64,r.NodeView=void 0,r.ElemView=void 0,r.TextView=void 0,r.HtmlView=void 0,r.SvgView=void 0,r.AppView=void 0,r}(),ba=function(){function t(){this._view=null}return Object.defineProperty(t.prototype,"view",{get:function(){return this._view},set:function(t){this._view!==t&&(this._view=t,this._view&&this.didSetView(this._view))},enumerable:!0,configurable:!0}),t.prototype.didSetView=function(t){},t.prototype.didSetParentView=function(t,e){},t.prototype.didInsertChildView=function(t,e){},t.prototype.didRemoveChildView=function(t,e){},t.prototype.viewScope=function(){return F.empty()},t.prototype.stack=function(){var t=new D;return t.push(ga.GlobalScope),t.push(this.viewScope()),t},t.prototype.didSetModel=function(t,e){},t.prototype.didSetStyle=function(t,e,i){},t.prototype.didSetState=function(t,e,i){},t.prototype.willResize=function(t){},t.prototype.didResize=function(t){},t.prototype.willReview=function(t,e){},t.prototype.didReview=function(t,e){},t.prototype.willRedraw=function(t){},t.prototype.didRedraw=function(t){},t}(),wa=function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return v(t,o),Object.defineProperty(t.prototype,"tag",{get:function(){return"view"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=new ga,o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new Gs,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){return o.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:o.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(ma);ma.addGlobal(wa.Form);var _a=function(r){function i(t,e){var i=r.call(this,e)||this;return i.node=t,i.node.view=i}return v(i,r),i.prototype.text=function(t){return void 0===t?this.node.textContent||"":(this.node.textContent=t,this)},i.prototype.attachApp=function(){for(var t,e=this.node;t=e.parentNode;){if(t.view instanceof ga.AppView){t.view.appendChildView(e.view);break}if(t instanceof HTMLBodyElement){ga.AppView.create(t).appendChildView(e.view);break}if(t instanceof HTMLHeadElement||t instanceof HTMLHtmlElement)break;i.create(t).appendChildView(e.view),e=t}},i.create=function(t){return t instanceof i?t:"string"==typeof t?new ga.ElemView(document.createElement(t)):t.view?t.view:t instanceof HTMLElement?new ga.HtmlView(t):t instanceof SVGElement?new ga.SvgView(t):t instanceof Element?new ga.ElemView(t):t instanceof Text?new ga.TextView(t):new i(t)},i}(ga);ga.NodeView=_a;var xa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e}(Gs),ka=function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return v(t,o),t.prototype.materializeViewParam=function(t,e,i,r){return o.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return o.prototype.materializeModelParam.call(this,t,e,i,r)},t}(ma),Aa=function(r){function e(t,e){var i=r.call(this,t,e)||this;return i.attributeAnimators={},i.styleAnimators={},i._eventsPopover={},i._eventNode=null,i}return v(e,r),e.prototype.isViewable=function(){var t=this.node.getBoundingClientRect(),e=document.documentElement.clientWidth,i=document.documentElement.clientHeight;return(t.top<=0&&0<t.bottom||0<=t.top&&t.top<i)&&(t.left<=0&&0<t.right||0<=t.left&&t.left<e)},e.prototype.getAttribute=function(t){var e=this.node.attributes;if(void 0===t){for(var i={},r=0;r<e.length;r++)i[e[r].nodeName]=e[r].nodeValue;return i}for(r=0;r<e.length;r++)if(e[r].nodeName===t)return e[r].nodeValue},e.prototype.setAttribute=function(t,e){if("string"==typeof t)this.node.setAttribute(t,e||"");else if("object"==typeof t)for(var i in t)this.node.setAttribute(i,t[i]);return this},e.prototype.setProperty=function(t,e){if("string"==typeof t)this.node.style.setProperty(t,e||"");else if("object"==typeof t)for(var i in t)this.node.style.setProperty(i,t[i]);return this},e.prototype.attribute=function(t,e,i,r){var o=this.attributeAnimators[t];if(void 0===e)return o?o.get():this.node.getAttribute(t);if(null===e)return o&&(o.cancel(),this.attributeAnimators[t]=void 0),this.node.removeAttribute(t),this;if(i=jn.fromAny(i,e),o||void 0===i||(i.f||(i=i.range(e)),o=new ds(this.node,t,e,i,r),this.attributeAnimators[t]=o),o)o.set(e,i);else{var n=this.node.getAttribute(t),s=ns(e);n!==s&&(this.node.setAttribute(t,s),void 0!==r&&0!=(r&as.REQUIRES_RESIZE)&&this.requireResize())}return this},e.prototype.style=function(t,e,i,r){var o=this.styleAnimators[t];if(void 0===e)return o?o.get():this.node.style.getPropertyValue(t);if(null===e)return o&&(o.cancel(),this.styleAnimators[t]=void 0),this.node.style.removeProperty(t),this;if(i=jn.fromAny(i,e),o||void 0===i||(i.f||(i=i.range(e)),o=new fs(this.node,t,e,i,void 0,r),this.styleAnimators[t]=o),o)o.set(e,i);else{var n=this.node.style.getPropertyValue(t),s=ss(e);n!==s&&(this.node.style.setProperty(t,s),void 0!==r&&0!=(r&as.REQUIRES_RESIZE)&&this.requireResize())}return this},e.prototype.attributeEnum=function(t,e,i,r){return this.attribute(t,e,i,r)},e.prototype.attributeNumber=function(t,e,i,r){null!=e&&(e=+e);var o=this.attribute(t,e,i,r);return"string"==typeof o&&(o=+o),o},e.prototype.attributeLength=function(t,e,i,r){null!=e&&(e=Lo.fromAny(e,this.node));var o=this.attribute(t,e,i,r);return"string"==typeof o&&(o=Lo.fromAny(o,this.node)),o},e.prototype.attributeLengthEnum=function(t,e,i,r){if(null!=e)try{e=Lo.fromAny(e,this.node)}catch(t){}var o=this.attribute(t,e,i,r);if("string"==typeof o)try{o=Lo.fromAny(o,this.node)}catch(t){}return o},e.prototype.attributeColor=function(t,e,i,r){null!=e&&(e=qo.fromAny(e));var o=this.attribute(t,e,i,r);return"string"==typeof o&&(o=qo.fromAny(o)),o},e.prototype.attributeTransform=function(t,e,i,r){null!=e&&(e=$o.fromAny(e));var o=this.attribute(t,e,i,r);return"string"==typeof o&&(o=$o.fromAny(o)),o},e.prototype.attributeBoolean=function(t,e,i,r){null!=e&&(e=!!e||null);var o=this.attribute(t,e,i,r);return"string"==typeof o&&(o=!!o),o},e.prototype.attributeValue=function(t,e,i,r){var o;null!=e&&void 0===(o=ws.Form.cast(e))&&(o=e.stringValue());var n=this.attribute(t,o,i,r);return"string"==typeof n&&(n=ws.parse(n)),n!==this&&(n=ws.Form.mold(n)),n},e.prototype.styleEnum=function(t,e,i,r){return this.style(t,e,i,r)},e.prototype.styleNumber=function(t,e,i,r){null!=e&&(e=+e);var o=this.style(t,e,i,r);return"string"==typeof o&&(o=+o),o},e.prototype.styleNumberEnum=function(t,e,i,r){var o=this.style(t,e,i,r);return"string"==typeof o&&isFinite(+o)&&(o=+o),o},e.prototype.styleLength=function(t,e,i,r){null!=e&&(e=Lo.fromAny(e,this.node));var o=this.style(t,e,i,r);return"string"==typeof o&&(o=Lo.fromAny(o,this.node)),o},e.prototype.styleLengthEnum=function(t,e,i,r){if(null!=e)try{e=Lo.fromAny(e,this.node)}catch(t){}var o=this.style(t,e,i,r);if("string"==typeof o)try{o=Lo.fromAny(o,this.node)}catch(t){}return o},e.prototype.styleColor=function(t,e,i,r){null!=e&&(e=qo.fromAny(e));var o=this.style(t,e,i,r);return"string"==typeof o&&(o=qo.fromAny(o)),o},e.prototype.styleColorEnum=function(t,e,i,r){if(null!=e)try{e=qo.fromAny(e)}catch(t){}var o=this.style(t,e,i,r);if("string"==typeof o)try{o=qo.fromAny(o)}catch(t){}return o},e.prototype.styleTransform=function(t,e,i,r){null!=e&&(e=$o.fromAny(e));var o=this.style(t,e,i,r);return"string"==typeof o&&(o=$o.fromAny(o)),o},e.prototype.styleValue=function(t,e,i,r){var o;null!=e&&void 0===(o=ws.Form.cast(e))&&(o=e.stringValue());var n=this.style(t,o,i,r);return"string"==typeof n&&(n=ws.parse(n)),n!==this&&(n=ws.Form.mold(n)),n},e.prototype.propertyEnum=function(t,e,i){return this.property(t,e,i)},e.prototype.propertyNumberEnum=function(t,e,i){var r=this.property(t,e,i);return"string"==typeof r&&isFinite(+r)&&(r=+r),r},e.prototype.propertyAngle=function(t,e,i){null!=e&&(e=Ao.fromAny(e));var r=this.property(t,e,i);return"string"==typeof r&&(r=Ao.fromAny(r)),r},e.prototype.propertyKeyAngle=function(t,e,i,r){null!=i&&(i=Ao.fromAny(i));var o=this.propertyKey(t,e,i,r);return"string"==typeof o&&(o=Ao.fromAny(o)),o},e.prototype.propertyKeyLength=function(t,e,i,r){null!=i&&(i=Lo.fromAny(i,this.node));var o=this.propertyKey(t,e,i,r);return"string"==typeof o&&(o=Lo.fromAny(o,this.node)),o},e.prototype.propertyLength=function(t,e,i){null!=e&&(e=Lo.fromAny(e,this.node));var r=this.property(t,e,i);return"string"==typeof r&&(r=Lo.fromAny(r,this.node)),r},e.prototype.propertyLengthEnum=function(t,e,i){if(null!=e)try{e=Lo.fromAny(e,this.node)}catch(t){}var r=this.property(t,e,i);if("string"==typeof r)try{r=Lo.fromAny(r,this.node)}catch(t){}return r},e.prototype.propertyColorEnum=function(t,e,i){if(null!=e)try{e=qo.fromAny(e)}catch(t){}var r=this.property(t,e,i);if("string"==typeof r)try{r=qo.fromAny(r)}catch(t){}return r},e.prototype.propertyBoolean=function(t,e,i){return this.property(t,e,i)},e.prototype.elemId=function(t,e){return this.attribute("id",t,e)},e.prototype.name=function(t,e){return this.attribute("name",t,e)},e.prototype.className=function(t,e){return this.attribute("class",t,e)},e.prototype.on=function(t,e,i){return this.node.addEventListener(t,e,i),this},e.prototype.off=function(t,e,i){return this.node.removeEventListener(t,e,i),this},e.prototype.createChildView=function(t){return e.create(t)},e.prototype.append=function(t){var e=this.createChildView(t);return this.appendChildView(e),this.node.appendChild(e.node),e},e.prototype.prepend=function(t){var e=this.createChildView(t);return this.prependChildView(e),this.node.insertBefore(e.node,this.node.firstChild),e},e.prototype.insertBefore=function(t,e){var i;e instanceof _a?e=(i=e).node:i=e&&e.view||null;var r=this.createChildView(t);return this.insertChildView(r,i),this.node.insertBefore(r.node,e),r},e.prototype.remove=function(t){if(void 0===t)this._parentView&&this._parentView.removeChildView(this),this.node.parentNode&&this.node.parentNode.removeChild(this.node);else{var e=void 0,i=void 0;t instanceof _a?i=(e=t).node:e=(i=t).view,this.node.removeChild(i),e&&this.removeChildView(e)}return this},e.prototype.removeAll=function(){for(var t;t=this.node.firstChild;)this.node.removeChild(t),t.view&&this.removeChildView(t.view);return this.removeAllChildViews(),this},e.prototype.didInsertChildView=function(t){r.prototype.didInsertChildView.call(this,t),t instanceof _a&&!t.node.parentNode&&this.node.appendChild(t.node)},e.prototype.didRemoveChildView=function(t){t instanceof _a&&t.node.parentNode===this.node&&t.node.parentNode.removeChild(t.node),r.prototype.didRemoveChildView.call(this,t)},e.prototype.didSetStateParam=function(t,e){"attrs"===t?this.didSetAttrs(e):"style"===t?this.didSetStyle(e):"events"===t?this.didSetEvents(e):r.prototype.didSetStateParam.call(this,t,e)},e.prototype.didSetAttrs=function(t){var e=t.get("transition").cast(jn.Form);t.forEach(function(t){t instanceof R&&t.key instanceof O&&("transition"!==t.key.value&&this.didSetAttrsParam(t.key.value,t.value,e))},this)},e.prototype.didSetAttrsParam=function(t,e,i){this.attributeValue(t,e,i)},e.prototype.didSetEvents=function(t){t.forEach(function(t){if(t instanceof R&&t.key instanceof O&&t.value instanceof Wt){var e=t.key.value;this.didSetEventParam(e,t.value)}},this)},e.prototype.didSetEventParam=function(t,e){if(e instanceof Wt){var i=window[e.func._key.toString()];this.node[t]=i.bind(this,e.args.toAny())}},e.prototype.didSetStyle=function(t){var e=t.get("transition").cast(jn.Form);t.forEach(function(t){t instanceof R&&t.key instanceof O&&("transition"!==t.key.value&&this.didSetStyleParam(t.key.value,t.value,e))},this)},e.prototype.didSetStyleParam=function(t,e,i){this.styleValue(t,e,i)},e.prototype.eventsFunc=function(t,e,i){var r=i.get("handler").get("className").toString();if("absent"!==r&&this._dataForm){var o=this._dataForm.model.stack(),n=i.get("params").evaluate(o),s=i.get("handler").get("method").toString(),a=window[r];"absent"!==s?a[s].call(this,t,n.toAny()):a.call(this,t,n.toAny())}},e.prototype.eventsPopover=function(t,e,i){var r=this._eventsPopover[e];if(r&&r.hide(),i&&this.appView&&this._dataForm){for(var o in this._eventsPopover)o!==e&&this._eventsPopover[o].hide();r&&"onmousemove"===e||(this._eventsPopover[e]=Qa.Form.castView(i,this._dataForm.model.stack(),ma.Global));var n=this._eventsPopover[e];n&&(this.eventPopupPivot(t,e,i),n.addObserver(this),this.appendChildView(n),this.appView.showPopover(n,{exclusive:!t.shiftKey}))}},e.prototype.eventPopupPivot=function(t,e,i){var r=this._eventsPopover[e];r&&r.setPivot(this.parentView,t.offsetX,t.offsetY)},e.prototype.eventInvokeExpr=function(t,e,i){if(this._dataForm){var r=this._dataForm.model.stack();window[i.func._key.toString()].call(this,t,i.args.evaluate(r).toValue().toAny())}},e.prototype.eventsDefault=function(t){var e=this;t.onmouseleave=function(t){e._eventsPopover.onmouseenter&&e._eventsPopover.onmouseenter.hide(),e._eventsPopover.onmousemove&&e._eventsPopover.onmousemove.hide()},t.onmouseout=function(t){e._eventsPopover.onmouseover&&e._eventsPopover.onmouseover.hide()},t.onmouseup=function(t){e._eventsPopover.onmousedown&&t.stopPropagation()}},Object.defineProperty(e.prototype,"eventNode",{get:function(){return this._eventNode},set:function(t){this._eventNode=t},enumerable:!0,configurable:!0}),e.prototype.appendEventHandlers=function(t,e){if(e){var i=this._eventNode||this.node;this.eventsDefault(i),this.eventsHandler(i,t,e)}},e.prototype.eventsHandler=function(t,e,i){var r=this;t[e]=function(t){"eventsPopover"===i.tag?(t.stopPropagation(),r.eventsPopover(t,e,i)):i instanceof Wt?r.eventInvokeExpr(t,e,i):r.eventsFunc(t,e,i)}},e}(_a);ga.ElemView=Aa;var Ea=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e}(xa),Ca=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return v(t,n),t.prototype.materializeViewParam=function(t,e,i,r){if(e.key instanceof O&&"id"===e.key.value){var o=e.toValue().stringValue();if(void 0!==o)return t.elemId(o),e}return n.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return n.prototype.materializeModelParam.call(this,t,e,i,r)},t}(ka),Sa=function(i){function e(t,e){return i.call(this,t,e)||this}return v(e,i),e.prototype.viewBox=function(t,e){return this.attribute("viewBox",t,e)},e.prototype.preserveAspectRatio=function(t,e){return this.attributeBoolean("preserveAspectRatio",t,e)},e.prototype.transform=function(t,e){return this.attributeTransform("transform",t,e),this.styleTransform("transform",t,e)},e.prototype.x=function(t,e){return this.attributeNumber("x",t,e)},e.prototype.y=function(t,e){return this.attributeNumber("y",t,e)},e.prototype.x1=function(t,e){return this.attributeNumber("x1",t,e)},e.prototype.y1=function(t,e){return this.attributeNumber("y1",t,e)},e.prototype.x2=function(t,e){return this.attributeNumber("x2",t,e)},e.prototype.y2=function(t,e){return this.attributeNumber("y2",t,e)},e.prototype.cx=function(t,e){return this.attributeNumber("cx",t,e)},e.prototype.cy=function(t,e){return this.attributeNumber("cy",t,e)},e.prototype.dx=function(t,e){return this.attributeNumber("dx",t,e)},e.prototype.dy=function(t,e){return this.attributeNumber("dy",t,e)},e.prototype.r=function(t,e){return this.attributeNumber("r",t,e)},e.prototype.d=function(t,e){return this.attribute("d",t,e)},e.prototype.points=function(t,e){return this.attribute("points",t,e)},e.prototype.clipPath=function(t,e){return this.attribute("clip-path",t,e)},e.prototype.in=function(t,e){return this.attribute("in",t,e)},e.prototype.in2=function(t,e){return this.attribute("in2",t,e)},e.prototype.mode=function(t,e){return this.attribute("mode",t,e)},e.prototype.edgeMode=function(t,e){return this.attribute("edgeMode",t,e)},e.prototype.stdDeviation=function(t,e){return this.attribute("stdDeviation",t,e)},e.prototype.type=function(t,e){return this.attribute("type",t,e)},e.prototype.values=function(t,e){return this.attribute("values",t,e)},e.prototype.result=function(t,e){return this.attribute("result",t,e)},e.prototype.width=function(t,e){return this.attributeLength("width",t,e)},e.prototype.height=function(t,e){return this.attributeLength("height",t,e)},e.prototype.alignmentBaseline=function(t,e){return this.attributeEnum("alignment-baseline",t,e)},e.prototype.textAnchor=function(t,e){return this.attributeEnum("text-anchor",t,e)},e.prototype.fill=function(t,e){return this.styleColorEnum("fill",t,e)},e.prototype.fillRule=function(t,e){return this.style("fill-rule",t,e)},e.prototype.stroke=function(t,e){return this.styleColorEnum("stroke",t,e)},e.prototype.strokeWidth=function(t,e){return this.styleNumber("stroke-width",t,e)},e.prototype.strokeDashArray=function(t,e){return this.styleNumber("stroke-dasharray",t,e)},e.prototype.cursor=function(t,e){return this.styleEnum("cursor",t,e)},e.prototype.createChildView=function(t){return e.create(t)},e.prototype.append=function(t){return i.prototype.append.call(this,t)},e.prototype.prepend=function(t){return i.prototype.prepend.call(this,t)},e.prototype.insertBefore=function(t,e){return i.prototype.insertBefore.call(this,t,e)},e.create=function(t){return t instanceof _a?t:"string"==typeof t?new ga.SvgView(document.createElementNS(e.NS,t)):t.view?t.view:t instanceof HTMLElement?new ga.HtmlView(t):t instanceof SVGElement?new ga.SvgView(t):t instanceof Element?new ga.ElemView(t):t instanceof Text?new ga.TextView(t):new _a(t)},e.NS="http://www.w3.org/2000/svg",e}(Aa);ga.SvgView=Sa;var Va=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e}(Ea),Da=function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return v(t,o),t.prototype.materializeViewParam=function(t,e,i,r){return o.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return o.prototype.materializeModelParam.call(this,t,e,i,r)},t}(Ca),Ma=function(){function t(){}return t.newGuid=function(){return"xxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},t.openSwimValueLink=function(t){return new Pa("value",t).downlink},t.openSwimMapLink=function(t){return new Pa("map",t).downlink},t.copyConfig=function(t){var e={};for(var i in t)e[i]=t[i];return e},t.parseHost=function(t){var e={},i=null;return-1!==t.indexOf("://")?(i=t.split("://"),e.isSecure="wss"===i[0]):e.isSecure=!1,i=i?i[1].split(":"):t.split(":"),e.hostUrl=i[0],e.hostPort=i[1]?i[1]:"",e},t}(),Pa=function(){function r(t,e,i){void 0===i&&(i=!1),this.type=t,this.config=e,this.shortUrl=null,this._debug=i,this._downlink=null,this.connect()}return r.prototype.connect=function(){switch(this.type){case"value":this._swimService=dr;break;default:this._swimService=cr}var t=this.config.hostPort?":"+this.config.hostPort:"";this.shortUrl=(this.config.isSecure?"wss":"ws")+"://"+this.config.hostUrl+t,this.fullUrlWithPath=""+this.shortUrl+this.config.node+"/"+this.config.lane+"/",void 0!==this.config.keepSynced&&null!==this.config.keepSynced||(this.config.keepSynced=!1),this._downlink=this._swimService().host(this.shortUrl).node(this.config.node).lane(this.config.lane).keepSynced(this.config.keepSynced).didConnect(this.didConnect.bind(this)).didFail(this.didFail.bind(this)).didSync(this.didSync.bind(this)).didLink(this.didLink.bind(this)).didUnlink(this.didUnlink.bind(this)),this.valueType(),this.mapType(),this.open()},Object.defineProperty(r.prototype,"downlink",{get:function(){return null===this._downlink&&this.connect(),this._downlink},enumerable:!0,configurable:!0}),r.prototype.valueType=function(){"value"===this.type&&this._downlink.didSet(this.didSet.bind(this))},r.prototype.didSet=function(t){this._debug&&console.log("[util] "+this.fullUrlWithPath+" didSet",t),this.config.didSet&&this.config.didSet(t)},r.prototype.mapType=function(){"value"!==this.type&&(this._downlink.didSync(this.didSync.bind(this)),this._downlink.didUpdate(this.didUpdate.bind(this)))},r.prototype.didSync=function(){this._debug&&console.log("[util] "+this.fullUrlWithPath+" didSync"),this.config.didSync&&this.config.didSync()},r.prototype.didLink=function(){this._debug&&console.log("[util] "+this.fullUrlWithPath+" didLink"),this.config.didLink&&this.config.didLink()},r.prototype.didUnlink=function(){this._debug&&console.log("[util] "+this.fullUrlWithPath+" didunlink"),this.config.didUnlink&&this.config.didUnlink()},r.prototype.didUpdate=function(t,e){this._debug&&console.log("[util] "+this.fullUrlWithPath+" didUpdate - key: "+t+", Value: ",e),this.config.didUpdate&&this.config.didUpdate(t,e)},r.prototype.update=function(t,e,i){void 0===i&&(i=!1),this.close(),this.type=t,this.config=e,this._debug=i,this.connect()},r.prototype.didConnect=function(t){this._debug&&console.log("[util] "+this.fullUrlWithPath+" opened.")},r.prototype.didFail=function(t){this._debug&&(console.error(this.fullUrlWithPath+" error: "+t),this.config.didFail&&this.config.didFail(t))},r.prototype.open=function(){this._downlink.open()},r.prototype.close=function(){this._downlink.close(),this._downlink.didSync(null),this._downlink.didUpdate(null)},r.create=function(t,e,i){return new r(t,e,i)},r}(),Ra=function(){function t(t){this.swimDataConfig={isSecure:!1,hostUrl:"",hostPort:"",node:"",lane:"",keepSynced:!1},this.parentElem=t,this.layoutDataIsDirty=!1,this.renderedElementCache={},this.swimDataLink=null}return t.prototype.setLayoutDefinition=function(t){return this.layoutDefinition=t,!!this.layoutDefinition&&(this.layoutDefinition.width&&this.setLayoutWidth(this.layoutDefinition.width),this.layoutDefinition.height&&this.setLayoutHeight(this.layoutDefinition.height),this.layoutDefinition.title&&this.setLayoutTitle(this.layoutDefinition.title),this.setLayoutElements(this.layoutDefinition.layoutElements),this.layoutDefinition.hostUrl&&(this.swimDataConfig.hostUrl=this.layoutDefinition.hostUrl),this.layoutDefinition.hostPort&&(this.swimDataConfig.hostPort=this.layoutDefinition.hostPort),this.layoutDefinition.node&&(this.swimDataConfig.node=this.layoutDefinition.node),this.layoutDefinition.lane&&(this.swimDataConfig.lane=this.layoutDefinition.lane),this.layoutDefinition.keepSynced&&(this.swimDataConfig.keepSynced=this.layoutDefinition.keepSynced),this.layoutDefinition.renderType&&this.setLayoutRenderType(this.layoutDefinition.renderType||"json"),!0)},t.prototype.openSwimDataLink=function(){this.swimDataConfig.didUpdate=this.handleSwimDataUpdate.bind(this),console.error("dataconfig",this.swimDataConfig),this.swimDataLink=Ma.openSwimMapLink(this.swimDataConfig)},t.prototype.handleSwimDataUpdate=function(){console.error("render sync",this.swimDataLink),this.swimDataLink&&(console.error(this.swimDataLink.get()),this.setSwimData(this.swimDataLink.get()))},t.prototype.getLayoutDefinition=function(){return this.layoutDefinition},t.prototype.setLayoutTitle=function(t){this.layoutDefinition.title=t,this.layoutTitle=this.layoutDefinition.title},t.prototype.getLayoutTitle=function(){return this.layoutTitle||"No Title"},t.prototype.setLayoutWidth=function(t){t!==this.layoutDefinition.width&&(this.layoutDefinition.width=t),this.container&&this.container.width(this.layoutDefinition.width)},t.prototype.setLayoutHeight=function(t){t!==this.layoutDefinition.height&&(this.layoutDefinition.height=t),this.container&&this.container.height(this.layoutDefinition.height)},t.prototype.setLayoutBackground=function(t){t!==this.layoutDefinition.backgroundColor&&(this.layoutDefinition.backgroundColor=t),this.container&&this.container.backgroundColor(this.layoutDefinition.backgroundColor)},t.prototype.setLayoutDisplayType=function(t){t!==this.layoutDefinition.display&&(this.layoutDefinition.display=t),this.container&&this.container.display(this.layoutDefinition.display)},t.prototype.setLayoutFlexType=function(t){t!==this.layoutDefinition.flexDirection&&(this.layoutDefinition.flexDirection=t)},t.prototype.setLayoutElements=function(t){this.layoutElements=t},t.prototype.setLayoutRenderType=function(t){t!==this.layoutDefinition.renderType&&(this.layoutDefinition.renderType=t,console.info("RE_RENDER THE LAYOUT HERE!!!!"),"recon"===t?this.buildReconLayout():this.buildJsonLayout())},t.prototype.setSwimData=function(t){},t.prototype.setSwimDataModel=function(t){},t.prototype.buildJsonLayout=function(){if(console.info("build json layout"),this.layoutDefinition&&(console.info("build json layout"),this.container=Fa.create("div").width(this.layoutDefinition.width||"100%").height(this.layoutDefinition.height||"100%").backgroundColor(this.layoutDefinition.backgroundColor||"transparent").display(this.layoutDefinition.display).flexDirection(this.layoutDefinition.flexDirection).position("relative"),this.container.node.innerHTML="",this.parentElem.appendChild(this.container.node),this.layoutElements&&0<this.layoutElements.length))for(var t=0,e=this.layoutElements;t<e.length;t++){var i=e[t];this.renderLayoutElement(i)}},t.prototype.buildReconLayout=function(){console.info("build recon layout"),this.layoutDefinition&&(this.container=Fa.create("script").type("script/recon"),this.container.node.innerHTML="",this.parentElem.appendChild(this.container.node))},t.prototype.destroyLayout=function(){if(this.container){for(var t in this.renderedElementCache)this.renderedElementCache[t].remove(),delete this.renderedElementCache[t];this.renderedElementCache=[],this.container.remove(),this.container.removeAll()}},t.prototype.renderLayoutElement=function(t){var e=this.createHtmlElement(t);this.container&&this.container.node.appendChild(e.node)},t.prototype.cacheNewElement=function(t,e){this.renderedElementCache[t]=e},t.prototype.getCachedElement=function(t){return this.renderedElementCache[t]},t.prototype.getLayoutElements=function(){return this.layoutElements},t.prototype.createHtmlElement=function(t){var e=Fa.create(t.type);if("svg"===t.type&&(e=Sa.create("svg").width(t.width).height(t.height).viewBox("0 0 "+t.width+" "+t.height)),t.id||(t.id=Ma.newGuid()),e.elemId(t.id),t.width&&"svg"!==t.type&&e.width(t.width),t.height&&"svg"!==t.type&&e.height(t.height),t.content&&e.text(t.content),t.swimAttributes)for(var i=0,r=Object.keys(t.swimAttributes);i<r.length;i++){"function"==typeof e[s=r[i]]?e[s](t.swimAttributes[s]):e.node.setAttribute(s,t.swimAttributes[s])}if(t.htmlAttributes)for(var o=0,n=Object.keys(t.htmlAttributes);o<n.length;o++){var s=n[o];"function"==typeof t.htmlAttributes[s]?e.node[s]=t.htmlAttributes[s]:"path"===s?e.append("path").d(t.htmlAttributes[s]):"polygon"===s?e.append("polygon").points(t.htmlAttributes[s]):e.node.setAttribute(s,t.htmlAttributes[s])}if(t.styleAttributes){for(var a="",u=0,h=Object.keys(t.styleAttributes);u<h.length;u++){a+=(s=h[u])+": "+t.styleAttributes[s]+"; "}e.node.setAttribute("style",a)}if(t.children&&0<t.children.length)for(var l=0,p=t.children;l<p.length;l++){var c=p[l],d=this.createHtmlElement(c);e.append(d)}return this.cacheNewElement(t.id,e),e},t}(),Ta=function(){function t(){}return t.getCachedLayout=function(t,e){var i=t.get(e);return i||(t.set(e,this.getLayout(e)),i=t.get(e)),i},t.getLayout=function(t){return this.layoutList[t]},t.getLayoutList=function(){return Object.keys(this.layoutList)},t.layoutList={addAttributeForm:{title:"New Add Attr Form",style:null,width:"100%",height:"100%",backgroundColor:"transparent",display:"flex",flexDirection:"column",layoutElements:[{type:"div",swimAttributes:{width:"100%"},id:"a199175b",styleAttributes:{display:"flex","flex-direction":"column",margin:"15px"},children:[{type:"h2",swimAttributes:{width:"100%"},id:"fc14565c",content:"Add Attribute to Element",styleAttributes:{color:"black",margin:"10px 0 0 0"}},{type:"h3",swimAttributes:{},id:"353ec5b7",content:"error message",htmlAttributes:{},styleAttributes:{color:"red"}},{type:"div",swimAttributes:{},id:"ddb022da",content:"",htmlAttributes:{},styleAttributes:{display:"flex","flex-direction":"row",width:"95%","padding-bottom":"10px",margin:"0px auto"},children:[{type:"h3",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"text-align":"right",width:"25%","padding-right":"5px",color:"black"},id:"2c102917",content:"Attribute Name"},{type:"input",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,width:"75%","font-size":"27px","background-color":"rgba(155,155,155,0.4)",border:"solid 1px rgba(45,45,45,0.4)","padding-left":"5px"},id:"e299d99c",htmlAttributes:{type:"text"}}]},{type:"div",swimAttributes:{},id:"ddb022db",content:"",htmlAttributes:{},styleAttributes:{display:"flex","flex-direction":"row",width:"95%",margin:"0px auto"},children:[{type:"h3",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"text-align":"right",width:"25%","padding-right":"5px",color:"black"},id:"88cc7f14",content:"Attribute Value"},{type:"input",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,width:"75%","font-size":"27px","background-color":"rgba(155,155,155,0.4)",border:"solid 1px rgba(45,45,45,0.4)","padding-left":"5px"},id:"01fa2cb7",htmlAttributes:{type:"text"}}]},{type:"div",swimAttributes:{width:"100%",height:"100px"},id:"b6fb0f93",children:[{type:"input",swimAttributes:{},id:"917495b7",content:"Add",styleAttributes:{"flex-grow":"1","font-size":"27px",margin:"20px",padding:"20px 0","background-color":"rgb(43,43,53)",border:"0",color:"white","border-radius":"5px"},htmlAttributes:{type:"button",value:"Add"}},{type:"input",swimAttributes:{},id:"0e315fca",content:"Cancel",styleAttributes:{"font-size":"27px","flex-grow":"1",margin:"20px",padding:"20px 0","background-color":"rgb(43,43,53)",color:"white",border:"0px","border-radius":"5px"},htmlAttributes:{type:"button",value:"Cancel"}}],styleAttributes:{display:"flex","flex-direction":"row"}}]}],id:"6693a2c9"},loadJsonDialog:{title:"Load Layout",style:null,width:"100%",height:"100%",backgroundColor:"transparent",display:"flex",flexDirection:"column",layoutElements:[{type:"div",swimAttributes:{width:"100%"},id:"a199175b",styleAttributes:{display:"flex","flex-direction":"column",margin:"15px"},children:[{type:"h2",swimAttributes:{width:"100%"},id:"fc14565c",content:"Load Card Layout",styleAttributes:{color:"black",margin:"10px 0 0 0"}},{type:"h3",swimAttributes:{},id:"353ec5b7",content:"error message",htmlAttributes:{},styleAttributes:{color:"red"}},{type:"textarea",swimAttributes:{},id:"ddb022da",content:"Enter Layout JSON",htmlAttributes:{cols:"60",rows:"15"},styleAttributes:{border:"solid 3px rgba(100,100,100, 0.3)","border-radius":"10px"}},{type:"div",swimAttributes:{width:"100%",height:"100px"},id:"b6fb0f93",children:[{type:"button",swimAttributes:{},id:"3fcd7fab",content:"Load",styleAttributes:{"flex-grow":"1","font-size":"27px",margin:"20px",padding:"20px 0","background-color":"rgb(43,43,53)",border:"0",color:"white","border-radius":"5px"}},{type:"button",swimAttributes:{},id:"0e315fca",content:"Cancel",styleAttributes:{"font-size":"27px","flex-grow":"1",margin:"20px",padding:"20px 0","background-color":"rgb(43,43,53)",color:"white",border:"0px","border-radius":"5px"}}],styleAttributes:{display:"flex","flex-direction":"row"}}]}]},loadListDialog:{title:"Load Layout",style:null,width:"100%",height:"100%",backgroundColor:"transparent",display:"flex",flexDirection:"column",layoutElements:[{type:"div",swimAttributes:{width:"100%"},id:"a199175b",styleAttributes:{display:"flex","flex-direction":"column",margin:"15px"},children:[{type:"h2",swimAttributes:{width:"100%"},id:"fc14565c",content:"Load Card Layout",styleAttributes:{color:"black",margin:"10px 0 0 0"}},{type:"h3",swimAttributes:{},id:"353ec5b7",content:"error message",htmlAttributes:{},styleAttributes:{color:"red"}},{type:"div",swimAttributes:{},id:"ddb022da",content:"<list goes here>",htmlAttributes:{},styleAttributes:{border:"solid 3px rgba(100,100,100, 0.3)","border-radius":"10px",height:"270px",overflow:"auto"}},{type:"div",swimAttributes:{width:"100%",height:"100px"},id:"b6fb0f93",children:[{type:"button",swimAttributes:{},id:"0e315fca",content:"Cancel",styleAttributes:{"font-size":"27px","flex-grow":"1",margin:"20px",padding:"20px 0","background-color":"rgb(43,43,53)",color:"white",border:"0px","border-radius":"5px"}}],styleAttributes:{display:"flex","flex-direction":"row"}}]}]},mainLayoutForm:{title:"Layout Form",width:"260px",height:"608px",backgroundColor:"rgb(53,53,53)",display:"flex",flexDirection:"column",layoutElements:[{type:"h3",id:"ee19a133",content:"Layout Info",styleAttributes:{margin:"0 0 18px 0",padding:"12px 0px 4px 8px","background-color":"rgb(42,42,42)","border-top":"solid 1px rgb(42,42,42)","border-bottom":"solid 1px rgba(255,255,255,0.4)","font-size":"22px"},children:[]},{type:"form",swimAttributes:{},id:"1090afd2",content:"",children:[{type:"div",swimAttributes:{},content:"Layout Title",styleAttributes:{"font-size":"18px"},id:"0ac74869"},{type:"input",swimAttributes:{bind:"{{blockTitleValue}}",slot:"value"},htmlAttributes:{type:"text"},styleAttributes:{margin:"3px 0 10px 0","background-color":"rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.1)",border:"solid 1px rgba(255,255,255,0.8)",color:"white","font-size":"20px",padding:"3px","border-radius":"3px","margin-bottom":"10px",width:"95%"},id:"258f66d4"},{type:"div",swimAttributes:{},content:"Layout Width",styleAttributes:{"font-size":"18px"},id:"83fea821"},{type:"input",swimAttributes:{bind:"{{blockWidthValue}}",slot:"value"},htmlAttributes:{type:"text"},styleAttributes:{margin:"3px 0 10px 0","background-color":"rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.1)",border:"solid 1px rgba(255,255,255,0.8)",color:"white","font-size":"20px",padding:"3px","border-radius":"3px","margin-bottom":"10px",width:"95%"},id:"1056f91e"},{type:"div",swimAttributes:{},content:"Layout Height",styleAttributes:{"font-size":"18px"},id:"1707e5cf"},{type:"input",swimAttributes:{bind:"{{blockHeightValue}}",slot:"value"},htmlAttributes:{type:"text"},styleAttributes:{margin:"3px 0 10px 0","background-color":"rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.1)",border:"solid 1px rgba(255,255,255,0.8)",color:"white","font-size":"20px",padding:"3px","border-radius":"3px","margin-bottom":"10px",width:"95%"},id:"e9a054b0"},{type:"div",swimAttributes:{},content:"Background Color",styleAttributes:{"font-size":"18px"},id:"63568108"},{type:"input",swimAttributes:{bind:"{{blockBgColorValue}}",slot:"value"},htmlAttributes:{type:"text"},styleAttributes:{margin:"3px 0 10px 0","background-color":"rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.1)",border:"solid 1px rgba(255,255,255,0.8)",color:"white","font-size":"20px",padding:"3px","border-radius":"3px","margin-bottom":"10px",width:"95%"},id:"bf26f39e"},{type:"div",swimAttributes:{},content:"Layout Display Type",styleAttributes:{"font-size":"18px"},id:"a32edb7c"},{type:"input",swimAttributes:{bind:"{{blockDisplayValue}}",slot:"value"},htmlAttributes:{type:"text"},styleAttributes:{margin:"3px 0 10px 0","background-color":"rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.1)",border:"solid 1px rgba(255,255,255,0.8)",color:"white","font-size":"20px",padding:"3px","border-radius":"3px","margin-bottom":"10px",width:"95%"},id:"ea01c64a"},{type:"div",swimAttributes:{},content:"Layout Flex Type",styleAttributes:{"font-size":"18px"},id:"8bf2625c"},{type:"input",swimAttributes:{bind:"{{blockFlexType}}",slot:"value"},htmlAttributes:{type:"text"},styleAttributes:{margin:"3px 0 10px 0","background-color":"rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.1)",border:"solid 1px rgba(255,255,255,0.8)",color:"white","font-size":"20px",padding:"3px","border-radius":"3px","margin-bottom":"10px",width:"95%"},id:"9e5c85a6"},{type:"div",swimAttributes:{},styleAttributes:{"font-size":"18px"},id:"d23899aa",content:"Render Type (json||recon)"},{type:"input",swimAttributes:{width:"100%"},styleAttributes:{margin:"3px 0 10px 0","background-color":"rgba(255,255,255,0.1)",border:"solid 1px rgba(255,255,255,0.8)",color:"white","font-size":"20px",padding:"3px","border-radius":"3px","margin-bottom":"10px",width:"95%"},id:"933f721d",htmlAttributes:{type:"text"}}],styleAttributes:{padding:"10px"}},{type:"h3",swimAttributes:{},id:"7aada818",content:"Layout Elements",styleAttributes:{margin:"0 0 18px 0",padding:"12px 0 4px 8px","background-color":"rgb(42,42,42)","border-top":"solid 1px rgba(0,0,0,0.8)","border-bottom":"solid 1px rgba(255,255,255,0.4)",position:"relative","font-size":"22px"},children:[{type:"div",swimAttributes:{width:"100%",height:"100px"},id:"27e250a2",content:"+",styleAttributes:{width:"28px",height:"28px",position:"absolute",right:"3px",top:"5px","border-radius":"50%",cursor:"pointer","background-color":"rgba(255,255,255,0.3)","text-align":"center","line-height":"28px",border:"solid 1px rgba(255,255,255,0.8)"},htmlAttributes:{}}]}],keepSynced:!1,renderType:"json"},mainHeaderMenus:{title:"Editor Header Menus",width:"100%",height:"45px",backgroundColor:"rgba(53,53,53,1)",display:"flex",flexDirection:"row",layoutElements:[{type:"div",swimAttributes:{},styleAttributes:{},id:"FileMenuContainer",content:"",children:[{type:"button",swimAttributes:{},styleAttributes:{},id:"e2e1d9a7",content:"File",children:{},htmlAttributes:{class:"dropbtn"}},{type:"div",swimAttributes:{},styleAttributes:{},id:"26bd9978",htmlAttributes:{class:"dropdown-content"},children:[{type:"a",swimAttributes:{},styleAttributes:{},id:"e5bae29c",content:"NewÂ  Layout",htmlAttributes:{href:"javascript:pageController.newLayout()"}},{type:"a",swimAttributes:{},styleAttributes:{},id:"933364fc",content:"Load Layout",htmlAttributes:{href:"javascript:pageController.loadLayoutFromService()"}},{type:"a",swimAttributes:{},styleAttributes:{},id:"d451499b",content:"Save Layout",htmlAttributes:{href:"javascript:pageController.saveLayout()"}},{type:"a",swimAttributes:{},styleAttributes:{},id:"adf15cb1",content:"Load Template",htmlAttributes:{href:"javascript:pageController.loadLayoutFromList()"}},{type:"a",swimAttributes:{},styleAttributes:{},id:"e328a3d2",content:"Load from JSON",htmlAttributes:{href:"javascript:pageController.loadLayoutFromJson()"}},{type:"a",swimAttributes:{},styleAttributes:{},id:"ba942fc2",content:"Output JSON",htmlAttributes:{href:"javascript:pageController.debugLayout()"}}]}],htmlAttributes:{class:"dropdown"}},{type:"div",swimAttributes:{},styleAttributes:{},id:"a997a04b",children:[{type:"button",swimAttributes:{},styleAttributes:{},id:"b4b0adbd",content:"Link Config",htmlAttributes:{class:"dropbtn"}},{type:"div",swimAttributes:{},styleAttributes:{},id:"a8ca9f23",htmlAttributes:{class:"dropdown-content"},children:[{type:"a",swimAttributes:{},styleAttributes:{},id:"36a36814",content:"Quilt Link Config",htmlAttributes:{href:"javascript:pageController.showQuiltConfigDialog()"}},{type:"a",swimAttributes:{},styleAttributes:{},id:"c49ea016",content:"Swim Link Config",htmlAttributes:{href:"javascript:pageController.showLinkConfigDialog()"}},{type:"a",swimAttributes:{},styleAttributes:{},id:"faf0659b",content:"Flush Saved Templates",htmlAttributes:{href:"javascript:pageController.flushSavedTemplates()"}}]}],htmlAttributes:{class:"dropdown"}},{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,color:"white","line-height":"42px","text-align":"right"},id:"swimHostUrlLabel",content:""},{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,color:"white","line-height":"42px"},id:"452d2af0"}],keepSynced:!1},dataLinkConfigForm:{title:"Data Link Config Form",width:"640px",height:"480px",backgroundColor:"transparent",display:"flex",flexDirection:"column",layoutElements:[{type:"div",swimAttributes:{width:"100%"},id:"a199175b",styleAttributes:{display:"flex","flex-direction":"column",margin:"0 15px",height:"75%","flex-grow":"1"},children:[{type:"h2",swimAttributes:{width:"100%"},id:"fc14565c",content:"link config",styleAttributes:{color:"black",margin:"10px 0 0 0"}},{type:"h3",swimAttributes:{},id:"353ec5b7",content:"error message",htmlAttributes:{},styleAttributes:{color:"red"}},{type:"div",swimAttributes:{},id:"ddb022da",content:"",htmlAttributes:{},styleAttributes:{display:"flex","flex-direction":"row",width:"95%","padding-bottom":"10px",margin:"0px auto"},children:[{type:"h3",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"text-align":"right",width:"25%","padding-right":"5px",color:"black"},content:"Host",id:"140f3854"},{type:"input",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,width:"75%","font-size":"27px","background-color":"rgba(155,155,155,0.4)",border:"solid 1px rgba(45,45,45,0.4)","padding-left":"5px"},htmlAttributes:{type:"text"},id:"96af4f65"}]},{type:"div",swimAttributes:{},id:"ddb022da",content:"",htmlAttributes:{},styleAttributes:{display:"flex","flex-direction":"row",width:"95%","padding-bottom":"10px",margin:"0px auto"},children:[{type:"h3",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"text-align":"right",width:"25%","padding-right":"5px",color:"black"},id:"2c102917",content:"Node"},{type:"input",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,width:"75%","font-size":"27px","background-color":"rgba(155,155,155,0.4)",border:"solid 1px rgba(45,45,45,0.4)","padding-left":"5px"},id:"e299d99c",htmlAttributes:{type:"text"}}]},{type:"div",swimAttributes:{},id:"ddb022db",content:"",htmlAttributes:{},styleAttributes:{display:"flex","flex-direction":"row",width:"95%",margin:"0px auto","padding-bottom":"10px"},children:[{type:"h3",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"text-align":"right",width:"25%","padding-right":"5px",color:"black"},id:"88cc7f14",content:"Lane"},{type:"input",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,width:"75%","font-size":"27px","background-color":"rgba(155,155,155,0.4)",border:"solid 1px rgba(45,45,45,0.4)","padding-left":"5px"},id:"01fa2cb7",htmlAttributes:{type:"text"}}]},{type:"div",swimAttributes:{},content:"",htmlAttributes:{},styleAttributes:{display:"flex","flex-direction":"row",width:"95%",margin:"0px auto"},children:[{type:"h3",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"text-align":"right",width:"25%","padding-right":"5px",color:"black"},content:"Keep Synced",id:"22c76974"},{type:"input",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,width:"75%","font-size":"27px","background-color":"rgba(155,155,155,0.4)",border:"solid 1px rgba(45,45,45,0.4)","padding-left":"5px"},htmlAttributes:{type:"text"},id:"faf17c1c"}],id:"a7000b31"},{type:"div",swimAttributes:{width:"100%",height:"110px"},id:"b6fb0f93",children:[{type:"input",swimAttributes:{},id:"917495b7",content:"",styleAttributes:{"flex-grow":"1","font-size":"27px",margin:"20px",padding:"20px 0","background-color":"rgb(43,43,53)",border:"0",color:"white","border-radius":"5px"},htmlAttributes:{type:"button",value:"Connect"}},{type:"input",swimAttributes:{},id:"0e315fca",content:"Cancel",styleAttributes:{"font-size":"27px","flex-grow":"1",margin:"20px",padding:"20px 0","background-color":"rgb(43,43,53)",color:"white",border:"0px","border-radius":"5px"},htmlAttributes:{type:"button",value:"Done"}}],styleAttributes:{display:"flex","flex-direction":"row"}}]}],hostUrl:null,hostPort:null,node:null,lane:null},quiltConfigForm:{title:"Quilt Config Form",width:"640px",height:"480px",backgroundColor:"transparent",display:"flex",flexDirection:"column",layoutElements:[{type:"div",swimAttributes:{width:"100%"},id:"a199175b",styleAttributes:{display:"flex","flex-direction":"column",margin:"0 15px",height:"75%","flex-grow":"1"},children:[{type:"h2",swimAttributes:{width:"100%"},id:"fc14565c",content:"link config",styleAttributes:{color:"black",margin:"10px 0 0 0"}},{type:"h3",swimAttributes:{},id:"353ec5b7",content:"error message",htmlAttributes:{},styleAttributes:{color:"red"}},{type:"div",swimAttributes:{},id:"ddb022da",content:"",htmlAttributes:{},styleAttributes:{display:"flex","flex-direction":"row",width:"95%","padding-bottom":"10px",margin:"0px auto"},children:[{type:"h3",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"text-align":"right",width:"25%","padding-right":"5px",color:"black"},content:"Host",id:"140f3854"},{type:"input",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,width:"75%","font-size":"27px","background-color":"rgba(155,155,155,0.4)",border:"solid 1px rgba(45,45,45,0.4)","padding-left":"5px"},htmlAttributes:{type:"text"},id:"96af4f65"}]},{type:"div",swimAttributes:{},id:"ddb022da",content:"",htmlAttributes:{},styleAttributes:{display:"none","flex-direction":"row",width:"95%","padding-bottom":"10px",margin:"0px auto"},children:[{type:"h3",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"text-align":"right",width:"25%","padding-right":"5px",color:"black"},id:"2c102917",content:"Node"},{type:"input",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,width:"75%","font-size":"27px","background-color":"rgba(155,155,155,0.4)",border:"solid 1px rgba(45,45,45,0.4)","padding-left":"5px"},id:"e299d99c",htmlAttributes:{type:"text"}}]},{type:"div",swimAttributes:{},id:"ddb022db",content:"",htmlAttributes:{},styleAttributes:{display:"flex","flex-direction":"row",width:"95%",margin:"0px auto","padding-bottom":"10px"},children:[{type:"h3",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"text-align":"right",width:"25%","padding-right":"5px",color:"black"},id:"88cc7f14",content:"Quilt ID"},{type:"input",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,width:"75%","font-size":"27px","background-color":"rgba(155,155,155,0.4)",border:"solid 1px rgba(45,45,45,0.4)","padding-left":"5px"},id:"01fa2cb7",htmlAttributes:{type:"text"}}]},{type:"div",swimAttributes:{width:"100%",height:"110px"},id:"b6fb0f93",children:[{type:"input",swimAttributes:{},id:"917495b7",content:"",styleAttributes:{"flex-grow":"1","font-size":"27px",margin:"20px",padding:"20px 0","background-color":"rgb(43,43,53)",border:"0",color:"white","border-radius":"5px"},htmlAttributes:{type:"button",value:"Update"}},{type:"input",swimAttributes:{},id:"0e315fca",content:"Cancel",styleAttributes:{"font-size":"27px","flex-grow":"1",margin:"20px",padding:"20px 0","background-color":"rgb(43,43,53)",color:"white",border:"0px","border-radius":"5px"},htmlAttributes:{type:"button",value:"Cancel"}}],styleAttributes:{display:"flex","flex-direction":"row"}}]}],hostUrl:null,hostPort:null,node:null,lane:null,keepSynced:!1},flexTestLayout:{title:"flex test layout",style:null,width:"100%",height:"100%",backgroundColor:"transparent",display:"flex",flexDirection:"column",layoutElements:[{type:"div",swimAttributes:{},id:"9d2fe39b",styleAttributes:{"background-color":"red",width:"200px",height:"200px",margin:"5px"}},{type:"div",swimAttributes:{width:"100%",height:"100px"},id:"08734296",styleAttributes:{width:"200px",height:"200px","background-color":"blue",margin:"5px"}}]},"@canary":{title:"@Canary Card Layout",width:"100%",height:"100%",backgroundColor:"transparent",display:"flex",flexDirection:"row",layoutElements:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1},id:"88181e51",children:[{type:"swim-canary-card",swimAttributes:{width:"100%",header:!1},styleAttributes:{"flex-grow":1,width:"100%",height:"100%"},id:"37a2b719",content:""}]}],hostUrl:null,hostPort:null,node:null,lane:null,keepSynced:!1},"@chart":{title:"@Chart Layout",width:"100%",height:"100%",backgroundColor:"transparent",display:"flex",flexDirection:"column",layoutElements:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,display:"flex",height:"90%"},id:"52716243",children:[{type:"swim-time-series",swimAttributes:{width:"100%",height:"100%","gutter-left":"60px","gutter-bottom":"20px",header:!1},styleAttributes:{"flex-grow":1},id:"584d0bee"}]}],hostUrl:null,hostPort:null,node:null,lane:null,keepSynced:!1},"@gauge":{title:"@Gauge Card",width:"100%",height:"100%",backgroundColor:"transparent",display:"flex",flexDirection:"column",layoutElements:[{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":"1",display:"flex",padding:"0px","margin-left":"5%","margin-right":"5%","margin-top":"5%","margin-bottom":"5%"},id:"78bcaa56",content:"",children:[{type:"swim-gauge",swimAttributes:{width:"100%",meter:"{{powerBattery}}",height:"100%","dial-corner":"10",header:!1},styleAttributes:{"flex-grow":1},id:"cd9db6a1",content:""}]}],hostUrl:"",hostPort:"",node:"",lane:"",keepSynced:!1},"@pie":{title:"@Pie chart ",width:"100%",height:"100%",backgroundColor:"transparent",display:"flex",flexDirection:"column",layoutElements:[{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":"1",display:"flex",padding:"0px","margin-left":"0%","margin-right":"0%","margin-top":"0%","margin-bottom":"0%"},id:"78bcaa56",content:"",children:[{type:"swim-pie",swimAttributes:{"inner-radius":"40","outer-radius":"160","tick-radius":"180","tick-length":"240","tick-color":"#667095","label-radius":"135","pad-angle":"0","label-size":"10","label-color":"#ffffff","title-size":"14","title-color":"#7883AA",header:!1},styleAttributes:{"flex-grow":"1"},id:"ab79f9fc",content:""}]}],hostUrl:null,hostPort:null,node:null,lane:null,keepSynced:!1},"@donut":{title:"@Donut pie chart ",width:"100%",height:"100%",backgroundColor:"transparent",display:"flex",flexDirection:"column",layoutElements:[{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":"1",display:"flex",padding:"0px","margin-left":"0%","margin-right":"0%","margin-top":"0%","margin-bottom":"0%"},id:"78bcaa56",content:"",children:[{type:"swim-pie",swimAttributes:{"inner-radius":"40","outer-radius":"160","tick-radius":"180","tick-length":"240","tick-color":"#667095","label-radius":"135","pad-angle":"0","label-size":"10","label-color":"#ffffff","title-size":"14","title-color":"#7883AA",header:!1},styleAttributes:{"flex-grow":"1"},id:"ab79f9fc",content:""}]}],hostUrl:null,hostPort:null,node:null,lane:null,keepSynced:!1},"@treemap":{title:"@Treemap chart",width:"100%",height:"100%",backgroundColor:"transparent",display:"flex",flexDirection:"column",layoutElements:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,display:"flex",padding:"0px","margin-left":"2%","margin-right":"2%","margin-top":"2%","margin-bottom":"2%"},id:"fead5c64",content:"",children:[{type:"swim-treemap",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1},id:"31ed4f1c",content:""}]}],hostUrl:"",hostPort:"",node:"",lane:"",keepSynced:!1},loginForm:{title:"Login Form",width:"100%",height:"100%",backgroundColor:"transparent",display:"flex",flexDirection:"row",layoutElements:[{type:"div",swimAttributes:{},styleAttributes:{width:"420px",margin:"40px auto",height:"400px","background-color":"rgba(155,155,155,0.2)",display:"flex","flex-direction":"column","border-radius":"5px"},id:"7b8c3d21",children:[{type:"h3",swimAttributes:{width:"100%"},styleAttributes:{padding:"0px 10px"},id:"2cecd57e",content:"UserName"},{type:"input",swimAttributes:{},styleAttributes:{padding:"10px",margin:"0px 10px"},id:"709b0b18",htmlAttributes:{type:"text"}},{type:"h3",swimAttributes:{width:"100%"},styleAttributes:{padding:"0px 10px"},id:"32e98c6a",content:"Password"},{type:"input",swimAttributes:{},styleAttributes:{margin:"0px 10px",padding:"10px"},id:"3586e072",content:"",htmlAttributes:{type:"text"}},{type:"input",swimAttributes:{},styleAttributes:{margin:"20px","font-size":"27px"},id:"f0bdc8ae",htmlAttributes:{type:"button",value:"Login"}}]}],hostUrl:"",hostPort:"",node:"",lane:"",keepSynced:!1},cardMainLayout:{title:"Card Base Layout",width:"100%",height:"100%",backgroundColor:"transparent",display:"flex",flexDirection:"row",layoutElements:[{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":1,display:"flex",width:"100%",height:"100%","flex-shrink":"0"},id:"85b73a7b",children:[{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":1,display:"flex","flex-direction":"column"},id:"b6933185",children:[{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":1,display:"flex",height:"5%","flex-direction":"row"},id:"aca40a2a",content:"",children:[{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":1,width:"60%",display:"flex"},id:"5cfbae2e",content:"",children:[{type:"swim-text",swimAttributes:{slot:"title"},styleAttributes:{color:"rgb(78,84,108)","padding-top":"0.5%","padding-left":"1.5%"},id:"31fb9ec5",content:"-title-"}],name:"Title"},{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":1,display:"flex","flex-direction":"row-reverse"},id:"fbb5cd76",content:"",children:[{type:"div",swimAttributes:{},styleAttributes:{color:"rgb(78, 84, 108)",opacity:"0.5","padding-top":"0.5%","padding-right":"2.5%"},id:"c41341e7",content:"ALL SYSTEMS"}],name:"System Name"}],name:"Header Row"},{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":1,height:"95%",position:"relative"},id:"3baa2621",content:"",children:[{type:"div",swimAttributes:{},styleAttributes:{display:"flex",position:"absolute",top:"0%",bottom:"0%",right:"1.8%",left:"1.8%"},id:"cardChartContainer",name:"chart target"},{type:"div",swimAttributes:{},styleAttributes:{position:"absolute",top:"0px",left:"3.8%",right:"3.8%","border-top":"solid 1px #529fc1",display:"none"},id:"8e021f2b",name:"blue top line"},{type:"swim-text",swimAttributes:{slot:"subtitle"},styleAttributes:{position:"absolute",left:"3.8%",top:"1.6%",opacity:"0"},id:"39be1de1",content:"-subtitle-",name:"subtitle"}],name:"Center Row"},{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,height:"1%"},id:"45ab68bf",content:"",name:"footer"}],name:"Padding"}],name:"Main"}],hostUrl:"",hostPort:"",node:"",lane:"",keepSynced:!1},modalMainLayout:{title:"Modal Base Layout",width:"100%",height:"100%",backgroundColor:"transparent",display:"flex",flexDirection:"row",layoutElements:[{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":1,display:"flex",width:"100%",height:"100%","flex-shrink":"0"},id:"db97694a",children:[{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":1,display:"flex","flex-direction":"column"},id:"d37b387d",children:[{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":1,display:"flex",height:"10%","flex-direction":"row"},id:"aca40a2a",content:"",children:[{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":1,width:"60%",display:"flex","align-items":"center","margin-left":"3.8%"},id:"afd6c1db",content:"",children:[{type:"swim-text",swimAttributes:{slot:"title"},styleAttributes:{"font-size":"24px",color:"rgb(78,84,108)"},id:"a82ff7a1",content:"-title-"}],name:"Title"},{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":1,display:"flex","flex-direction":"row-reverse","align-items":"center","margin-right":"3.8%"},id:"96480d63",content:"",children:[{type:"swim-text",swimAttributes:{},styleAttributes:{color:"rgb(78, 84, 108)",opacity:"0.5"},id:"7f041834",content:"ALL SYSTEMS"}],name:"System Name"}],name:"Header Row"},{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":1,height:"80%",position:"relative"},id:"f34fd5cd",content:"",children:[{type:"div",swimAttributes:{},styleAttributes:{display:"flex",position:"absolute",top:"0%",bottom:"0%",right:"3.8%",left:"3.8%"},id:"mainChartContainer",name:"chart target"},{type:"div",swimAttributes:{},styleAttributes:{position:"absolute",top:"0px",left:"3.8%",right:"3.8%","border-top":"solid 1px #529fc1"},id:"34b3d8b3",name:"blue top line"},{type:"swim-text",swimAttributes:{slot:"subtitle"},styleAttributes:{position:"absolute",left:"3.8%",top:"1.6%",opacity:"0"},id:"80f95769",content:"-subtitle-",name:"subtitle"}],name:"Center Row"},{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":"1","flex-direction":"row",display:"flex",position:"relative",height:"15%"},id:"30ab02aa",content:"",children:[{type:"div",swimAttributes:{},styleAttributes:{position:"absolute",top:"0%",bottom:"0%",left:"3.8%",right:"3.8%",display:"flex"},id:"secondChartContainer",content:"",children:[{type:"swim-time-series",swimAttributes:{width:"100%","gutter-left":"0px","gutter-bottom":"0px",header:!1,subheader:!1},styleAttributes:{"flex-grow":1},id:"954dfba4"}],name:"second chart tagget"}],name:"second chart row"},{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,height:"5%"},id:"10a281f8",content:"",name:"footer"}],name:"Padding"}],name:"Main"}],hostUrl:"",hostPort:"",node:"",lane:"",keepSynced:!1},moonOverMountainsLayout:{title:"Moon Over Mountains Layout",width:"100%",height:"100%",backgroundColor:"transparent",display:"flex",flexDirection:"row",layoutElements:[{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":1,display:"flex",width:"100%",height:"100%","flex-shrink":"0"},id:"db97694a",children:[{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":1,display:"flex","flex-direction":"column"},id:"d37b387d",children:[{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":1,display:"flex",height:"10%","flex-direction":"row"},id:"aca40a2a",content:"",children:[{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":1,width:"60%",display:"flex","align-items":"center","margin-left":"3.8%"},id:"afd6c1db",content:"",children:[{type:"swim-text",swimAttributes:{slot:"title"},styleAttributes:{"font-size":"24px",color:"rgb(78,84,108)"},id:"a82ff7a1",content:"-title-"}],name:"Title"},{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":1,display:"flex","flex-direction":"row-reverse","align-items":"center","margin-right":"3.8%"},id:"96480d63",content:"",children:[{type:"div",swimAttributes:{},styleAttributes:{color:"rgb(78, 84, 108)",opacity:"0.5"},id:"7f041834",content:"ALL SYSTEMS"}],name:"System Name"}],name:"Header Row"},{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":1,height:"80%",position:"relative"},id:"f34fd5cd",content:"",children:[{type:"div",swimAttributes:{},styleAttributes:{display:"flex",position:"absolute",top:"0%",bottom:"0%",right:"3.8%",left:"3.8%"},id:"mainChartContainer",name:"time series target"},{type:"div",swimAttributes:{},styleAttributes:{position:"absolute",top:"0px",left:"3.8%",right:"3.8%","border-top":"solid 1px #529fc1"},id:"34b3d8b3",name:"blue top line"},{type:"swim-text",swimAttributes:{slot:"subtitle"},styleAttributes:{position:"absolute",left:"3.8%",top:"1.6%",opacity:"0"},id:"80f95769",content:"-subtitle-",name:"subtitle"},{type:"div",swimAttributes:{},styleAttributes:{position:"absolute",width:"40%",height:"40%",top:"0px",right:"0px"},id:"smallChartContainer",name:"small chart target"}],name:"Center Row"},{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":"1","flex-direction":"row",display:"flex",position:"relative",height:"15%"},id:"30ab02aa",content:"",children:[{type:"div",swimAttributes:{},styleAttributes:{position:"absolute",top:"0%",bottom:"0%",left:"3.8%",right:"3.8%",display:"flex"},id:"secondChartContainer",content:"",children:[{type:"swim-time-series",swimAttributes:{width:"100%","gutter-left":"0px","gutter-bottom":"0px",header:!1,subheader:!1},styleAttributes:{"flex-grow":1},id:"954dfba4"}],name:"second chart tagget"}],name:"second chart row"},{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,height:"5%"},id:"10a281f8",content:"",name:"footer"}],name:"Padding"}],name:"Main"}],hostUrl:"",hostPort:"",node:"",lane:"",keepSynced:!1},pieChartCard3:{title:"pie chart 1",width:"100%",height:"100%",backgroundColor:"transparent",display:"flex",flexDirection:"row",layoutElements:[{type:"swim-pie",swimAttributes:{width:"100%","inner-radius":"0","outer-radius":"60","tick-radius":"80","tick-length":"140","tick-color":"#667095","label-radius":"35","label-size":"10","label-color":"#ffffff","title-size":"14","title-color":"#7883aa"},styleAttributes:{"flex-grow":"1"},id:"13245",content:""}]},boxGraphCard:{title:"block chart",width:"100%",height:"100%",backgroundColor:"transparent",display:"flex",flexDirection:"column",layoutElements:[{type:"div",swimAttributes:{},id:"9d2fe39b",styleAttributes:{"flex-grow":"0",height:"6%"},children:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,color:"#555c78",margin:"2%"},id:"661d7ca7",content:"Alerts Distribution by Fan Types & Manufacturers - Al"}]},{type:"div",swimAttributes:{},id:"08734296",styleAttributes:{"flex-grow":"1",display:"flex",height:"77%",width:"100%","flex-direction":"row"},children:[{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":"1",display:"flex","flex-direction":"row",margin:"2%"},id:"440cb5a2",content:"",children:[{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":"1","background-color":"#d4d7e5",border:"solid 1px #b0b6cf",display:"flex","flex-shrink":"0",width:"33%"},id:"96d6d678",children:[{type:"span",swimAttributes:{},styleAttributes:{"flex-grow":1,"border-right":"solid 1px #b0b6cf",display:"flex",overflow:"hidden","text-align":"center","align-items":"center"},id:"054e1d501",children:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"text-align":"center"},id:"24c68b73",content:"Samsung"}],content:""},{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":1,display:"flex","flex-direction":"column"},id:"9ee59edf",content:"",children:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":"1.7","border-bottom":"solid 1px #b0b6cf","text-align":"center","align-items":"center",display:"flex"},id:"7bf10628",content:"",children:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1},id:"75114a32",content:"LG"}]},{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"border-bottom":"solid 1px #b0b6cf",display:"flex","align-items":"center"},id:"d31b2f01",children:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"text-align":"center"},id:"41ec8cdf",content:"LTech"}]},{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,display:"flex","align-items":"center"},id:"e2d38b18",content:"",children:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"text-align":"center"},id:"c6bcc9cb",content:"TEL"}]}]}]},{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":1,"background-color":"#e0e2ec",border:"solid 1px #b0b6cf","flex-shrink":"0",display:"flex",width:"33%"},id:"9179933a",children:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"border-right":"solid 1px #b0b6cf",display:"flex","align-items":"center"},id:"bf5646ce",content:"",children:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"text-align":"center"},id:"7d6b584a",content:"Samsung"}]},{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,display:"flex","flex-direction":"column"},id:"5d5ceb7e",children:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"border-bottom":"solid 1px #b0b6cf",display:"flex","align-items":"center"},id:"ee57a30d",content:"",children:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"text-align":"center"},id:"cf495ff3",content:"XPower"}]},{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"border-bottom":"solid 1px #b0b6cf",display:"flex","align-items":"center"},id:"79576306",children:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"text-align":"center"},id:"9d8db363",content:"Ltech"}]},{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"border-bottom":"solid 1px #b0b6cf",display:"flex","align-items":"center"},id:"0e3f6374",children:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"text-align":"center"},id:"4f77c46e",content:"PG"}]},{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,display:"flex","align-items":"center","border-bottom":"solid 1px #b0b6cf"},id:"f0d5aa9e",children:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"text-align":"center"},id:"cbabebc9",content:"TEL"}]},{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,display:"flex","align-items":"center"},id:"a5e75b9c",children:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"text-align":"center"},id:"3e0bd773",content:"G5"}]}]}]},{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":1,"background-color":"#eeeff5",border:"solid 1px #b0b6cf","flex-shrink":"0",display:"flex",width:"33%"},id:"ecc0feee",content:"",children:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"border-right":"solid 1px #b0b6cf",display:"flex","align-items":"center"},id:"2cba09a0",content:"",children:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"text-align":"center"},id:"132e1d3c",content:"LTech"}]},{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,display:"flex","flex-direction":"column"},id:"e6f25067",children:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"border-bottom":"solid 1px #b0b6cf",display:"flex","align-items":"center"},id:"5e13a780",content:"",children:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"text-align":"center"},id:"28a3260a",content:"PG"}]},{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"border-bottom":"solid 1px #b0b6cf",display:"flex","align-items":"center"},id:"1db161ee",children:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"text-align":"center"},id:"2213f1e8",content:"TEL"}]},{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,display:"flex","align-items":"center"},id:"dd5fcdb8",children:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"text-align":"center"},id:"4e02c462",content:"G5"}]}]}]}]}],content:""},{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":"0",height:"16%",display:"flex",padding:"0px"},id:"165d28d8",children:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,margin:"2%",display:"flex"},id:"aad130ae",children:[{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":"1",display:"flex",width:"33%"},id:"6211555d",children:[{type:"div",swimAttributes:{},styleAttributes:{width:"20px"},id:"c47b2767",children:[{type:"div",swimAttributes:{},styleAttributes:{width:"20px",height:"20px","background-color":"#cccfe0",border:"solid 1px #b7bed9"},id:"c8a005dc"}]},{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,padding:"0 0 0 10px",display:"flex","flex-direction":"column"},id:"309e5643",children:[{type:"swim-text",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"font-size":"12px"},id:"3fa0e788",content:"Fan Type 1 (2 blade)"},{type:"swim-text",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"font-size":"12px"},id:"d4e46fc1",content:"51% of types"},{type:"swim-text",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"font-size":"12px"},id:"ca48ae9d",content:"5 Fan dudes"}]}]},{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":"1",display:"flex",width:"33%"},id:"669c77bc",children:[{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":"0",width:"20px"},id:"b80f830c",children:[{type:"div",swimAttributes:{},styleAttributes:{width:"20px",height:"20px",border:"solid 1px #b7bed9","background-color":"#e0e2ec"},id:"e24df4ae"}]},{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,display:"flex",padding:"0 0 0 10px","flex-direction":"column"},id:"e3502637",children:[{type:"swim-text",swimAttributes:{},styleAttributes:{"flex-grow":1,"font-size":"12px"},id:"ca9b8cf5",content:"Fan Type 2 (3 blade)"},{type:"swim-text",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"font-size":"12px"},id:"108e84d0",content:"26% of Types"},{type:"swim-text",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"font-size":"12px"},id:"6ce8705d",content:"6 Fan Manuf."}]}]},{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":"1",display:"flex",width:"33%"},id:"4090ed1a",children:[{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":"0",width:"20px"},id:"92414999",children:[{type:"div",swimAttributes:{},styleAttributes:{"flex-grow":1,width:"20px",height:"20px",border:"solid 1px #b7bed9","background-color":"#edeef5"},id:"16a7f5a9"}]},{type:"div",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,display:"flex","flex-direction":"column",padding:"0 0 0 10px"},id:"39d43ef0",children:[{type:"swim-text",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"font-size":"12px"},id:"0e561efe",content:"Fan Type 3 (4 blade)"},{type:"swim-text",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"font-size":"12px"},id:"98a4fda1",content:"23% of Types"},{type:"swim-text",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,"font-size":"12px"},id:"8a370100",content:"5 Fan man"}]}]}]}]},{type:"swim-text",swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1,position:"absolute",top:"3%",right:"2%",color:"rgba(85, 92, 120, 0.4)"},id:"5be728c3",content:"GRPNG"}]}},t}(),La=function(){function t(t,e){this.unselectedShadow="rgb(0, 0, 0) 0px 0px 0px 0px",this.selectedShadow="rgba(42, 255, 42, 0.5) 0px 0px 0px 5px",this.highlightedShadow="rgba(255, 42, 42, 0.5) 0px 0px 0px 5px",this.titleFieldTagId="258f66d4",this.widthFieldTagId="1056f91e",this.widthTitleTagId="83fea821",this.heightFieldTagId="e9a054b0",this.heightTitleTagId="1707e5cf",this.bgColorFieldTagId="bf26f39e",this.bgColorTitleTagId="63568108",this.addElementButtonTagId="27e250a2",this.displayTypeTitleTagId="a32edb7c",this.displayTypeFieldTagId="ea01c64a",this.flexTypeTitleTagId="8bf2625c",this.flexTypeFieldTagId="9e5c85a6",this.renderTypeTitleTagId="d23899aa",this.renderTypeFieldTagId="933f721d",this.swimHostUrlLabelId="swimHostUrlLabel",this.swimDataKeysLabelId="452d2af0",this.hostInputFieldId="96af4f65",this.nodeInputFieldId="e299d99c",this.laneInputFieldId="01fa2cb7",this.submitButtonId="917495b7",this.cancelButtonId="0e315fca",this.errorMessageId="353ec5b7",this.titleMessageId="fc14565c",this.keepSyncedFieldId="faf17c1c",this.quiltIdInputFieldId="01fa2cb7",this.nameInputFieldId="e299d99c",this.valueInputFieldId="01fa2cb7",this.loadButtonId="3fcd7fab",this.textAreaInputFieldId="ddb022da",this.addAttributeForm=Ta.getLayout("addAttributeForm"),this.loadJsonDialog=Ta.getLayout("loadJsonDialog"),this.loadListDialog=Ta.getLayout("loadListDialog"),this.mainHeaderMenus=Ta.getLayout("mainHeaderMenus"),this.mainLayoutForm=Ta.getLayout("mainLayoutForm"),this.dataLinkConfigForm=Ta.getLayout("dataLinkConfigForm"),this.quiltConfigForm=Ta.getLayout("quiltConfigForm"),this.flexTestLayout=Ta.getLayout("flexTestLayout"),this.swimLayoutLinkConfig={isSecure:!1,hostUrl:"auto2.swim.services",hostPort:"",node:"/quilt/martin_quilt",lane:"layouts",keepSynced:!0},this.swimDataConfig={isSecure:!1,hostUrl:"",hostPort:"",node:"",lane:"",keepSynced:!1},this.loadJsonDialog=Ta.getLayout("loadJsonDialog"),this.parentElem=t,this.editorPanelDefinition=Ta.getLayout("mainLayoutForm"),this.swimDataSet=e,this.buildBaseEditorLayout(),this.buildLayoutEditorForm(),this.newLayout()}return t.prototype.saveLayout=function(){var t=this.activeLayoutRenderTrack.getLayoutDefinition();t.id||(t.id=Ma.newGuid());var e={id:t.id,title:t.title,width:t.width,height:t.height,backgroundColor:t.backgroundColor,display:t.display,flexDirection:t.flexDirection,layoutElements:t.layoutElements||[],hostUrl:this.swimDataConfig.hostUrl,hostPort:this.swimDataConfig.hostPort,node:this.swimDataConfig.node,lane:this.swimDataConfig.lane,keepSynced:this.swimDataConfig.keepSynced,renderType:t.renderType};this.swimLayoutLink.set(t.id,e)},t.prototype.buildEditorHeader=function(){var t=Fa.create("div");this.headerMenuElement=t.renderLayout(this.mainHeaderMenus);var e=document.getElementById("headerNavigation");e&&e.appendChild(t.node)},t.prototype.openSwimDataLink=function(){var r=this;if(this.headerMenuElement&&this.swimDataConfig&&""!==this.swimDataConfig.hostUrl){var t=this.headerMenuElement.getCachedElement(this.swimHostUrlLabelId),o=this.headerMenuElement.getCachedElement(this.swimDataKeysLabelId);t&&o&&(t.node.innerText="swim://"+this.swimDataConfig.hostUrl+":"+this.swimDataConfig.hostPort+this.swimDataConfig.node+"/"+this.swimDataConfig.lane,o.node.innerHTML=""),this.swimDataConfig.didUpdate=function(t,e){if(r.swimDataLink&&r.updateLayoutDataset(e),r.headerMenuElement&&o&&r.swimDataLink&&e&&""===o.node.innerHTML)for(var i in o.node.innerHTML="&nbsp;<i>Bindings:</i>&nbsp;",e)o.node.innerHTML+="&nbsp;{{"+i+"}}&nbsp;"},this.swimDataLink&&this.swimDataLink.isConnected()&&this.swimDataLink.close()}},t.prototype.buildBaseEditorLayout=function(){this.buildEditorHeader(),this.leftColumnElementTrack=Fa.create("div").elemId("leftColumn"),this.workspaceElementTrack=Fa.create("div").elemId("workspace"),this.rightColumnElementTrack=Fa.create("div").elemId("rightColumn"),this.parentElem.appendChild(this.leftColumnElementTrack.node),this.parentElem.appendChild(this.workspaceElementTrack.node),this.parentElem.appendChild(this.rightColumnElementTrack.node)},t.prototype.buildLayoutEditorForm=function(){var o=this;this.editorFormRenderTrack=this.leftColumnElementTrack.renderLayout(this.mainLayoutForm);var t=this.editorFormRenderTrack.getCachedElement(this.titleFieldTagId),e=this.editorFormRenderTrack.getCachedElement(this.widthFieldTagId),n=this.editorFormRenderTrack.getCachedElement(this.widthTitleTagId),i=this.editorFormRenderTrack.getCachedElement(this.heightFieldTagId),s=this.editorFormRenderTrack.getCachedElement(this.heightTitleTagId),r=this.editorFormRenderTrack.getCachedElement(this.bgColorFieldTagId),a=this.editorFormRenderTrack.getCachedElement(this.bgColorTitleTagId),u=this.editorFormRenderTrack.getCachedElement(this.displayTypeFieldTagId),h=this.editorFormRenderTrack.getCachedElement(this.flexTypeFieldTagId),l=this.editorFormRenderTrack.getCachedElement(this.addElementButtonTagId),p=this.editorFormRenderTrack.getCachedElement(this.renderTypeTitleTagId),c=this.editorFormRenderTrack.getCachedElement(this.renderTypeFieldTagId),d=function(t,e){if(e){var i=e;if(i&&i.srcElement&&i.srcElement.value){var r=i.srcElement.value;switch(t){case"title":o.updateLayoutTitle(r);break;case"width":try{Lo.parse(r)instanceof Object&&(o.updateLayoutWidth(r),n&&n.color(qo.parse("rgb(214,214,214)")))}catch(t){n&&n.color(qo.parse("rgb(255,0,0)"))}break;case"height":try{Lo.parse(r)instanceof Object&&(o.updateLayoutHeight(r),s&&s.color(qo.parse("rgb(214,214,214)")))}catch(t){s&&s.color(qo.parse("rgb(255,0,0)"))}break;case"bgColor":try{qo.parse(r)&&o.updateLayoutBackgroundColor(r),a&&a.color(qo.parse("rgb(214,214,214)"))}catch(t){a&&a.color(qo.parse("rgb(255,0,0)"))}break;case"displayType":o.updateLayoutDisplayType(r);break;case"flexType":o.updateLayoutFlexType(r);break;case"renderType":"json"===r||"recon"===r?(o.updateLayoutRenderType(r),p&&p.color(qo.parse("rgb(214,214,214)"))):p&&p.color(qo.parse("rgb(255,0,0)"))}}}};t&&t.on("keyup",function(t){d("title",t)}),e&&e.on("keyup",function(t){d("width",t)}),i&&i.on("keyup",function(t){d("height",t)}),r&&r.on("keyup",function(t){d("bgColor",t)}),u&&u.on("keyup",function(t){d("displayType",t)}),h&&h.on("keyup",function(t){d("flexType",t)}),c&&c.on("keyup",function(t){d("renderType",t)}),l&&l.on("mouseup",function(t){o.addNewLayoutElement("div")})},t.prototype.buildLayoutAttributePanelLists=function(){this.removeLayoutAttributePanel(),this.layoutAttributesPanelTrack=Fa.create("div"),this.buildLayoutAttributePanel("Core Attributes"),this.buildLayoutAttributePanel("Swim Attributes","swimAttributes"),this.buildLayoutAttributePanel("HTML Attributes","htmlAttributes"),this.buildLayoutAttributePanel("Style Attributes","styleAttributes"),this.rightColumnElementTrack.append(this.layoutAttributesPanelTrack)},t.prototype.buildLayoutAttributePanel=function(t,i,e){var r=this;void 0===i&&(i="core"),void 0===e&&(e=!1);var o=null;o="core"===i?{id:this.selectedLayoutData.id,name:this.selectedLayoutData.name||"",type:this.selectedLayoutData.type,content:this.selectedLayoutData.content||""}:this.selectedLayoutData[i];var n=Fa.create("div").elemId("attributePanel"),s=Fa.create("h3").text(t),a=Fa.create("div").className("addElementButton").text("+");a.node.onmouseup=function(t){r.showAddAttributeDialog(function(t,e){t&&e&&r.addElementAttribute(i,t,e)})},s.append(a),n.append(s);var u=1,h=Fa.create("div");if(e&&(h.append(this.buildAttributeRow(i,"type",this.selectedLayoutData.type)),this.selectedLayoutData.content)){var l=this.buildAttributeRow(i,"content",this.selectedLayoutData.content);l.node.style.backgroundColor="rgba(200, 200, 200, 0.2)",u++,h.append(l)}if(o)for(var p=0,c=Object.keys(o);p<c.length;p++){var d=c[p],f=o[d],y=this.buildAttributeRow(i,d,f);u%2==1&&(y.node.style.backgroundColor="rgba(200, 200, 200, 0.2)"),h.append(y),u++}n.append(h),this.layoutAttributesPanelTrack&&this.layoutAttributesPanelTrack.append(n)},t.prototype.flushSavedTemplates=function(){var i=this;confirm("This will reset all saved templates. Are you sure?")&&this.swimLayoutLink.forEach(function(t){var e=Ta.getLayout(t);e&&i.swimLayoutLink.set(t,e)})},t.prototype.showLinkConfigDialog=function(t){var r=this,e=this.spawnDialog(this.dataLinkConfigForm);if(e){var o=e.getCachedElement(this.hostInputFieldId),n=e.getCachedElement(this.nodeInputFieldId),s=e.getCachedElement(this.laneInputFieldId),i=e.getCachedElement(this.submitButtonId),a=e.getCachedElement(this.cancelButtonId),u=e.getCachedElement(this.errorMessageId),h=e.getCachedElement(this.titleMessageId),l=e.getCachedElement(this.keepSyncedFieldId);o&&n&&i&&s&&a&&u&&h&&l&&(h.text("Configure swim data link"),u.text(""),""!==this.swimDataConfig.hostPort?o.node.value=this.swimDataConfig.hostUrl+":"+this.swimDataConfig.hostPort:o.node.value=""+this.swimDataConfig.hostUrl,n.node.value=this.swimDataConfig.node,s.node.value=this.swimDataConfig.lane,l.node.value=this.swimDataConfig.keepSynced,o.node.focus(),i.on("click",function(t){var e=o.node.value;if(e&&0<=e.indexOf(":")){var i=e.split(":");r.swimDataConfig.hostUrl=i[0],r.swimDataConfig.hostPort=i[1]}else r.swimDataConfig.hostUrl=e,r.swimDataConfig.hostPort="";r.swimDataConfig.node=n.node.value,r.swimDataConfig.lane=s.node.value,r.swimDataConfig.keepSynced=l.node.value,u.node.innerHTML="<span style='color:black'>Connecting Link...</span>",r.swimDataConfig.didUnlink=function(){u.node.innerHTML="Link disconected due to error"},r.swimDataConfig.didFail=function(){u.node.innerHTML="Link failed to connect"},r.swimDataConfig.didLink=function(){u.node.innerHTML="<span style='color:green'>Link Connected</span>"},r.openSwimDataLink()}),a.on("click",function(t){r.swimDataConfig.didUnlink=null,r.swimDataConfig.didLink=null,r.swimDataConfig.didUpdate=function(t){r.swimDataLink&&r.updateLayoutDataset(r.swimDataLink.get(t))}}))}},t.prototype.showQuiltConfigDialog=function(){var r=this,t=this.spawnDialog(this.quiltConfigForm);if(t){var o=t.getCachedElement(this.hostInputFieldId),e=t.getCachedElement(this.nodeInputFieldId),n=t.getCachedElement(this.quiltIdInputFieldId),i=t.getCachedElement(this.submitButtonId),s=t.getCachedElement(this.cancelButtonId),a=t.getCachedElement(this.errorMessageId),u=t.getCachedElement(this.titleMessageId);o&&e&&i&&n&&s&&a&&u&&(u.text("Configure Quilt"),a.text(""),""!==this.swimLayoutLinkConfig.hostPort?o.node.value=this.swimLayoutLinkConfig.hostUrl+":"+this.swimLayoutLinkConfig.hostPort:o.node.value=""+this.swimLayoutLinkConfig.hostUrl,n.node.value=this.swimLayoutLinkConfig.node.replace("/quilt/",""),o.node.focus(),i.on("click",function(t){var e=o.node.value;if(e&&0<=e.indexOf(":")){var i=e.split(":");r.swimLayoutLinkConfig.hostUrl=i[0],r.swimLayoutLinkConfig.hostPort=i[1]}else r.swimLayoutLinkConfig.hostUrl=e,r.swimLayoutLinkConfig.hostPort="";r.swimLayoutLinkConfig.node="/quilt/"+n.node.value,r.swimLayoutLink.close()}),s.on("click",function(t){}))}},t.prototype.showAddAttributeDialog=function(r){if(null!==this.loadJsonDialog){var t=this.spawnDialog(this.addAttributeForm);if(t){var o=t.getCachedElement(this.nameInputFieldId),n=t.getCachedElement(this.valueInputFieldId),e=t.getCachedElement(this.submitButtonId),i=t.getCachedElement(this.cancelButtonId),s=t.getCachedElement(this.errorMessageId);o&&e&&n&&i&&s&&(s.text(""),e.on("click",function(t){var e=o.node.value,i=n.node.value;r(e,i)}),i.on("click",function(t){}))}}},t.prototype.buildAttributeRow=function(e,i,t){var r=this,o=Fa.create("div").className("attributeRow").display("flex").flexDirection("row"),n=Fa.create("div").text(i).className("rowKey"),s=Fa.create("span").className("removeElementButton").text("-");n.append(s),s.node.onmouseup=function(t){confirm("Are you sure you want to delete this element?\r\nThis will also remove any child elements as well and can not be undone")&&r.deleteElementAttribute(e,i)&&o.remove(),t.preventDefault()};var a=Fa.create("div").text(t).className("rowValue");return a.node.setAttribute("contenteditable","true"),a.node.onkeyup=function(t){r.updateSelectedLayoutAttribute(e,i,a.node.innerText)},o.append(n),o.append(a),o},t.prototype.updateSelectedLayoutAttribute=function(t,e,i){var r=!1;if("core"===t)switch(e){case"type":if(""===i)break;this.selectedLayoutData.type!==i&&(this.selectedLayoutData.type=i,r=!0);break;case"name":this.selectedLayoutData.name!==i&&(this.selectedLayoutData.name=i,r=!0);break;case"content":this.selectedLayoutData.content!==i&&(this.selectedLayoutData.content=i,r=!0);break;case"id":this.selectedLayoutData.id!==i&&(this.selectedLayoutData.id=i,r=!0)}else{var o=this.selectedLayoutData[t];o[e]!==i&&(o[e]=i,r=!0)}r&&(this.clearWorkspace(!1),this.setLayoutDefinition(this.activeLayoutDefinition),r=!1)},t.prototype.removeLayoutAttributePanel=function(){this.layoutAttributesPanelTrack&&(this.rightColumnElementTrack.remove(this.layoutAttributesPanelTrack),this.layoutAttributesPanelTrack=null)},t.prototype.loadLayoutFromJson=function(){var e=this;if(null!==this.loadJsonDialog){var t=this.spawnDialog(this.loadJsonDialog);if(t){var i=t.getCachedElement(this.loadButtonId),r=t.getCachedElement(this.cancelButtonId),o=t.getCachedElement(this.textAreaInputFieldId),n=t.getCachedElement(this.errorMessageId);i&&r&&o&&n&&(n.text(""),i.on("click",function(t){try{e.clearWorkspace(!0),e.setLayoutDefinition(JSON.parse(o.node.value))}catch(t){return void n.text(t.toString())}}),r.on("click",function(t){}))}}},t.prototype.loadLayoutFromList=function(){var i=this;if(null!==this.loadJsonDialog){var t=this.spawnDialog(this.loadListDialog);if(t){var e=t.getCachedElement(this.cancelButtonId),r=t.getCachedElement(this.textAreaInputFieldId),o=t.getCachedElement(this.errorMessageId);if(e&&r&&o){var n=Ta.getLayoutList();r.node.innerHTML="";for(var s=function(t){var e=Fa.create("li").width("100%").padding("10px").text(t).color(qo.parse("black")).on("mouseover",function(){e.backgroundColor("rgba(0,0,0,0.3)")}).on("mouseout",function(){e.backgroundColor("transparent")}).on("click",function(){i.clearWorkspace(!0),i.setLayoutDefinition(Ta.getLayout(t))});r.append(e)},a=0,u=n;a<u.length;a++){s(u[a])}o.text(""),e.on("click",function(t){})}}}},t.prototype.loadLayoutFromService=function(){var r=this;if(null!==this.loadJsonDialog){var t=this.spawnDialog(this.loadListDialog);if(t){var e=t.getCachedElement(this.cancelButtonId),o=t.getCachedElement(this.textAreaInputFieldId),i=t.getCachedElement(this.errorMessageId);e&&o&&i&&(o.node.innerHTML="",this.swimLayoutLink.forEach(function(t){var e=r.swimLayoutLink.get(t);if(e){e.id=t;var i=Fa.create("li").width("100%").padding("10px").text(e.title||"No Title").color(qo.parse("black")).on("mouseover",function(){i.backgroundColor("rgba(0,0,0,0.3)")}).on("mouseout",function(){i.backgroundColor("transparent")}).on("click",function(){r.clearWorkspace(!0),r.setLayoutDefinition(e)});o.append(i)}}),i.text(""),e.on("click",function(t){}))}}},t.prototype.newLayout=function(){this.clearWorkspace(!0);var t={id:Ma.newGuid(),title:"New layout",width:"100%",height:"100%",backgroundColor:"transparent",display:"flex",flexDirection:"row",layoutElements:null,hostUrl:"",hostPort:"",node:"",lane:"",keepSynced:!1,renderType:"json"};this.setLayoutDefinition(t)},t.prototype.debugLayout=function(){var t=this.activeLayoutRenderTrack.getLayoutDefinition(),e={id:t.id,title:t.title,width:t.width,height:t.height,backgroundColor:t.backgroundColor,display:t.display,flexDirection:t.flexDirection,layoutElements:t.layoutElements||[],hostUrl:this.swimDataConfig.hostUrl,hostPort:this.swimDataConfig.hostPort,node:this.swimDataConfig.node,lane:this.swimDataConfig.lane,keepSynced:this.swimDataConfig.keepSynced,renderType:"json"};console.log(JSON.stringify(e))},t.prototype.clearWorkspace=function(t){void 0===t&&(t=!1),this.activeLayoutRenderTrack&&this.activeLayoutRenderTrack.destroyLayout(),t&&this.selectLayoutElement()},t.prototype.updateLayoutTitle=function(t){t!==this.activeLayoutDefinition.title&&(this.activeLayoutDefinition.title=t,this.activeLayoutRenderTrack.setLayoutTitle(this.activeLayoutDefinition.title))},t.prototype.updateLayoutWidth=function(t){t!==this.activeLayoutDefinition.width&&(this.activeLayoutDefinition.width=t,this.activeLayoutRenderTrack.setLayoutWidth(this.activeLayoutDefinition.width))},t.prototype.updateLayoutHeight=function(t){t!==this.activeLayoutDefinition.height&&(this.activeLayoutDefinition.height=t,this.activeLayoutRenderTrack.setLayoutHeight(this.activeLayoutDefinition.height))},t.prototype.updateLayoutBackgroundColor=function(t){t!==this.activeLayoutDefinition.backgroundColor&&(this.activeLayoutDefinition.backgroundColor=t,this.activeLayoutRenderTrack.setLayoutBackground(this.activeLayoutDefinition.backgroundColor))},t.prototype.updateLayoutDisplayType=function(t){t!==this.activeLayoutDefinition.backgroundColor&&(this.activeLayoutDefinition.display=t,this.activeLayoutRenderTrack.setLayoutDisplayType(this.activeLayoutDefinition.display))},t.prototype.updateLayoutFlexType=function(t){t!==this.activeLayoutDefinition.flexDirection&&(this.activeLayoutDefinition.flexDirection=t,this.activeLayoutRenderTrack.setLayoutFlexType(this.activeLayoutDefinition.flexDirection))},t.prototype.updateLayoutDataset=function(t){this.swimDataSet=t,this.editorFormRenderTrack.setSwimData(this.swimDataSet)},t.prototype.updateLayoutRenderType=function(t){t!==this.activeLayoutDefinition.flexDirection&&(this.activeLayoutDefinition.renderType=t,this.activeLayoutRenderTrack.setLayoutRenderType(this.activeLayoutDefinition.renderType||"json"))},t.prototype.setLayoutDataValue=function(t){for(var e=0,i=t;e<i.length;e++){var r=i[e],o=r[0],n=r[1];this.swimDataSet[o]=n}this.activeLayoutRenderTrack.setSwimData(this.swimDataSet),this.editorFormRenderTrack.setSwimData(this.swimDataSet)},t.prototype.setLayoutDefinition=function(t){if(this.activeLayoutDefinition=t,this.activeLayoutDefinition){this.activeLayoutRenderTrack=new Ra(this.workspaceElementTrack.node),this.activeLayoutRenderTrack.setLayoutDefinition(this.activeLayoutDefinition),this.activeLayoutDefinition.renderType&&"recon"===this.activeLayoutDefinition.renderType?this.activeLayoutRenderTrack.buildReconLayout():this.activeLayoutRenderTrack.buildJsonLayout(),this.buildLayoutElementList(this.activeLayoutRenderTrack.getLayoutElements());var e=this.editorFormRenderTrack.getCachedElement(this.titleFieldTagId),i=this.editorFormRenderTrack.getCachedElement(this.widthFieldTagId),r=this.editorFormRenderTrack.getCachedElement(this.heightFieldTagId),o=this.editorFormRenderTrack.getCachedElement(this.bgColorFieldTagId),n=this.editorFormRenderTrack.getCachedElement(this.displayTypeFieldTagId),s=this.editorFormRenderTrack.getCachedElement(this.flexTypeFieldTagId),a=this.editorFormRenderTrack.getCachedElement(this.renderTypeFieldTagId);if(e&&(e.node.value=this.activeLayoutDefinition.title),i&&(i.node.value=this.activeLayoutDefinition.width),r&&(r.node.value=this.activeLayoutDefinition.height),o&&(o.node.value=this.activeLayoutDefinition.backgroundColor),n&&(n.node.value=this.activeLayoutDefinition.display),s&&(s.node.value=this.activeLayoutDefinition.flexDirection),a&&(a.node.value=this.activeLayoutDefinition.renderType||"json"),this.swimDataConfig.hostUrl=this.activeLayoutDefinition.hostUrl,this.swimDataConfig.hostPort=this.activeLayoutDefinition.hostPort,this.swimDataConfig.node=this.activeLayoutDefinition.node,this.swimDataConfig.lane=this.activeLayoutDefinition.lane,this.headerMenuElement){var u=this.headerMenuElement.getCachedElement("swimHostUrlLabel"),h=this.headerMenuElement.getCachedElement("452d2af0");u&&h&&(u.node.innerText="",h.node.innerHTML="")}this.swimDataLink&&this.swimDataLink.close&&this.swimDataLink.close(),this.swimDataConfig.hostUrl&&""!==this.swimDataConfig.hostUrl&&this.openSwimDataLink()}},t.prototype.buildLayoutElementList=function(t){this.layoutElementListTrack&&null!==this.layoutElementListTrack&&this.layoutElementListTrack.remove(),this.layoutElementListTrack=Fa.create("div").elemId("layoutElementListContainer").overflow("auto"),this.leftColumnElementTrack.append(this.layoutElementListTrack);var e=[{type:"root",id:"root",children:t}];this.outputLayoutElementsListItems(e,this.layoutElementListTrack)},t.prototype.selectLayoutElement=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),console.info(t,e),this.selectedLayoutElement&&(this.selectedLayoutElement.node.style.boxShadow=this.unselectedShadow,this.selectedLayoutElement=null),this.selectedLayoutElement&&(this.selectedLayoutElement.node.className="",this.selectedLayoutElement=null),e&&(this.selectedLayoutElement=e,this.selectedLayoutElement.node.className="selected");var i=null;t&&"root"!==t.id&&(i=this.activeLayoutRenderTrack.getCachedElement(t.id)),i?(this.selectedLayoutData=t,this.selectedLayoutElement=i,this.selectedLayoutElement.node.style.boxShadow=this.selectedShadow,this.buildLayoutAttributePanelLists()):(this.selectedLayoutData=null,this.selectedLayoutElement=null,this.removeLayoutAttributePanel())},t.prototype.removeElementHightlight=function(){this.selectedLayoutElement&&this.highlightedLayoutElement&&this.selectedLayoutElement.node.id===this.highlightedLayoutElement.node.id||this.highlightedLayoutElement&&(this.highlightedLayoutElement.node.style.boxShadow=this.unselectedShadow,this.highlightedLayoutElement=null)},t.prototype.highlightLayoutElement=function(t){t&&this.selectedLayoutElement&&this.selectedLayoutElement.node.id===t.node.id||(this.highlightedLayoutElement&&this.removeElementHightlight(),this.highlightedLayoutElement=t,this.highlightedLayoutElement&&(this.highlightedLayoutElement.node.style.boxShadow=this.highlightedShadow))},t.prototype.addNewLayoutElement=function(t){void 0===t&&(t="div");var e={type:t,swimAttributes:{width:"100%"},styleAttributes:{"flex-grow":1}};if(this.selectedLayoutElement){var i=this.findLayoutElementById(this.selectedLayoutElement.node.id,this.activeLayoutDefinition.layoutElements);i.children&&i.children.length||(i.children=[]),i.children.push(e)}else null===this.activeLayoutDefinition.layoutElements&&(this.activeLayoutDefinition.layoutElements=[]),this.activeLayoutDefinition.layoutElements.push(e);this.clearWorkspace(!1),this.activeLayoutRenderTrack.setLayoutDefinition(this.activeLayoutDefinition),this.activeLayoutDefinition.renderType&&"recon"===this.activeLayoutDefinition.renderType?this.activeLayoutRenderTrack.buildReconLayout():this.activeLayoutRenderTrack.buildJsonLayout(),this.buildLayoutElementList(this.activeLayoutRenderTrack.getLayoutElements())},t.prototype.addElementAttribute=function(t,e,i){if(void 0===e&&(e="newAttr"),void 0===i&&(i=""),"style"!==e&&"id"!==e)if(""!==e){if(this.selectedLayoutElement){var r=this.findLayoutElementById(this.selectedLayoutElement.node.id,this.activeLayoutDefinition.layoutElements);if("content"===e)r.hasOwnProperty("content")?alert("content already exists"):r.content="new content";else if(r[t]||(r[t]={}),r[t].hasOwnProperty(e))alert("Attribute '"+e+"' already exists");else r[t][e]=i;this.buildLayoutAttributePanelLists(),this.clearWorkspace(!1),this.activeLayoutDefinition.renderType&&"recon"===this.activeLayoutDefinition.renderType?this.activeLayoutRenderTrack.buildReconLayout():this.activeLayoutRenderTrack.buildJsonLayout(),this.buildLayoutElementList(this.activeLayoutRenderTrack.getLayoutElements())}}else alert("Enter an attribute name.");else alert("You can not set the "+e+" manually")},t.prototype.findLayoutElementById=function(t,e){for(var i=null,r=0,o=e;r<o.length;r++){var n=o[r];if(null!==i)break;n.id===t&&(i=n),n.children&&null===i&&(i=this.findLayoutElementById(t,n.children))}return i},t.prototype.findParentElementById=function(t,e,i){void 0===e&&(e=this.activeLayoutDefinition.layoutElements),void 0===i&&(i=null);for(var r=null,o=0,n=e;o<n.length;o++){var s=n[o];if(null!==r)break;s.id===t&&(r=i),s.children&&null===r&&(r=this.findParentElementById(t,s.children,s))}return r},t.prototype.deleteChildElement=function(t,e){if(this.selectLayoutElement(),t){o=[];for(var i=0,r=t.children;i<r.length;i++){(a=r[i]).id!==e.id&&o.push(a)}t.children=o}else{for(var o=[],n=0,s=this.activeLayoutDefinition.layoutElements;n<s.length;n++){var a;(a=s[n]).id!==e.id&&o.push(a)}this.activeLayoutDefinition.layoutElements=o,this.activeLayoutRenderTrack.setLayoutDefinition(this.activeLayoutDefinition)}this.buildLayoutElementList(this.activeLayoutRenderTrack.getLayoutElements()),this.clearWorkspace(!0),this.activeLayoutDefinition.renderType&&"recon"===this.activeLayoutDefinition.renderType?this.activeLayoutRenderTrack.buildReconLayout():this.activeLayoutRenderTrack.buildJsonLayout()},t.prototype.deleteElementAttribute=function(t,e){if("core"===t)return alert("You can not delete core attributes."),!1;var i={},r=this.selectedLayoutData[t];for(var o in r)o!==e&&(i[o]=r[o]);return this.selectedLayoutData[t]=i,this.clearWorkspace(!1),this.activeLayoutDefinition.renderType&&"recon"===this.activeLayoutDefinition.renderType?this.activeLayoutRenderTrack.buildReconLayout():this.activeLayoutRenderTrack.buildJsonLayout(),!0},t.prototype.spawnDialog=function(t){return null},t.prototype.outputLayoutElementsListItems=function(u,t,h){var l=this;void 0===h&&(h=0);for(var p=0,e=function(i){var t="",e="";if(p++,0!==h&&(t=p!==u.length||i.children?"â":"â"),2<=h)for(var r=1;r<h;r++)e+="â";var o=i.name?""+i.name:"<"+i.type+">",n=Fa.create("div").text(""+t+e+" "+o);n.node&&(n.node.id=i.id);var s=Fa.create("span").className("removeElementButton").text("-");if(c.selectedLayoutElement&&c.selectedLayoutElement.node.id===i.id?(c.selectedLayoutElement=n).className("selected"):c.selectedLayoutElement||"root"!==i.id?n.className(""):(c.selectedLayoutElement=n).className("selected"),"root"!==i.id&&(s.node.onmouseup=function(t){if(confirm("Are you sure you want to delete this element?\r\nThis will also remove any child elements as well and can not be undone")){var e=l.findParentElementById(i.id);l.deleteChildElement(e,i)}t.preventDefault(),t.stopPropagation()},n.append(s)),n.node.onmouseover=function(t){"root"===i.id?l.highlightLayoutElement(l.workspaceElementTrack):l.highlightLayoutElement(l.activeLayoutRenderTrack.getCachedElement(i.id)),t.preventDefault(),t.stopPropagation()},n.node.onmouseout=function(t){l.removeElementHightlight(),t.preventDefault(),t.stopPropagation()},n.node.onmouseup=function(t){"root"===i.id?l.selectLayoutElement(null,n):l.selectLayoutElement(i,n),t.preventDefault(),t.stopPropagation()},c.layoutElementListTrack.append(n),i.children&&0<i.children.length){var a=h+1;c.outputLayoutElementsListItems(i.children,n,a)}},c=this,i=0,r=u;i<r.length;i++){e(r[i])}},t}(),Fa=function(i){function e(t,e){return i.call(this,t,e)||this}return v(e,i),e.prototype.width=function(t,e){return this.styleLengthEnum("width",t,e,as.REQUIRES_RESIZE)},e.prototype.minWidth=function(t,e){return this.styleLengthEnum("min-width",t,e)},e.prototype.maxWidth=function(t,e){return this.styleLengthEnum("max-width",t,e)},e.prototype.height=function(t,e){return this.styleLengthEnum("height",t,e,as.REQUIRES_RESIZE)},e.prototype.minHeight=function(t,e){return this.styleLengthEnum("min-height",t,e)},e.prototype.maxHeight=function(t,e){return this.styleLengthEnum("max-height",t,e)},e.prototype.type=function(t,e){return this.attribute("type",t,e)},e.prototype.value=function(t,e){return this.attribute("value",t,e)},e.prototype.placeholder=function(t,e){return this.attribute("placeholder",t,e)},e.prototype.autocomplete=function(t,e){return this.attribute("autocomplete",t,e)},e.prototype.selected=function(t,e){return this.attributeBoolean("selected",t,e)},e.prototype.checked=function(t,e){return this.attributeBoolean("checked",t,e)},e.prototype.disabled=function(t,e){return this.attributeBoolean("disabled",t,e)},e.prototype.title=function(t,e){return this.attribute("title",t,e)},e.prototype.display=function(t,e){return this.styleEnum("display",t,e)},e.prototype.visibility=function(t,e){return this.styleEnum("visibility",t,e)},e.prototype.position=function(t,e){return this.styleEnum("position",t,e)},e.prototype.justifyContent=function(t,e){return this.styleEnum("justify-content",t,e)},e.prototype.alignContent=function(t,e){return this.styleEnum("align-content",t,e)},e.prototype.alignItems=function(t,e){return this.styleEnum("align-items",t,e)},e.prototype.alignSelf=function(t,e){return this.styleEnum("align-self",t,e)},e.prototype.flexDirection=function(t,e){return this.styleEnum("flex-direction",t,e)},e.prototype.flexWrap=function(t,e){return this.styleEnum("flex-wrap",t,e)},e.prototype.flexGrow=function(t,e){return this.styleNumber("flex-grow",t,e)},e.prototype.flexShrink=function(t,e){return this.styleNumber("flex-shrink",t,e)},e.prototype.flexBasis=function(t,e){return this.styleLengthEnum("flex-basis",t,e)},e.prototype.order=function(t,e){return this.styleNumber("order",t,e)},e.prototype.verticalAlign=function(t,e){return this.styleLengthEnum("vertical-align",t,e)},e.prototype.overflowX=function(t,e){return this.styleEnum("overflow-x",t,e)},e.prototype.overflowY=function(t,e){return this.styleEnum("overflow-y",t,e)},e.prototype.overflow=function(t,e){return this.styleEnum("overflow",t,e)},e.prototype.pointerEvents=function(t,e){return this.styleEnum("pointer-events",t,e)},e.prototype.cursor=function(t,e){return this.styleEnum("cursor",t,e)},e.prototype.opacity=function(t,e){return this.styleNumber("opacity",t,e)},e.prototype.backgroundColor=function(t,e){return this.styleColor("background-color",t,e)},e.prototype.backdropFilter=function(t,e){return this.style("backdrop-filter",t,e)},e.prototype.filter=function(t,e){return this.style("filter",t,e)},e.prototype.boxShadow=function(t,e){null!=t&&(t=vs.fromAny(t));var i=this.style("box-shadow",t,e);return"string"==typeof i&&(i=vs.fromAny(i)),i},e.prototype.boxSizing=function(t,e){return this.styleEnum("box-sizing",t,e)},e.prototype.transform=function(t,e){return this.styleTransform("transform",t,e)},e.prototype.top=function(t,e){return this.styleLengthEnum("top",t,e)},e.prototype.right=function(t,e){return this.styleLengthEnum("right",t,e)},e.prototype.bottom=function(t,e){return this.styleLengthEnum("bottom",t,e)},e.prototype.left=function(t,e){return this.styleLengthEnum("left",t,e)},e.prototype.marginTop=function(t,e){return this.styleLengthEnum("margin-top",t,e)},e.prototype.marginRight=function(t,e){return this.styleLengthEnum("margin-right",t,e)},e.prototype.marginBottom=function(t,e){return this.styleLengthEnum("margin-bottom",t,e)},e.prototype.marginLeft=function(t,e){return this.styleLengthEnum("margin-left",t,e)},e.prototype.margin=function(t,e){return void 0===t?[this.marginTop(),this.marginRight(),this.marginBottom(),this.marginLeft()]:(Array.isArray(t)?(1<=t.length&&this.marginTop(t[0],e),2<=t.length&&this.marginRight(t[1],e),3<=t.length&&this.marginBottom(t[2],e),4<=t.length&&this.marginLeft(t[3],e)):(this.marginTop(t,e),this.marginRight(t,e),this.marginBottom(t,e),this.marginLeft(t,e)),this)},e.prototype.paddingTop=function(t,e){return this.styleLength("padding-top",t,e)},e.prototype.paddingRight=function(t,e){return this.styleLength("padding-right",t,e)},e.prototype.paddingBottom=function(t,e){return this.styleLength("padding-bottom",t,e)},e.prototype.paddingLeft=function(t,e){return this.styleLength("padding-left",t,e)},e.prototype.padding=function(t,e){return void 0===t?[this.paddingTop(),this.paddingRight(),this.paddingBottom(),this.paddingLeft()]:(Array.isArray(t)?(1<=t.length&&this.paddingTop(t[0],e),2<=t.length&&this.paddingRight(t[1],e),3<=t.length&&this.paddingBottom(t[2],e),4<=t.length&&this.paddingLeft(t[3],e)):(this.paddingTop(t,e),this.paddingRight(t,e),this.paddingBottom(t,e),this.paddingLeft(t,e)),this)},e.prototype.borderTopWidth=function(t,e){return this.styleLengthEnum("border-top-width",t,e)},e.prototype.borderRightWidth=function(t,e){return this.styleLengthEnum("border-right-width",t,e)},e.prototype.borderBottomWidth=function(t,e){return this.styleLengthEnum("border-bottom-width",t,e)},e.prototype.borderLeftWidth=function(t,e){return this.styleLengthEnum("border-left-width",t,e)},e.prototype.borderWidth=function(t,e){return void 0===t?[this.borderTopWidth(),this.borderRightWidth(),this.borderBottomWidth(),this.borderLeftWidth()]:(Array.isArray(t)?(1<=t.length&&this.borderTopWidth(t[0],e),2<=t.length&&this.borderRightWidth(t[1],e),3<=t.length&&this.borderBottomWidth(t[2],e),4<=t.length&&this.borderLeftWidth(t[3],e)):(this.borderTopWidth(t,e),this.borderRightWidth(t,e),this.borderBottomWidth(t,e),this.borderLeftWidth(t,e)),this)},e.prototype.borderTopStyle=function(t,e){return this.styleEnum("border-top-style",t,e)},e.prototype.borderRightStyle=function(t,e){return this.styleEnum("border-right-style",t,e)},e.prototype.borderBottomStyle=function(t,e){return this.styleEnum("border-bottom-style",t,e)},e.prototype.borderLeftStyle=function(t,e){return this.styleEnum("border-left-style",t,e)},e.prototype.borderStyle=function(t,e){return void 0===t?[this.borderTopStyle(),this.borderRightStyle(),this.borderBottomStyle(),this.borderLeftStyle()]:(Array.isArray(t)?(1<=t.length&&this.borderTopStyle(t[0],e),2<=t.length&&this.borderRightStyle(t[1],e),3<=t.length&&this.borderBottomStyle(t[2],e),4<=t.length&&this.borderLeftStyle(t[3],e)):(this.borderTopStyle(t,e),this.borderRightStyle(t,e),this.borderBottomStyle(t,e),this.borderLeftStyle(t,e)),this)},e.prototype.borderTopColor=function(t,e){return this.styleColorEnum("border-top-color",t,e)},e.prototype.borderRightColor=function(t,e){return this.styleColorEnum("border-right-color",t,e)},e.prototype.borderBottomColor=function(t,e){return this.styleColorEnum("border-bottom-color",t,e)},e.prototype.borderLeftColor=function(t,e){return this.styleColorEnum("border-left-color",t,e)},e.prototype.borderColor=function(t,e){return void 0===t?[this.borderTopColor(),this.borderRightColor(),this.borderBottomColor(),this.borderLeftColor()]:(Array.isArray(t)?(1<=t.length&&this.borderTopColor(t[0],e),2<=t.length&&this.borderRightColor(t[1],e),3<=t.length&&this.borderBottomColor(t[2],e),4<=t.length&&this.borderLeftColor(t[3],e)):(this.borderTopColor(t,e),this.borderRightColor(t,e),this.borderBottomColor(t,e),this.borderLeftColor(t,e)),this)},e.prototype.borderTopLeftRadius=function(t,e){return this.styleLength("border-top-left-radius",t,e)},e.prototype.borderTopRightRadius=function(t,e){return this.styleLength("border-top-right-radius",t,e)},e.prototype.borderBottomRightRadius=function(t,e){return this.styleLength("border-bottom-right-radius",t,e)},e.prototype.borderBottomLeftRadius=function(t,e){return this.styleLength("border-bottom-left-radius",t,e)},e.prototype.borderRadius=function(t,e){return this.styleLength("border-radius",t,e)},e.prototype.borderCollapse=function(t,e){return this.styleEnum("border-collapse",t,e)},e.prototype.borderSpacing=function(t,e){return this.style("border-spacing",t,e)},e.prototype.outlineWidth=function(t,e){return this.styleLengthEnum("outline-width",t,e)},e.prototype.outlineStyle=function(t,e){return this.styleEnum("outline-style",t,e)},e.prototype.outlineColor=function(t,e){return this.styleColorEnum("outline-color",t,e)},e.prototype.appearance=function(t,e){return this.styleEnum("appearance",t,e)},e.prototype.zIndex=function(t,e){return this.styleNumberEnum("z-index",t,e)},e.prototype.fontFamily=function(t,e){return this.style("font-family",t,e)},e.prototype.fontSize=function(t,e){return this.styleLengthEnum("font-size",t,e)},e.prototype.fontStyle=function(t,e){return this.styleEnum("font-style",t,e)},e.prototype.fontWeight=function(t,e){return this.styleEnum("font-weight",t,e)},e.prototype.fontVariant=function(t,e){return this.style("font-variant",t,e)},e.prototype.lineHeight=function(t,e){return"number"==typeof t&&(t=Lo.fromAny(t,"")),this.styleLengthEnum("line-height",t,e)},e.prototype.textTransform=function(t,e){return this.styleEnum("text-transform",t,e)},e.prototype.textOverflow=function(t,e){return this.style("text-overflow",t,e)},e.prototype.textAlign=function(t,e){return this.styleEnum("text-align",t,e)},e.prototype.textDecorationLine=function(t,e){return this.style("text-decoration-line",t,e)},e.prototype.textDecorationStyle=function(t,e){return this.styleEnum("text-decoration-style",t,e)},e.prototype.textDecorationColor=function(t,e){return this.styleColorEnum("text-decoration-color",t,e)},e.prototype.whiteSpace=function(t,e){return this.styleEnum("white-space",t,e)},e.prototype.userSelect=function(t,e){return this.styleEnum("-webkit-user-select",t,e),this.styleEnum("-moz-user-select",t,e),this.styleEnum("-ms-user-select",t,e),this.styleEnum("user-select",t,e)},e.prototype.color=function(t,e){return this.styleColorEnum("color",t,e)},e.prototype.fill=function(t,e){return this.styleColorEnum("fill",t,e)},e.prototype.fillRule=function(t,e){return this.style("fill-rule",t,e)},e.prototype.stroke=function(t,e){return this.styleColorEnum("stroke",t,e)},e.prototype.strokeWidth=function(t,e){return this.styleNumber("stroke-width",t,e)},e.prototype.strokeDashArray=function(t,e){return this.styleNumber("stroke-dasharray",t,e)},e.prototype.createChildView=function(t){return e.create(t)},e.prototype.append=function(t){return i.prototype.append.call(this,t)},e.prototype.prepend=function(t){return i.prototype.prepend.call(this,t)},e.prototype.insertBefore=function(t,e){return i.prototype.insertBefore.call(this,t,e)},e.prototype.renderLayout=function(t){this.node.innerHTML="";var e=new Ra(this.node);return e.setLayoutDefinition(t),t.renderType&&"recon"===t.renderType?e.buildReconLayout():e.buildJsonLayout(),e},e.create=function(t){return t instanceof _a?t:"string"==typeof t?new ga.HtmlView(document.createElement(t)):t.view?t.view:t instanceof HTMLElement?new ga.HtmlView(t):t instanceof SVGElement?new ga.SvgView(t):t instanceof Element?new ga.ElemView(t):t instanceof Text?new ga.TextView(t):new _a(t)},e}(Aa);ga.HtmlView=Fa;var Ia=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e}(Ea),za=function(u){function t(){return null!==u&&u.apply(this,arguments)||this}return v(t,u),t.prototype.materializeView=function(o,t,n,s,a,u){void 0===u&&(u=a);var h=F.empty();return t.forEach(function(t){if(t instanceof P&&t.key.value===a)if(t.value instanceof F){h.attr(u);var r=F.empty(1+t.value.length).attr("attrs");t.value.forEach(function(t){if(t instanceof R){var e=t.key.value,i="";t.value instanceof L?t.value.forEach(function(t){t.value instanceof O?(console.info(t.value),i+=t.key+": "+t.value+"; "):i+=t+"; "}):i=t.value.value,o.node.setAttribute(e,i)}r.push(t)},this),h.push(r)}else a!==u?h.attr(u,t.value):h.push(t);else{if(t instanceof R){var e=t.key.value;if("style"===e){var i="";t.value instanceof L?t.value.forEach(function(t){t.value instanceof O?i+=t.key+": "+t.value+"; ":i+=t+"; "}):i=t.value.value,o.node.setAttribute(e,i)}}(t=this.materializeViewParam(o,t,n,s,!1))instanceof F&&void 0===t.tag?t.forEach(function(t){(t=this.materializeViewParam(o,t,n,s,!0))instanceof b&&t.isDefined()&&h.push(t)},this):t instanceof b&&t.isDefined()&&h.push(t)}},this),h},t.prototype.materializeViewParam=function(t,e,i,r,o){if(e instanceof O){var n=lu.create(e.value);return t.append(n),n}if(e instanceof w){var s=r.castView(e.toValue(),i,r);if(s instanceof _a)return t.append(s),s;if(s instanceof ga)return t.appendChildView(s),s;if(o&&e.isDefined()&&void 0===e.tag){n=lu.create();var a=F.empty(1).attr("text",e);return n.setModel(a),n}}return u.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModel=function(e,t,i,r,o){var n=F.empty();return t.forEach(function(t){(t=this.materializeModelParam(e,t,i,r,o))instanceof b&&t.isDefined()&&n.push(t)},this),n},t.prototype.materializeModelParam=function(t,e,i,r,o){return e instanceof P&&e.key.value===o?b.Absent:u.prototype.materializeModelParam.call(this,t,e,i,r)},t}(Ca),Ua=function(i){function t(t){var e=i.call(this)||this;return e.tag=t,e}return v(t,i),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=Fa.create(this.tag),o=this.materializeView(r,t,e,i,this.tag);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new Ia,o=this.materializeModel(r,t,e,i,this.tag);return r.setData(o),r}},t}(za);ma.addGlobal(new Ua("main")),ma.addGlobal(new Ua("article")),ma.addGlobal(new Ua("section")),ma.addGlobal(new Ua("nav")),ma.addGlobal(new Ua("aside")),ma.addGlobal(new Ua("h1")),ma.addGlobal(new Ua("h2")),ma.addGlobal(new Ua("h3")),ma.addGlobal(new Ua("h4")),ma.addGlobal(new Ua("h5")),ma.addGlobal(new Ua("h6")),ma.addGlobal(new Ua("hgroup")),ma.addGlobal(new Ua("header")),ma.addGlobal(new Ua("footer")),ma.addGlobal(new Ua("address")),ma.addGlobal(new Ua("p")),ma.addGlobal(new Ua("hr")),ma.addGlobal(new Ua("pre")),ma.addGlobal(new Ua("blockquote")),ma.addGlobal(new Ua("ol")),ma.addGlobal(new Ua("ul")),ma.addGlobal(new Ua("menu")),ma.addGlobal(new Ua("li")),ma.addGlobal(new Ua("dl")),ma.addGlobal(new Ua("dt")),ma.addGlobal(new Ua("dd")),ma.addGlobal(new Ua("figure")),ma.addGlobal(new Ua("figcaption")),ma.addGlobal(new Ua("main")),ma.addGlobal(new Ua("div")),ma.addGlobal(new Ua("a")),ma.addGlobal(new Ua("em")),ma.addGlobal(new Ua("strong")),ma.addGlobal(new Ua("small")),ma.addGlobal(new Ua("s")),ma.addGlobal(new Ua("cite")),ma.addGlobal(new Ua("q")),ma.addGlobal(new Ua("dfn")),ma.addGlobal(new Ua("abbr")),ma.addGlobal(new Ua("ruby")),ma.addGlobal(new Ua("rt")),ma.addGlobal(new Ua("rp")),ma.addGlobal(new Ua("data")),ma.addGlobal(new Ua("time")),ma.addGlobal(new Ua("code")),ma.addGlobal(new Ua("var")),ma.addGlobal(new Ua("samp")),ma.addGlobal(new Ua("kbd")),ma.addGlobal(new Ua("sub")),ma.addGlobal(new Ua("sup")),ma.addGlobal(new Ua("i")),ma.addGlobal(new Ua("b")),ma.addGlobal(new Ua("u")),ma.addGlobal(new Ua("mark")),ma.addGlobal(new Ua("bdi")),ma.addGlobal(new Ua("bdo")),ma.addGlobal(new Ua("span")),ma.addGlobal(new Ua("br")),ma.addGlobal(new Ua("wbr")),ma.addGlobal(new Ua("a")),ma.addGlobal(new Ua("ins")),ma.addGlobal(new Ua("del")),ma.addGlobal(new Ua("picture")),ma.addGlobal(new Ua("source")),ma.addGlobal(new Ua("img")),ma.addGlobal(new Ua("iframe")),ma.addGlobal(new Ua("embed")),ma.addGlobal(new Ua("object")),ma.addGlobal(new Ua("param")),ma.addGlobal(new Ua("video")),ma.addGlobal(new Ua("audio")),ma.addGlobal(new Ua("track")),ma.addGlobal(new Ua("table")),ma.addGlobal(new Ua("caption")),ma.addGlobal(new Ua("colgroup")),ma.addGlobal(new Ua("col")),ma.addGlobal(new Ua("tbody")),ma.addGlobal(new Ua("thead")),ma.addGlobal(new Ua("tfoot")),ma.addGlobal(new Ua("tr")),ma.addGlobal(new Ua("td")),ma.addGlobal(new Ua("th")),ma.addGlobal(new Ua("form")),ma.addGlobal(new Ua("label")),ma.addGlobal(new Ua("input")),ma.addGlobal(new Ua("button")),ma.addGlobal(new Ua("select")),ma.addGlobal(new Ua("datalist")),ma.addGlobal(new Ua("optgroup")),ma.addGlobal(new Ua("option")),ma.addGlobal(new Ua("textarea")),ma.addGlobal(new Ua("output")),ma.addGlobal(new Ua("progress")),ma.addGlobal(new Ua("meter")),ma.addGlobal(new Ua("fieldset")),ma.addGlobal(new Ua("legend")),ma.addGlobal(new Ua("details")),ma.addGlobal(new Ua("summary")),ma.addGlobal(new Ua("dialog")),ma.addGlobal(new Ua("script")),ma.addGlobal(new Ua("noscript"));var Oa,Wa,Ba=function(n){function o(t,e,i,r){var o=n.call(this,t,i,r)||this;return o.update(i),o.view=t.view||t,o.parent=t.animator,o.key=e,o}return v(o,n),o.prototype.update=function(t){this.key&&this.view[this.key](t)},o.prototype.getProperty=function(){this.key&&this.view[this.key]()},o.prototype.setProperty=function(t){this.key&&(null===t?this.parent[this.key]=void 0:(this.view[this.key](t),this.parent.animate()))},o.get=function(t,e){return t.view[e]()},o.set=function(t,e,i){null===i?t.animator[e]=void 0:((t.view||t)[e](i),t.animator.animate())},o.animator=function(t,e,i,r){return void 0===i||t.animator[e]||(t.animator[e]=new o(t,e,i,r)),t.animator[e]},o}(ps),qa=function(n){function o(t,e,i,r){var o=n.call(this,t,i,r)||this;return o.view=t.view,o.parent=t.animator,o.key=e,o}return v(o,n),o.prototype.update=function(t){this.key&&this.view[this.key](t)},o.prototype.getProperty=function(){this.key&&this.view[this.key]()},o.prototype.setProperty=function(t){this.key&&(null===t?this.parent[this.key]=void 0:(this.view[this.key](t),this.parent.animate()))},o.get=function(t,e){return t.view[e]()},o.set=function(t,e,i){null===i?t.animator[e]=void 0:(t.view[e](i),t.animator.animate())},o.animator=function(t,e,i,r){return void 0===i||t.animator[e]||(t.animator[e]=new o(t,e,i,r)),t.animator[e]},o}(ps),Ga=function(n){function o(t,e,i,r){var o=n.call(this,t,i,r)||this;return o.view=t.view,o.parent=t.animator,o.key=e,o}return v(o,n),o.prototype.update=function(t){this.key&&this.view[this.key](t)},o.prototype.getProperty=function(){this.key&&this.view[this.key]()},o.prototype.setProperty=function(t){this.key&&(null===t?this.parent[this.key]=void 0:(this.view[this.key](t),this.parent.animate()))},o.get=function(t,e){return t.view[e]()},o.set=function(t,e,i){null===i?t.animator[e]=void 0:(t.view[e](i),t.animator.animate())},o.animator=function(t,e,i,r){return void 0===i||t.animator[e]||(t.animator[e]=new o(t,e,i,r)),t.animator[e]},o}(ps),Na=function(n){function o(t,e,i,r){var o=n.call(this,t,i,r)||this;return o.view=t.view,o.parent=t.animator,o.key=e,o}return v(o,n),o.prototype.update=function(t){this.key&&this.view[this.key](t)},o.prototype.getProperty=function(){this.key&&this.view[this.key]()},o.prototype.setProperty=function(t){this.key&&(null===t?this.parent[this.key]=void 0:(this.view[this.key](t),this.parent.animate()))},o.get=function(t,e){return t.view[e]()},o.set=function(t,e,i){null===i?t.animator[e]=void 0:(t.view[e](i),t.animator.animate())},o.animator=function(t,e,i,r){return void 0===i||t.animator[e]||(t.animator[e]=new o(t,e,i,r)),t.animator[e]},o}(ps);(Wa=Oa||(Oa={}))[Wa.Hidden=0]="Hidden",Wa[Wa.Showing=1]="Showing",Wa[Wa.Visible=2]="Visible",Wa[Wa.Hiding=3]="Hiding";var Ha=function(r){function t(t,e){var i=r.call(this)||this;return i.popover=t,i.popoverState=e,i}return v(t,r),t.prototype.onFrame=function(t){for(var e in this)this[e]instanceof ps&&this[e].onFrame(t);this.update()},t.prototype.show=function(t){return(0===this.popoverState||3===this.popoverState)&&(t=jn.fromAny(t||!0,1),this.opacity||(t.f||(t=t.range(0)),this.opacity=new ja(this,0,t)),this.popover.willShow(),this.popover.node.style.setProperty("pointer-events","auto"),this.popoverState=1,this.opacity.set(1,t),!0)},t.prototype.hide=function(t){return(2===this.popoverState||1===this.popoverState)&&(t=jn.fromAny(t||!0,0),this.opacity||(t.f||(t=t.range(1)),this.opacity=new ja(this,1,t)),this.popover.willHide(),this.popover.node.style.setProperty("pointer-events","none"),this.popoverState=3,this.opacity.set(0,t),!0)},t.prototype.update=function(){this.popover.place(),this.popover.render()},t}(us),ja=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.update=function(t){this.parent.popover.node.style.setProperty("opacity",""+t)},o.prototype.onEnd=function(t){1===this.parent.popoverState?(this.parent.popover.node.style.setProperty("pointer-events","auto"),this.parent.popoverState=2,this.parent.popover.didShow()):3===this.parent.popoverState&&(this.parent.popover.node.style.setProperty("pointer-events","none"),this.parent.popoverState=0,this.parent.popover.didHide())},o.get=function(t){return+t.node.style.getPropertyValue("opacity")},o.set=function(t,e){null===e?(t.animator.opacity=void 0,t.node.style.removeProperty("opacity")):t.node.style.setProperty("opacity",""+e)},o.animator=function(t,e,i){return void 0===e||t.animator.opacity||(t.animator.opacity=new o(t.animator,e,i)),t.animator.opacity},o}(ps),Ka=function(p){function e(t){var e=p.call(this,t.node)||this;return e.view=t,e._source=null,e._sourceZIndex=null,e._replaceDelay=0,e.resizeObserver=null,e.mutationObserver=null,e.replaceTimer=0,e.animator=new Ha(e.view,0),e.replace=e.replace.bind(e),e.onResize=e.onResize.bind(e),e.onMutation=e.onMutation.bind(e),e.onClick=e.onClick.bind(e),e.node.addEventListener("click",e.onClick),e}return v(e,p),e.prototype.isVisible=function(){return 2===this.animator.popoverState||1===this.animator.popoverState},e.prototype.isViewable=function(){return!0},e.prototype.show=function(t){return this.view.addObserver(this),this.animator.show(t)&&(this.observeSource(this._source),(null!==this._sourceZIndex&&this._source instanceof HTMLElement||this._source instanceof SVGElement)&&this._source.style.setProperty("z-index",""+this._sourceZIndex)),this},e.prototype.hide=function(t){return this.animator.hide(t),this},e.prototype.opacity=function(t,e){return this.propertyNumber(ja,t,e)},e.prototype.placement=function(t){return void 0===t?this.view.placement():(this.view.placement(t),this)},e.prototype.source=function(t){var e=this._source;return void 0===t?e:(e!==t?(this.view.sourceWillChange(t,e),this.unobserveSource(e),(this._source=t)&&(this.replace(),this.observeSource(t)),this.view.sourceDidChange(t,e)):t&&this.replace(),this)},e.prototype.sourceLeft=function(t,e){return this.propertyKeyLength(qa,"sourceLeft",t,e)},e.prototype.sourceTop=function(t,e){return this.propertyKeyLength(qa,"sourceTop",t,e)},e.prototype.sourceWidth=function(t,e){return this.propertyKeyLength(qa,"sourceWidth",t,e)},e.prototype.sourceHeight=function(t,e){return this.propertyKeyLength(qa,"sourceHeight",t,e)},e.prototype.sourceZIndex=function(t){return void 0===t?this._sourceZIndex:(this._sourceZIndex=t,this)},e.prototype.replaceDelay=function(t){return void 0===t?this._replaceDelay:(this._replaceDelay=t,this)},e.prototype.render=function(){this.animator.update()},e.prototype.didResize=function(){p.prototype.didResize.call(this),this.onReplace()},e.prototype.addObserver=function(t){this.view.addObserver(t)},e.prototype.removeObserver=function(t){this.view.removeObserver(t)},e.prototype.observeSource=function(t){t&&(this.resizeObserver||(this.resizeObserver=new Xn(this.onResize)),this.mutationObserver||(this.mutationObserver=new MutationObserver(this.onMutation)),this.resizeObserver.observe(t),this.mutationObserver.observe(t,{attributes:!0,childList:!0,subtree:!0,attributeFilter:["style"]}))},e.prototype.unobserveSource=function(t){t&&(this.resizeObserver&&this.resizeObserver.unobserve(t),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null))},e.prototype.replace=function(){this.replaceTimer=0;for(var t=this._source;t&&!(t instanceof HTMLElement);)t=t.parentNode||t.host;if(t){var e=t.getBoundingClientRect(),i=e.left-t.offsetLeft,r=e.top-t.offsetTop,o=this.node.getBoundingClientRect(),n=o.left-this.node.offsetLeft,s=o.top-this.node.offsetTop;this.view.sourceLeft(t.offsetLeft+i-n),this.view.sourceTop(t.offsetTop+r-s),this.view.sourceWidth(t.offsetWidth),this.view.sourceHeight(t.offsetHeight),this.animator.update()}},e.prototype.onReplace=function(){this._replaceDelay<0?this.replace():0===this.replaceTimer&&(this.replaceTimer=setTimeout(this.replace,this._replaceDelay))},e.prototype.onResize=function(t){this.onReplace()},e.prototype.onMutation=function(t){this.onReplace()},e.prototype.onClick=function(t){t.stopPropagation()},e.prototype.popoverDidPlace=function(t,e){this.requireReview(),this.requireResize()},e.prototype.popoverWillShow=function(t){this.requireReview(),this.requireResize()},e.prototype.popoverDidShow=function(t){this.requireReview(),this.requireResize()},e.prototype.popoverDidHide=function(t){(null!==this._sourceZIndex&&this._source instanceof HTMLElement||this._source instanceof SVGElement)&&this._source.style.removeProperty("z-index"),this.replaceTimer&&(clearTimeout(this.replaceTimer),this.replaceTimer=0),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null),this.view.removeObserver(this)},e.prototype.didSetState=function(t,e){p.prototype.didSetState.call(this,t,e);var i=t.get("transition").cast(jn.Form),r=t.get("backgroundColor").cast(qo.Form);r&&this.propertyKeyColor(Na,"backgroundColor",r,i);var o=t.get("borderRadius").cast(Lo.Form);o&&this.propertyKeyLength(qa,"borderRadius",o,i);var n=t.get("arrowWidth").cast(Lo.Form);n&&this.propertyKeyLength(qa,"arrowWidth",n,i);var s=t.get("arrowHeight").cast(Lo.Form);s&&this.propertyKeyLength(qa,"arrowHeight",s,i);var a=t.get("viewportLeft").cast(Lo.Form);a&&this.propertyKeyLength(qa,"viewportLeft",a,i);var u=t.get("viewportRight").cast(Lo.Form);u&&this.propertyKeyLength(qa,"viewportRight",u,i);var h=t.get("viewportTop").cast(Lo.Form);h&&this.propertyKeyLength(qa,"viewportTop",h,i);var l=t.get("viewportBottom").cast(Lo.Form);l&&this.propertyKeyLength(qa,"viewportBottom",l,i)},e.create=function(t){if(t instanceof e)return t;if(t instanceof _a)throw new TypeError(""+t);if(void 0===t||"string"==typeof t)return new e(ms.create(t));if(t.view instanceof e)return t.view;if(t.view)throw new TypeError(""+t.view);if(t instanceof HTMLElement)return new e(new ms(t));throw new TypeError(""+t)},e}(Fa),Ya=function(e){function t(t){return e.call(this,t)||this}return v(t,e),t.Params=Ia.Params.concat([new qs("backgroundColor",q.get("backgroundColor").or(q.get("popover").get("backgroundColor"))),new qs("borderRadius",q.get("borderRadius").or(q.get("popover").get("borderRadius"))),new qs("arrowWidth",q.get("arrowWidth").or(q.get("popover").get("arrowWidth"))),new qs("arrowHeight",q.get("arrowHeight").or(q.get("popover").get("arrowHeight"))),new qs("viewportLeft",q.get("viewportLeft").or(q.get("popover").get("viewportLeft"))),new qs("viewportRight",q.get("viewportRight").or(q.get("popover").get("viewportRight"))),new qs("viewportTop",q.get("viewportTop").or(q.get("popover").get("viewportTop"))),new qs("viewportBottom",q.get("viewportBottom").or(q.get("popover").get("viewportBottom")))]),t}(Ia),Xa=function(l){function e(t){var e=l.call(this,t)||this;return e.display("flex").visibility("hidden").position("absolute").placement(["top","bottom","right","left"]).borderRadius(3),e}return v(e,l),e.prototype.sourceSize=function(t){return void 0===t?this._sourceSize:(this._sourceSize=t||0,this)},e.prototype.setPivot=function(t,e,i){this._boundView=t,this._x=e||0,this._y=i||0,this.replace()},e.prototype.viewPort=function(){},e.prototype.replace=function(){if(this._boundView){var t=this._sourceSize||10,e=this._sourceSize||10,i=this._boundView.node.getBoundingClientRect(),r=i.left,o=i.top,n=this.node.getBoundingClientRect(),s=n.left-this.node.offsetLeft,a=n.top-this.node.offsetTop,u=Math.round(this._x-t/2+r-s),h=Math.round(this._y-e/2+o-a);u===this.view.sourceLeft().pxValue()&&h===this.view.sourceTop().pxValue()||(this.view.sourceLeft(u),this.view.sourceTop(h),this.view.sourceWidth(t),this.view.sourceHeight(e),this.animator.update())}else l.prototype.replace.call(this)},e.prototype.didSetState=function(t,e){l.prototype.didSetState.call(this,t,e);var i=t.get("width").cast(Lo.Form);i&&(this.width(i),this._width=i);var r=t.get("height").cast(Lo.Form);r&&(this.height(r),this._height=r),e.isDefined()||(this.visibility(null),this.render())},e.create=function(t){if(t instanceof e)return t;if(t instanceof _a)throw new TypeError(""+t);if(void 0===t||"string"==typeof t)return new e(ms.create(t));if(t.view instanceof e)return t.view;if(t.view)throw new TypeError(""+t.view);if(t instanceof HTMLElement)return new e(new ms(t));throw new TypeError(""+t)},e}(Ka),Qa=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return v(t,n),Object.defineProperty(t.prototype,"tag",{get:function(){return"eventsPopover"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=Xa.create(),o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new $a,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){if(e.key instanceof O&&"body"===e.key.value){var o=r.castView(e.toValue(),i,r);if(o)return t.append(o),o}return n.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:n.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(za);ma.addGlobal(Qa.Form);var Za,Ja,$a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Params=Ya.Params.concat([new qs("width",q.get("width").or(q.get("popover").get("width"))),new qs("height",q.get("height").or(q.get("popover").get("height")))]),e}(Ya);(Ja=Za||(Za={}))[Ja.Hidden=0]="Hidden",Ja[Ja.Showing=1]="Showing",Ja[Ja.Visible=2]="Visible",Ja[Ja.Hiding=3]="Hiding";var tu=function(o){function t(t,e,i){var r=o.call(this,e,i)||this;return r.shadowBox=t,r}return v(t,o),t.prototype.update=function(t){this.shadowBox.backgroundColor(this.shadowBox.shadowColor().alpha(t))},t.prototype.onEnd=function(t){1===this.shadowBox.shadowBoxState?(this.shadowBox.shadowBoxState=2,this.shadowBox.didShow()):3===this.shadowBox.shadowBoxState&&(this.shadowBox.shadowBoxState=0,this.shadowBox.didHide())},t}(cs),eu=function(i){function t(t){var e=i.call(this,t)||this;return e._shadowColor=qo.black(),e._shadowOpacity=.5,e._shadowTransition=new jn(250,br.quadOut).range(0),e.shadowBoxState=0,e.shadowBoxAnimator=new tu(e,0,e._shadowTransition),e}return v(t,i),t.prototype.isVisible=function(){return 2===this.shadowBoxState||1===this.shadowBoxState},t.prototype.shadowColor=function(t){return void 0===t?this._shadowColor:(this._shadowColor=qo.fromAny(t),this)},t.prototype.shadowOpacity=function(t){return void 0===t?this._shadowOpacity:(this._shadowOpacity=t,this)},t.prototype.shadowTransition=function(t){return void 0===t?this._shadowTransition:(this._shadowTransition=jn.fromAny(t),this)},t.prototype.show=function(t){2!==this.shadowBoxState&&(t=void 0===t?this._shadowTransition:jn.fromAny(t||this._shadowTransition,0),this.willShow(),this.shadowBoxState=1,this.shadowBoxAnimator.set(this._shadowOpacity,t))},t.prototype.hide=function(t){0!==this.shadowBoxState&&(t=void 0===t?this._shadowTransition:jn.fromAny(t||this._shadowTransition,this._shadowOpacity),this.willHide(),this.shadowBoxState=3,this.shadowBoxAnimator.set(0,t))},t.prototype.willShow=function(){},t.prototype.didShow=function(){},t.prototype.willHide=function(){},t.prototype.didHide=function(){},t.create=function(){return new t(document.createElement("div")).className("shadow-box").display("flex").position("absolute").top(0).right(0).bottom(0).left(0).pointerEvents("none").zIndex(50)},t}(Fa),iu=function(){function t(){this._showDebug=!1}return t.prototype.log=function(t){this._showDebug&&console.log(t)},t}(),ru=function(){function t(){this._showDebug=!1}return t.prototype.log=function(t){this._showDebug&&console.log(t)},t}(),ou=function(i){function t(t){var e=i.call(this)||this;return e._appModel=t,e}return v(t,i),t.prototype.setViewPortModel=function(t){this._viewPortModel=t},t.prototype.appendChild=function(t,e,i){this.log("ClientViewPort.appendChild parentId: "+t+"; childId: "+e+";"),i=w.fromAny(i);var r=new Is(t,e,"",i);this.postEnvelope(r)},t.prototype.prependChild=function(t,e,i){this.log("ClientViewPort.prependChild parentId: "+t+"; childId: "+e+";"),i=w.fromAny(i);var r=new zs(t,e,"",i);this.postEnvelope(r)},t.prototype.insertChild=function(t,e,i,r){this.log("ClientViewPort.insertChild parentId: "+t+"; childId: "+e+";"),r=w.fromAny(r);var o=new Us(t,e,i,r);this.postEnvelope(o)},t.prototype.removeChild=function(t,e){this.log("ClientViewPort.removeChild parentId: "+t+"; childId: "+e+";");var i=new Os(t,e,"");this.postEnvelope(i)},t.prototype.setState=function(t,e){this.log("ClientViewPort.setState modelId: "+t+"; viewDef: "+e+";"),e=w.fromAny(e);var i=new Ws(t,e);this.postEnvelope(i)},t.prototype.setModel=function(t,e){},t.prototype.postEnvelope=function(t){this.log("ClientViewPort.postEnvelope"),this._viewPortModel.onEnvelope(t)},t.prototype.onEnvelope=function(t){this.log("ClientViewPort.onEnvelope"),t instanceof Is?this.onAppendEnvelope(t):t instanceof zs?this.onPrependEnvelope(t):t instanceof Us?this.onInsertEnvelope(t):t instanceof Os?this.onRemoveEnvelope(t):t instanceof Bs?this.onModelEnvelope(t):this.onUnknownEnvelope(t)},t.prototype.onAppendEnvelope=function(t){var e=t.parent(),i=t.child(),r=t.body();this.log("ClientViewPort.onAppendEnvelope parentId: "+e+"; childId: "+i+"; modelDef: "+r.toRecon());var o=this._appModel.getModel(e);if(o){var n=ma.Global.castModel(r,o.stack(),ma.Global);n||(n=new Gs(i)),n&&(n._id=i,o.appendChildModel(n))}},t.prototype.onPrependEnvelope=function(t){var e=t.parent(),i=t.child(),r=t.body();this.log("ClientViewPort.prependChild parentId: "+e+"; childId: "+i+"; modelDef: "+r.toRecon());var o=this._appModel.getModel(e);if(o){var n=ma.Global.castModel(r,o.stack(),ma.Global);n||(n=new Gs(i)),n&&(n._id=i,o.prependChildModel(n))}},t.prototype.onInsertEnvelope=function(t){var e=t.parent(),i=t.child(),r=t.target(),o=t.body();this.log("ClientViewPort.insertChild parentId: "+e+"; childId: "+i+"; targetId: "+r+"; modelDef: "+o.toRecon());var n=this._appModel.getModel(e);if(n){var s=ma.Global.castModel(o,n.stack(),ma.Global);if(s||(s=new Gs(i)),s){s._id=i;var a=this._appModel.getModel(r)||null;n.insertChildModel(s,a)}}},t.prototype.onRemoveEnvelope=function(t){var e=t.parent(),i=t.child();this.log("ClientViewPort.removeChild parentId: "+e+"; childId: "+i);var r=this._appModel.getModel(e);if(r){var o=this._appModel.getModel(i);o&&r.removeChildModel(o)}},t.prototype.onModelEnvelope=function(t){var e=t.child(),i=t.body().branch();this.log("ClientViewPort.setModel modelId: "+e+"; modelDef: "+i.toRecon());var r=this._appModel.getModel(e);r&&r.setData(i)},t.prototype.onUnknownEnvelope=function(t){},t.prototype.onMessage=function(t){this.log(["ClientViewPort.onMessage: ",t]);var e=t.data;if("string"==typeof e){var i=Ts.parseRecon(e);i?this.onEnvelope(i):this.onUnknownEnvelope(e)}},t}(iu),nu=function(r){function t(t,e){var i=r.call(this)||this;return i._appView=t,i._worker=e,i.onMessage=i.onMessage.bind(i),e._viewPort.setViewPortModel(i),i}return v(t,r),Object.defineProperty(t.prototype,"worker",{get:function(){return this._worker},enumerable:!0,configurable:!0}),t.prototype.appendChild=function(t,e,i){i=w.fromAny(i);var r=new Is(t,e,"",i);this.postEnvelope(r)},t.prototype.prependChild=function(t,e,i){i=w.fromAny(i);var r=new zs(t,e,"",i);this.postEnvelope(r)},t.prototype.insertChild=function(t,e,i,r){r=w.fromAny(r);var o=new Us(t,e,i,r);this.postEnvelope(o)},t.prototype.removeChild=function(t,e){var i=new Os(t,e,"");this.postEnvelope(i)},t.prototype.setModel=function(t,e){e=w.fromAny(e);var i=new Bs(t,e);this.postEnvelope(i)},t.prototype.postEnvelope=function(t){var e=this;setTimeout(function(){e._worker._viewPort.onEnvelope(t)},10)},t.prototype.onEnvelope=function(t){t instanceof Is?this.onAppendEnvelope(t):t instanceof zs?this.onPrependEnvelope(t):t instanceof Us?this.onInsertEnvelope(t):t instanceof Os?this.onRemoveEnvelope(t):t instanceof Ws?this.onStateEnvelope(t):this.onUnknownEnvelope(t)},t.prototype.onAppendEnvelope=function(t){var e=t.parent(),i=t.child(),r=t.body();this.log("ClientViewPortModel.appendChild parentId: "+e+"; childId: "+i+"; viewDef: "+r.toRecon());var o=this._appView.getView(e);if(o){var n=ma.Global.castView(r,o.stack(),ma.Global);n&&(n._id=i,o.appendChildView(n))}},t.prototype.onPrependEnvelope=function(t){var e=t.parent(),i=t.child(),r=t.body();this.log("ClientViewPortModel.prependChild parentId: "+e+"; childId: "+i+"; viewDef: "+r.toRecon());var o=this._appView.getView(e);if(o){var n=ma.Global.castView(r,o.stack(),ma.Global);n&&(n._id=i,o.prependChildView(n))}},t.prototype.onInsertEnvelope=function(t){var e=t.parent(),i=t.child(),r=t.target(),o=t.body(),n=this._appView.getView(e);if(this.log("ClientViewPortModel.insertChild parentId: "+e+"; childId: "+i+"; targetId: "+r+"; viewDef: "+o.toRecon()),n){var s=ma.Global.castView(o,n.stack(),ma.Global);if(s){s._id=i;var a=this._appView.getView(r)||null;n.insertChildView(s,a)}}},t.prototype.onRemoveEnvelope=function(t){var e=t.parent(),i=t.child();this.log("ClientViewPortModel.removeChild parentId: "+e+"; childId: "+i);var r=this._appView.getView(e);if(r){var o=this._appView.getView(i);o&&r.removeChildView(o)}},t.prototype.onStateEnvelope=function(t){var e=t.child(),i=t.body();this.log("ClientViewPortModel.setState viewId: "+e+"; viewDef: "+i.toRecon());var r=this._appView.getView(e);r&&r.setState(i)},t.prototype.onUnknownEnvelope=function(t){},t.prototype.onMessage=function(t){this.log("ClientViewPortModel.onMessage");var e=t.data;if("string"==typeof e){var i=Ts.parseRecon(e);i?this.onEnvelope(i):this.onUnknownEnvelope(e)}},t}(ru),su=function(i){function t(t){var e=i.call(this)||this;return e._appModel=t,e.onMessage=e.onMessage.bind(e),self.addEventListener("message",e.onMessage),e}return v(t,i),t.prototype.appendChild=function(t,e,i){this.log("WorkerViewPort.appendChild parentId: "+t+"; childId: "+e+";"),i=w.fromAny(i);var r=new Is(t,e,"",i);this.postEnvelope(r)},t.prototype.prependChild=function(t,e,i){this.log("WorkerViewPort.prependChild parentId: "+t+"; childId: "+e+";"),i=w.fromAny(i);var r=new zs(t,e,"",i);this.postEnvelope(r)},t.prototype.insertChild=function(t,e,i,r){this.log("WorkerViewPort.insertChild parentId: "+t+"; childId: "+e+";"),r=w.fromAny(r);var o=new Us(t,e,i,r);this.postEnvelope(o)},t.prototype.removeChild=function(t,e){this.log("WorkerViewPort.removeChild parentId: "+t+"; childId: "+e+";");var i=new Os(t,e,"");this.postEnvelope(i)},t.prototype.setState=function(t,e){console.log("WorkerViewPort.setState modelId: "+t+"; viewDef: "+e+";"),e=w.fromAny(e);var i=new Ws(t,e);this.postEnvelope(i)},t.prototype.setModel=function(t,e){},t.prototype.postEnvelope=function(t){var e=t.toRecon();self.postMessage(e)},t.prototype.onEnvelope=function(t){t instanceof Is?this.onAppendEnvelope(t):t instanceof zs?this.onPrependEnvelope(t):t instanceof Us?this.onInsertEnvelope(t):t instanceof Os?this.onRemoveEnvelope(t):t instanceof Bs?this.onModelEnvelope(t):this.onUnknownEnvelope(t)},t.prototype.onAppendEnvelope=function(t){var e=t.parent(),i=t.child(),r=t.body();this.log("WorkerViewPort.onAppendEnvelope parentId: "+e+"; childId: "+i+"; modelDef: "+r.toRecon());var o=this._appModel.getModel(e);if(o){var n=ma.Global.castModel(r,o.stack(),ma.Global);n||(n=new Gs(i)),n&&(n._id=i,o.appendChildModel(n))}},t.prototype.onPrependEnvelope=function(t){var e=t.parent(),i=t.child(),r=t.body();this.log("WorkerViewPort.prependChild parentId: "+e+"; childId: "+i+"; modelDef: "+r.toRecon());var o=this._appModel.getModel(e);if(o){var n=ma.Global.castModel(r,o.stack(),ma.Global);n||(n=new Gs(i)),n&&(n._id=i,o.prependChildModel(n))}},t.prototype.onInsertEnvelope=function(t){var e=t.parent(),i=t.child(),r=t.target(),o=t.body();this.log("WorkerViewPort.insertChild parentId: "+e+"; childId: "+i+"; targetId: "+r+"; modelDef: "+o.toRecon());var n=this._appModel.getModel(e);if(n){var s=ma.Global.castModel(o,n.stack(),ma.Global);if(s||(s=new Gs(i)),s){s._id=i;var a=this._appModel.getModel(r)||null;n.insertChildModel(s,a)}}},t.prototype.onRemoveEnvelope=function(t){var e=t.parent(),i=t.child();this.log("WorkerViewPort.removeChild parentId: "+e+"; childId: "+i);var r=this._appModel.getModel(e);if(r){var o=this._appModel.getModel(i);o&&r.removeChildModel(o)}},t.prototype.onModelEnvelope=function(t){var e=t.child(),i=t.body();this.log("WorkerViewPort.setModel modelId: "+e+"; modelDef: "+i.toRecon());var r=this._appModel.getModel(e);r&&r.setData(i)},t.prototype.onUnknownEnvelope=function(t){},t.prototype.onMessage=function(t){this.log(["WorkerViewPort.onMessage: ",t]);var e=t.data;if("string"==typeof e){var i=Ts.parseRecon(e);i?this.onEnvelope(i):this.onUnknownEnvelope(e)}},t}(iu),au=function(r){function t(t,e){var i=r.call(this)||this;return i._appView=t,i._worker=e,i.onMessage=i.onMessage.bind(i),i._worker.addEventListener("message",i.onMessage),i}return v(t,r),Object.defineProperty(t.prototype,"worker",{get:function(){return this._worker},enumerable:!0,configurable:!0}),t.prototype.appendChild=function(t,e,i){i=w.fromAny(i);var r=new Is(t,e,"",i);this.postEnvelope(r)},t.prototype.prependChild=function(t,e,i){i=w.fromAny(i);var r=new zs(t,e,"",i);this.postEnvelope(r)},t.prototype.insertChild=function(t,e,i,r){r=w.fromAny(r);var o=new Us(t,e,i,r);this.postEnvelope(o)},t.prototype.removeChild=function(t,e){var i=new Os(t,e,"");this.postEnvelope(i)},t.prototype.setModel=function(t,e){console.info("WorkerViewPortModel.setModel",t,e),e=w.fromAny(e);var i=new Bs(t,e);this.postEnvelope(i)},t.prototype.postEnvelope=function(t){var e=t.toRecon();this._worker.postMessage(e)},t.prototype.onEnvelope=function(t){t instanceof Is?this.onAppendEnvelope(t):t instanceof zs?this.onPrependEnvelope(t):t instanceof Us?this.onInsertEnvelope(t):t instanceof Os?this.onRemoveEnvelope(t):t instanceof Ws?this.onStateEnvelope(t):this.onUnknownEnvelope(t)},t.prototype.onAppendEnvelope=function(t){var e=t.parent(),i=t.child(),r=t.body();this.log("WorkerModelPort.appendChild parentId: "+e+"; childId: "+i+"; viewDef: "+r.toRecon());var o=this._appView.getView(e);if(o){var n=ma.Global.castView(r,o.stack(),ma.Global);n&&(n._id=i,o.appendChildView(n))}},t.prototype.onPrependEnvelope=function(t){var e=t.parent(),i=t.child(),r=t.body();this.log("WorkerModelPort.prependChild parentId: "+e+"; childId: "+i+"; viewDef: "+r.toRecon());var o=this._appView.getView(e);if(o){var n=ma.Global.castView(r,o.stack(),ma.Global);n&&(n._id=i,o.prependChildView(n))}},t.prototype.onInsertEnvelope=function(t){var e=t.parent(),i=t.child(),r=t.target(),o=t.body(),n=this._appView.getView(e);if(this.log("WorkerModelPort.insertChild parentId: "+e+"; childId: "+i+"; targetId: "+r+"; viewDef: "+o.toRecon()),n){var s=ma.Global.castView(o,n.stack(),ma.Global);if(s){s._id=i;var a=this._appView.getView(r)||null;n.insertChildView(s,a)}}},t.prototype.onRemoveEnvelope=function(t){var e=t.parent(),i=t.child();this.log("WorkerModelPort.removeChild parentId: "+e+"; childId: "+i);var r=this._appView.getView(e);if(r){var o=this._appView.getView(i);o&&r.removeChildView(o)}},t.prototype.onStateEnvelope=function(t){var e=t.child(),i=t.body();console.log("WorkerModelPort.setState viewId: "+e+"; viewDef: "+i.toRecon());var r=this._appView.getView(e);r&&r.setState(i)},t.prototype.onUnknownEnvelope=function(t){},t.prototype.onMessage=function(t){var e=t.data;if("string"==typeof e){var i=Ts.parseRecon(e);i?this.onEnvelope(i):this.onUnknownEnvelope(e)}},t}(ru),uu=function(h){function e(t,e){var i=h.call(this,t,"app")||this;if(i._appView=i,void 0===e)for(var r=document.querySelectorAll("script"),o=0;o<r.length;o+=1){var n=r[o];if(n.hasAttribute("swim-app")){var s=n.getAttribute("src");if(s){var a=new Worker(s);e=new au(i,a);break}}}if(void 0===e){var u=new hu("client");e=new nu(i,u)}return i._viewPort=e,i._descendantViews={},(i._descendantViews[i._id]=i).onPopState=i.onPopState.bind(i),i._popovers=[],i._modals=[],i._popoverTransition=new jn(250,br.quadOut),i._modalTransition=i._popoverTransition,i._shadowBox=eu.create(),i._shadowBox.didHide=i.shadowBoxDidHide.bind(i),i.onClick=i.onClick.bind(i),i.node.addEventListener("click",i.onClick),i._refreshFrame=0,i.onRefreshFrame=i.onRefreshFrame.bind(i),i.onResize=i.onResize.bind(i),i.onScroll=i.onScroll.bind(i),window.addEventListener("resize",i.onResize),window.addEventListener("scroll",i.onScroll),i._viewPort.setModel(i._id,ga.Theme),i.refreshRouteState(),i}return v(e,h),Object.defineProperty(e.prototype,"appView",{get:function(){return this},enumerable:!0,configurable:!0}),e.prototype.getView=function(t){return this._descendantViews[t]},e.prototype.addDescendantViews=function(t,e){this._descendantViews[t._id]||((this._descendantViews[t._id]=t).setAppView(this),this._viewPort.appendChild(e._id,t._id,t._model));for(var i=0;i<t._childViews.length;i+=1)this.addDescendantViews(t._childViews[i],t)},e.prototype.removeDescendantViews=function(t,e){for(var i=0;i<t._childViews.length;i+=1)this.removeDescendantViews(t._childViews[i],t);this._descendantViews[t._id]&&(this._viewPort.removeChild(e._id,t._id),t.setAppView(null),delete this._descendantViews[t._id])},e.prototype.setModel=function(t,e){void 0===e?h.prototype.setModel.call(this,t):this._viewPort.setModel(e._id,t)},e.prototype.popoverTransition=function(t){return void 0===t?this._popoverTransition:(this._popoverTransition=jn.fromAny(t),this)},e.prototype.modalTransition=function(t){return void 0===t?this._modalTransition:(this._modalTransition=jn.fromAny(t),this)},e.prototype.pushRouteState=function(t,e){},e.prototype.replaceRouteState=function(t,e){},e.prototype.refreshRouteState=function(){},e.prototype.onPopState=function(t){this.refreshRouteState()},e.prototype.indexOfPopover=function(t){t instanceof Ka&&(t=t.view);for(var e=0;e<this._popovers.length;e+=1)if(this._popovers[e].view===t)return e;return-1},e.prototype.showPopover=function(t,e,i){void 0===i&&void 0!==e&&(i=e),e=e;var r=this.indexOfPopover(t);0<=r?t=this._popovers[r]:(e&&void 0!==e.exclusive&&!e.exclusive||this.hideAll(i),t instanceof ms&&(t=new Ka(t)),this._popovers.push(t),this.appendPopover(t),t.addObserver(this)),void 0===i&&(i=this._popoverTransition),t.show(i)},e.prototype.hidePopover=function(t,e){var i=this.indexOfPopover(t);0<=i&&(void 0===e&&(e=this._popoverTransition),this._popovers[i].hide(e))},e.prototype.hidePopovers=function(t){void 0===t&&(t=this._popoverTransition);for(var e=0;e<this._popovers.length;e+=1)this._popovers[e].hide(t)},e.prototype.appendPopover=function(t){this.node.appendChild(t.node)},e.prototype.showShadowBox=function(t){this._shadowBox.isVisible()||(this._shadowBox.node.parentNode||this.appendShadowBox(this._shadowBox),this._shadowBox.show(t))},e.prototype.hideShadowBox=function(t){this._shadowBox.isVisible()&&this._shadowBox.hide(t)},e.prototype.appendShadowBox=function(t){this.append(t)},e.prototype.shadowBoxDidHide=function(){this._shadowBox.remove()},e.prototype.indexOfModal=function(t){t instanceof Ka&&(t=t.view);for(var e=0;e<this._modals.length;e+=1)if(this._modals[e].view===t)return e;return-1},e.prototype.showModal=function(t,e,i){void 0===i&&void 0!==e&&(i=e),e=e;var r=this.indexOfModal(t);0<=r?t=this._modals[r]:(e&&void 0!==e.exclusive&&!e.exclusive||this.hideAll(i),t instanceof ms&&(t=new Ka(t)),this.showShadowBox(i),this._modals.push(t),this._shadowBox.append(t),t.addObserver(this)),void 0===i&&(i=this._modalTransition),t.show(i)},e.prototype.hideModal=function(t,e){var i=this.indexOfModal(t);0<=i&&(void 0===e&&(e=this._modalTransition),this._modals[i].hide(e));for(var r=0;r<this._modals.length;r+=1)if(this._modals[r].isVisible())return;this.hideShadowBox(e)},e.prototype.hideModals=function(t){void 0===t&&(t=this._modalTransition);for(var e=0;e<this._modals.length;e+=1)this._modals[e].hide(t);this.hideShadowBox(t)},e.prototype.hideAll=function(t){this.hidePopovers(),this.hideModals()},e.prototype.popoverDidShow=function(t){this.requireReview(),this.requireResize()},e.prototype.popoverDidHide=function(t){var e=this.indexOfPopover(t);return 0<=e?((t=this._popovers[e]).remove(),void this._popovers.splice(e,1)):0<=(e=this.indexOfModal(t))?((t=this._modals[e]).remove(),void this._modals.splice(e,1)):void 0},e.prototype.onPassthroughClick=function(t){this.hideAll()},e.prototype.onClick=function(t){this.onPassthroughClick(t)},e.prototype.requestResize=function(){0==(this._flags&ga.REQUEST_RESIZE)&&(this._flags|=ga.REQUEST_RESIZE,this._refreshFrame||(this._refreshFrame=requestAnimationFrame(this.onRefreshFrame)))},e.prototype.requestReview=function(){0==(this._flags&ga.REQUEST_REVIEW)&&(this._flags|=ga.REQUEST_REVIEW,this._refreshFrame||(this._refreshFrame=requestAnimationFrame(this.onRefreshFrame)))},e.prototype.requestRedraw=function(){0==(this._flags&ga.REQUEST_REDRAW)&&(this._flags|=ga.REQUEST_REDRAW,this._refreshFrame||(this._refreshFrame=requestAnimationFrame(this.onRefreshFrame)))},e.prototype.onRefreshFrame=function(){(this._refreshFrame=0)!=(this._flags&ga.REQUEST_RESIZE)&&(this.cascadeWillResize(),this.cascadeDidResize()),0!=(this._flags&ga.REQUEST_REVIEW)&&(this.cascadeWillReview(),this.cascadeDidReview()),0!=(this._flags&ga.REQUEST_REDRAW)&&(this.cascadeWillRedraw(),this.cascadeDidRedraw())},e.prototype.onResize=function(t){this.requireResize()},e.prototype.onScroll=function(t){this.requireReview()},e.create=function(t){if(void 0===t&&(t="div"),t instanceof e)return t;if(t instanceof _a)throw new TypeError(""+t);if("string"==typeof t)return new e(document.createElement(t));if(t.view instanceof e)return t.view;if(t.view)throw new TypeError(""+t.view);if(t instanceof HTMLElement)return new e(t);throw new TypeError(""+t)},e}(Fa);ga.AppView=uu;var hu=function(r){function t(t){var e=r.call(this,"app")||this,i=null;return e._appModel=e,i=void 0===t?new su(e):new ou(e),e._viewPort=i,e._routeScope=new Hs(e),e._descendantModels={},(e._descendantModels[e._id]=e)._lastRefreshTime=0,e._refreshTimer=0,e.onRefresh=e.onRefresh.bind(e),e}return v(t,r),Object.defineProperty(t.prototype,"appModel",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"routeScope",{get:function(){return this._routeScope},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parentScope",{get:function(){return this._routeScope},enumerable:!0,configurable:!0}),t.prototype.getModel=function(t){return this._descendantModels[t]},t.prototype.addDescendantModels=function(t,e){this._descendantModels[t._id]||(this._descendantModels[t._id]=t).setAppModel(this);for(var i=0;i<t._childModels.length;i+=1)this.addDescendantModels(t._childModels[i],t)},t.prototype.removeDescendantModels=function(t,e){for(var i=0;i<t._childModels.length;i+=1)this.removeDescendantModels(t._childModels[i],t);this._descendantModels[t._id]&&(t.setAppModel(null),delete this._descendantModels[t._id])},t.prototype.appendChildView=function(t,e,i){2===arguments.length&&(i=e,e=t,t=this._id),this._viewPort.appendChild(t,e,i)},t.prototype.prependChildView=function(t,e,i){2===arguments.length&&(i=e,e=t,t=this._id),this._viewPort.prependChild(t,e,i)},t.prototype.insertChildView=function(t,e,i,r){3===arguments.length&&(r=i,i=e,e=t,t=this._id),this._viewPort.insertChild(t,e,i,r)},t.prototype.removeChildView=function(t,e){1===arguments.length&&(e=t,t=this._id),this._viewPort.removeChild(t,e)},t.prototype.setState=function(t,e){void 0===e?r.prototype.setState.call(this,t):(this._viewPort.setModel(e._id,t),this._viewPort.setState(e._id,t))},t.prototype.requestRestate=function(){0==(this._flags&Gs.REQUEST_RESTATE)&&(this._flags|=Gs.REQUEST_RESTATE,this._refreshTimer||(this._refreshTimer=setTimeout(this.onRefresh,4)))},t.prototype.onRefresh=function(){(this._refreshTimer=0)!=(this._flags&Gs.REQUEST_RESTATE)&&(this.cascadeWillRestate(),this.cascadeDidRestate())},t}(Gs);Gs.AppModel=hu;var lu=function(o){function e(t,e){return o.call(this,t,e)||this}return v(e,o),e.prototype.text=function(t,e){var i=this.textAnimator;if(void 0===t)return i?i.get():this.node.nodeValue||"";if(null===t)return i&&(i.cancel(),this.textAnimator=void 0),this.node.nodeValue=null,this;if(e=jn.fromAny(e,t),i||void 0===e||(e.f||(e=e.range(t)),i=new ys(this.node,t,e),this.textAnimator=i),i)i.set(t,e);else if(t instanceof b){var r=this.stack();this.node.nodeValue=t.evaluate(r).stringValue("")}else this.node.nodeValue=""+t;return this},e.prototype.didSetState=function(t,e){o.prototype.didSetState.call(this,t,e);var i=t.get("text");if(i instanceof b.Text)this.text(i.value);else if(i.isDefined()){var r=t.get("transition").cast(jn.Form);this.text(i,r)}},e.create=function(t){if(void 0===t&&(t=""),t instanceof e)return t;if(t instanceof _a)throw new TypeError(""+t);if("string"==typeof t)return new ga.TextView(document.createTextNode(t));if(t.view instanceof e)return t.view;if(t.view)throw new TypeError(""+t.view);if(t instanceof Text)return new e(t);throw new TypeError(""+t)},e}(_a);ga.TextView=lu;var pu=function(e){function t(t){return e.call(this,t)||this}return v(t,e),t.prototype.remodel=function(t){void 0===t&&(t=this.stack());var e=F.empty(),i=cu.evaluate(t).toValue();i.isDefined()&&e.slot("transition",i);var r=du.substitute(t).toValue();r.isDefined()&&e.slot("text",r),this.setState(e)},t}(xa),cu=q.get("transition"),du=q.get("text"),fu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"tag",{get:function(){return"text"},enumerable:!0,configurable:!0}),e.prototype.castView=function(t,e,i){if(t.header(this.tag).isDefined()){var r=lu.create(),o=this.materializeView(r,t,e,i);return r.setModel(o),r}},e.prototype.castModel=function(t,e,i){if(t.header(this.tag).isDefined()){var r=new pu,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},e.Form=new e,e}(ka);ma.addGlobal(fu.Form);var yu=function(t,e){void 0===e&&(e={});var i=document.createEvent("CustomEvent");return i.initCustomEvent(t,e.bubbles||!1,e.cancelable||!1,e.detail),i.__proto__=this.__proto__,i};"undefined"!=typeof Event&&(yu.prototype=Event.prototype);var mu=function(){},vu=864e5,gu=7*vu,bu=function(i){function t(t){void 0===t&&(t="");var e=i.call(this)||this;return e.units=t,e}return v(t,i),t.prototype.format=function(t){if(isFinite(t)){var e=void 0;gu<t&&(e=Math.floor(t/gu),t%=gu);var i=void 0;vu<t&&(i=Math.floor(t/vu),t%=vu);var r=void 0;36e5<t&&(r=Math.floor(t/36e5),t%=36e5);var o=void 0;6e4<t&&(o=Math.floor(t/6e4),t%=6e4);var n=void 0;1e3<t&&(n=Math.floor(t/1e3),t%=1e3);var s="";return e&&(s+=e+"w"),i&&(s+=i+"d"),r&&(s+=r+"h"),o&&(s+=o+"m"),!n&&s||(s+=(n||0)+"s"),s+=this.units}return""+t},t}(mu),wu=function(){},_u=["p","n","u","m","","k","M","G","T"],xu=function(o){function t(t,e,i){void 0===t&&(t=2),void 0===e&&(e=""),void 0===i&&(i="");var r=o.call(this)||this;return r.digits=t,r.units=e,r.symbol=i,r}return v(t,o),t.prototype.format=function(t){if(isFinite(t)){var e=t.toExponential(this.digits).split(/e/),i=+e[0],r=+e[1]<0?0:+e[1],o=Math.floor(r/3);return this.symbol+(i*Math.pow(10,r-3*o)).toFixed(r)+_u[o+4]+this.units}return""+t},t}(wu),ku=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.map=function(t){return b.Absent},e.prototype.unmap=function(t){return 0},e.prototype.range=function(t,e){return void 0===t?[this.map(0),this.map(1)]:void 0===e?(t=t,kn.recon(t[0],t[1])):kn.recon(t,e)},e.prototype.equals=function(t){return this===t},e}(kn),Au=function(r){function e(t,e){var i=r.call(this)||this;if(!t&&!e)throw new TypeError;if(e?t||(t=e):e=t,!(t.key instanceof O))throw new TypeError(""+t.key);if(!(e.key instanceof O))throw new TypeError(""+e.key);return t.commit(),e.commit(),i.keyInterpolator=kn.recon(t.key,e.key),i.valueInterpolator=kn.recon(t.value,e.value),i}return v(e,r),e.prototype.map=function(t){var e=this.keyInterpolator.map(t),i=this.valueInterpolator.map(t);return P.of(e,i)},e.prototype.unmap=function(t){return 0},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.keyInterpolator.equals(t.keyInterpolator)&&this.valueInterpolator.equals(t.valueInterpolator))},e}(ku),Eu=function(r){function e(t,e){var i=r.call(this)||this;if(!t&&!e)throw new TypeError;return e?t||(t=e):e=t,t.commit(),e.commit(),i.keyInterpolator=kn.recon(t.key,e.key),i.valueInterpolator=kn.recon(t.value,e.value),i}return v(e,r),e.prototype.map=function(t){var e=this.keyInterpolator.map(t),i=this.valueInterpolator.map(t);return R.of(e,i)},e.prototype.unmap=function(t){return 0},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.keyInterpolator.equals(t.keyInterpolator)&&this.valueInterpolator.equals(t.valueInterpolator))},e}(ku),Cu=function(r){function e(t,e){var i=r.call(this)||this;return void 0!==t&&(t=w.fromAny(t)),void 0!==e&&(e=w.fromAny(e)),t||e?e?t||(t=e):e=t:e=t=w.Absent,i.v0=t.commit(),i.v1=e.commit(),i}return v(e,r),e.prototype.map=function(t){return t<1?this.v0:this.v1},e.prototype.unmap=function(t){return t.equals(this.v1)?1:0},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.v0.equals(t.v0)&&this.v1.equals(t.v1))},e}(ku),Su=function(n){function r(t,e){var i=n.call(this)||this;void 0!==t&&(t=F.fromAny(t)),void 0!==e&&(e=F.fromAny(e)),t||e?e?t||(t=e):e=t:e=t=F.Empty,t.commit(),e.commit(),i.interpolators=[];for(var r=Math.min(t.length,e.length),o=0;o<r;o+=1)i.interpolators.push(kn.recon(t.getItem(o),e.getItem(o)));return i}return v(r,n),r.prototype.map=function(t){for(var e=this.interpolators.length,i=F.empty(e),r=0;r<e;r+=1)i.push(this.interpolators[r].map(t));return i},r.prototype.unmap=function(t){return 0},r.prototype.equals=function(t){if(this===t)return!0;if(t instanceof r){var e=this.interpolators.length;if(e===t.interpolators.length){for(var i=0;i<e;i+=1)if(!this.interpolators[i].equals(t.interpolators[i]))return!1;return!0}}return!1},r}(ku),Vu=function(r){function e(t,e){var i=r.call(this)||this;return void 0===t&&void 0===e?e=t=0:void 0===e?e=t:void 0===t&&(t=e),i.y0=+t,i.dy=+e-i.y0,i}return v(e,r),e.prototype.map=function(t){return W.valueOf(this.y0+this.dy*t)},e.prototype.unmap=function(t){return this.dy?(t.value-this.y0)/this.dy:this.dy},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.y0===t.y0&&this.dy===t.dy)},e}(ku),Du=function(r){function e(t,e){var i=r.call(this)||this;if(!t&&!e)throw new TypeError;if(e?t||(t=e):e=t,i.operator=t.operator,i.operator!==e.operator)throw new Error(e.operator);return t.commit(),e.commit(),i.lhsInterpolator=kn.recon(t.lhs,e.lhs),i.rhsInterpolator=kn.recon(t.rhs,e.rhs),i}return v(e,r),e.prototype.map=function(t){var e=this.lhsInterpolator.map(t),i=this.rhsInterpolator.map(t);switch(this.operator){case"||":return e.or(i);case"&&":return e.and(i);case"|":return e.bor(i);case"^":return e.bxor(i);case"&":return e.band(i);case"<":return e.lt(i);case"<=":return e.le(i);case"==":return e.eq(i);case"!=":return e.ne(i);case">=":return e.ge(i);case">":return e.gt(i);case"+":return e.plus(i);case"-":return e.minus(i);case"*":return e.times(i);case"/":return e.divide(i);case"%":return e.modulo(i);default:throw new Error(this.operator)}},e.prototype.unmap=function(t){return 0},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.lhsInterpolator.equals(t.lhsInterpolator)&&this.rhsInterpolator.equals(t.rhsInterpolator))},e}(ku),Mu=function(r){function e(t,e){var i=r.call(this)||this;if(!t&&!e)throw new TypeError;if(e?t||(t=e):e=t,i.operator=t.operator,i.operator!==e.operator)throw new Error(e.operator);return t.commit(),e.commit(),i.rhsInterpolator=kn.recon(t.rhs,e.rhs),i}return v(e,r),e.prototype.map=function(t){var e=this.rhsInterpolator.map(t);switch(this.operator){case"!":return e.not();case"~":return e.bnot();case"-":return e.neg();default:throw new Error(this.operator)}},e.prototype.unmap=function(t){return 0},e.prototype.equals=function(t){return this===t||t instanceof e&&this.rhsInterpolator.equals(t.rhsInterpolator)},e}(ku),Pu=function(r){function e(t,e){var i=r.call(this)||this;if(!t&&!e)throw new TypeError;return e?t||(t=e):e=t,t.commit(),e.commit(),i.funcInterpolator=kn.recon(t.func,e.func),i.argsInterpolator=kn.recon(t.args,e.args),i}return v(e,r),e.prototype.map=function(t){var e=this.funcInterpolator.map(t),i=this.argsInterpolator.map(t);return q.literal(e).invoke(i)},e.prototype.unmap=function(t){return 0},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.funcInterpolator.equals(t.funcInterpolator)&&this.argsInterpolator.equals(t.argsInterpolator))},e}(ku);kn.recon=function(t,e){if(void 0===t&&void 0===e)return new ku;if(void 0!==t&&(t=b.fromAny(t)),void 0!==e&&(e=b.fromAny(e)),t||e?e?t||(t=e):e=t:e=t=b.Absent,t instanceof M&&e instanceof M)return t instanceof P&&e instanceof P||t instanceof P&&e.key instanceof O||e instanceof P&&t.key instanceof O?new Au(t,e):new Eu(t,e);var i=t.toValue(),r=e.toValue();return i instanceof F&&r instanceof F?new Su(i,r):i instanceof W&&r instanceof W?new Vu(i,r):i instanceof vt&&r instanceof vt?new Du(i,r):i instanceof gt&&r instanceof gt?new Mu(i,r):i instanceof Wt&&r instanceof Wt?new Pu(i,r):new Cu(i,r)};var Ru=Math.cos(Math.PI/4),Tu=Math.sin(Math.PI/4),Lu=function(r){function t(t,e){var i=r.call(this,t,e)||this;return i.points=e.points,i}return v(t,r),t}(yu),Fu=function(){function t(t,e){this.kinematic=t,this.identifier=e,this.path=[],this.t=NaN,this.cx=NaN,this.cy=NaN,this.vx=NaN,this.vy=NaN,this.ax=NaN,this.ay=NaN,this.dx=NaN,this.dy=NaN}return Object.defineProperty(t.prototype,"ghost",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.moveTo=function(t,e,i){for(this.path.push({t:t,cx:e,cy:i});1<this.path.length&&t-this.path[0].t>this.kinematic.h;)this.path.splice(0,1);this.update()},t.prototype.update=function(){var t=this.path[0],e=this.path[this.path.length-1];if(e&&e!==t){var i=e.t-t.t,r=void 0,o=void 0;if(i){var n=(r=(e.cx-t.cx)/i)*r+(o=(e.cy-t.cy)/i)*o,s=this.kinematic.vMax;if(s*s<n){var a=Math.sqrt(n);r=r*s/a,o=o*s/a}}else o=r=0;this.t=e.t,this.dx=e.cx-this.cx,this.dy=e.cy-this.cy,this.cx=e.cx,this.cy=e.cy,this.vx=r,this.vy=o}else t&&(this.t=t.t,this.dx=t.cx-this.cx,this.dy=t.cy-this.cy,this.cx=t.cx,this.cy=t.cy,this.vx=0,this.vy=0)},t}(),Iu=function(){function t(t,e,i,r,o,n,s,a,u){this.kinematic=t,this.identifier=e,this.t=i,this.cx=r,this.cy=o,this.vx=n,this.vy=s,this.ax=a,this.ay=u,this.dx=0,this.dy=0}return Object.defineProperty(t.prototype,"ghost",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.translate=function(t,e){this.cx+=t,this.cy+=e},t.prototype.update=function(t){var e=t-this.t;if(e){var i=this.vx+this.ax*e,r=void 0;i<0==this.vx<0?r=this.cx+this.vx*e+this.ax*e*e*.5:(r=this.cx-this.vx*this.vx/(2*this.ax),i=0,this.ax=0);var o=this.vy+this.ay*e,n=void 0;o<0==this.vy<0?n=this.cy+this.vy*e+this.ay*e*e*.5:(n=this.cy-this.vy*this.vy/(2*this.ay),o=0,this.ay=0),this.dx=r-this.cx,this.dy=n-this.cy,this.cx=r,this.cy=n,this.vx=i,this.vy=o,this.t=t}},t}(),zu=function(){function t(){this.node=null,this.tracks={},this.trackCount=0,this.ghosts={},this.ghostCount=0,this.ghostFrame=0,this.h=67,this.a=.00175,this.vMax=1.75,this.dMin=10,this.onGhostFrame=this.onGhostFrame.bind(this)}return t.prototype.surface=function(t){return void 0===t?this.node:(this.node&&this.detach(this.node),this.node=t,this.node&&this.attach(this.node),this)},t.prototype.hysteresis=function(t){return void 0===t?this.h:(this.h=t,this)},t.prototype.acceleration=function(t){return void 0===t?this.a:(this.a=t,this)},t.prototype.velocityMax=function(t){return void 0===t?this.vMax:(this.vMax=t,this)},t.prototype.distanceMin=function(t){return void 0===t?this.dMin:(this.dMin=t,this)},t.prototype.wheel=function(t){return void 0!==t&&this},t.prototype.points=function(){var t=[];for(var e in this.tracks)t.push(this.tracks[e]);for(var e in this.ghosts)t.push(this.ghosts[e]);return t},t.prototype.interrupt=function(){this.ghostFrame&&(cancelAnimationFrame(this.ghostFrame),this.ghostFrame=0),this.ghostCount&&(this.ghosts={},this.ghostCount=0,this.trackCount?this.kinematicUpdate():this.kinematicEnd())},t.prototype.zoom=function(t,e,i){if(i){var r=Date.now(),o=this.a,n=o*Ru,s=o*Tu,a=this.vMax,u=.5*a*Ru,h=.5*a*Tu,l=4*u*u/n,p=4*h*h/s,c=this.ghosts.zoom0,d=this.ghosts.zoom1;if(c&&d){var f=Math.abs(d.cx-c.cx)/2,y=Math.abs(d.cy-c.cy)/2,m=r-c.t,v=(i=Math.min(Math.max(-a*m,i),a*m))*f*Ru/l,g=i*y*Tu/p;n=n*f/l,s=s*y/p,0<m&&(c.t=r,c.cx+=v,c.cy+=g,c.vx=v/m,c.vy=g/m,c.ax=c.vx<0?n:0<c.vx?-n:0,c.ay=c.vy<0?s:0<c.vy?-s:0,c.dx=v,c.dy=g,d.t=r,d.cx-=v,d.cy-=g,d.vx=-v/m,d.vy=-g/m,d.ax=d.vx<0?n:0<d.vx?-n:0,d.ay=d.vy<0?s:0<d.vy?-s:0,d.dx=-v,d.dy=-g)}else this.interrupt(),this.kinematicStart(),i<0?(c=new Iu(this,"zoom0",r,t-l,e-p,-u,-h,n,s),d=new Iu(this,"zoom1",r,t+l,e+p,u,h,-n,-s)):(c=new Iu(this,"zoom0",r,t-l,e-p,u,h,-n,-s),d=new Iu(this,"zoom1",r,t+l,e+p,-u,-h,n,s)),this.ghosts.zoom0=c,this.ghostCount+=1,this.ghosts.zoom1=d,this.ghostCount+=1;this.kinematicUpdate(),this.ghostFrame&&cancelAnimationFrame(this.ghostFrame),this.ghostFrame=requestAnimationFrame(this.onGhostFrame)}},t.prototype.updateVelocity=function(t,e){var i=e[0],r=e[1],o=0;if(i&&r){o=2;var n=Math.abs(r.cx-i.cx),s=Math.abs(r.cy-i.cy);i instanceof Iu&&i.update(t),r instanceof Iu&&r.update(t);var a=Math.abs(r.cx-i.cx)/n,u=Math.abs(r.cy-i.cy)/s;i.vx*=a,i.vy*=u,i.ax*=a,i.ay*=u,r.vx*=a,r.vy*=u,r.ax*=a,r.ay*=u}for(;o<e.length;){var h=e[o];h instanceof Iu&&h.update(t),o+=1}},t.prototype.spreadVelocity=function(t){for(var e in this.ghosts){var i=this.ghosts[e];t.vx<0==i.vx<0?(t.vx=(t.vx+i.vx)/2,i.vx=(t.vx+i.vx)/2):(t.vx=(t.vx-i.vx)/2,i.vx=(i.vx-t.vx)/2),t.vy<0==i.vy<0?(t.vy=(t.vy+i.vy)/2,i.vy=(t.vy+i.vy)/2):(t.vy=(t.vy-i.vy)/2,i.vy=(i.vy-t.vy)/2)}},t.prototype.coast=function(t){if(t.vx||t.vy){this.spreadVelocity(t);var e=Math.atan2(Math.abs(t.vy),Math.abs(t.vx)),i=this.a,r=(t.vx<0?i:0<t.vx?-i:0)*Math.cos(e),o=(t.vy<0?i:0<t.vy?-i:0)*Math.sin(e);if(r||o){var n=new Iu(this,t.identifier,t.t,t.cx,t.cy,t.vx,t.vy,r,o);this.ghosts[n.identifier]=n,this.ghostCount+=1,this.ghostFrame||(this.ghostFrame=requestAnimationFrame(this.onGhostFrame))}}},t.prototype.translate=function(t,e){for(var i in t=t||0,e=e||0,this.ghosts)this.ghosts[i].translate(t,e)},t.prototype.interpolate=function(t){for(var e in this.tracks)this.tracks[e].update();for(var e in this.updateVelocity(t,this.points()),this.kinematicUpdate(),this.ghosts){var i=this.ghosts[e];i.ax||i.ay||(delete this.ghosts[e],this.ghostCount-=1)}this.trackCount||this.ghostCount?this.ghostCount&&!this.ghostFrame&&(this.ghostFrame=requestAnimationFrame(this.onGhostFrame)):this.kinematicEnd()},t.prototype.onGhostFrame=function(t){this.ghostFrame=0,this.interpolate(Date.now())},t.prototype.kinematicStart=function(){var t=new Lu("kinematicstart",{bubbles:!0,cancelable:!0,composed:!0,points:this.points()});this.node.dispatchEvent(t)},t.prototype.kinematicUpdate=function(){var t=new Lu("kinematicupdate",{bubbles:!0,cancelable:!0,composed:!0,points:this.points()});this.node.dispatchEvent(t)},t.prototype.kinematicEnd=function(){var t=new Lu("kinematicend",{bubbles:!0,cancelable:!0,composed:!0,points:this.points()});this.node.dispatchEvent(t)},t.prototype.trackStart=function(t,e,i,r){this.interrupt();var o=new Fu(this,t);(this.tracks[t]=o).moveTo(Date.now(),e,i),this.trackCount+=1,1===this.trackCount&&this.startTracking(this.node),this.trackDidStart(o,this.node,r)},t.prototype.trackMove=function(t,e,i,r){var o=this.tracks[t];o&&(o.moveTo(Date.now(),e,i),this.trackDidMove(o,this.node,r))},t.prototype.trackCancel=function(t,e,i,r){var o=this.tracks[t];o&&(delete this.tracks[t],this.trackCount-=1,o.update(),this.trackDidCancel(o,this.node,r),0===this.trackCount&&this.endTracking(this.node))},t.prototype.trackEnd=function(t,e,i,r){var o=this.tracks[t];o&&(delete this.tracks[t],this.trackCount-=1,o.update(),this.trackDidEnd(o,this.node,r),0===this.trackCount&&this.endTracking(this.node))},t.prototype.trackDidStart=function(t,e,i){1===this.trackCount&&this.kinematicStart()},t.prototype.trackDidMove=function(t,e,i){this.translate(t.dx,t.dy),this.interpolate(Date.now())},t.prototype.trackDidCancel=function(t,e,i){this.trackCount||this.ghostCount||this.kinematicEnd()},t.prototype.trackDidEnd=function(t,e,i){this.coast(t),this.trackCount||this.ghostCount||this.kinematicEnd()},t.create=function(){return"undefined"!=typeof PointerEvent?new Uu:"undefined"!=typeof TouchEvent?new Ou:new Wu},t}(),Uu=function(r){function t(){var t=r.call(this)||this;return t._wheel=!0,t.onPointerDown=t.onPointerDown.bind(t),t.onPointerMove=t.onPointerMove.bind(t),t.onPointerUp=t.onPointerUp.bind(t),t.onWheel=t.onWheel.bind(t),t}return v(t,r),t.prototype.wheel=function(t){return void 0===t?this._wheel:(this._wheel!==t&&(this._wheel=t,this.node&&(t?this.node.addEventListener("wheel",this.onWheel):this.node.removeEventListener("wheel",this.onWheel))),this)},t.prototype.attach=function(t){t.addEventListener("pointerdown",this.onPointerDown),this._wheel&&t.addEventListener("wheel",this.onWheel)},t.prototype.detach=function(t){t.removeEventListener("pointerdown",this.onPointerDown),t.removeEventListener("wheel",this.onWheel)},t.prototype.startTracking=function(t){t.addEventListener("pointermove",this.onPointerMove),t.addEventListener("pointerup",this.onPointerUp)},t.prototype.endTracking=function(t){t.removeEventListener("pointermove",this.onPointerMove),t.removeEventListener("pointerup",this.onPointerUp)},t.prototype.trackDidStart=function(t,e,i){r.prototype.trackDidStart.call(this,t,e,i),e.setPointerCapture&&e.setPointerCapture(+t.identifier)},t.prototype.trackDidEnd=function(t,e,i){r.prototype.trackDidEnd.call(this,t,e,i),e.releasePointerCapture&&e.releasePointerCapture(+t.identifier)},t.prototype.onPointerDown=function(t){this.trackStart(""+t.pointerId,t.clientX,t.clientY,t)},t.prototype.onPointerMove=function(t){this.trackMove(""+t.pointerId,t.clientX,t.clientY,t)},t.prototype.onPointerUp=function(t){this.trackEnd(""+t.pointerId,t.clientX,t.clientY,t)},t.prototype.onWheel=function(t){t.preventDefault(),this.zoom(t.clientX,t.clientY,t.wheelDeltaY||t.deltaY)},t}(zu),Ou=function(e){function t(){var t=e.call(this)||this;return t.onTouchStart=t.onTouchStart.bind(t),t.onTouchMove=t.onTouchMove.bind(t),t.onTouchCancel=t.onTouchCancel.bind(t),t.onTouchEnd=t.onTouchEnd.bind(t),t}return v(t,e),t.prototype.attach=function(t){t.addEventListener("touchstart",this.onTouchStart)},t.prototype.detach=function(t){t.removeEventListener("touchstart",this.onTouchStart)},t.prototype.startTracking=function(t){t.addEventListener("touchmove",this.onTouchMove),t.addEventListener("touchcancel",this.onTouchCancel),t.addEventListener("touchend",this.onTouchEnd)},t.prototype.endTracking=function(t){t.removeEventListener("touchmove",this.onTouchMove),t.removeEventListener("touchcancel",this.onTouchCancel),t.removeEventListener("touchend",this.onTouchEnd)},t.prototype.onTouchStart=function(t){for(var e=0;e<t.changedTouches.length;e+=1){var i=t.changedTouches[e];this.trackStart(""+i.identifier,i.clientX,i.clientY,t)}(1<t.changedTouches.length||1<this.trackCount)&&t.preventDefault()},t.prototype.onTouchMove=function(t){for(var e=0;e<t.changedTouches.length;e+=1){var i=t.changedTouches[e];this.trackMove(""+i.identifier,i.clientX,i.clientY,t)}},t.prototype.onTouchCancel=function(t){for(var e=0;e<t.changedTouches.length;e+=1){var i=t.changedTouches[e];this.trackCancel(""+i.identifier,i.clientX,i.clientY,t)}},t.prototype.onTouchEnd=function(t){for(var e=0;e<t.changedTouches.length;e+=1){var i=t.changedTouches[e];this.trackEnd(""+i.identifier,i.clientX,i.clientY,t)}},t}(zu),Wu=function(e){function t(){var t=e.call(this)||this;return t._wheel=!0,t.onMouseDown=t.onMouseDown.bind(t),t.onMouseMove=t.onMouseMove.bind(t),t.onMouseUp=t.onMouseUp.bind(t),t.onWheel=t.onWheel.bind(t),t}return v(t,e),t.prototype.wheel=function(t){return void 0===t?this._wheel:(this._wheel!==t&&(this._wheel=t,this.node&&(t?this.node.addEventListener("wheel",this.onWheel):this.node.removeEventListener("wheel",this.onWheel))),this)},t.prototype.attach=function(t){t.addEventListener("mousedown",this.onMouseDown),this._wheel&&t.addEventListener("wheel",this.onWheel)},t.prototype.detach=function(t){t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("wheel",this.onWheel)},t.prototype.startTracking=function(t){document.body.addEventListener("mousemove",this.onMouseMove),document.body.addEventListener("mouseup",this.onMouseUp)},t.prototype.endTracking=function(t){document.body.removeEventListener("mousemove",this.onMouseMove),document.body.removeEventListener("mouseup",this.onMouseUp)},t.prototype.onMouseDown=function(t){this.trackStart("mouse",t.clientX,t.clientY,t)},t.prototype.onMouseMove=function(t){this.trackMove("mouse",t.clientX,t.clientY,t)},t.prototype.onMouseUp=function(t){this.trackEnd("mouse",t.clientX,t.clientY,t)},t.prototype.onWheel=function(t){t.preventDefault(),this.zoom(t.clientX,t.clientY,t.wheelDeltaY||t.deltaY)},t}(zu),Bu=function(r){function t(t,e){var i=r.call(this,t,e)||this;return i.kinematicScale=e.kinematicScale,i.kinematic=e.kinematic,i.ruler=e.ruler,i.scale=e.scale,i}return v(t,r),t}(yu),qu=function(){function t(){this._kinematic=null,this._ruler=null,this._scale=null,this._xMin=null,this._xMax=null,this._zMin=null,this._zMax=null,this._points=[],this.onKinematicStart=this.onKinematicStart.bind(this),this.onKinematicUpdate=this.onKinematicUpdate.bind(this),this.onKinematicEnd=this.onKinematicEnd.bind(this)}return t.prototype.kinematic=function(t){return void 0===t?this._kinematic:(this._kinematic&&this.detach(this._kinematic),this._kinematic=t,this._kinematic&&this.attach(this._kinematic),this)},t.prototype.hysteresis=function(t){return void 0===t?this._kinematic.hysteresis():(this._kinematic.hysteresis(t),this)},t.prototype.acceleration=function(t){return void 0===t?this._kinematic.acceleration():(this._kinematic.acceleration(t),this)},t.prototype.velocityMax=function(t){return void 0===t?this._kinematic.velocityMax():(this._kinematic.velocityMax(t),this)},t.prototype.distanceMin=function(t){return void 0===t?this._kinematic.distanceMin():(this._kinematic.distanceMin(t),this)},t.prototype.wheel=function(t){return void 0===t?this._kinematic.wheel():(this._kinematic.wheel(t),this)},t.prototype.ruler=function(t){return void 0===t?this._ruler:(this._ruler=t,this)},t.prototype.scale=function(t){if(void 0===t)return this._scale;var e=this._scale;return this._scale=t,null===e&&this.zoomBounds(!0),this},t.prototype.domainMin=function(t){return void 0===t?this._xMin:(this._xMin=t,this)},t.prototype.domainMax=function(t){return void 0===t?this._xMax:(this._xMax=t,this)},t.prototype.domainBounds=function(t,e){return void 0===t?[this._xMin,this._xMax]:(void 0===e?(t=t,this._xMin=t[0],this._xMax=t[1]):(this._xMin=t,this._xMax=e),this)},t.prototype.zoomMin=function(t){return void 0===t?this._zMin:(this._zMin=t,this)},t.prototype.zoomMax=function(t){return void 0===t?this._zMax:(this._zMax=t,this)},t.prototype.zoomBounds=function(t,e){return void 0===t?[this._zMin,this._zMax]:(void 0===e?"boolean"==typeof t?this._scale instanceof wn?(this._zMin=1e6,this._zMax=.001):this._scale instanceof _n&&(this._zMin=864e5,this._zMax=1):(t=t,this._zMin=t[0],this._zMax=t[1]):(this._zMin=t,this._zMax=e),this)},t.prototype.attach=function(t){var e=this._kinematic&&this._kinematic.surface();e&&(e.addEventListener("kinematicstart",this.onKinematicStart),e.addEventListener("kinematicupdate",this.onKinematicUpdate),e.addEventListener("kinematicend",this.onKinematicEnd))},t.prototype.detach=function(t){var e=this._kinematic&&this._kinematic.surface();e&&(e.removeEventListener("kinematicstart",this.onKinematicStart),e.removeEventListener("kinematicupdate",this.onKinematicUpdate),e.removeEventListener("kinematicend",this.onKinematicEnd))},t.prototype.createPoint=function(t){var e=this.coords(t.cx,t.cy);return{identifier:t.identifier,domainCoord:e.domainCoord,rangeCoord:e.rangeCoord}},t.prototype.updatePoint=function(t,e){e.rangeCoord=this.rangeCoord(t.cx,t.cy)},t.prototype.updatePoints=function(t){var e=this._points;t:for(var i=0;i<t.length;i+=1){for(var r=t[i],o=0;o<e.length;o+=1){var n=e[o];if(r.identifier==n.identifier){this.updatePoint(r,n);continue t}}var s=this.createPoint(r);e.push(s)}var a=0;t:for(;a<e.length;){for(s=e[a],i=0;i<t.length;i+=1){r=t[i];if(s.identifier==r.identifier){a+=1;continue t}}e.splice(a,1)}},t.prototype.clampScale=function(){var t=null!==this._xMin?this._xMin:void 0,e=null!==this._xMax?this._xMax:void 0,i=null!==this._zMin?this._zMin:void 0,r=null!==this._zMax?this._zMax:void 0,o=this._scale;if(this._scale=o.clampDomain(t,e,i,r),this._scale!==o)for(var n=0;n<this._points.length;n+=1){var s=this._points[n];s.domainCoord=this._scale.unscale(s.rangeCoord)}},t.prototype.rescale=function(){var t=this._points[0],e=this._points[1];if(t&&e){var i=t.domainCoord,r=t.rangeCoord,o=e.domainCoord,n=e.rangeCoord;this._scale=this._scale.solveDomain(i,r,o,n),this.clampScale()}else if(t){i=t.domainCoord,r=t.rangeCoord;this._scale=this._scale.solveDomain(i,r),this.clampScale()}},t.prototype.onKinematicStart=function(t){this.scaleStart()},t.prototype.onKinematicUpdate=function(t){this.updatePoints(t.points),this.rescale(),this.scaleUpdate()},t.prototype.onKinematicEnd=function(t){this.scaleEnd()},t.prototype.scaleStart=function(){var t=new Bu("kinematicscalestart",{bubbles:!0,cancelable:!0,composed:!0,kinematicScale:this,kinematic:this._kinematic,ruler:this._ruler,scale:this._scale});this._ruler.dispatchEvent(t)},t.prototype.scaleUpdate=function(){var t=new Bu("kinematicscaleupdate",{bubbles:!0,cancelable:!0,composed:!0,kinematicScale:this,kinematic:this._kinematic,ruler:this._ruler,scale:this._scale});this._ruler.dispatchEvent(t)},t.prototype.scaleEnd=function(){var t=new Bu("kinematicscaleend",{bubbles:!0,cancelable:!0,composed:!0,kinematicScale:this,kinematic:this._kinematic,ruler:this._ruler,scale:this._scale});this._ruler.dispatchEvent(t),this._points.length=0},t.horizontal=function(){return new Gu},t.vertical=function(){return new Nu},t}(),Gu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.coords=function(t,e){var i=this._ruler.getBoundingClientRect();return{domainCoord:this._scale.unscale(t-i.left),rangeCoord:t-i.left}},e.prototype.rangeCoord=function(t,e){return t-this._ruler.getBoundingClientRect().left},e.prototype.isParallel=function(t,e,i,r){return Math.abs(i-t)>=Math.abs(r-e)},e}(qu),Nu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.coords=function(t,e){var i=this._ruler.getBoundingClientRect();return{domainCoord:this._scale.unscale(e-i.top),rangeCoord:e-i.top}},e.prototype.rangeCoord=function(t,e){return e-this._ruler.getBoundingClientRect().top},e.prototype.isParallel=function(t,e,i,r){return Math.abs(r-e)>=Math.abs(i-t)},e}(qu),Hu=Math.PI,ju=2*Hu,Ku=1e-6,Yu=function(){function t(){this.x0=null,this.y0=null,this.x1=null,this.y1=null,this.d=""}return t.prototype.moveTo=function(t,e){this.d+="M"+(this.x0=this.x1=t)+","+(this.y0=this.y1=e)},t.prototype.closePath=function(){void 0!==this.x1&&(this.x1=this.x0,this.y1=this.y0,this.d+="Z")},t.prototype.lineTo=function(t,e){this.d+="L"+(this.x1=t)+","+(this.y1=e)},t.prototype.quadraticCurveTo=function(t,e,i,r){this.d+="Q"+t+","+e+","+(this.x1=i)+","+(this.y1=r)},t.prototype.bezierCurveTo=function(t,e,i,r,o,n){this.d+="C"+t+","+e+","+i+","+r+","+(this.x1=o)+","+(this.y1=n)},t.prototype.arcTo=function(t,e,i,r,o){var n=+this.x1,s=+this.y1,a=i-t,u=r-e,h=n-t,l=s-e,p=h*h+l*l;if(o<0)throw new Error("negative radius: "+o);if(null===this.x1)this.d+="M"+(this.x1=t)+","+(this.y1=e);else if(Ku<p)if(Math.abs(l*a-u*h)>Ku&&o){var c=i-n,d=r-s,f=a*a+u*u,y=c*c+d*d,m=Math.sqrt(f),v=Math.sqrt(p),g=o*Math.tan((Hu-Math.acos((f+p-y)/(2*m*v)))/2),b=g/v,w=g/m;Math.abs(b-1)>Ku&&(this.d+="L"+(t+b*h)+","+(e+b*l)),this.d+="A"+o+","+o+",0,0,"+ +(h*d<l*c)+","+(this.x1=t+w*a)+","+(this.y1=e+w*u)}else this.d+="L"+(this.x1=t)+","+(this.y1=e);else;},t.prototype.arc=function(t,e,i,r,o,n){void 0===n&&(n=!1);var s=i*Math.cos(r),a=i*Math.sin(r),u=t+s,h=e+a,l=1^+n,p=n?r-o:o-r;if(i<0)throw new Error("negative radius: "+i);null===this.x1?this.d+="M"+u+","+h:(Math.abs(+this.x1-u)>Ku||Math.abs(+this.y1-h)>Ku)&&(this.d+="L"+u+","+h),i&&(p<0&&(p=p%ju+ju),ju-Ku<p?this.d+="A"+i+","+i+",0,1,"+l+","+(t-s)+","+(e-a)+"A"+i+","+i+",0,1,"+l+","+(this.x1=u)+","+(this.y1=h):Ku<p&&(this.d+="A"+i+","+i+",0,"+ +(Hu<=p)+","+l+","+(this.x1=t+i*Math.cos(o))+","+(this.y1=e+i*Math.sin(o))))},t.prototype.rect=function(t,e,i,r){this.d+="M"+(this.x0=this.x1=t)+","+(this.y0=this.y1=e)+"h"+i+"v"+r+"h"+-i+"Z"},t.prototype.toString=function(){return this.d},t}(),Xu=Math.PI,Qu=Xu/2,Zu=2*Xu,Ju=1e-12,$u=function(){function t(t,e,i,r,o,n,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=Ao.zero()),void 0===r&&(r=Ao.zero()),void 0===o&&(o=Ao.zero()),void 0===n&&(n=null),void 0===s&&(s=0),this._innerRadius=t,this._outerRadius=e,this._startAngle=Ao.fromAny(i),this._deltaAngle=Ao.fromAny(r),this._padAngle=Ao.fromAny(o),this._padRadius=n,this._cornerRadius=s,this.dirty=!0}return t.prototype.innerRadius=function(t){return void 0===t?this._innerRadius:(this._innerRadius!==t&&(this._innerRadius=t,this.dirty=!0),this)},t.prototype.outerRadius=function(t){return void 0===t?this._outerRadius:(this._outerRadius!==t&&(this._outerRadius=t,this.dirty=!0),this)},t.prototype.startAngle=function(t){return void 0===t?this._startAngle:(t=Ao.fromAny(t),this._startAngle.equals(t)||(this._startAngle=t,this.dirty=!0),this)},t.prototype.deltaAngle=function(t){return void 0===t?this._deltaAngle:(t=Ao.fromAny(t),this._deltaAngle.equals(t)||(this._deltaAngle=t,this.dirty=!0),this)},t.prototype.padAngle=function(t){return void 0===t?this._padAngle:(t=Ao.fromAny(t),this._padAngle.equals(t)||(this._padAngle=t,this.dirty=!0),this)},t.prototype.padRadius=function(t){return void 0===t?this._padRadius:(this._padRadius!==t&&(this._padRadius=t,this.dirty=!0),this)},t.prototype.cornerRadius=function(t){return void 0===t?this._cornerRadius:(this._cornerRadius!==t&&(this._cornerRadius=t,this.dirty=!0),this)},t.prototype.draw=function(t){this.dirty=!1,t=t||new Yu;var e,i,r,o,n,s,a,u,h,l=this._innerRadius,p=this._outerRadius,c=this._startAngle.radValue()-Qu,d=this._deltaAngle.radValue(),f=c+d,y=0<=d;if(p<l){var m=p;p=l,l=m}if(Ju<p)if(Zu-Ju<d)t.moveTo(p*Math.cos(c),p*Math.sin(c)),t.arc(0,0,p,c,f,!y),Ju<l&&(t.moveTo(l*Math.cos(f),l*Math.sin(f)),t.arc(0,0,l,f,c,y));else{var v=c,g=f,b=c,w=f,_=d,x=d,k=this._padAngle.radValue()/2,A=+(Ju<k)&&(null!==this._padRadius?this._padRadius:Math.sqrt(l*l+p*p)),E=Math.min(Math.abs(p-l)/2,this._cornerRadius),C=E,S=E;if(Ju<A){var V=Math.asin(A/l*Math.sin(k)),D=Math.asin(A/p*Math.sin(k));(_-=2*V)>Ju?(b+=V*=y?1:-1,w-=V):(_=0,b=w=(c+f)/2),(x-=2*D)>Ju?(v+=D*=y?1:-1,g-=D):(x=0,v=g=(c+f)/2)}var M=void 0,P=void 0,R=p*Math.cos(v),T=p*Math.sin(v),L=l*Math.cos(w),F=l*Math.sin(w),I=void 0,z=void 0;if(Ju<E&&(I=p*Math.cos(g),z=p*Math.sin(g),M=l*Math.cos(b),P=l*Math.sin(b),d<Xu)){var U=Ju<_?[(e=R)+(h=((a=L-(r=I))*((i=T)-(o=z))-(u=F-o)*(e-r))/(u*(n=M-e)-a*(s=P-i)))*n,i+h*s]:[L,F],O=R-U[0],W=T-U[1],B=I-U[0],q=z-U[1],G=1/Math.sin(.5*Math.acos((O*B+W*q)/(Math.sqrt(O*O+W*W)*Math.sqrt(B*B+q*q)))),N=Math.sqrt(U[0]*U[0]+U[1]*U[1]);C=Math.min(E,(l-N)/(G-1)),S=Math.min(E,(p-N)/(G+1))}if(Ju<x)if(Ju<S){var H=th(M,P,R,T,p,S,y),j=th(I,z,L,F,p,S,y);t.moveTo(H.cx+H.x01,H.cy+H.y01),S<E?t.arc(H.cx,H.cy,S,Math.atan2(H.y01,H.x01),Math.atan2(j.y01,j.x01),!y):(t.arc(H.cx,H.cy,S,Math.atan2(H.y01,H.x01),Math.atan2(H.y11,H.x11),!y),t.arc(0,0,p,Math.atan2(H.cy+H.y11,H.cx+H.x11),Math.atan2(j.cy+j.y11,j.cx+j.x11),!y),t.arc(j.cx,j.cy,S,Math.atan2(j.y11,j.x11),Math.atan2(j.y01,j.x01),!y))}else t.moveTo(R,T),t.arc(0,0,p,v,g,!y);else t.moveTo(R,T);if(Ju<l&&Ju<_)if(Ju<C){H=th(L,F,I,z,l,-C,y),j=th(R,T,M,P,l,-C,y);t.lineTo(H.cx+H.x01,H.cy+H.y01),C<E?t.arc(H.cx,H.cy,C,Math.atan2(H.y01,H.x01),Math.atan2(j.y01,j.x01),!y):(t.arc(H.cx,H.cy,C,Math.atan2(H.y01,H.x01),Math.atan2(H.y11,H.x11),!y),t.arc(0,0,l,Math.atan2(H.cy+H.y11,H.cx+H.x11),Math.atan2(j.cy+j.y11,j.cx+j.x11),y),t.arc(j.cx,j.cy,C,Math.atan2(j.y11,j.x11),Math.atan2(j.y01,j.x01),!y))}else t.arc(0,0,l,w,b,y);else t.lineTo(L,F)}else t.moveTo(0,0);if(t.closePath(),!arguments.length)return t.toString()},t}();function th(t,e,i,r,o,n,s){var a=t-i,u=e-r,h=(s?n:-n)/Math.sqrt(a*a+u*u),l=h*u,p=-h*a,c=t+l,d=e+p,f=i+l,y=r+p,m=(c+f)/2,v=(d+y)/2,g=f-c,b=y-d,w=g*g+b*b,_=o-n,x=c*y-f*d,k=(b<0?-1:1)*Math.sqrt(Math.max(0,_*_*w-x*x)),A=(x*b-g*k)/w,E=(-x*g-b*k)/w,C=(x*b+g*k)/w,S=(-x*g+b*k)/w,V=A-m,D=E-v,M=C-m,P=S-v;return M*M+P*P<V*V+D*D&&(A=C,E=S),{cx:A,cy:E,x01:-l,y01:-p,x11:A*(o/_-1),y11:E*(o/_-1)}}var eh=function(r){function t(t,e){var i=r.call(this)||this;return i.target=t,i.arc=e,i.innerRadius=void 0,i.outerRadius=void 0,i.startAngle=void 0,i.deltaAngle=void 0,i.padAngle=void 0,i.padRadius=void 0,i.cornerRadius=void 0,i}return v(t,r),t.prototype.onFrame=function(t){this.innerRadius&&this.innerRadius.onFrame(t),this.outerRadius&&this.outerRadius.onFrame(t),this.startAngle&&this.startAngle.onFrame(t),this.deltaAngle&&this.deltaAngle.onFrame(t),this.padAngle&&this.padAngle.onFrame(t),this.padRadius&&this.padRadius.onFrame(t),this.cornerRadius&&this.cornerRadius.onFrame(t),this.update()},t.prototype.update=function(){this.arc.dirty&&this.target.setAttribute("d",this.arc.draw())},t}(us),ih=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.update=function(t){this.parent.arc.innerRadius(t)},o.get=function(t){return t.arc.innerRadius()},o.set=function(t,e){null===e?t.arcAnimator.innerRadius=void 0:(t.arc.innerRadius(e),t.arcAnimator.animate())},o.animator=function(t,e,i){return void 0===e||t.arcAnimator.innerRadius||(t.arcAnimator.innerRadius=new o(t.arcAnimator,e,i)),t.arcAnimator.innerRadius},o}(ps),rh=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.update=function(t){this.parent.arc.outerRadius(t)},o.get=function(t){return t.arc.outerRadius()},o.set=function(t,e){null===e?t.arcAnimator.outerRadius=void 0:(t.arc.outerRadius(e),t.arcAnimator.animate())},o.animator=function(t,e,i){return void 0===e||t.arcAnimator.outerRadius||(t.arcAnimator.outerRadius=new o(t.arcAnimator,e,i)),t.arcAnimator.outerRadius},o}(ps),oh=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.update=function(t){this.parent.arc.startAngle(t)},o.get=function(t){return t.arc.startAngle()},o.set=function(t,e){null===e?t.arcAnimator.startAngle=void 0:(t.arc.startAngle(e),t.arcAnimator.animate())},o.animator=function(t,e,i){return void 0===e||t.arcAnimator.startAngle||(t.arcAnimator.startAngle=new o(t.arcAnimator,e,i)),t.arcAnimator.startAngle},o}(ps),nh=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.update=function(t){this.parent.arc.deltaAngle(t)},o.get=function(t){return t.arc.deltaAngle()},o.set=function(t,e){null===e?t.arcAnimator.deltaAngle=void 0:(t.arc.deltaAngle(e),t.arcAnimator.animate())},o.animator=function(t,e,i){return void 0===e||t.arcAnimator.deltaAngle||(t.arcAnimator.deltaAngle=new o(t.arcAnimator,e,i)),t.arcAnimator.deltaAngle},o}(ps),sh=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.update=function(t){this.parent.arc.padAngle(t)},o.get=function(t){return t.arc.padAngle()},o.set=function(t,e){null===e?t.arcAnimator.padAngle=void 0:(t.arc.padAngle(e),t.arcAnimator.animate())},o.animator=function(t,e,i){return void 0===e||t.arcAnimator.padAngle||(t.arcAnimator.padAngle=new o(t.arcAnimator,e,i)),t.arcAnimator.padAngle},o}(ps),ah=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.update=function(t){this.parent.arc.padRadius(t)},o.get=function(t){return t.arc.padRadius()},o.set=function(t,e){null===e&&(t.arcAnimator.padRadius=void 0),t.arc.padRadius(e),t.arcAnimator.animate()},o.animator=function(t,e,i){return void 0===e||t.arcAnimator.padRadius||(t.arcAnimator.padRadius=new o(t.arcAnimator,e,i)),t.arcAnimator.padRadius},o}(ps),uh=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.update=function(t){this.parent.arc.cornerRadius(t)},o.get=function(t){return t.arc.cornerRadius()},o.set=function(t,e){null===e?t.arcAnimator.cornerRadius=void 0:(t.arc.cornerRadius(e),t.arcAnimator.animate())},o.animator=function(t,e,i){return void 0===e||t.arcAnimator.cornerRadius||(t.arcAnimator.cornerRadius=new o(t.arcAnimator,e,i)),t.arcAnimator.cornerRadius},o}(ps),hh=function(r){function i(t,e){void 0===e&&(e=new $u);var i=r.call(this,t)||this;return i.arc=e,i.arcAnimator=new eh(t,e),i}return v(i,r),i.prototype.innerRadius=function(t,e){return this.propertyNumber(ih,t,e)},i.prototype.outerRadius=function(t,e){return this.propertyNumber(rh,t,e)},i.prototype.startAngle=function(t,e){return this.propertyAngle(oh,t,e)},i.prototype.deltaAngle=function(t,e){return this.propertyAngle(nh,t,e)},i.prototype.padAngle=function(t,e){return this.propertyAngle(sh,t,e)},i.prototype.padRadius=function(t,e){null!=t&&(t=+t);var i=this.property(ah,t,e);return"string"==typeof i&&(i=+i),i},i.prototype.cornerRadius=function(t,e){return this.propertyNumber(uh,t,e)},i.create=function(t,e){if(t instanceof i)return t;if(t instanceof _a)throw new TypeError(""+t);if("string"==typeof t)return new i(document.createElementNS(Sa.NS,"path"),e);if(t.view instanceof i)return t.view;if(t.view)throw new TypeError(""+t.view);if(t instanceof SVGPathElement)return new i(t,e);throw new TypeError(""+t)},i}(Sa),lh=function(r){function t(t,e){var i=r.call(this,t,e)||this;return i._deauthedTemplate=w.Absent,i._authedTemplate=w.Absent,i.onGoogleAuth2Loaded=i.onGoogleAuth2Loaded.bind(i),i.onGoogleUserChanged=i.onGoogleUserChanged.bind(i),i.display("flex").flexGrow(1),i}return v(t,r),t.prototype.isAuthenticated=function(){return!!this._auth2&&this._auth2.isSignedIn.get()},t.prototype.didSetAppView=function(t){t&&"undefined"!=typeof gapi&&void 0!==this._googleClientId&&gapi.load("auth2",this.onGoogleAuth2Loaded)},t.prototype.onGoogleAuth2Loaded=function(){this._auth2=gapi.auth2.init({client_id:this._googleClientId,scope:"profile email"}),this._auth2.currentUser.listen(this.onGoogleUserChanged),this._auth2.isSignedIn.get()&&this._auth2.signIn()},t.prototype.onGoogleUserChanged=function(t){if(t.isSignedIn()){var e=t.getAuthResponse().id_token;this.setModel(this._model.withSlot("openIDToken",e))}else this.setModel(this._model.withoutKey("openIDToken").toValue())},t.create=function(){return new t(document.createElement("div")).className("authenticated")},t.applyTheme=function(t){var e=F.empty().slot("width","180px").slot("height","240px"),i=F.empty().slot("baseColor",q.get("primaryColor")),r=F.empty().slot("popover",e).slot("button",i);t.set("account",r)},t}(Fa);lh.applyTheme(lh.Theme);var ph=function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return v(t,o),t.prototype.remodel=function(t){void 0===t&&(t=this.stack());var i,e=this._openIDToken,r=ch.evaluate(t).stringValue();e!==r&&(this._openIDToken=r,i=void 0!==r?F.empty().attr("idToken",r):w.Absent,ar._options.credentials=i,ar._hosts.forEach(function(t,e){e.authenticate(i)},this));o.prototype.remodel.call(this,t)},t}(Ia),ch=q.get("openIDToken"),dh=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return v(t,n),Object.defineProperty(t.prototype,"tag",{get:function(){return"authenticated"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=lh.create(),o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new ph,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){e.key instanceof O&&("googleClientId"===e.key.value&&(t._googleClientId=e.toValue().stringValue()));var o=r.castView(e.toValue(),i,r);return o instanceof _a&&t.append(o),n.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:n.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(za);ma.addGlobal(dh.Form);var fh=function(o){function e(t){var e=o.call(this,t)||this;return e.onGoogleUserChanged=e.onGoogleUserChanged.bind(e),e.onSignOut=e.onSignOut.bind(e),e.display("flex").position("absolute").justifyContent("center").alignItems("center").placement(["top","bottom"]).boxShadow("0 2px 4px 0 rgba(0, 0, 0, 0.12), 0 0 4px 0 rgba(0, 0, 0, 0.08)").borderRadius(3),e._googleSignInButton=Fa.create("div"),e._googleSignInButton.elemId(e._googleSignInButton._id),e._signOutButton=Fa.create("button").text("Sign Out"),e._signOutButton.on("click",e.onSignOut),e}return v(e,o),Object.defineProperty(e.prototype,"authenticatedView",{get:function(){for(var t=this._parentView;t;){if(t instanceof lh)return t;t=t._parentView}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"auth2",{get:function(){var t=this.authenticatedView;if(t){var e=t._auth2;if(e)return e}},enumerable:!0,configurable:!0}),e.prototype.onGoogleUserChanged=function(t){t.isSignedIn()?(this._googleSignInButton.remove(),this.append(this._signOutButton)):this._googleSignInButton._parentView||(this._signOutButton.remove(),this.append(this._googleSignInButton),gapi.signin2.render(this._googleSignInButton._id,{scope:"profile email"})),this.hide()},e.prototype.onSignOut=function(t){var e=this.auth2;e&&e.disconnect()},e.prototype.didSetState=function(t,e){o.prototype.didSetState.call(this,t,e);var i=t.get("popoverWidth").cast(Lo.Form);i&&(this.width(i),this.requireResize());var r=t.get("popoverHeight").cast(Lo.Form);r&&(this.height(r),this.requireResize())},e.prototype.popoverWillShow=function(t){o.prototype.popoverWillShow.call(this,t);var e=this.auth2;e&&(e.currentUser.listen(this.onGoogleUserChanged),this.onGoogleUserChanged(e.currentUser.get()))},e.create=function(t){if(t instanceof e)return t;if(t instanceof _a)throw new TypeError(""+t);if(void 0===t||"string"==typeof t)return new e(ms.create(t)).className("account-popover");if(t.view instanceof e)return t.view;if(t.view)throw new TypeError(""+t.view);if(t instanceof HTMLElement)return new e(new ms(t));throw new TypeError(""+t)},e}(Ka),yh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Params=Ya.Params.concat([new qs("popoverWidth",q.get("popoverWidth").or(q.get("account").get("popover").get("width"))),new qs("popoverHeight",q.get("popoverHeight").or(q.get("account").get("popover").get("height")))]),e}(Ya),mh=function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return v(t,o),Object.defineProperty(t.prototype,"tag",{get:function(){return"accountPopover"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=fh.create(),o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new yh,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){return o.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:o.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(za);ma.addGlobal(mh.Form);var vh=function(o){function t(t){var e=o.call(this,t)||this;return e._autoPrompt=!1,e._accountPopoverTemplate=F.empty().attr("accountPopover"),e.onClick=e.onClick.bind(e),e.display("flex").visibility("hidden").flexGrow(1).flexShrink(0).justifyContent("center").alignItems("center"),e._iconBox=e.append("div").cursor("pointer"),e._iconView=Sa.create("svg").width(32).height(32).viewBox("0 0 32 32"),e._iconBox.append(e._iconView),e._baseView=e._iconView.append("circle").cx(16).cy(16).r(16),e._headView=e._iconView.append("path").d("M7.24,24.22 L8.99,24.22 C10.91,24.22 12.48,22.65 12.48,20.72 L12.48,19.56 C11.79,18.73 11.24,17.78 10.91,16.75 C10.84,16.54 10.80,16.29 10.61,16.16 C9.85,15.54 9.64,14.37 10.11,13.51 C10.207,13.34 10.37,13.20 10.35,12.99 C10.35,11.94 10.34,10.90 10.36,9.86 C10.40,8.88 10.64,7.90 11.19,7.09 C11.82,6.16 12.83,5.53 13.91,5.25 C15.14,4.94 16.45,4.93 17.70,5.17 C18.70,5.35 19.66,5.79 20.36,6.53 C21.22,7.45 21.58,8.73 21.60,9.97 C21.61,10.99 21.60,12.02 21.60,13.05 C21.60,13.20 21.72,13.30 21.79,13.42 C22.29,14.23 22.16,15.36 21.49,16.03 C21.37,16.16 21.18,16.25 21.14,16.45 C20.80,17.60 20.24,18.68 19.47,19.60 L19.47,20.72 C19.47,22.65 21.04,24.22 22.97,24.22 L24.71,24.22 C24.71,24.22 26.35,24.67 28.04,26.54 C25.10,29.89 20.80,32 16,32 C11.19,32 6.87,29.88 3.94,26.52 C5.62,24.67 7.24,24.22 7.24,24.22 Z").fill(qo.white()),e._iconBox.on("click",e.onClick),e}return v(t,o),Object.defineProperty(t.prototype,"authenticatedView",{get:function(){for(var t=this._parentView;t;){if(t instanceof lh)return t;t=t._parentView}},enumerable:!0,configurable:!0}),t.prototype.autoPrompt=function(t){if(void 0===t)return this._autoPrompt;if(this._autoPrompt!==t&&(this._autoPrompt=t)){var e=this.authenticatedView;e&&!e.isAuthenticated()&&this.showAccountPopover()}return this},t.prototype.showAccountPopover=function(){var t=this.appView;t&&(this._accountPopover=mh.Form.castView(this._accountPopoverTemplate,this.stack(),ma.Global),this._accountPopover&&(this._accountPopover.addObserver(this),this._accountPopover.source(this._iconView.node),this.appendChildView(this._accountPopover),t.showPopover(this._accountPopover)))},t.prototype.hideAccountPopover=function(){this._accountPopover&&this._accountPopover.hide()},t.prototype.toggleAccountPopover=function(){this._accountPopover?this.hideAccountPopover():this.showAccountPopover()},t.prototype.didSetAppView=function(t){if(t&&this._autoPrompt){var e=this.authenticatedView;e&&!e.isAuthenticated()&&this.showAccountPopover()}},t.prototype.didSetState=function(t,e){o.prototype.didSetState.call(this,t,e);var i=t.get("autoPrompt").booleanValue();void 0!==i&&this.autoPrompt(i);var r=t.get("baseColor").cast(qo.Form);r&&this._baseView.fill(r),e.isDefined()||this.visibility(null)},t.prototype.onClick=function(t){t.stopPropagation(),this.toggleAccountPopover()},t.prototype.popoverDidHide=function(t){this._accountPopover&&this._accountPopover.view===t&&(this._accountPopover=void 0)},t.create=function(){return new t(document.createElement("div")).className("account-button")},t}(Fa),gh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Params=Ia.Params.concat([new qs("autoPrompt",q.get("autoPrompt").or(q.get("account").get("autoPrompt"))),new qs("baseColor",q.get("baseColor").or(q.get("account").get("button").get("baseColor")))]),e}(Ia),bh=function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return v(t,o),Object.defineProperty(t.prototype,"tag",{get:function(){return"accountButton"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=vh.create(),o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new gh,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){return o.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:o.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(za);ma.addGlobal(bh.Form);var wh=function(i){function t(t){var e=i.call(this,t)||this;return e.position("relative").flexGrow(1).flexBasis(0),e._surfaceView=null,e._overlayView=e.append("div").display("flex").position("absolute").top(0).right(0).bottom(0).left(0).pointerEvents("none"),e._middleView=e._overlayView.append("div").display("flex").flexDirection("column").flexGrow(1).flexBasis(0),e._centerView=e._middleView.append("div").display("flex").flexGrow(1).flexBasis(0),e._leftView=null,e._rightView=null,e._topView=null,e._bottomView=null,e}return v(t,i),t.prototype.surfaceView=function(t){return void 0===t?this._surfaceView:(this._surfaceView!==t&&(this._surfaceView&&this._surfaceView.remove(),this._surfaceView=t,this._surfaceView&&(this._surfaceView.position("absolute").top(0).right(0).bottom(0).left(0),this.insertBefore(this._surfaceView,this._overlayView))),this)},t.prototype.leftView=function(t){return void 0===t?this._leftView:(this._leftView!==t&&(this._leftView&&this._leftView.remove(),this._leftView=t,this._leftView&&(this._leftView.pointerEvents("auto"),this._overlayView.insertBefore(this._leftView,this._middleView))),this)},t.prototype.rightView=function(t){return void 0===t?this._rightView:(this._rightView!==t&&(this._rightView&&this._rightView.remove(),this._rightView=t,this._rightView&&(this._rightView.pointerEvents("auto"),this._overlayView.append(this._rightView))),this)},t.prototype.topView=function(t){return void 0===t?this._topView:(this._topView!==t&&(this._topView&&this._topView.remove(),this._topView=t,this._topView&&(this._topView.pointerEvents("auto"),this._middleView.insertBefore(this._topView,this._centerView))),this)},t.prototype.bottomView=function(t){return void 0===t?this._bottomView:(this._bottomView!==t&&(this._bottomView&&this._bottomView.remove(),this._bottomView=t,this._bottomView&&(this._bottomView.pointerEvents("auto"),this._middleView.append(this._bottomView))),this)},t.create=function(){return new t(document.createElement("div")).className("board")},t}(Fa),_h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e}(Ia),xh=function(l){function t(){return null!==l&&l.apply(this,arguments)||this}return v(t,l),Object.defineProperty(t.prototype,"tag",{get:function(){return"board"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=wh.create(),o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new _h,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){if(e.key instanceof O){var o=e.key.value;if("surface"===o){var n=r.castView(e.toValue(),i,r);if(n)return t.surfaceView(n),t.surfaceView()}else if("left"===o){var s=r.castView(e.toValue(),i,r);if(s)return t.leftView(s),t.leftView()}else if("right"===o){var a=r.castView(e.toValue(),i,r);if(a)return t.rightView(a),t.rightView()}else if("top"===o){var u=r.castView(e.toValue(),i,r);if(u)return t.topView(u),t.topView()}else if("bottom"===o){var h=r.castView(e.toValue(),i,r);if(h)return t.bottomView(h),t.bottomView()}}return l.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:l.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(za);ma.addGlobal(xh.Form);var kh,Ah,Eh=function(){function n(t,e){this.node=t,this.ticks=new si,this._frame=null,this._scale=e,this._domainColor=qo.transparent(),this._domainWidth=1,this._domainSerif=6,this._tickMarkColor=qo.transparent(),this._tickMarkWidth=1,this._tickMarkLength=6,this._tickLabelColor=qo.transparent(),this._tickLabelPadding=0,this.dirty=!0,this.observers=[],this.domainPath=document.createElementNS("http://www.w3.org/2000/svg","path"),this.domainPath.setAttribute("class","domain"),this.domainPath.setAttribute("fill","none"),this.node.appendChild(this.domainPath)}return n.prototype.frame=function(t){if(void 0===t)return this._frame;this._frame=t;for(var e=0;e<this.observers.length;e+=1){var i=this.observers[e];i.axisDidScale&&i.axisDidScale(this._scale,this)}return this},n.prototype.scale=function(t){if(void 0===t)return this._scale;if(t=n.scale(t),!this._scale.equals(t)){this._scale=t,this.dirty=!0;for(var e=0;e<this.observers.length;e+=1){var i=this.observers[e];i.axisDidScale&&i.axisDidScale(this._scale,this)}}return this},n.prototype.domain=function(t,e){if(void 0===t)return this._scale.domain();"string"==typeof t&&(t=n.scale(t).domain());var i=this._scale.domain(t,e);if(!this._scale.equals(i)){this._scale=i,this.dirty=!0;for(var r=0;r<this.observers.length;r+=1){var o=this.observers[r];o.axisDidScale&&o.axisDidScale(this._scale,this)}}return this},n.prototype.range=function(t,e){if(void 0===t)return this._scale.range();var i=this._scale.range(t,e);if(!this._scale.equals(i)){this._scale=i,this.dirty=!0;for(var r=0;r<this.observers.length;r+=1){var o=this.observers[r];o.axisDidScale&&o.axisDidScale(this._scale,this)}}return this},n.prototype.transformFrameX=function(){if(this._frame){var t=this._frame.domain(),e=this._scale.domain(),i=this._frame.scale(t[0]),r=this._frame.scale(t[1]),o=this._frame.scale(e[0]),n=this._frame.scale(e[1]),s=i-o,a=r-n,u=.5<Math.abs(s-a)&&.5<Math.abs(r-i)?(r-i)/(n-o):1,h=$o.translateX(u*s);return 1!==u&&(h=h.scaleX(u)),h}return null},n.prototype.transformFrameY=function(){if(this._frame){var t=this._frame.domain(),e=this._scale.domain(),i=this._frame.scale(t[0]),r=this._frame.scale(t[1]),o=this._frame.scale(e[0]),n=this._frame.scale(e[1]),s=i-o,a=r-n,u=.5<Math.abs(s-a)&&.5<Math.abs(r-i)?(r-i)/(n-o):1,h=$o.translateY(u*s);return 1!==u&&(h=h.scaleY(u)),h}return null},n.prototype.domainColor=function(t){return void 0===t?this._domainColor:(t=qo.fromAny(t),this._domainColor.equals(t)||(this._domainColor=t,this.dirty=!0),this)},n.prototype.domainWidth=function(t){return void 0===t?this._domainWidth:(this._domainWidth!==t&&(this._domainWidth=t,this.dirty=!0),this)},n.prototype.domainSerif=function(t){return void 0===t?this._domainSerif:(this._domainSerif!==t&&(this._domainSerif=t,this.dirty=!0),this)},n.prototype.tickMarkColor=function(t){return void 0===t?this._tickMarkColor:(t=qo.fromAny(t),this._tickMarkColor.equals(t)||(this._tickMarkColor=t,this.dirty=!0),this)},n.prototype.tickMarkWidth=function(t){return void 0===t?this._tickMarkWidth:(this._tickMarkWidth!==t&&(this._tickMarkWidth=t,this.dirty=!0),this)},n.prototype.tickMarkLength=function(t){return void 0===t?this._tickMarkLength:(this._tickMarkLength!==t&&(this._tickMarkLength=t,this.dirty=!0),this)},n.prototype.tickLabelColor=function(t){return void 0===t?this._tickLabelColor:(t=qo.fromAny(t),this._tickLabelColor.equals(t)||(this._tickLabelColor=t,this.dirty=!0),this)},n.prototype.tickLabelPadding=function(t){return void 0===t?this._tickLabelPadding:(this._tickLabelPadding!==t&&(this._tickLabelPadding=t,this.dirty=!0),this)},n.prototype.getTick=function(t){return this.ticks.get(t)},n.prototype.insertTick=function(t){for(var e=0;e<this.observers.length;e+=1){if((r=this.observers[e]).axisWillInsertTick){var i=r.axisWillInsertTick(t,this);if(i)t=i;else if(null===i)return}}this.ticks.set(t.tickValue,t),this.node.insertBefore(t,this.ticks.nextValue(t.tickValue)||null),this.renderTick(t);for(e=0;e<this.observers.length;e+=1){var r;(r=this.observers[e]).axisDidInsertTick&&r.axisDidInsertTick(t,this)}},n.prototype.removeTick=function(t){if(t.parentNode===this.node){for(var e=0;e<this.observers.length;e+=1){(i=this.observers[e]).axisWillRemoveTick&&i.axisWillRemoveTick(t,this)}this.node.removeChild(t),this.ticks.delete(t.tickValue);for(e=0;e<this.observers.length;e+=1){var i;(i=this.observers[e]).axisDidRemoveTick&&i.axisDidRemoveTick(t,this)}}},n.prototype.addObserver=function(t){this.observers.indexOf(t)<0&&this.observers.push(t)},n.prototype.removeObserver=function(t){var e=this.observers.indexOf(t);0<=e&&this.observers.splice(e,1)},n.prototype.render=function(){this.dirty&&(this.dirty=!1,this.renderDomainPath(),this.renderTicks())},n.prototype.renderDomainPath=function(){this.domainPath.setAttribute("stroke",""+this._domainColor),this.domainPath.setAttribute("stroke-width",""+this._domainWidth)},n.prototype.renderTicks=function(){this.ticks.forEach(function(t,e){this.renderTick(e)},this)},n.prototype.renderTick=function(t){for(var e=0;e<t.childNodes.length;e+=1){var i=t.childNodes[e];i instanceof Element&&("tick-mark"===i.getAttribute("slot")?this.renderTickMark(i,t):"tick-label"===i.getAttribute("slot")&&this.renderTickLabel(i,t))}},n.prototype.renderTickMark=function(t,e){t.setAttribute("stroke",""+this._tickMarkColor),t.setAttribute("stroke-width",""+this._tickMarkWidth)},n.prototype.renderTickLabel=function(t,e){t.setAttribute("fill",""+this._tickLabelColor)},n.top=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.setAttribute("pointer-events","all"),e.setAttribute("class","axis axis-top"),new Ch(e,n.scale(t))},n.right=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.setAttribute("pointer-events","all"),e.setAttribute("class","axis axis-right"),new Sh(e,n.scale(t))},n.bottom=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.setAttribute("pointer-events","all"),e.setAttribute("class","axis axis-bottom"),new Vh(e,n.scale(t))},n.left=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.setAttribute("pointer-events","all"),e.setAttribute("class","axis axis-left"),new Dh(e,n.scale(t))},n.scale=function(t){if(t instanceof bn)return t;if("string"==typeof t){if("linear"===t)return new wn(0,1,new En(0,0));if("time"===t){var e=ro.current(),i=new ro(+e,e.zone());return i.day(i.day()-1),new _n(i,e,new En(0,0))}var r=t.split("..."),o=ws.parse(r[0]),n=ws.parse(r[1]);if("number"==typeof o&&"number"==typeof n)return new wn(o,n,new En(0,0));if(o instanceof ro&&n instanceof ro)return new _n(o,n,new En(0,0))}throw new TypeError(t)},n}(),Ch=function(n){function t(t,e){var i=n.call(this,t,e)||this;return i._tickLabelPadding=2,i}return v(t,n),Object.defineProperty(t.prototype,"orientation",{get:function(){return"top"},enumerable:!0,configurable:!0}),t.prototype.transformFrame=function(){return this.transformFrameX()},t.prototype.renderDomainPath=function(){var t=this._scale.interpolate(),e=t.map(0),i=t.map(1),r=this._domainSerif,o=new Yu;r?(o.moveTo(e,-r),o.lineTo(e,0),o.lineTo(i,0),o.lineTo(i,-r)):(o.moveTo(e,0),o.lineTo(i,0)),this.domainPath.setAttribute("d",o.toString()),n.prototype.renderDomainPath.call(this)},t.prototype.renderTick=function(t){var e=this._scale.scale(t.tickValue);t.tickCoord=e;var i=$o.translateX(e);t.setAttribute("transform",i.toAttributeString()),n.prototype.renderTick.call(this,t)},t.prototype.renderTickMark=function(t,e){"line"===t.tagName&&(t.setAttribute("x1","0"),t.setAttribute("y1","0"),t.setAttribute("x2","0"),t.setAttribute("y2",""+-this._tickMarkLength)),n.prototype.renderTickMark.call(this,t,e)},t.prototype.renderTickLabel=function(t,e){var i=-(this._tickMarkLength+this._tickLabelPadding);if("g"===t.tagName){var r=$o.translateY(i);t.setAttribute("transform",r.toAttributeString())}else"text"===t.tagName&&(t.setAttribute("y",""+i),t.setAttribute("text-anchor","middle"),t.setAttribute("dominant-baseline","text-after-edge"));n.prototype.renderTickLabel.call(this,t,e)},t}(Eh),Sh=function(n){function t(t,e){var i=n.call(this,t,e)||this;return i._tickLabelPadding=4,i}return v(t,n),Object.defineProperty(t.prototype,"orientation",{get:function(){return"right"},enumerable:!0,configurable:!0}),t.prototype.transformFrame=function(){return this.transformFrameY()},t.prototype.renderDomainPath=function(){var t=this._scale.interpolate(),e=t.map(0),i=t.map(1),r=this._domainSerif,o=new Yu;r?(o.moveTo(r,e),o.lineTo(0,e),o.lineTo(0,i),o.lineTo(r,i)):(o.moveTo(0,e),o.lineTo(0,i)),this.domainPath.setAttribute("d",o.toString()),n.prototype.renderDomainPath.call(this)},t.prototype.renderTick=function(t){var e=this._scale.scale(t.tickValue);t.tickCoord=e;var i=$o.translateY(e);t.setAttribute("transform",i.toAttributeString()),n.prototype.renderTick.call(this,t)},t.prototype.renderTickMark=function(t,e){"line"===t.tagName&&(t.setAttribute("x1","0"),t.setAttribute("y1","0"),t.setAttribute("x2",""+this._tickMarkLength),t.setAttribute("y2","0")),n.prototype.renderTickMark.call(this,t,e)},t.prototype.renderTickLabel=function(t,e){var i=this._tickMarkLength+this._tickLabelPadding;if("g"===t.tagName){var r=$o.translateX(i);t.setAttribute("transform",r.toAttributeString())}else"text"===t.tagName&&(t.setAttribute("x",""+i),t.setAttribute("text-anchor","start"),t.setAttribute("dominant-baseline","central"));n.prototype.renderTickLabel.call(this,t,e)},t}(Eh),Vh=function(n){function t(t,e){var i=n.call(this,t,e)||this;return i._tickLabelPadding=2,i}return v(t,n),Object.defineProperty(t.prototype,"orientation",{get:function(){return"bottom"},enumerable:!0,configurable:!0}),t.prototype.transformFrame=function(){return this.transformFrameX()},t.prototype.renderDomainPath=function(){var t=this._scale.interpolate(),e=t.map(0),i=t.map(1),r=this._domainSerif,o=new Yu;r?(o.moveTo(e,r),o.lineTo(e,0),o.lineTo(i,0),o.lineTo(i,r)):(o.moveTo(e,0),o.lineTo(i,0)),this.domainPath.setAttribute("d",o.toString()),n.prototype.renderDomainPath.call(this)},t.prototype.renderTick=function(t){var e=this._scale.scale(t.tickValue);t.tickCoord=e;var i=$o.translateX(e);t.setAttribute("transform",i.toAttributeString()),n.prototype.renderTick.call(this,t)},t.prototype.renderTickMark=function(t,e){"line"===t.tagName&&(t.setAttribute("x1","0"),t.setAttribute("y1","0"),t.setAttribute("x2","0"),t.setAttribute("y2",""+this._tickMarkLength)),n.prototype.renderTickMark.call(this,t,e)},t.prototype.renderTickLabel=function(t,e){var i=this._tickMarkLength+this._tickLabelPadding;if("g"===t.tagName){var r=$o.translateY(i);t.setAttribute("transform",r.toAttributeString())}else"text"===t.tagName&&(t.setAttribute("y",""+i),t.setAttribute("text-anchor","middle"),t.setAttribute("dominant-baseline","text-before-edge"));n.prototype.renderTickLabel.call(this,t,e)},t}(Eh),Dh=function(n){function t(t,e){var i=n.call(this,t,e)||this;return i._tickLabelPadding=4,i}return v(t,n),Object.defineProperty(t.prototype,"orientation",{get:function(){return"left"},enumerable:!0,configurable:!0}),t.prototype.transformFrame=function(){return this.transformFrameY()},t.prototype.renderDomainPath=function(){var t=this._scale.interpolate(),e=t.map(0),i=t.map(1),r=this._domainSerif,o=new Yu;r?(o.moveTo(-r,e),o.lineTo(0,e),o.lineTo(0,i),o.lineTo(-r,i)):(o.moveTo(0,e),o.lineTo(0,i)),this.domainPath.setAttribute("d",o.toString()),n.prototype.renderDomainPath.call(this)},t.prototype.renderTick=function(t){var e=this._scale.scale(t.tickValue);t.tickCoord=e;var i=$o.translateY(e);t.setAttribute("transform",i.toAttributeString()),n.prototype.renderTick.call(this,t)},t.prototype.renderTickMark=function(t,e){"line"===t.tagName&&(t.setAttribute("x1","0"),t.setAttribute("y1","0"),t.setAttribute("x2",""+-this._tickMarkLength),t.setAttribute("y2","0")),n.prototype.renderTickMark.call(this,t,e)},t.prototype.renderTickLabel=function(t,e){var i=-(this._tickMarkLength+this._tickLabelPadding);if("g"===t.tagName){var r=$o.translateX(i);t.setAttribute("transform",r.toAttributeString())}else"text"===t.tagName&&(t.setAttribute("x",""+i),t.setAttribute("text-anchor","end"),t.setAttribute("dominant-baseline","central"));n.prototype.renderTickLabel.call(this,t,e)},t}(Eh),Mh=Math.sqrt(50),Ph=Math.sqrt(10),Rh=Math.sqrt(2),Th=36e5,Lh=864e5,Fh=(new si).set(1e3,uo.seconds()).set(5e3,uo.seconds(5)).set(15e3,uo.seconds(15)).set(3e4,uo.seconds(30)).set(6e4,uo.minutes(1)).set(3e5,uo.minutes(5)).set(9e5,uo.minutes(15)).set(18e5,uo.minutes(30)).set(Th,uo.hours()).set(3*Th,uo.hours(3)).set(6*Th,uo.hours(6)).set(432e5,uo.hours(12)).set(Lh,uo.days()).set(2*Lh,uo.days(2)).set(6048e5,uo.weeks()).set(2592e6,uo.months()).set(7776e6,uo.months(3)).set(31536e6,uo.years()),Ih=Ar.pattern(".%L"),zh=Ar.pattern(":%S"),Uh=Ar.pattern("%I:%M"),Oh=Ar.pattern("%I %p"),Wh=Ar.pattern("%a %d"),Bh=Ar.pattern("%b %d"),qh=Ar.pattern("%B"),Gh=Ar.pattern("%Y"),Nh=function(){function t(){}return t.prototype.format=function(t){return""+t},t.prototype.createElement=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttribute("class","tick"),e.tickValue=t;var i=document.createElementNS("http://www.w3.org/2000/svg","line");i.setAttribute("slot","tick-mark"),i.setAttribute("class","tick-mark"),e.appendChild(i);var r=document.createElementNS("http://www.w3.org/2000/svg","text");return r.setAttribute("slot","tick-label"),r.setAttribute("class","tick-label"),r.textContent=this.format(t),e.appendChild(r),e},t.scale=function(t,e){if(void 0===e&&(e=10),t instanceof _n){var i=t.domain();return new jh(i[0],i[1],e)}i=t.domain();return new Hh(i[0],i[1],e)},t.step=function(t,e){var i=Math.abs(t)/e,r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),o=i/r;return Mh<=o?r*=10:Ph<=o?r*=5:Rh<=o&&(r*=2),t<0?-r:r},t}(),Hh=function(o){function s(t,e,i){var r=o.call(this)||this;return r.x0=t,r.dx=e-r.x0,r.n=Math.max(0,i),r}return v(s,o),s.prototype.count=function(t){return void 0===t?this.n:(this.n=Math.max(0,t),this)},s.prototype.domain=function(t,e){return void 0===t?[this.x0,this.x0+this.dx]:(void 0===e?(t=t,this.x0=t[0],this.dx=t[1]-this.x0):(this.x0=t,this.dx=e-this.x0),this)},s.prototype.generate=function(){var t,e;this.dx<0?t=(e=this.x0)+this.dx:e=(t=this.x0)+this.dx;var i,r=s.interval(e-t,this.n);if(0===r||!isFinite(r))return[];if(0<r){t=Math.ceil(t/r),e=Math.floor(e/r);var o=Math.ceil(e-t+1);i=new Array(o);for(var n=0;n<o;n+=1)i[n]=(t+n)*r}else{t=Math.floor(t*r),e=Math.ceil(e*r);o=Math.ceil(t-e+1);i=new Array(o);for(n=0;n<o;n+=1)i[n]=(t-n)/r}return this.dx<0&&i.reverse(),i},s.interval=function(t,e){void 0===e&&(e=10);var i=t/e,r=Math.floor(Math.log(i)/Math.LN10),o=Math.pow(10,r),n=i/o,s=Mh<=n?10:Ph<=n?5:Rh<=n?2:1;return 0<=r?o*s:-Math.pow(10,-r)/s},s}(Nh),jh=function(n){function o(t,e,i,r){var o=n.call(this)||this;return t=ro.fromAny(t),e=ro.fromAny(e),o.t0=t.time(),o.dt=e.time()-o.t0,o.zone=r||t.zone(),o.n=Math.max(0,i),o}return v(o,n),o.prototype.count=function(t){return void 0===t?this.n:(this.n=Math.max(0,t),this)},o.prototype.domain=function(t,e){return void 0===t?[new ro(this.t0,this.zone),new ro(this.t0+this.dt,this.zone)]:(void 0===e?(e=(t=t)[1],t=t[0]):t=t,t=ro.fromAny(t),e=ro.fromAny(e),this.t0=t.time(),this.dt=e.time()-this.t0,this)},o.prototype.generate=function(t){var e,i;this.dt<0?e=(i=this.t0)+this.dt:i=(e=this.t0)+this.dt,void 0===t&&(t=this.n);var r=(t=o.interval(i-e,t)).range(new ro(e,this.zone),new ro(i+1,this.zone));return this.dt<0&&r.reverse(),r},o.prototype.format=function(t){return uo.seconds().floor(t)<t?Ih.format(t):uo.minutes().floor(t)<t?zh.format(t):uo.hours().floor(t)<t?Uh.format(t):uo.days().floor(t)<t?Oh.format(t):uo.months().floor(t)<t?uo.weeks().floor(t)<t?Wh.format(t):Bh.format(t):uo.years().floor(t)<t?qh.format(t):Gh.format(t)},o.interval=function(t,e){if(void 0===e&&(e=10),"number"==typeof e){var i=Math.abs(t)/e,r=Fh.nextKey(i);if(void 0===r){var o=Nh.step(t/31536e6,e);e=uo.years(o)}else if(1e3<r)e=i/Fh.previousKey(i)<r/i?Fh.previousValue(i):Fh.nextValue(i);else{o=Math.max(1,Nh.step(t,e));e=uo.milliseconds(o)}}return e},o}(Nh),Kh=function(n){function t(t,e,i,r){var o=n.call(this)||this;return o.axis=t,o.tickGenerator=e,o.tickSpacing=i,o.tickTransition=r,o.scale=void 0,o.domain=void 0,o.range=void 0,o.domainColor=void 0,o.domainWidth=void 0,o.domainSerif=void 0,o.tickMarkColor=void 0,o.tickMarkWidth=void 0,o.tickMarkLength=void 0,o.tickLabelColor=void 0,o.tickLabelPadding=void 0,o.dirtyScale=!1,o.ticks=new si,o}return v(t,n),t.prototype.onFrame=function(i){this.scale&&this.scale.onFrame(i),this.domain&&this.domain.onFrame(i),this.range&&this.range.onFrame(i),this.domainColor&&this.domainColor.onFrame(i),this.domainWidth&&this.domainWidth.onFrame(i),this.domainSerif&&this.domainSerif.onFrame(i),this.tickMarkColor&&this.tickMarkColor.onFrame(i),this.tickMarkWidth&&this.tickMarkWidth.onFrame(i),this.tickMarkLength&&this.tickMarkLength.onFrame(i),this.tickLabelColor&&this.tickLabelColor.onFrame(i),this.tickLabelPadding&&this.tickLabelPadding.onFrame(i),this.dirtyScale&&this.updateTicks(),this.update(),this.ticks.forEach(function(t,e){e.onFrame(i)},this)},t.prototype.updateTicks=function(){this.dirtyScale=!1;var t=this.axis.scale();if(this.tickSpacing){var e=t.range(),i=Math.abs(e[1]-e[0]),r=Math.max(1,Math.floor(i/this.tickSpacing));this.tickGenerator.count(r)}this.tickGenerator.domain(t.domain());var o=this.ticks.clone(),n=this.tickGenerator.generate(),s=0;t:for(;s<n.length;){for(var a=n[s],u=o.firstKey();void 0!==u;){if(+a==+u){var h=o.get(u);o.delete(u),h.fadeIn(this.tickTransition),n.splice(s,1);continue t}u=o.nextKey(u)}var l=this.insertTick(a);l&&l.fadeIn(this.tickTransition),s+=1}o.forEach(function(t,e){e.fadeOut(this.tickTransition)},this)},t.prototype.insertTick=function(t){var e=this.tickGenerator.createElement(t);if(e){e.style.setProperty("opacity","0");var i=new nl(this,e,t);return this.axis.insertTick(e),this.ticks.set(t,i),i}return null},t.prototype.removeTick=function(t){this.axis.removeTick(t.node),this.ticks.delete(t.tickValue)},t.prototype.update=function(){this.axis.render()},t}(us),Yh=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.update=function(t){this.parent.axis.scale(t),this.parent.dirtyScale=!0},o.get=function(t){return t.axis.scale()},o.set=function(t,e){null===e?t.axisAnimator.scale=void 0:(t.axis.scale(e),t.axisAnimator.updateTicks(),t.axisAnimator.update(),t.axisAnimator.animate())},o.animator=function(t,e,i){return void 0===e||t.axisAnimator.scale||(t.axisAnimator.scale=new o(t.axisAnimator,e,i)),t.axisAnimator.scale},o}(ps),Xh=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.update=function(t){this.parent.axis.domain(t.domain()),this.parent.dirtyScale=!0},o.get=function(t){return t.axis.scale()},o.set=function(t,e){null===e?t.axisAnimator.domain=void 0:(t.axis.scale(e),t.axisAnimator.updateTicks(),t.axisAnimator.update(),t.axisAnimator.animate())},o.animator=function(t,e,i){return void 0===e||t.axisAnimator.domain||(t.axisAnimator.domain=new o(t.axisAnimator,e,i)),t.axisAnimator.domain},o}(ps),Qh=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.update=function(t){this.parent.axis.range(t.range()),this.parent.dirtyScale=!0},o.get=function(t){return t.axis.scale()},o.set=function(t,e){null===e?t.axisAnimator.range=void 0:(t.axis.scale(e),t.axisAnimator.updateTicks(),t.axisAnimator.update(),t.axisAnimator.animate())},o.animator=function(t,e,i){return void 0===e||t.axisAnimator.range||(t.axisAnimator.range=new o(t.axisAnimator,e,i)),t.axisAnimator.range},o}(ps),Zh=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.update=function(t){this.parent.axis.domainColor(t)},o.get=function(t){return t.axis.domainColor()},o.set=function(t,e){null===e?t.axisAnimator.domainColor=void 0:t.axis.domainColor(e)},o.animator=function(t,e,i){return void 0===e||t.axisAnimator.domainColor||(t.axisAnimator.domainColor=new o(t.axisAnimator,e,i)),t.axisAnimator.domainColor},o}(ps),Jh=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.update=function(t){this.parent.axis.domainWidth(t)},o.get=function(t){return t.axis.domainWidth()},o.set=function(t,e){null===e?t.axisAnimator.domainWidth=void 0:t.axis.domainWidth(e)},o.animator=function(t,e,i){return void 0===e||t.axisAnimator.domainWidth||(t.axisAnimator.domainWidth=new o(t.axisAnimator,e,i)),t.axisAnimator.domainWidth},o}(ps),$h=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.update=function(t){this.parent.axis.domainSerif(t)},o.get=function(t){return t.axis.domainSerif()},o.set=function(t,e){null===e?t.axisAnimator.domainSerif=void 0:t.axis.domainSerif(e)},o.animator=function(t,e,i){return void 0===e||t.axisAnimator.domainSerif||(t.axisAnimator.domainSerif=new o(t.axisAnimator,e,i)),t.axisAnimator.domainSerif},o}(ps),tl=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.update=function(t){this.parent.axis.tickMarkColor(t)},o.get=function(t){return t.axis.tickMarkColor()},o.set=function(t,e){null===e?t.axisAnimator.tickMarkColor=void 0:t.axis.tickMarkColor(e)},o.animator=function(t,e,i){return void 0===e||t.axisAnimator.tickMarkColor||(t.axisAnimator.tickMarkColor=new o(t.axisAnimator,e,i)),t.axisAnimator.tickMarkColor},o}(ps),el=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.update=function(t){this.parent.axis.tickMarkWidth(t)},o.get=function(t){return t.axis.tickMarkWidth()},o.set=function(t,e){null===e?t.axisAnimator.tickMarkWidth=void 0:t.axis.tickMarkWidth(e)},o.animator=function(t,e,i){return void 0===e||t.axisAnimator.tickMarkWidth||(t.axisAnimator.tickMarkWidth=new o(t.axisAnimator,e,i)),t.axisAnimator.tickMarkWidth},o}(ps),il=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.update=function(t){this.parent.axis.tickMarkLength(t)},o.get=function(t){return t.axis.tickMarkLength()},o.set=function(t,e){null===e?t.axisAnimator.tickMarkLength=void 0:t.axis.tickMarkLength(e)},o.animator=function(t,e,i){return void 0===e||t.axisAnimator.tickMarkLength||(t.axisAnimator.tickMarkLength=new o(t.axisAnimator,e,i)),t.axisAnimator.tickMarkLength},o}(ps),rl=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.update=function(t){this.parent.axis.tickLabelColor(t)},o.get=function(t){return t.axis.tickLabelColor()},o.set=function(t,e){null===e?t.axisAnimator.tickLabelColor=void 0:t.axis.tickLabelColor(e)},o.animator=function(t,e,i){return void 0===e||t.axisAnimator.tickLabelColor||(t.axisAnimator.tickLabelColor=new o(t.axisAnimator,e,i)),t.axisAnimator.tickLabelColor},o}(ps),ol=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return v(o,r),o.prototype.update=function(t){this.parent.axis.tickLabelPadding(t)},o.get=function(t){return t.axis.tickLabelPadding()},o.set=function(t,e){null===e?t.axisAnimator.tickLabelPadding=void 0:t.axis.tickLabelPadding(e)},o.animator=function(t,e,i){return void 0===e||t.axisAnimator.tickLabelPadding||(t.axisAnimator.tickLabelPadding=new o(t.axisAnimator,e,i)),t.axisAnimator.tickLabelPadding},o}(ps);(Ah=kh||(kh={}))[Ah.Excluded=0]="Excluded",Ah[Ah.Entering=1]="Entering",Ah[Ah.Included=2]="Included",Ah[Ah.Leaving=3]="Leaving";var nl=function(o){function t(t,e,i){var r=o.call(this,t)||this;return r.node=e,r.tickValue=i,r.tickState=0,r.opacity=null,r.coord0=NaN,r}return v(t,o),t.prototype.onFrame=function(t){this.opacity&&this.opacity.onFrame(t)},t.prototype.remove=function(){this.parent.removeTick(this)},t.prototype.fadeIn=function(t){if(0===this.tickState||3===this.tickState){this.coord0=NaN;var e=this.opacity;e||(t.f||(t=t.range(0)),e=new sl(this,0,t),this.opacity=e),this.tickState=1,e.set(1,t)}},t.prototype.fadeOut=function(t){if(1===this.tickState||2===this.tickState){this.coord0=NaN;var e=this.opacity;e||(t.f||(t=t.range(1)),e=new sl(this,1,t),this.opacity=e),this.tickState=3,e.set(0,t)}},t}(hs),sl=function(r){function t(t,e,i){return r.call(this,t,e,i)||this}return v(t,r),t.prototype.map=function(t){var e=+this.parent.node.tickCoord;isNaN(this.parent.coord0)&&(this.parent.coord0=e);var i=this.parent.parent.tickSpacing/2,r=Math.min(Math.abs(e-this.parent.coord0)/i,1)||0;return this.f.map(Math.max(t,r))},t.prototype.update=function(t){this.parent.node.style.setProperty("opacity",""+t)},t.prototype.onEnd=function(t){this.parent.coord0=NaN,0===t?(this.parent.tickState=0,this.parent.remove()):1===t&&(this.parent.tickState=2)},t}(ps),al=function(f){function o(t,e,i,r){void 0===e&&(e=Nh.scale(t.scale())),void 0===i&&(i="left"===t.orientation||"right"===t.orientation?40:80),void 0===r&&(r=new jn(200,"linear"));var o=f.call(this,t.node)||this;return o.axis=t,o._tickGenerator=e,o._tickSpacing=i,o._tickTransition=r,o.axisAnimator=new Kh(o.axis,o._tickGenerator,o._tickSpacing,o._tickTransition),o}return v(o,f),Object.defineProperty(o.prototype,"orientation",{get:function(){return this.axis.orientation},enumerable:!0,configurable:!0}),o.prototype.frame=function(t){return void 0===t?this.axis.frame():(this.axis.frame(t),this)},o.prototype.scale=function(t,e){return void 0!==t&&(t=Eh.scale(t)),this.property(Yh,t,e)},o.prototype.domain=function(t,e,i){var r=this.axis.scale();"string"==typeof t?r=r.domain(Eh.scale(t).domain()):void 0!==t&&(r=r.domain(t,e));var o=this.property(Xh,r,i);return o instanceof bn&&(o=o.domain()),o},o.prototype.range=function(t,e,i){var r=this.axis.scale();"string"==typeof t?r=r.range(Eh.scale(t).range()):void 0!==t&&(r=r.range(t,e));var o=this.property(Qh,r,i);return o instanceof bn&&(o=o.range()),o},o.prototype.transformFrame=function(){return this.axis.transformFrame()},o.prototype.domainColor=function(t,e){return this.propertyColor(Zh,t,e)},o.prototype.domainWidth=function(t,e){return this.propertyNumber(Jh,t,e)},o.prototype.domainSerif=function(t,e){return this.propertyNumber($h,t,e)},o.prototype.tickGenerator=function(t){return void 0===t?this._tickGenerator:(this._tickGenerator=t,this.axisAnimator.tickGenerator=t,this.axisAnimator.animate(),this)},o.prototype.tickSpacing=function(t){return void 0===t?this._tickSpacing:(this._tickSpacing=t,this.axisAnimator.tickSpacing=t,this.axisAnimator.animate(),this)},o.prototype.tickTransition=function(t){return void 0===t?this._tickTransition:(this._tickTransition=t,this.axisAnimator.tickTransition=t,this)},o.prototype.tickMarkColor=function(t,e){return this.propertyColor(tl,t,e)},o.prototype.tickMarkWidth=function(t,e){return this.propertyNumber(el,t,e)},o.prototype.tickMarkLength=function(t,e){return this.propertyNumber(il,t,e)},o.prototype.tickLabelColor=function(t,e){return this.propertyColor(rl,t,e)},o.prototype.tickLabelPadding=function(t,e){return this.propertyNumber(ol,t,e)},o.prototype.render=function(){this.axisAnimator.updateTicks(),this.axisAnimator.update()},o.prototype.didReview=function(t){f.prototype.didReview.call(this,t),this.axisAnimator.enabled(t)},o.prototype.didSetState=function(t,e){f.prototype.didSetState.call(this,t,e);var i=t.get("transition").cast(jn.Form);t.get("hidden").booleanValue()?this.node.setAttribute("visibility","hidden"):this.node.removeAttribute("visibility");var r=t.get("domainColor").cast(qo.Form);r&&this.domainColor(r,i);var o=t.get("domainWidth").numberValue();void 0!==o&&this.domainWidth(o,i);var n=t.get("domainSerif").numberValue();void 0!==n&&this.domainSerif(n,i);var s=t.get("tickSpacing").numberValue();void 0!==s&&this.tickSpacing(s);var a=t.get("tickTransition").cast(jn.Form);void 0!==a&&this.tickTransition(a);var u=t.get("tickMarkColor").cast(qo.Form);u&&this.tickMarkColor(u,i);var h=t.get("tickMarkWidth").numberValue();void 0!==h&&this.tickMarkWidth(h,i);var l=t.get("tickMarkLength").numberValue();void 0!==l&&this.tickMarkLength(l,i);var p=t.get("tickLabelColor").cast(qo.Form);p&&this.tickLabelColor(p,i);var c=t.get("tickLabelPadding").numberValue();void 0!==c&&this.tickLabelPadding(c,i);var d=t.get("tickLabelWeight").numberValue();void 0!==d&&this.node.setAttribute("font-weight",""+d)},o.prototype.addObserver=function(t){this.axis.addObserver(t)},o.prototype.removeObserver=function(t){this.axis.removeObserver(t)},o.top=function(t,e,i,r){return new o(Eh.top(t),e,i,r)},o.right=function(t,e,i,r){return new o(Eh.right(t),e,i,r)},o.bottom=function(t,e,i,r){return new o(Eh.bottom(t),e,i,r)},o.left=function(t,e,i,r){return new o(Eh.left(t),e,i,r)},o.applyTheme=function(t){var e=F.empty().slot("domainColor","#ececec").slot("tickMarkColor","#ececec").slot("tickLabelColor",q.get("textColor")).slot("tickLabelWeight",300);t.set("axis",e)},o}(Sa);al.applyTheme(al.Theme);var ul=function(s){function t(){return null!==s&&s.apply(this,arguments)||this}return v(t,s),Object.defineProperty(t.prototype,"tag",{get:function(){return"axis"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new hl,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){if(e.key instanceof O&&"domain"===e.key.value){var o=e.toValue().getItem(0).cast(ws.Form),n=e.toValue().getItem(1).cast(ws.Form);void 0!==o&&void 0!==n&&t.domain([o,n])}return s.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:s.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(Da);ma.addGlobal(ul.Form);var hl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Params=Va.Params.concat([new qs("transition",q.get("transition").or(q.get("axis").get("transition"))),new qs("hidden",q.get("hidden")),new qs("domainColor",q.get("domainColor").or(q.get("axis").get("domainColor"))),new qs("domainWidth",q.get("domainWidth").or(q.get("axis").get("domainWidth"))),new qs("domainSerif",q.get("domainSerif").or(q.get("axis").get("domainSerif"))),new qs("tickSpacing",q.get("tickSpacing").or(q.get("axis").get("tickSpacing"))),new qs("tickTransition",q.get("tickTransition").or(q.get("axis").get("tickTransition"))),new qs("tickMarkColor",q.get("tickMarkColor").or(q.get("axis").get("tickMarkColor"))),new qs("tickMarkWidth",q.get("tickMarkWidth").or(q.get("axis").get("tickMarkWidth"))),new qs("tickMarkLength",q.get("tickMarkLength").or(q.get("axis").get("tickMarkLength"))),new qs("tickLabelColor",q.get("tickLabelColor").or(q.get("axis").get("tickLabelColor"))),new qs("tickLabelPadding",q.get("tickLabelPadding").or(q.get("axis").get("tickLabelPadding"))),new qs("tickLabelWeight",q.get("tickLabelWeight").or(q.get("axis").get("tickLabelWeight")))]),e}(Va),ll=function(i){function t(t){var e=i.call(this,t.node)||this;return e.plot=t,e._axisX=null,e._axisY=null,e._activePoint=null,e.plot.addObserver(e),e}return v(t,i),t.prototype.getPoint=function(t){return this.plot.getPoint(t)},t.prototype.insertPoint=function(t){this.plot.insertPoint(t)},t.prototype.removePoint=function(t){var e=this.plot.getPoint(t);e&&e._clickPopover&&e._clickPopover.hide(),this.plot.removePoint(t)},t.prototype.axisX=function(t){return void 0===t?this._axisX:(this._axisX=t,this.plot.axisX(t?t.axis:null),this)},t.prototype.scaleX=function(t,e){if(!this._axisX)throw new Error;return void 0===t?this._axisX.scale():(this._axisX.scale(t,e),this)},t.prototype.domainX=function(t,e,i){if(!this._axisX)throw new Error;return void 0===t?this._axisX.domain():(this._axisX.domain(t,e,i),this)},t.prototype.rangeX=function(t,e,i){if(!this._axisX)throw new Error;return void 0===t?this._axisX.range():(this._axisX.range(t,e,i),this)},t.prototype.axisY=function(t){return void 0===t?this._axisY:(this._axisY=t,this.plot.axisY(t?t.axis:null),this)},t.prototype.scaleY=function(t,e){if(!this._axisY)throw new Error;return void 0===t?this._axisY.scale():(this._axisY.scale(t,e),this)},t.prototype.domainY=function(t,e,i){if(!this._axisY)throw new Error;return void 0===t?this._axisY.domain():(this._axisY.domain(t,e,i),this)},t.prototype.rangeY=function(t,e,i){if(!this._axisY)throw new Error;return void 0===t?this._axisY.range():(this._axisY.range(t,e,i),this)},t.prototype.transformX=function(t){return void 0===t?this.plot.transformX():(this.plot.transformX(t),this)},t.prototype.transformY=function(t){return void 0===t?this.plot.transformY():(this.plot.transformY(t),this)},t.prototype.plotDidScaleX=function(t,e,i){console.info("plot-controller.plotDidScaleX")},t.prototype.plotDidScaleY=function(t,e,i){console.info("plot-controller.plotDidScaleY")},t.prototype.plotDidInsertPoint=function(t,e){console.info("plot-controller.plotDidInsertPoint")},t.prototype.plotDidRemovePoint=function(t,e){console.info("plot-controller.plotDidRemovePoint")},t.prototype.plotOnClick=function(t,e){this._activePoint&&this._activePoint.onPlotPointClick(t,e)},t.prototype.plotOnMouseMove=function(t,e){var o=this,n=t.offsetX-e.gutterLeft().value,s=t.offsetY-e.gutterTop().value,a=null;0<=n&&0<=s&&this.plot.getPoints().forEach(function(t){var e=o.getPoint(t);if(e){var i=n-Math.round(e.offsetX||0),r=s-Math.round(e.offsetY||0);i<=3&&-3<=i&&r<=3&&-3<=r&&(a=e)}});this._activePoint!==a&&(this._activePoint&&this._activePoint.onPointMouseOut(),this._activePoint=a,this._activePoint&&this._activePoint.onPointMouseOver(t,e))},t.prototype.insertPlotPointControllers=function(){for(var t=0;t<this._childViews.length;t+=1){var e=this._childViews[t];e instanceof yl&&void 0!==e._x&&this.insertPoint(e)}},t.prototype.render=function(){var i=this;this.plot.getPoints().forEach(function(t){var e=i.getPoint(t);e&&e._clickPopover&&i.parentView&&e.movePopup(i.parentView.chart)})},t.prototype.addObserver=function(t){this.plot.addObserver(t)},t.prototype.removeObserver=function(t){this.plot.removeObserver(t)},t}(Sa),pl=function(l){function e(t){var e=l.call(this,t)||this;return e.display("flex").visibility("hidden").position("absolute").placement(["top","bottom","right","left"]).borderRadius(3),e}return v(e,l),e.prototype.sourceSize=function(t){return void 0===t?this._sourceSize:(this._sourceSize=t||0,this)},e.prototype.setPivot=function(t,e,i){this._chartView=t,this._x=e||0,this._y=i||0,this.replace()},e.prototype.viewPort=function(){this._chartView},e.prototype.replace=function(){if(this._chartView){var t=this._sourceSize||10,e=this._sourceSize||10,i=this._chartView.node.getBoundingClientRect(),r=i.left,o=i.top,n=this.node.getBoundingClientRect(),s=n.left-this.node.offsetLeft,a=n.top-this.node.offsetTop,u=Math.round(this._x-t/2+r-s),h=Math.round(this._y-e/2+o-a);u===this.view.sourceLeft().pxValue()&&h===this.view.sourceTop().pxValue()||(this.view.sourceLeft(u),this.view.sourceTop(h),this.view.sourceWidth(t),this.view.sourceHeight(e),this.animator.update())}else l.prototype.replace.call(this)},e.prototype.didSetState=function(t,e){l.prototype.didSetState.call(this,t,e);var i=t.get("popoverWidth").cast(Lo.Form);i&&(this.width(i),this._width=i);var r=t.get("popoverHeight").cast(Lo.Form);r&&(this.height(r),this._height=r),e.isDefined()||(this.visibility(null),this.render())},e.create=function(t){if(t instanceof e)return t;if(t instanceof _a)throw new TypeError(""+t);if(void 0===t||"string"==typeof t)return new e(ms.create(t));if(t.view instanceof e)return t.view;if(t.view)throw new TypeError(""+t.view);if(t instanceof HTMLElement)return new e(new ms(t));throw new TypeError(""+t)},e}(Ka),cl=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return v(t,n),Object.defineProperty(t.prototype,"tag",{get:function(){return"plotPopover"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=pl.create(),o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new dl,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){if(e.key instanceof O&&"body"===e.key.value){var o=r.castView(e.toValue(),i,r);if(o)return t.append(o),o}return n.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:n.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(za);ma.addGlobal(cl.Form);var dl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Params=Ya.Params.concat([new qs("popoverWidth",q.get("popoverWidth").or(q.get("popover").get("width"))),new qs("popoverHeight",q.get("popoverHeight").or(q.get("popover").get("height")))]),e}(Ya),fl=function(i){function t(t){var e=i.call(this)||this;return e._parentView=t,e}return v(t,i),Object.defineProperty(t.prototype,"parentView",{get:function(){return this._parentView},set:function(t){this._parentView=t},enumerable:!0,configurable:!0}),t.prototype.onFrame=function(t){for(var e in this)this[e]instanceof ps&&this[e].onFrame(t);this.update()},t.prototype.update=function(){this._parentView&&(this._parentView.plot._dirty=!0,this._parentView.render())},t}(us),yl=function(c){function t(){var t=c.call(this)||this;return t.animator=new fl,t}return v(t,c),t.prototype.y=function(t){return void 0===t?this._y:(this._y=t,this)},t.prototype.dy=function(t){return void 0===t?this._dy:(this._dy=t,this)},t.prototype.r=function(t){return void 0===t?this._r:(this._r=t,this)},t.prototype.color=function(t){return void 0===t?this._color:(this._color=t||qo.transparent(),this)},t.prototype.opacity=function(t){return void 0===t?this._r:(this._opacity=t,this)},t.prototype.plotY=function(t,e){return this.propertyKeyNumber(Ba,"y",t,e)},t.prototype.plotDy=function(t,e){return this.propertyKeyNumber(Ba,"dy",t,e)},t.prototype.plotR=function(t,e){return this.propertyKeyNumber(Ba,"r",t,e)},t.prototype.plotColor=function(t,e){return this.propertyKeyColor(Na,"color",t,e)},t.prototype.plotOpacity=function(t,e){return this.propertyKeyNumber(Ba,"opacity",t,e)},t.prototype.onPlotPointClick=function(t,e){t.stopPropagation(),this._chartView||(this._chartView=e),this._clickPopover&&this._clickPopover.hide(),this._clickPopoverTemplate&&this.appView&&(this._clickPopover=cl.Form.castView(this._clickPopoverTemplate,this.stack(),ma.Global),this._clickPopover?(this._hoverPopover&&this._hoverPopover.hide(),this.movePopup(e),this._clickPopover.addObserver(this),this.appendChildView(this._clickPopover),this.appView.showPopover(this._clickPopover,{exclusive:!t.shiftKey})):this._hoverPopover&&(this._clickPopover=this._hoverPopover,this._hoverPopover=void 0))},t.prototype.onPointMouseOver=function(t,e){this._chartView||(this._chartView=e),this._hoverPopover&&this._hoverPopover.hide(),this._hoverPopoverTemplate&&this.appView&&(this._hoverPopover=cl.Form.castView(this._hoverPopoverTemplate,this.stack(),ma.Global),this._hoverPopover?(this._clickPopover&&this._clickPopover.hide(),this.movePopup(e),this._hoverPopover.addObserver(this),this.appendChildView(this._hoverPopover),this.appView.showPopover(this._hoverPopover,{exclusive:!1})):this._clickPopover&&(this._hoverPopover=this._clickPopover,this._clickPopover=void 0))},t.prototype.onPointMouseOut=function(){this._hoverPopover&&this._hoverPopover.hide()},t.prototype.didSetModel=function(t){this._clickPopover&&this._clickPopover.setModel(t)},t.prototype.movePopup=function(t){var e=this._clickPopover||this._hoverPopover;if(e){var i=this.parentView?this.parentView.plot._circleRadius:void 0,r=this._r||i||10,o=(this.offsetX||0)+t.gutterLeft().pxValue()-r/2,n=(this.offsetY||0)+t.gutterTop().pxValue()+r/2;e.sourceSize(r),e.setPivot(t,o,n)}},t.prototype.popoverDidHide=function(t){this._hoverPopover&&this._hoverPopover.view===t&&(this._hoverPopover=void 0),this._clickPopover&&this._clickPopover.view===t&&(this._clickPopover=void 0)},t.prototype.didSetState=function(t,e){c.prototype.didSetState.call(this,t,e);var i=t.get("transition").cast(jn.Form),r=t.get("x").cast(ws.Form);void 0!==r&&(this._x=r);var o=t.get("y").cast(ws.Form);void 0!==o&&(this._y||(this._y=o),this.plotY(o,i));var n=t.get("dy").cast(ws.Form);void 0!==n&&this.plotDy(n,i);var s=t.get("r").numberValue();void 0!==s&&this.plotR(s,i);var a=t.get("color").cast(qo.Form);a&&(this._color=a);var u=t.get("opacity").numberValue();void 0!==u&&this.plotOpacity(u,i);var h=t.get("offsetX").numberValue();void 0!==h&&(this.offsetX=h);var l=t.get("offsetY").numberValue();void 0!==l&&(this.offsetY=l);var p=t.get("offsetDY").numberValue();void 0!==p&&(this.offsetDY=p),this.parentView instanceof ll&&(this.animator.parentView=this.parentView)},t.prototype.appendEventHandlers=function(t){console.log("loading events"),this.parentView instanceof ll&&console.log("this.parentView: ",this.parentView)},t}(ga),ml=function(u){function t(){return null!==u&&u.apply(this,arguments)||this}return v(t,u),Object.defineProperty(t.prototype,"tag",{get:function(){return"plotPoint"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=new yl,o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new vl,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){if(e.key instanceof O){var o=e.key.value;if("click"===o){var n=e.toValue();t._clickPopoverTemplate=n.get("popover")}else if("hover"===o){var s=e.toValue();t._hoverPopoverTemplate=s.get("popover")}else if("events"===o){var a=e.toValue();t.appendEventHandlers(a)}}return u.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:u.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(ma);ma.addGlobal(ml.Form);var vl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Params=Gs.Params.concat([new qs("transition",q.get("transition")),new qs("x",q.get("x")),new qs("y",q.get("y")),new qs("dy",q.get("dy")),new qs("r",q.get("r")),new qs("color",q.get("color")),new qs("opacity",q.get("opacity")),new qs("offsetX",q.get("offsetX")),new qs("offsetY",q.get("offsetY")),new qs("offsetDY",q.get("offsetDY")),new qs("click",q.get("click")),new qs("hover",q.get("hover")),new qs("popover",q.get("click").get("popover"))]),e}(Gs),gl=function(){function t(t){this.node=t,this._axisX=null,this._axisY=null,this._scaleX=null,this._scaleY=null,this._transformX=null,this._transformY=null,this._points=new si,this._dirty=!0,this._observers=[],this._parentView=null}return t.prototype.getPoints=function(){return this._points},t.prototype.getPoint=function(t){return this._points.get(t)},t.prototype.willInsertPoint=function(t){},t.prototype.didInsertPoint=function(t){},t.prototype.willRemovePoint=function(t){},t.prototype.didRemovePoint=function(t){},t.prototype.insertPoint=function(t){if(!this._points.has(t._x)){for(var e=0;e<this._observers.length;e+=1){(i=this._observers[e]).plotWillInsertPoint&&i.plotWillInsertPoint(t,this)}this.willInsertPoint(t),this._points.set(t._x,t),this._dirty=!0,this.didInsertPoint(t);for(e=0;e<this._observers.length;e+=1){var i;(i=this._observers[e]).plotDidInsertPoint&&i.plotDidInsertPoint(t,this)}}},t.prototype.removePoint=function(t){var e=this._points.get(t);if(e){for(var i=0;i<this._observers.length;i+=1){(r=this._observers[i]).plotWillRemovePoint&&r.plotWillRemovePoint(e,this)}this.willRemovePoint(e),this._points.delete(t),this._dirty=!0,this.didRemovePoint(e);for(i=0;i<this._observers.length;i+=1){var r;(r=this._observers[i]).plotDidRemovePoint&&r.plotDidRemovePoint(e,this)}}},t.prototype.dataDomainX=function(){if(!this._points.isEmpty())return[this._points.firstKey(),this._points.lastKey()]},t.prototype.dataRangeX=function(){if(!this._points.isEmpty()){var t=this._scaleX;return[t.scale(this._points.firstKey()),t.scale(this._points.lastKey())]}},t.prototype.dataDomainY=function(){var r,o;if(!this._points.isEmpty()&&(this._points.forEach(function(t,e){var i=e._y;void 0!==i&&((void 0===r||0<V(r,i))&&(r=i),(void 0===o||V(o,i)<0)&&(o=i))},this),void 0!==r&&void 0!==o))return[r,o]},t.prototype.dataRangeY=function(){if(!this._points.isEmpty()){var r,o,n=this._scaleY;if(this._points.forEach(function(t,e){if(void 0!==e._y){var i=n.scale(e._y);(void 0===r||i<r)&&(r=i),(void 0===o||o<i)&&(o=i)}},this),void 0!==r&&void 0!==o)return[r,o]}},t.prototype.parentView=function(t){return void 0===t?this._parentView:(this._parentView=t||null,this)},t.prototype.axisX=function(t){return void 0===t?this._axisX:(this._axisX&&this._axisX.removeObserver(this),this._axisX=t,this._axisX&&(this._scaleX=this._axisX.scale(),this._axisX.addObserver(this),this._dirty=!0),this)},t.prototype.scaleX=function(t){if(!this._axisX)throw new Error;return void 0===t?this._axisX.scale():(this._axisX.scale(t),this._dirty=!0,this)},t.prototype.domainX=function(t,e){if(!this._axisX)throw new Error;return void 0===t?this._axisX.domain():(this._axisX.domain(t,e),this._dirty=!0,this)},t.prototype.rangeX=function(t,e){if(!this._axisX)throw new Error;return void 0===t?this._axisX.range():(this._axisX.range(t,e),this._dirty=!0,this)},t.prototype.axisY=function(t){return void 0===t?this._axisY:(this._axisY&&this._axisY.removeObserver(this),this._axisY=t,this._axisY&&(this._scaleY=this._axisY.scale(),this._axisY.addObserver(this),this._dirty=!0),this)},t.prototype.scaleY=function(t){if(!this._axisY)throw new Error;return void 0===t?this._axisY.scale():(this._axisY.scale(t),this._dirty=!0,this)},t.prototype.domainY=function(t,e){if(!this._axisY)throw new Error;return void 0===t?this._axisY.domain():(this._axisY.domain(t,e),this._dirty=!0,this)},t.prototype.rangeY=function(t,e){if(!this._axisY)throw new Error;return void 0===t?this._axisY.range():(this._axisY.range(t,e),this._dirty=!0,this)},t.prototype.transformX=function(t){return void 0===t?this._transformX:((this._transformX=t)?this.retransform():this._dirty=!0,this)},t.prototype.transformY=function(t){return void 0===t?this._transformY:((this._transformY=t)?this.retransform():this._dirty=!0,this)},t.prototype.transform=function(){return this._transformX&&this._transformY?this._transformX.transform(this._transformY):this._transformX?this._transformX:this._transformY?this._transformY:null},t.prototype.retransform=function(){var t=this.transform();t?this.node.setAttribute("transform",t.toAttributeString()):this.node.removeAttribute("transform")},t.prototype.addObserver=function(t){this._observers.indexOf(t)<0&&this._observers.push(t)},t.prototype.removeObserver=function(t){var e=this._observers.indexOf(t);0<=e&&this._observers.splice(e,1)},t.prototype.axisDidScale=function(t,e){e===this._axisX?this.axisXDidScale(t):e===this._axisY&&this.axisYDidScale(t)},t.prototype.axisXDidScale=function(t){this._transformX=this._axisX.transformFrame(),this._transformX?this.retransform():(this._scaleX=t,this._dirty=!0);for(var e=0;e<this._observers.length;e+=1){var i=this._observers[e];i.plotDidScaleX&&i.plotDidScaleX(t,this._axisX,this)}},t.prototype.axisYDidScale=function(t){this._transformY=this._axisY.transformFrame(),this._transformY?this.retransform():(this._scaleY=t,this._dirty=!0);for(var e=0;e<this._observers.length;e+=1){var i=this._observers[e];i.plotDidScaleY&&i.plotDidScaleY(t,this._axisY,this)}},t}(),bl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.addGlobal=function(t){e.Global=e.Global.withUiForm(t)},e.removeGlobal=function(t){e.Global=e.Global.withoutUiForm(t)},e.Global=new va([]),e}(Da),wl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e}(Va),_l=function(i){function e(t){var e=i.call(this,t)||this;return e._stops=new si,e._areaFill=qo.transparent(.5),e.areaPath=document.createElementNS("http://www.w3.org/2000/svg","path"),e.areaPath.setAttribute("class","area"),e.areaPath.setAttribute("stroke","none"),e.node.appendChild(e.areaPath),e.gradient=document.createElementNS("http://www.w3.org/2000/svg","linearGradient"),e.gradient.setAttribute("id",C.generateId()),e.gradient.setAttribute("gradientUnits","userSpaceOnUse"),e.gradient.setAttribute("x1","0"),e.gradient.setAttribute("y1","0"),e.gradient.setAttribute("x2","0"),e.gradient.setAttribute("y2","0"),e}return v(e,i),e.prototype.areaFill=function(t){return void 0===t?this._areaFill:(t=qo.fromAny(t),this._areaFill.equals(t)||(this._areaFill=t,this._dirty=!0),this)},e.prototype.didInsertPoint=function(t){var e=this._stops.get(t._x);if(e&&(this._stops.delete(t._x),this.gradient.removeChild(e)),t._color||void 0!==t._opacity){var i=document.createElementNS("http://www.w3.org/2000/svg","stop");t._color&&i.setAttribute("stop-color",t._color.toString()),void 0!==t._opacity&&i.setAttribute("stop-opacity",""+t._opacity),this._stops.set(t._x,i),this.gradient.insertBefore(i,this._stops.nextValue(t._x)||null)}},e.prototype.willRemovePoint=function(t){var e=this._stops.get(t._x);e&&(this._stops.delete(t._x),this.gradient.removeChild(e))},e.prototype.render=function(){this._dirty&&this._axisX&&this._axisY&&(this._dirty=!1,this.renderPlot())},e.prototype.renderPlot=function(){var t,e,i,r=this._scaleX,o=this._scaleY,n=new Yu,s=this._points.size;if(0<s){var a=this._points.firstValue(),u=this._points.lastValue();t=r.scale(a._x),i=(e=r.scale(u._x))-t,a.offsetX=t,a.offsetY=o.scale(a._y),n.moveTo(a.offsetX,a.offsetY);var h=this._stops.get(a._x);if(h&&(a._color||h.setAttribute("stop-color",this._areaFill.toString()),i)){var l=(a.offsetX-t)/i;h.setAttribute("offset",""+l)}}else i=e=t=NaN;var p=this._points.entries();for(p.next();p.hasNext();){var c=p.next().value,d=c[0];(y=c[1]).offsetX=r.scale(y._x),y.offsetY=o.scale(y._y),n.lineTo(y.offsetX,y.offsetY);var f=this._stops.get(d);if(f&&(y._color||f.setAttribute("stop-color",this._areaFill.toString()),i)){l=(y.offsetX-t)/i;f.setAttribute("offset",""+l)}}for(;p.hasPrevious();){var y;(y=p.previous().value[1]).offsetDY=void 0!==y._dy?o.scale(y._dy):y.offsetY,n.lineTo(y.offsetX,y.offsetDY)}0<s&&n.closePath(),this.retransform(),isFinite(t)&&isFinite(e)&&(this.gradient.setAttribute("x1",""+t),this.gradient.setAttribute("x2",""+e),this._stops.size?(this.gradient.parentNode||this.node.insertBefore(this.gradient,this.node.firstChild),this.areaPath.setAttribute("fill","url(#"+this.gradient.getAttribute("id")+")")):(this.gradient.parentNode&&this.node.removeChild(this.gradient),this.areaPath.setAttribute("fill",this._areaFill.toString()))),this.areaPath.setAttribute("d",n.toString())},e.create=function(){var t=document.createElementNS("http://www.w3.org/2000/svg","g");return t.setAttribute("pointer-events","none"),t.setAttribute("class","plot area-plot"),new e(t)},e}(gl),xl=function(i){function t(t){var e=i.call(this)||this;return e.plot=t,e}return v(t,i),t.prototype.onFrame=function(t){for(var e in this)this[e]instanceof ps&&this[e].onFrame(t);this.update()},t.prototype.update=function(){var t=this.plot.node;t.view instanceof kl&&t.view.insertPlotPointControllers(),this.plot.render()},t}(us),kl=function(o){function t(t){var e=o.call(this,t)||this;return e.view=t,e.animator=new xl(e.view),e}return v(t,o),t.prototype.areaFill=function(t,e){return this.propertyKeyColor(Na,"areaFill",t,e)},t.prototype.didRemoveChildView=function(t){o.prototype.didRemoveChildView.call(this,t),t instanceof yl&&this.removePoint(t._x)},t.prototype.plotDidScaleX=function(t,e,i){this.animator.animate()},t.prototype.plotDidScaleY=function(t,e,i){this.animator.animate()},t.prototype.plotDidInsertPoint=function(t,e){this.animator.animate()},t.prototype.plotDidRemovePoint=function(t,e){this.animator.animate()},t.prototype.render=function(){this.animator.update()},t.prototype.didReview=function(t){o.prototype.didReview.call(this,t),this.animator.enabled(t)},t.prototype.didSetState=function(t,e){o.prototype.didSetState.call(this,t,e);var i=t.get("transition").cast(jn.Form),r=t.get("areaFill").cast(qo.Form);r&&this.areaFill(r,i)},t.create=function(){return new t(_l.create())},t.applyTheme=function(t){var e=q.get("value"),i=q.get("primaryHue").invoke(e).or(q.get("primaryColor")),r=F.empty().slot("areaFill",i);t.set("plotArea",r)},t}(ll);kl.applyTheme(kl.Theme);var Al=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return v(t,n),Object.defineProperty(t.prototype,"tag",{get:function(){return"plotArea"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){var r=kl.create();return r.setModel(this.materializeView(r,t,e,i)),r},t.prototype.castModel=function(t,e,i){var r=new El;return r.setData(this.materializeModel(r,t,e,i)),r},t.prototype.materializeViewParam=function(t,e,i,r){var o=r.castView(e.toValue(),i,r);return o instanceof ga?(t.appendChildView(o),o):n.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:n.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(bl);ma.addGlobal(Al.Form),bl.addGlobal(Al.Form);var El=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Params=wl.Params.concat([new qs("transition",q.get("transition").or(q.get("plotCircle").get("transition"))),new qs("areaFill",q.get("areaFill").or(q.get("plotCircle").get("areaFill")))]),e}(wl),Cl=function(i){function e(t){var e=i.call(this,t)||this;return e._areaFill=qo.black(),e._lineColor=null,e._lineWidth=1,e._circleRadius=5,e._circleOpacity=1,e.circlePath=new si,e}return v(e,i),e.prototype.areaFill=function(t){return void 0===t?this._areaFill:(t=qo.fromAny(t),this._areaFill.equals(t)||(this._areaFill=t,this._dirty=!0),this)},e.prototype.lineColor=function(t){return void 0===t?this._lineColor:(null===t?null!==this._lineColor&&(this._lineColor=null,this._dirty=!0):(t=qo.fromAny(t),this._lineColor&&this._lineColor.equals(t)||(this._lineColor=t,this._dirty=!0)),this)},e.prototype.lineWidth=function(t){return void 0===t?this._lineWidth:(this._lineWidth!==t&&(this._lineWidth=t,this._dirty=!0),this)},e.prototype.circleRadius=function(t){return void 0===t?this._circleRadius:(this._circleRadius!==t&&(this._circleRadius=t,this._dirty=!0),this)},e.prototype.circleOpacity=function(t){return void 0===t?this._circleOpacity:(this._circleOpacity!==t&&(this._circleOpacity=t,this._dirty=!0),this)},e.prototype.render=function(){this._dirty&&this._axisX&&this._axisY&&(this._dirty=!1,this.renderPlot())},e.prototype.didInsertPoint=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttribute("data-index",""+t._x),this.node.appendChild(e),this.circlePath.set(t._x,e)},e.prototype.didRemovePoint=function(t){var e=this.circlePath.get(t._x);e&&(this.node.removeChild(e),this.circlePath.delete(t._x))},e.prototype.renderPlot=function(){var t=this._scaleX,e=this._scaleY,i=this._points.entries();for(i.next();i.hasNext();){var r=i.next().value,o=r[0],n=r[1],s=n._r?n._r:this._circleRadius,a=n._color?n._color:this._areaFill,u=null!==n._opacity&&void 0!==n._opacity?n._opacity:this._circleOpacity;n.offsetX=t.scale(n._x),n.offsetY=e.scale(n._y);var h=this.circlePath.get(o);h&&(h.setAttribute("r",""+s),h.setAttribute("cx",""+n.offsetX),h.setAttribute("cy",""+n.offsetY),h.setAttribute("fill",""+a),h.setAttribute("opacity",""+u),h.setAttribute("stroke",""+(this._lineColor?this._lineColor:"none"))),this.retransform()}},e.create=function(){var t=document.createElementNS("http://www.w3.org/2000/svg","g");return t.setAttribute("pointer-events","none"),t.setAttribute("class","plot circle-plot"),new e(t)},e}(gl),Sl=function(i){function t(t){var e=i.call(this)||this;return e.plot=t,e}return v(t,i),t.prototype.onFrame=function(t){for(var e in this)this[e]instanceof ps&&this[e].onFrame(t);this.update()},t.prototype.update=function(){var t=this.plot.node;t.view instanceof Vl&&t.view.insertPlotPointControllers(),this.plot.render()},t}(us),Vl=function(s){function t(t){var e=s.call(this,t)||this;return e.view=t,e.animator=new Sl(e.view),e}return v(t,s),t.prototype.areaFill=function(t,e){return this.propertyKeyColor(Na,"areaFill",t,e)},t.prototype.lineColor=function(t,e){return this.propertyKeyColor(Na,"lineColor",t,e)},t.prototype.lineWidth=function(t,e){return this.propertyKeyNumber(Ba,"lineWidth",t,e)},t.prototype.didRemoveChildView=function(t){s.prototype.didRemoveChildView.call(this,t),t instanceof yl&&this.removePoint(t._x)},t.prototype.plotDidScaleX=function(t,e,i){this.animator.animate()},t.prototype.plotDidScaleY=function(t,e,i){this.animator.animate()},t.prototype.plotDidInsertPoint=function(t,e){this.animator.animate()},t.prototype.plotDidRemovePoint=function(t,e){this.animator.animate()},t.prototype.render=function(){s.prototype.render.call(this),this.animator.update()},t.prototype.didReview=function(t){s.prototype.didReview.call(this,t),this.animator.enabled(t)},t.prototype.didSetState=function(t,e){s.prototype.didSetState.call(this,t,e);var i=t.get("transition").cast(jn.Form),r=t.get("areaFill").cast(qo.Form);r&&this.areaFill(r,i);var o=t.get("lineColor").cast(qo.Form);o&&this.lineColor(o,i);var n=t.get("lineWidth").numberValue();n&&this.lineWidth(n,i)},t.create=function(){return new t(Cl.create())},t.applyTheme=function(t){var e=q.get("value"),i=q.get("primaryHue").invoke(e).or(q.get("primaryColor")),r=F.empty().slot("areaFill",i);t.set("plotCircle",r)},t}(ll);Vl.applyTheme(Vl.Theme);var Dl=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return v(t,n),Object.defineProperty(t.prototype,"tag",{get:function(){return"plotCircle"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){var r=Vl.create();return r.setModel(this.materializeView(r,t,e,i)),r},t.prototype.castModel=function(t,e,i){var r=new Ml;return r.setData(this.materializeModel(r,t,e,i)),r},t.prototype.materializeViewParam=function(t,e,i,r){var o=r.castView(e.toValue(),i,r);return o instanceof ga?(t.appendChildView(o),o):n.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:n.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(bl);ma.addGlobal(Dl.Form),bl.addGlobal(Dl.Form);var Ml=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Params=wl.Params.concat([new qs("transition",q.get("transition").or(q.get("plotCircle").get("transition"))),new qs("areaFill",q.get("areaFill").or(q.get("plotCircle").get("areaFill"))),new qs("lineColor",q.get("lineColor")),new qs("lineWidth",q.get("lineWidth"))]),e}(wl),Pl=function(i){function e(t){var e=i.call(this,t)||this;return e._lineColor=qo.black(),e._lineWidth=1,e._lineDashArray=[],e._legend=null,e.linePath=document.createElementNS("http://www.w3.org/2000/svg","path"),e.linePath.setAttribute("class","line"),e.linePath.setAttribute("fill","none"),e.linePath.setAttribute("vector-effect","non-scaling-stroke"),e.node.appendChild(e.linePath),e}return v(e,i),e.prototype.lineColor=function(t){return void 0===t?this._lineColor:(t=qo.fromAny(t),this._lineColor.equals(t)||(this._lineColor=t,this._dirty=!0),this)},e.prototype.lineWidth=function(t){return void 0===t?this._lineWidth:(this._lineWidth!==t&&(this._lineWidth=t,this._dirty=!0),this)},e.prototype.lineDashArray=function(t){return void 0===t?this._lineDashArray:(this._lineDashArray!==t&&(this._lineDashArray=t,this._dirty=!0),this)},e.prototype.legend=function(t){return void 0===t?this._legend:(this._dirty=!0,this._legend!==t&&(this._legend&&this.node.removeChild(this._legend),this._legend=t,this._legend&&this.node.appendChild(this._legend),this.render()),this)},e.prototype.render=function(){this._dirty&&this._axisX&&this._axisY&&(this._dirty=!1,this.renderPlot())},e.prototype.renderPlot=function(){var t=this._scaleX,e=this._scaleY,i=new Yu,r=0,o=0;if(0<this._points.size){var n=this._points.firstValue();n.offsetX=t.scale(n._x),n.offsetY=e.scale(n._y),i.moveTo(n.offsetX,n.offsetY)}var s=this._points.entries();for(s.next();s.hasNext();){var a=s.next().value[1];a.offsetX=t.scale(a._x),a.offsetY=e.scale(a._y),a._y>r&&(r=a._y,o=a.offsetY),i.lineTo(a.offsetX,a.offsetY)}this.retransform(),this.linePath.setAttribute("stroke",this._lineColor.toString()),this.linePath.setAttribute("stroke-width",""+this._lineWidth);var u=this._lineDashArray,h=u.length;if(0<h){for(var l=""+u[0],p=1;p<h;p+=1)l+=","+u[p];this.linePath.setAttribute("stroke-dasharray",l)}else this.linePath.removeAttribute("stroke-dasharray");this.linePath.setAttribute("d",i.toString());var c=this._legend;c&&(c.setAttribute("x","1000"),c.setAttribute("y",""+o),c.setAttribute("text-anchor","end"),c.setAttribute("text-valign","bottom"))},e.create=function(){var t=document.createElementNS("http://www.w3.org/2000/svg","g");return t.setAttribute("pointer-events","none"),t.setAttribute("class","plot line-plot"),new e(t)},e}(gl),Rl=function(i){function t(t){var e=i.call(this)||this;return e.plot=t,e}return v(t,i),t.prototype.onFrame=function(t){for(var e in this)this[e]instanceof ps&&this[e].onFrame(t);this.update()},t.prototype.update=function(){var t=this.plot.node;t.view instanceof Tl&&t.view.insertPlotPointControllers(),this.plot.render()},t}(us),Tl=function(a){function t(t){var e=a.call(this,t)||this;return e.view=t,e.animator=new Rl(e.view),e}return v(t,a),t.prototype.lineColor=function(t,e){return this.propertyKeyColor(Na,"lineColor",t,e)},t.prototype.lineWidth=function(t,e){return this.propertyKeyNumber(Ba,"lineWidth",t,e)},t.prototype.lineDashArray=function(t,e){return this.propertyKey(Ba,"lineDashArray",t,e)},t.prototype.legend=function(t){var e=this.view.legend();if(void 0===t)return e;if("string"==typeof t?t=document.createTextNode(t):(t instanceof Sa||t instanceof lu)&&(t=t.node),t instanceof Text)if(e){for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(t),t=e}else{var i=Sa.create("text").className("value");i.append(t),t=i.node}if(e){var r=e.view;e!==t&&r&&this.removeChildView(r)}if(this.view.legend(t),t){var o=t.view;e!==t&&o&&this.appendChildView(o)}return this.animator.animate(),this},t.prototype.didRemoveChildView=function(t){a.prototype.didRemoveChildView.call(this,t),t instanceof yl&&this.removePoint(t._x)},t.prototype.plotDidScaleX=function(t,e,i){this.animator.animate()},t.prototype.plotDidScaleY=function(t,e,i){this.animator.animate()},t.prototype.plotDidInsertPoint=function(t,e){this.animator.animate()},t.prototype.plotDidRemovePoint=function(t,e){this.animator.animate()},t.prototype.render=function(){a.prototype.render.call(this),this.animator.update()},t.prototype.didReview=function(t){a.prototype.didReview.call(this,t),this.animator.enabled(t)},t.prototype.didSetState=function(t,e){a.prototype.didSetState.call(this,t,e);var i=t.get("transition").cast(jn.Form),r=t.get("lineColor").cast(qo.Form);r&&this.lineColor(r,i);var o=t.get("lineWidth").numberValue();o&&this.lineWidth(o,i);var n=t.get("lineDashArray");if(n.isDefined()){var s=[];n.forEach(function(t){var e=t.numberValue();void 0!==e&&s.push(e)},this),this.lineDashArray(s,i)}},t.create=function(){return new t(Pl.create())},t.applyTheme=function(t){var e=q.get("value"),i=q.get("primaryHue").invoke(e).or(q.get("primaryColor")),r=F.empty().slot("lineColor",i).slot("lineWidth","0").slot("lineDashArray","0").slot("legendSize","10px").slot("legendWeight",400);t.set("plotLine",r)},t}(ll);Tl.applyTheme(Tl.Theme);var Ll=function(s){function t(){return null!==s&&s.apply(this,arguments)||this}return v(t,s),Object.defineProperty(t.prototype,"tag",{get:function(){return"plotLine"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){var r=Tl.create();return r.setModel(this.materializeView(r,t,e,i)),r},t.prototype.castModel=function(t,e,i){var r=new Fl;return r.setData(this.materializeModel(r,t,e,i)),r},t.prototype.materializeViewParam=function(t,e,i,r){if(e.key instanceof O&&"legend"===e.key.value){var o=r.castView(e.toValue(),i,r)||e.toValue().stringValue();if(void 0!==o)return t.legend(o),b.Absent}var n=r.castView(e.toValue(),i,r);return n instanceof ga?(t.appendChildView(n),n):s.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:s.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(bl);ma.addGlobal(Ll.Form),bl.addGlobal(Ll.Form);var Fl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Params=wl.Params.concat([new qs("transition",q.get("transition").or(q.get("plotLine").get("transition"))),new qs("lineColor",q.get("lineColor").or(q.get("plotLine").get("lineColor"))),new qs("lineWidth",q.get("lineWidth").or(q.get("plotLine").get("lineWidth"))),new qs("lineDashArray",q.get("lineDashArray").or(q.get("plotLine").get("lineDashArray")))]),e}(wl),Il=function(){function i(t){this.node=t,this._plots=[],this._axisTop=null,this._axisRight=null,this._axisBottom=null,this._axisLeft=null,this._gutterTop=Lo.px(20,t),this._gutterRight=Lo.px(40,t),this._gutterBottom=Lo.px(20,t),this._gutterLeft=Lo.px(40,t),this._width=Lo.zero(t),this._height=Lo.zero(t),this._dirty=!0,this._observers=[],this.defs=document.createElementNS("http://www.w3.org/2000/svg","defs"),this.node.appendChild(this.defs),this.clipPath=document.createElementNS("http://www.w3.org/2000/svg","clipPath"),this.clipPath.setAttribute("id",C.generateId()),this.defs.appendChild(this.clipPath),this.clipRect=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.clipPath.appendChild(this.clipRect),this.surfaceRect=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.surfaceRect.setAttribute("fill","none"),this.surfaceRect.setAttribute("stroke","none"),this.surfaceRect.setAttribute("pointer-events","all"),this.surfaceRect.setAttribute("class","surfaceRect"),this.node.appendChild(this.surfaceRect),this.plotsGroup=document.createElementNS("http://www.w3.org/2000/svg","g"),this.plotsGroup.setAttribute("clip-path","url(#"+this.clipPath.getAttribute("id")+")"),this.plotsGroup.setAttribute("class","plots"),this.node.appendChild(this.plotsGroup),this.axesGroup=document.createElementNS("http://www.w3.org/2000/svg","g"),this.axesGroup.setAttribute("class","axes"),this.node.appendChild(this.axesGroup)}return i.prototype.plots=function(){return this._plots.slice(0)},i.prototype.addPlot=function(t){if(this._plots.indexOf(t)<0){for(var e=0;e<this._observers.length;e+=1){if((r=this._observers[e]).chartWillAddPlot){var i=r.chartWillAddPlot(t,this);if(i)t=i;else if(null===i)return}}this._plots.push(t),this.plotsGroup.appendChild(t.node),t.addObserver(this),t.axisX()||(this._axisBottom?t.axisX(this._axisBottom):this._axisTop&&t.axisX(this._axisTop)),t.axisY()||(this._axisLeft?t.axisY(this._axisLeft):this._axisRight&&t.axisY(this._axisRight)),this._dirty=!0;for(e=0;e<this._observers.length;e+=1){var r;(r=this._observers[e]).chartDidAddPlot&&r.chartDidAddPlot(t,this)}}},i.prototype.removePlot=function(t){var e=this._plots.indexOf(t);if(0<=e){for(var i=0;i<this._observers.length;i+=1){(o=this._observers[i]).chartWillRemovePlot&&o.chartWillRemovePlot(t,this)}t.removeObserver(this),this.plotsGroup.removeChild(t.node),this._plots.splice(e,1);for(var r=0;r<this._observers.length;r+=1){var o;(o=this._observers[r]).chartDidRemovePlot&&o.chartDidRemovePlot(t,this)}}},i.prototype.axisTop=function(t){if(void 0===t)return this._axisTop;if(null===t)return this._axisTop&&(this._axisTop.removeObserver(this),this.axesGroup.removeChild(this._axisTop.node)),this._axisTop=null,this;this._axisTop?(this._axisTop.removeObserver(this),this.axesGroup.replaceChild(t.node,this._axisTop.node)):this.axesGroup.appendChild(t.node),this._axisTop=t,this._axisTop.addObserver(this);for(var e=0;e<this._plots.length;e+=1){var i=this._plots[e];i.axisX()||i.axisX(this._axisTop)}return this._dirty=!0,this},i.prototype.axisRight=function(t){if(void 0===t)return this._axisRight;if(null===t)return this._axisRight&&(this._axisRight.removeObserver(this),this.axesGroup.removeChild(this._axisRight.node)),this._axisRight=null,this;this._axisRight?(this._axisRight.removeObserver(this),this.axesGroup.replaceChild(t.node,this._axisRight.node)):this.axesGroup.appendChild(t.node),this._axisRight=t,this._axisRight.addObserver(this);for(var e=0;e<this._plots.length;e+=1){var i=this._plots[e];i.axisY()||i.axisY(this._axisRight)}return this._dirty=!0,this},i.prototype.axisBottom=function(t){if(void 0===t)return this._axisBottom;if(null===t)return this._axisBottom&&(this._axisBottom.removeObserver(this),this.axesGroup.removeChild(this._axisBottom.node)),this._axisBottom=null,this;this._axisBottom?(this._axisBottom.removeObserver(this),this.axesGroup.replaceChild(t.node,this._axisBottom.node)):this.axesGroup.appendChild(t.node),this._axisBottom=t,this._axisBottom.addObserver(this);for(var e=0;e<this._plots.length;e+=1){var i=this._plots[e];i.axisX()||i.axisX(this._axisBottom)}return this._dirty=!0,this},i.prototype.axisLeft=function(t){if(void 0===t)return this._axisLeft;if(null===t)return this._axisLeft&&(this._axisLeft.removeObserver(this),this.axesGroup.removeChild(this._axisLeft.node)),this._axisLeft=null,this;this._axisLeft?(this._axisLeft.removeObserver(this),this.axesGroup.replaceChild(t.node,this._axisLeft.node)):this.axesGroup.appendChild(t.node),this._axisLeft=t,this._axisLeft.addObserver(this);for(var e=0;e<this._plots.length;e+=1){var i=this._plots[e];i.axisY()||i.axisY(this._axisLeft)}return this._dirty=!0,this},i.prototype.gutterTop=function(t){return void 0===t?this._gutterTop:(t=Lo.fromAny(t,this.node),this._gutterTop.equals(t)||(this._gutterTop=t,this._dirty=!0),this)},i.prototype.gutterRight=function(t){return void 0===t?this._gutterRight:(t=Lo.fromAny(t,this.node),this._gutterRight.equals(t)||(this._gutterRight=t,this._dirty=!0),this)},i.prototype.gutterBottom=function(t){return void 0===t?this._gutterBottom:(t=Lo.fromAny(t,this.node),this._gutterBottom.equals(t)||(this._gutterBottom=t,this._dirty=!0),this)},i.prototype.gutterLeft=function(t){return void 0===t?this._gutterLeft:(t=Lo.fromAny(t,this.node),this._gutterLeft.equals(t)||(this._gutterLeft=t,this._dirty=!0),this)},i.prototype.width=function(t){return void 0===t?this._width:(t=Lo.fromAny(t,this.node),this._width.equals(t)||(this._width=t,this._dirty=!0),this)},i.prototype.height=function(t){return void 0===t?this._height:(t=Lo.fromAny(t,this.node),this._height.equals(t)||(this._height=t,this._dirty=!0),this)},i.prototype.dataDomainX=function(){var t=this._plots.length;if(t){for(var e=void 0,i=void 0,r=0;r<t;r+=1){var o=this._plots[r].dataDomainX();o&&((void 0===e||0<V(e,o[0]))&&(e=o[0]),(void 0===i||V(i,o[1])<0)&&(i=o[1]))}if(void 0!==e&&void 0!==i)return[e,i]}},i.prototype.dataRangeX=function(){var t=this._plots.length;if(t){for(var e=void 0,i=void 0,r=0;r<t;r+=1){var o=this._plots[r].dataRangeX();o&&((void 0===e||e>o[0])&&(e=o[0]),(void 0===i||i<o[1])&&(i=o[1]))}if(void 0!==e&&void 0!==i)return[e,i]}},i.prototype.dataDomainY=function(){var t=this._plots.length;if(t){for(var e=void 0,i=void 0,r=0;r<t;r+=1){var o=this._plots[r].dataDomainY();o&&((void 0===e||0<V(e,o[0]))&&(e=o[0]),(void 0===i||V(i,o[1])<0)&&(i=o[1]))}if(void 0!==e&&void 0!==i)return[e,i]}},i.prototype.dataRangeY=function(){var t=this._plots.length;if(t){for(var e=void 0,i=void 0,r=0;r<t;r+=1){var o=this._plots[r].dataRangeY();o&&((void 0===e||e>o[0])&&(e=o[0]),(void 0===i||i<o[1])&&(i=o[1]))}if(void 0!==e&&void 0!==i)return[e,i]}},i.prototype.update=function(){this._dirty&&(this._dirty=!1,this.updateClipPath(),this.updateSurface(),this.updatePlots(),this.updateAxes())},i.prototype.updateClipPath=function(){var t=Math.max(0,this._width.pxValue()-this._gutterLeft.pxValue()-this._gutterRight.pxValue()),e=Math.max(0,this._height.pxValue()-this._gutterTop.pxValue()-this._gutterBottom.pxValue());this.clipRect.setAttribute("x","0"),this.clipRect.setAttribute("y","0"),this.clipRect.setAttribute("width",""+t),this.clipRect.setAttribute("height",""+e)},i.prototype.updateSurface=function(){var t=this._gutterLeft.pxValue(),e=this._gutterTop.pxValue(),i=Math.max(0,this._width.pxValue()-t-this._gutterRight.pxValue()),r=Math.max(0,this._height.pxValue()-e-this._gutterBottom.pxValue());this.surfaceRect.setAttribute("x",""+t),this.surfaceRect.setAttribute("y",""+e),this.surfaceRect.setAttribute("width",""+i),this.surfaceRect.setAttribute("height",""+r)},i.prototype.updatePlots=function(){var t=$o.translate(this._gutterLeft.pxValue(),this._gutterTop.pxValue());this.plotsGroup.setAttribute("transform",t.toAttributeString());for(var e=0;e<this._plots.length;e+=1)this.updatePlot(this._plots[e])},i.prototype.updatePlot=function(t){var e=t.axisX();e&&(e===this._axisBottom?e.scale(this._axisBottom.scale()):e===this._axisTop&&e.scale(this._axisTop.scale()));var i=t.axisY();i&&(i===this._axisLeft?i.scale(this._axisLeft.scale()):i===this._axisRight&&i.scale(this._axisRight.scale()))},i.prototype.updateAxes=function(){this.updateAxisTop(),this.updateAxisRight(),this.updateAxisBottom(),this.updateAxisLeft()},i.prototype.updateAxisTop=function(){if(this._axisTop){var t=this._gutterLeft.pxValue(),e=this._gutterTop.pxValue(),i=$o.translate(t,e);this._axisTop.node.setAttribute("transform",i.toAttributeString()),this._axisTop.range(0,Math.max(0,this._width.pxValue()-t-this._gutterRight.pxValue()))}},i.prototype.updateAxisRight=function(){if(this._axisRight){var t=Math.max(this._gutterLeft.pxValue(),this._width.pxValue()-this._gutterRight.pxValue()),e=this._gutterTop.pxValue(),i=$o.translate(t,e);this._axisRight.node.setAttribute("transform",i.toAttributeString()),this._axisRight.range(Math.max(this._height.pxValue()-e-this._gutterBottom.pxValue()),0)}},i.prototype.updateAxisBottom=function(){if(this._axisBottom){var t=this._gutterLeft.pxValue(),e=Math.max(this._gutterTop.pxValue(),this._height.pxValue()-this._gutterBottom.pxValue()),i=$o.translate(t,e);this._axisBottom.node.setAttribute("transform",i.toAttributeString()),this._axisBottom.range(0,Math.max(this._width.pxValue()-t-this._gutterRight.pxValue()))}},i.prototype.updateAxisLeft=function(){if(this._axisLeft){var t=this._gutterLeft.pxValue(),e=this._gutterTop.pxValue(),i=$o.translate(t,e);this._axisLeft.node.setAttribute("transform",i.toAttributeString()),this._axisLeft.range(Math.max(0,this._height.pxValue()-e-this._gutterBottom.pxValue()),0)}},i.prototype.render=function(){this.renderSurface(),this.renderPlots(),this.renderAxes()},i.prototype.renderSurface=function(){this.updateSurface()},i.prototype.renderPlots=function(){this.updatePlots();for(var t=0;t<this._plots.length;t+=1)this._plots[t].render()},i.prototype.renderAxes=function(){this.updateAxes(),this._axisTop&&this._axisTop.render(),this._axisRight&&this._axisRight.render(),this._axisBottom&&this._axisBottom.render(),this._axisLeft&&this._axisLeft.render()},i.prototype.addObserver=function(t){this._observers.indexOf(t)<0&&this._observers.push(t)},i.prototype.removeObserver=function(t){var e=this._observers.indexOf(t);0<=e&&this._observers.splice(e,1)},i.prototype.plotDidScaleX=function(t,e,i){e===this._axisBottom?this.axisDidScaleBottom(t):e===this._axisTop&&this.axisDidScaleTop(t)},i.prototype.plotDidScaleY=function(t,e,i){e===this._axisLeft?this.axisDidScaleLeft(t):e===this._axisRight&&this.axisDidScaleRight(t)},i.prototype.plotDidInsertPoint=function(t,e){for(var i=0;i<this._observers.length;i+=1){var r=this._observers[i];r.chartDidInsertPoint&&r.chartDidInsertPoint(t,e,this)}},i.prototype.plotDidRemovePoint=function(t,e){for(var i=0;i<this._observers.length;i+=1){var r=this._observers[i];r.chartDidRemovePoint&&r.chartDidRemovePoint(t,e,this)}},i.prototype.axisDidScale=function(t,e){e===this._axisTop?this.axisDidScaleTop(t):e===this._axisRight?this.axisDidScaleRight(t):e===this._axisBottom?this.axisDidScaleBottom(t):e===this._axisLeft&&this.axisDidScaleLeft(t)},i.prototype.axisDidScaleTop=function(t){for(var e=0;e<this._observers.length;e+=1){var i=this._observers[e];i.chartDidScaleTop&&i.chartDidScaleTop(t,this._axisTop,this)}},i.prototype.axisDidScaleRight=function(t){for(var e=0;e<this._observers.length;e+=1){var i=this._observers[e];i.chartDidScaleRight&&i.chartDidScaleRight(t,this._axisRight,this)}},i.prototype.axisDidScaleBottom=function(t){for(var e=0;e<this._observers.length;e+=1){var i=this._observers[e];i.chartDidScaleBottom&&i.chartDidScaleBottom(t,this._axisBottom,this)}},i.prototype.axisDidScaleLeft=function(t){for(var e=0;e<this._observers.length;e+=1){var i=this._observers[e];i.chartDidScaleLeft&&i.chartDidScaleLeft(t,this._axisLeft,this)}},i.create=function(t){void 0===t&&(t="svg");var e=document.createElementNS("http://www.w3.org/2000/svg",t);return e.setAttribute("class","chart"),e.style.setProperty("-webkit-user-select","none"),e.style.setProperty("-moz-user-select","none"),e.style.setProperty("-ms-user-select","none"),e.style.setProperty("user-select","none"),e.style.setProperty("cursor","default"),new i(e)},i}(),zl=function(r){function t(t,e){var i=r.call(this)||this;return i.chart=t,i.childViews=e,i.axisTop=null,i.axisRight=null,i.axisBottom=null,i.axisLeft=null,i}return v(t,r),t.prototype.onFrame=function(t){for(var e in this)this[e]instanceof ps&&this[e].onFrame(t);this.update()},t.prototype.updatePlots=function(){for(var t=0;t<this.childViews.length;t+=1){var e=this.childViews[t];e instanceof ll&&e.render()}},t.prototype.updateAxes=function(){for(var t in this)this[t]instanceof al&&this[t].render()},t.prototype.update=function(){var t=this.chart.node;t.view instanceof Wl&&(t.view.autoscale(),t.view.rebound()),this.chart.update(),this.updatePlots(),this.updateAxes()},t}(us),Ul=function(n){function o(t,e,i,r){var o=n.call(this,t,i,r)||this;return o.view=t.chart,o.parent=t.chartAnimator,o.key=e,o}return v(o,n),o.prototype.update=function(t){this.key&&this.view[this.key](t)},o.prototype.getProperty=function(){this.key&&this.view[this.key]()},o.prototype.setProperty=function(t){this.key&&(null===t?this.parent[this.key]=void 0:(this.view[this.key](t),this.parent.animate()))},o.get=function(t,e){return t.chart[e]()},o.set=function(t,e,i){null===i?t.chartAnimator[e]=void 0:(t.chart[e](i),t.chartAnimator.animate())},o.animator=function(t,e,i,r){return void 0===i||t.chartAnimator[e]||(t.chartAnimator[e]=new o(t,e,i,r)),t.chartAnimator[e]},o}(ps),Ol=function(n){function o(t,e,i,r){var o=n.call(this,t,i,r,as.REQUIRES_RESIZE)||this;return o.view=t.chart,o.parent=t.chartAnimator,o.key=e,o}return v(o,n),o.prototype.update=function(t){this.parent.chart.width(t),this.updateTarget(this.parent.chart.node)},o.prototype.getProperty=function(){this.key&&this.view[this.key]()},o.prototype.setProperty=function(t){this.key&&(null===t?this.parent[this.key]=void 0:(this.view[this.key](t),this.parent.animate()))},o.get=function(t,e){return t.chart[e]()},o.set=function(t,e,i){if(null===i)t.chartAnimator[e]=void 0,t.chart.node.removeAttribute(e);else{t.chart[e](i);var r=t.chart.node.getAttribute(e),o=""+i.pxValue();r!==o&&(t.chart.node.setAttribute(e,o),t.requireResize())}},o.animator=function(t,e,i,r){return void 0===i||t.chartAnimator.width||(t.chartAnimator.width=new o(t,e,i,r)),t.chartAnimator.width},o}(ps),Wl=function(m){function a(t){var e=m.call(this,t.node)||this;return e.chart=t,e._axisTop=null,e._axisRight=null,e._axisBottom=null,e._axisLeft=null,e._kinematic=null,e._kinematicScaleTop=null,e._kinematicScaleRight=null,e._kinematicScaleBottom=null,e._kinematicScaleLeft=null,e._domainBoundTop=null,e._domainBoundRight=null,e._domainBoundBottom=null,e._domainBoundLeft=null,e._domainPaddingTop=null,e._domainPaddingRight=null,e._domainPaddingBottom=null,e._domainPaddingLeft=null,e._scaleTransition=null,e._flags=e._flags|a.FitX|a.TrackX|a.FitY|a.TrackY,e.chartAnimator=new zl(e.chart,e._childViews),e.chart.addObserver(e),t.node.addEventListener("kinematicscalestart",e.onKinematicScaleStart.bind(e)),t.node.addEventListener("kinematicscaleupdate",e.onKinematicScaleUpdate.bind(e)),t.node.addEventListener("kinematicscaleend",e.onKinematicScaleEnd.bind(e)),t.node.onclick=e.onChartClick.bind(e),t.node.onmousemove=e.onChartMouseMove.bind(e),e}return v(a,m),a.prototype.plots=function(){for(var t=[],e=0;e<this._childViews.length;e+=1){var i=this._childViews[e];i instanceof ll&&t.push(i)}return t},a.prototype.addPlot=function(t){this.appendChildView(t)},a.prototype.removePlot=function(t){this.removeChildView(t)},a.prototype.didInsertChildView=function(t){t instanceof ll&&(t.axisX()||(this._axisBottom?t.axisX(this._axisBottom):this._axisTop&&t.axisX(this._axisTop)),t.axisY()||(this._axisLeft?t.axisY(this._axisLeft):this._axisRight&&t.axisY(this._axisRight)),t.parentView&&t.plot.parentView(t.parentView.chart),this.chart.addPlot(t.plot)),m.prototype.didInsertChildView.call(this,t)},a.prototype.didRemoveChildView=function(t){t instanceof ll&&this.chart.removePlot(t.plot),m.prototype.didRemoveChildView.call(this,t)},a.prototype.axisTop=function(t){return void 0===t?this._axisTop:(this._axisTop&&this.removeChildView(this._axisTop),this._axisTop=t,this._axisTop&&this.appendChildView(this._axisTop),this.chartAnimator.axisTop=t,this.chart.axisTop(t?t.axis:null),this)},a.prototype.axisRight=function(t){return void 0===t?this._axisRight:(this._axisRight&&this.removeChildView(this._axisRight),this._axisRight=t,this._axisRight&&this.appendChildView(this._axisRight),this.chartAnimator.axisRight=t,this.chart.axisRight(t?t.axis:null),this)},a.prototype.axisBottom=function(t){return void 0===t?this._axisBottom:(this._axisBottom&&this.removeChildView(this._axisBottom),this._axisBottom=t,this._axisBottom&&this.appendChildView(this._axisBottom),this.chartAnimator.axisBottom=t,this.chart.axisBottom(t?t.axis:null),this)},a.prototype.axisLeft=function(t){return void 0===t?this._axisLeft:(this._axisLeft&&this.removeChildView(this._axisLeft),this._axisLeft=t,this._axisLeft&&this.appendChildView(this._axisLeft),this.chartAnimator.axisLeft=t,this.chart.axisLeft(t?t.axis:null),this)},a.prototype.kinematic=function(t){return void 0===t?this._kinematic:(!0===t?t=zu.create():!1===t&&(t=null),this._kinematic&&this._kinematic.surface(null),this._kinematic=t,this._kinematic&&this._kinematic.surface(this.chart.surfaceRect),this)},a.prototype.kinematicScaleTop=function(t){return void 0===t?this._kinematicScaleTop:(!0===t?t=qu.horizontal():!1===t&&(t=null),this._kinematicScaleTop&&this._kinematicScaleTop.kinematic(null).ruler(null).scale(null),this._kinematicScaleTop=t,this._kinematicScaleTop&&(this._kinematic||this.kinematic(!0),this._kinematicScaleTop.kinematic(this._kinematic).ruler(this.chart.surfaceRect).scale(this.chart.axisTop().scale()),this.reboundX()),this)},a.prototype.kinematicScaleRight=function(t){return void 0===t?this._kinematicScaleRight:(!0===t?t=qu.vertical():!1===t&&(t=null),this._kinematicScaleRight&&this._kinematicScaleRight.kinematic(null).ruler(null).scale(null),this._kinematicScaleRight=t,this._kinematicScaleRight&&(this._kinematic||this.kinematic(!0),this._kinematicScaleRight.kinematic(this._kinematic).ruler(this.chart.surfaceRect).scale(this.chart.axisRight().scale()),this.reboundY()),this)},a.prototype.kinematicScaleBottom=function(t){return void 0===t?this._kinematicScaleBottom:(!0===t?t=qu.horizontal():!1===t&&(t=null),this._kinematicScaleBottom&&this._kinematicScaleBottom.kinematic(null).ruler(null).scale(null),this._kinematicScaleBottom=t,this._kinematicScaleBottom&&(this._kinematic||this.kinematic(!0),this._kinematicScaleBottom.kinematic(this._kinematic).ruler(this.chart.surfaceRect).scale(this.chart.axisBottom().scale()),this.reboundX()),this)},a.prototype.kinematicScaleLeft=function(t){return void 0===t?this._kinematicScaleLeft:(!0===t?t=qu.vertical():!1===t&&(t=null),this._kinematicScaleLeft&&this._kinematicScaleLeft.kinematic(null).ruler(null).scale(null),this._kinematicScaleLeft=t,this._kinematicScaleLeft&&(this._kinematic||this.kinematic(!0),this._kinematicScaleLeft.kinematic(this._kinematic).ruler(this.chart.surfaceRect).scale(this.chart.axisLeft().scale()),this.reboundY()),this)},a.prototype.gutterTop=function(t,e){return this.propertyKeyLength(Ul,"gutterTop",t,e)},a.prototype.gutterRight=function(t,e){return this.propertyKeyLength(Ul,"gutterRight",t,e)},a.prototype.gutterBottom=function(t,e){return this.propertyKeyLength(Ul,"gutterBottom",t,e)},a.prototype.gutterLeft=function(t,e){return this.propertyKeyLength(Ul,"gutterLeft",t,e)},a.prototype.width=function(t,e){return this.propertyKeyLength(Ol,"width",t,e)},a.prototype.height=function(t,e){return this.propertyKeyLength(Ol,"height",t,e)},a.prototype.domainBoundTop=function(t){return void 0===t?this._domainBoundTop:(S(this._domainBoundTop,t)||(this._domainBoundTop=t,this.reboundY()),this)},a.prototype.domainBoundRight=function(t){return void 0===t?this._domainBoundRight:(S(this._domainBoundRight,t)||(this._domainBoundRight=t,this.reboundX()),this)},a.prototype.domainBoundBottom=function(t){return void 0===t?this._domainBoundBottom:(S(this._domainBoundBottom,t)||(this._domainBoundBottom=t,this.reboundY()),this)},a.prototype.domainBoundLeft=function(t){return void 0===t?this._domainBoundLeft:(S(this._domainBoundLeft,t)||(this._domainBoundLeft=t,this.reboundX()),this)},a.prototype.domainPaddingTop=function(t){return void 0===t?this._domainPaddingTop:(S(this._domainPaddingTop,t)||(this._domainPaddingTop=t,this.chartAnimator.animate()),this)},a.prototype.domainPaddingRight=function(t){return void 0===t?this._domainPaddingRight:(S(this._domainPaddingRight,t)||(this._domainPaddingRight=t,this.chartAnimator.animate()),this)},a.prototype.domainPaddingBottom=function(t){return void 0===t?this._domainPaddingBottom:(S(this._domainPaddingBottom,t)||(this._domainPaddingBottom=t,this.chartAnimator.animate()),this)},a.prototype.domainPaddingLeft=function(t){return void 0===t?this._domainPaddingLeft:(S(this._domainPaddingLeft,t)||(this._domainPaddingLeft=t,this.chartAnimator.animate()),this)},a.prototype.scaleTransition=function(t){return void 0===t?this._scaleTransition:(null!==t&&(t=jn.fromAny(t)),this._scaleTransition=t,this)},a.prototype.fitX=function(t){if(void 0===t)return 0!=(this._flags&a.FitX);var e=this._flags,i=void 0;return e!==(i=t?e|a.FitX|a.TrackX:e&~(a.FitX|a.TrackX))&&(this._flags=i,this.chartAnimator.animate()),this},a.prototype.fitY=function(t){if(void 0===t)return 0!=(this._flags&a.FitY);var e=this._flags,i=void 0;return e!==(i=t?e|a.FitY|a.TrackY:e&~(a.FitY|a.TrackY))&&(this._flags=i,this.chartAnimator.animate()),this},a.prototype.dataDomainX=function(){var t=this.chart.dataDomainX();return t&&(this._domainPaddingLeft&&(t[0]=+t[0]-+this._domainPaddingLeft),this._domainPaddingRight&&(t[1]=+t[1]+ +this._domainPaddingRight)),t},a.prototype.dataRangeX=function(){return this.chart.dataRangeX()},a.prototype.dataDomainY=function(){var t=this.chart.dataDomainY();return t&&(this._domainPaddingBottom&&(t[0]=+t[0]-+this._domainPaddingBottom),this._domainPaddingTop&&(t[1]=+t[1]+ +this._domainPaddingTop)),t},a.prototype.dataRangeY=function(){return this.chart.dataRangeY()},a.prototype.domainColor=function(t,e){return t=qo.fromAny(t),this._axisTop&&this._axisTop.domainColor(t,e),this._axisRight&&this._axisRight.domainColor(t,e),this._axisBottom&&this._axisBottom.domainColor(t,e),this._axisLeft&&this._axisLeft.domainColor(t,e),this},a.prototype.domainWidth=function(t,e){return this._axisTop&&this._axisTop.domainWidth(t,e),this._axisRight&&this._axisRight.domainWidth(t,e),this._axisBottom&&this._axisBottom.domainWidth(t,e),this._axisLeft&&this._axisLeft.domainWidth(t,e),this},a.prototype.domainSerif=function(t,e){return this._axisTop&&this._axisTop.domainSerif(t,e),this._axisRight&&this._axisRight.domainSerif(t,e),this._axisBottom&&this._axisBottom.domainSerif(t,e),this._axisLeft&&this._axisLeft.domainSerif(t,e),this},a.prototype.tickTransition=function(t){return this._axisTop&&this._axisTop.tickTransition(t),this._axisRight&&this._axisRight.tickTransition(t),this._axisBottom&&this._axisBottom.tickTransition(t),this._axisLeft&&this._axisLeft.tickTransition(t),this},a.prototype.tickMarkColor=function(t,e){return t=qo.fromAny(t),this._axisTop&&this._axisTop.tickMarkColor(t,e),this._axisRight&&this._axisRight.tickMarkColor(t,e),this._axisBottom&&this._axisBottom.tickMarkColor(t,e),this._axisLeft&&this._axisLeft.tickMarkColor(t,e),this},a.prototype.tickMarkWidth=function(t,e){return this._axisTop&&this._axisTop.tickMarkWidth(t,e),this._axisRight&&this._axisRight.tickMarkWidth(t,e),this._axisBottom&&this._axisBottom.tickMarkWidth(t,e),this._axisLeft&&this._axisLeft.tickMarkWidth(t,e),this},a.prototype.tickMarkLength=function(t,e){return this._axisTop&&this._axisTop.tickMarkLength(t,e),this._axisRight&&this._axisRight.tickMarkLength(t,e),this._axisBottom&&this._axisBottom.tickMarkLength(t,e),this._axisLeft&&this._axisLeft.tickMarkLength(t,e),this},a.prototype.tickLabelColor=function(t,e){return t=qo.fromAny(t),this._axisTop&&this._axisTop.tickLabelColor(t,e),this._axisRight&&this._axisRight.tickLabelColor(t,e),this._axisBottom&&this._axisBottom.tickLabelColor(t,e),this._axisLeft&&this._axisLeft.tickLabelColor(t,e),this},a.prototype.tickLabelPadding=function(t,e){return this._axisTop&&this._axisTop.tickLabelPadding(t,e),this._axisRight&&this._axisRight.tickLabelPadding(t,e),this._axisBottom&&this._axisBottom.tickLabelPadding(t,e),this._axisLeft&&this._axisLeft.tickLabelPadding(t,e),this},a.prototype.render=function(){this.chartAnimator.update()},a.prototype.reboundX=function(){var t=this._kinematicScaleBottom,e=this._kinematicScaleTop,i=this._domainBoundLeft,r=this._domainBoundRight;if((t||e)&&(null!==i||null!==r)){var o=this.dataDomainX();if(o){var n=o[0];null!==i&&"boolean"!=typeof i&&(n=+n-+i);var s=o[1];null!==r&&"boolean"!=typeof r&&(s=+s+ +r),t&&(null!==i&&t.domainMin(n),null!==r&&t.domainMax(s)),e&&(null!==i&&e.domainMin(n),null!==r&&e.domainMax(s))}}},a.prototype.reboundY=function(){var t=this._kinematicScaleLeft,e=this._kinematicScaleRight,i=this._domainBoundBottom,r=this._domainBoundTop;if((t||e)&&null!==i&&null!==r){var o=this.dataDomainY();if(o){var n=o[0];"boolean"!=typeof i&&(n=+n-+i);var s=o[1];"boolean"!=typeof r&&(s=+s+ +r),t&&(null!==i&&t.domainMin(n),null!==r&&t.domainMax(s)),e&&(null!==i&&e.domainMin(n),null!==r&&e.domainMax(s))}}},a.prototype.rebound=function(){this.reboundX(),this.reboundY()},a.prototype.autoscaleX=function(t){if(0!=(this._flags&a.TrackX)){var e=this._axisBottom,i=this._axisTop;if(e||i){var r=this.dataDomainX();r&&(e&&e.domain(r,void 0,t),i&&i.domain(r,void 0,t))}}},a.prototype.autoscaleY=function(t){if(0!=(this._flags&a.TrackY)){var e=this._axisLeft,i=this._axisRight;if(e||i){var r=this.dataDomainY();r&&(e&&e.domain(r,void 0,t),i&&i.domain(r,void 0,t))}}},a.prototype.autoscale=function(t){void 0===t&&(t=this._scaleTransition||void 0),this.autoscaleX(t),this.autoscaleY(t)},a.prototype.autosize=function(){for(var t=this.node;;){var e=t.parentNode;if(!e)return;if(e instanceof HTMLElement)return void this.width(e.offsetWidth).height(e.offsetHeight);t=e}},a.prototype.didResize=function(){m.prototype.didResize.call(this),this.autosize(),this.render()},a.prototype.didReview=function(t){m.prototype.didReview.call(this,t),this.chartAnimator.enabled(t)},a.prototype.didSetState=function(t,e){m.prototype.didSetState.call(this,t,e);var i=t.get("transition").cast(jn.Form),r=t.get("scaleTransition").cast(jn.Form);r&&this.scaleTransition(r);var o=t.get("domainBoundTop").cast(ws.Form);void 0!==o&&this.domainBoundTop(o);var n=t.get("domainBoundRight").cast(ws.Form);void 0!==n&&this.domainBoundRight(n);var s=t.get("domainBoundBottom").cast(ws.Form);void 0!==s&&this.domainBoundBottom(s);var a=t.get("domainBoundLeft").cast(ws.Form);void 0!==a&&this.domainBoundLeft(a);var u=t.get("domainPaddingTop").cast(ws.Form);void 0!==u&&this.domainPaddingTop(u);var h=t.get("domainPaddingRight").cast(ws.Form);void 0!==h&&this.domainPaddingRight(h);var l=t.get("domainPaddingBottom").cast(ws.Form);void 0!==l&&this.domainPaddingBottom(l);var p=t.get("domainPaddingLeft").cast(ws.Form);void 0!==p&&this.domainPaddingLeft(p);var c=t.get("gutterTop").cast(Lo.Form);c&&this.gutterTop(c,i);var d=t.get("gutterRight").cast(Lo.Form);d&&this.gutterRight(d,i);var f=t.get("gutterBottom").cast(Lo.Form);f&&this.gutterBottom(f,i);var y=t.get("gutterLeft").cast(Lo.Form);y&&this.gutterLeft(y,i)},a.prototype.addObserver=function(t){this.chart.addObserver(t)},a.prototype.removeObserver=function(t){this.chart.removeObserver(t)},a.prototype.chartDidInsertPoint=function(t,e,i){this.chartAnimator.animate()},a.prototype.chartDidRemovePoint=function(t,e,i){this.chartAnimator.animate()},a.prototype.chartDidScaleTop=function(t,e,i){this._kinematicScaleTop&&this._kinematicScaleTop.scale(t);for(var r=0;r<this._childViews.length;r+=1){var o=this._childViews[r];o instanceof ll&&o.axisX()===this._axisTop&&o.scaleX(t)}},a.prototype.chartDidScaleRight=function(t,e,i){this._kinematicScaleRight&&this._kinematicScaleRight.scale(t);for(var r=0;r<this._childViews.length;r+=1){var o=this._childViews[r];o instanceof ll&&o.axisY()===this._axisRight&&o.scaleY(t)}},a.prototype.chartDidScaleBottom=function(t,e,i){this._kinematicScaleBottom&&this._kinematicScaleBottom.scale(t);for(var r=0;r<this._childViews.length;r+=1){var o=this._childViews[r];o instanceof ll&&o.axisX()===this._axisBottom&&o.scaleX(t)}},a.prototype.chartDidScaleLeft=function(t,e,i){this._kinematicScaleLeft&&this._kinematicScaleLeft.scale(t);for(var r=0;r<this._childViews.length;r+=1){var o=this._childViews[r];o instanceof ll&&o.axisY()===this._axisLeft&&o.scaleY(t)}},a.prototype.xScaleDidStart=function(t){this._flags&=~a.TrackX},a.prototype.yScaleDidStart=function(t){this._flags&=~a.TrackY},a.prototype.xScaleDidEnd=function(t){if(0!=(this._flags&a.FitX)){var e=t.scale().domain(),i=t.domainMin(),r=t.domainMax();if(e&&null!==i&&null!==r){var o=e[0],n=e[1],s=V(o,n);s<0?V(o,i)<=0&&0<=V(n,r)&&(this._flags|=a.TrackX):0<s&&V(n,i)<=0&&0<=V(o,r)&&(this._flags|=a.TrackX)}}},a.prototype.yScaleDidEnd=function(t){if(0!=(this._flags&a.FitY)){var e=t.scale().domain(),i=t.domainMin(),r=t.domainMax();if(e&&null!==i&&null!==r){var o=e[0],n=e[1],s=V(o,n);s<0?V(o,i)<=0&&0<=V(n,r)&&(this._flags|=a.TrackX):0<s&&V(n,i)<=0&&0<=V(o,r)&&(this._flags|=a.TrackX)}}},a.prototype.onKinematicScaleStart=function(t){this._axisTop&&t.kinematicScale===this._kinematicScaleTop?(this._axisTop.frame(this._axisTop.scale()),this._axisTop.domain(t.scale.domain()),this.xScaleDidStart(t.kinematicScale)):this._axisRight&&t.kinematicScale===this._kinematicScaleRight?(this._axisRight.frame(this._axisRight.scale()),this._axisRight.domain(t.scale.domain()),this.yScaleDidStart(t.kinematicScale)):this._axisBottom&&t.kinematicScale===this._kinematicScaleBottom?(this._axisBottom.frame(this._axisBottom.scale()),this._axisBottom.domain(t.scale.domain()),this.xScaleDidStart(t.kinematicScale)):this._axisLeft&&t.kinematicScale===this._kinematicScaleLeft&&(this._axisLeft.frame(this._axisLeft.scale()),this._axisLeft.domain(t.scale.domain()),this.yScaleDidStart(t.kinematicScale))},a.prototype.onKinematicScaleUpdate=function(t){this._axisTop&&t.kinematicScale===this._kinematicScaleTop?this._axisTop.domain(t.scale.domain()):this._axisRight&&t.kinematicScale===this._kinematicScaleRight?this._axisRight.domain(t.scale.domain()):this._axisBottom&&t.kinematicScale===this._kinematicScaleBottom?this._axisBottom.domain(t.scale.domain()):this._axisLeft&&t.kinematicScale===this._kinematicScaleLeft&&this._axisLeft.domain(t.scale.domain())},a.prototype.onKinematicScaleEnd=function(t){this._axisTop&&t.kinematicScale===this._kinematicScaleTop?(this._axisTop.frame(null),this._axisTop.domain(t.scale.domain()),this.xScaleDidEnd(t.kinematicScale)):this._axisRight&&t.kinematicScale===this._kinematicScaleRight?(this._axisRight.frame(null),this._axisRight.domain(t.scale.domain()),this.yScaleDidEnd(t.kinematicScale)):this._axisBottom&&t.kinematicScale===this._kinematicScaleBottom?(this._axisBottom.frame(null),this._axisBottom.domain(t.scale.domain()),this.xScaleDidEnd(t.kinematicScale)):this._axisLeft&&t.kinematicScale===this._kinematicScaleLeft&&(this._axisLeft.frame(null),this._axisLeft.domain(t.scale.domain()),this.yScaleDidEnd(t.kinematicScale))},a.prototype.onChartClick=function(t){for(var e=0,i=this.plots();e<i.length;e++){i[e].plotOnClick(t,this.chart)}},a.prototype.onChartMouseMove=function(t){for(var e=0,i=this.plots();e<i.length;e++){i[e].plotOnMouseMove(t,this.chart)}},a.create=function(t){if(t instanceof a)return t;if(t instanceof _a)throw new TypeError(""+t);if(void 0===t||"string"==typeof t)return new a(Il.create(t));if(t.view instanceof a)return t.view;if(t.view)throw new TypeError(""+t.view);if(t instanceof SVGElement)return new a(new Il(t));throw new TypeError(""+t)},a.FitX=65536,a.TrackX=1<<17,a.FitY=1<<18,a.TrackY=1<<19,a}(Sa),Bl=function(p){function t(){return null!==p&&p.apply(this,arguments)||this}return v(t,p),Object.defineProperty(t.prototype,"tag",{get:function(){return"chart"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=Wl.create(),o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new ql,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeKinematic=function(t,e){var i=e.get("wheel");i.isDefined()&&t.wheel(i.booleanValue(!1))},t.prototype.materializeAxisTop=function(t,e,i,r,o){var n=al.top(e);n.setModel(ul.Form.materializeView(n,i,r,o)),t.axisTop(n);var s=i.get("kinematic");return s.isDefined()&&!1!==s.booleanValue()&&(t.kinematicScaleTop(!0),this.materializeKinematic(t.kinematicScaleTop(),s)),n},t.prototype.materializeAxisRight=function(t,e,i,r,o){var n=al.right(e);n.setModel(ul.Form.materializeView(n,i,r,o)),t.axisRight(n);var s=i.get("kinematic");return s.isDefined()&&!1!==s.booleanValue()&&(t.kinematicScaleRight(!0),this.materializeKinematic(t.kinematicScaleRight(),s)),n},t.prototype.materializeAxisBottom=function(t,e,i,r,o){var n=al.bottom(e);n.setModel(ul.Form.materializeView(n,i,r,o)),t.axisBottom(n);var s=i.get("kinematic");return s.isDefined()&&!1!==s.booleanValue()&&(t.kinematicScaleBottom(!0),this.materializeKinematic(t.kinematicScaleBottom(),s)),n},t.prototype.materializeAxisLeft=function(t,e,i,r,o){var n=al.left(e);n.setModel(ul.Form.materializeView(n,i,r,o)),t.axisLeft(n);var s=i.get("kinematic");return s.isDefined()&&!1!==s.booleanValue()&&(t.kinematicScaleLeft(!0),this.materializeKinematic(t.kinematicScaleLeft(),s)),n},t.prototype.materializeViewParam=function(t,e,i,r){if(e.key instanceof O){var o=e.key.value;if("top"===o){var n=e.toValue().header("axis");if(n.isDefined()){var s=n.get("type").stringValue("linear");this.materializeAxisTop(t,s,e.toValue(),i,r)}}else if("right"===o){var a=e.toValue().header("axis");if(a.isDefined()){s=a.get("type").stringValue("linear");this.materializeAxisRight(t,s,e.toValue(),i,r)}}else if("bottom"===o){var u=e.toValue().header("axis");if(u.isDefined()){s=u.get("type").stringValue("linear");this.materializeAxisBottom(t,s,e.toValue(),i,r)}}else if("left"===o){var h=e.toValue().header("axis");if(h.isDefined()){s=h.get("type").stringValue("linear");this.materializeAxisLeft(t,s,e.toValue(),i,r)}}}else{var l=bl.Global.castView(e.toValue(),i,r);if(l)return t.addPlot(l),l}return p.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:p.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(Da);ma.addGlobal(Bl.Form);var ql=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Params=Va.Params.concat([new qs("transition",q.get("transition").or(q.get("chart").get("transition"))),new qs("scaleTransition",q.get("scaleTransition").or(q.get("chart").get("scaleTransition"))),new qs("domainBoundTop",q.get("domainBoundTop")),new qs("domainBoundRight",q.get("domainBoundRight")),new qs("domainBoundBottom",q.get("domainBoundBottom")),new qs("domainBoundLeft",q.get("domainBoundLeft")),new qs("domainPaddingTop",q.get("domainPaddingTop").or(q.get("chart").get("domainPaddingTop"))),new qs("domainPaddingRight",q.get("domainPaddingRight").or(q.get("chart").get("domainPaddingRight"))),new qs("domainPaddingBottom",q.get("domainPaddingBottom").or(q.get("chart").get("domainPaddingBottom"))),new qs("domainPaddingLeft",q.get("domainPaddingLeft").or(q.get("chart").get("domainPaddingLeft"))),new qs("gutterTop",q.get("top").get("gutter").or(q.get("chart").get("top").get("gutter"))),new qs("gutterRight",q.get("right").get("gutter").or(q.get("chart").get("right").get("gutter"))),new qs("gutterBottom",q.get("bottom").get("gutter").or(q.get("chart").get("bottom").get("gutter"))),new qs("gutterLeft",q.get("left").get("gutter").or(q.get("chart").get("left").get("gutter")))]),e}(Va),Gl=function(){function t(){}return t.Meter=0,t.InnerRadius=90,t.OuterRadius=100,t.FaceColor="#eaecf4",t.DialColor="#8b8ea0",t.DialCornerRadius=100,t.ValueSize=100,t}(),Nl=function(){function e(t){this.parentView=t,this.observers=[],this._meter={new:Gl.Meter},this._innerRadius=Lo.pct(Gl.InnerRadius,t.node),this._outerRadius=Lo.pct(Gl.OuterRadius,t.node),this._faceColor=qo.rgb(Gl.FaceColor),this._dialColor=qo.rgb(Gl.DialColor),this._dialCornerRadius=Lo.pct(Gl.DialCornerRadius),this._value=null,this._valueSize=Lo.pct(Gl.ValueSize),this.gaugeBox=Sa.create("g").className("gauge-box"),this.parentView.append(this.gaugeBox),this.arcGroup=Sa.create("g").className("arc-group"),this.gaugeBox.append(this.arcGroup),this.face=hh.create("face").setAttribute("class","face"),this.face.deltaAngle(2*Math.PI*1,void 0),this.arcGroup.append(this.face),this.dial=hh.create("dial").setAttribute("class","dial"),this.dial.deltaAngle(2*Math.PI*0,void 0),this.arcGroup.append(this.dial)}return e.prototype.meter=function(t){return void 0===t?this._meter.new:(this._meter.old=this._meter.new,this._meter.new=t||Gl.Meter,this)},e.prototype.width=function(t,e){return void 0===t?this._width:(this._width=null===t?Lo.zero(this.parentView.node):t instanceof Lo?t:Lo.fromAny(t,e),this)},e.prototype.height=function(t,e){return void 0===t?this._height:(this._height=null===t?Lo.zero(this.parentView.node):t instanceof Lo?t:Lo.fromAny(t,e),this)},e.prototype.innerRadius=function(t){return void 0===t?this._innerRadius:(this._innerRadius=t instanceof Lo?t:Lo.pct(Gl.InnerRadius,this.parentView.node),this)},e.prototype.outerRadius=function(t){return void 0===t?this._outerRadius:(this._outerRadius=t instanceof Lo?t:Lo.pct(Gl.OuterRadius,this.parentView.node),this)},e.prototype.faceColor=function(t){return void 0===t?this._faceColor:(this._faceColor=t instanceof qo?t:qo.rgb(Gl.FaceColor),this)},e.prototype.dialColor=function(t){return void 0===t?this._dialColor:(this._dialColor=t instanceof qo?t:qo.rgb(Gl.DialColor),this)},e.prototype.dialCornerRadius=function(t){return void 0===t?this._dialCornerRadius:(this._dialCornerRadius=t instanceof Lo?t:Lo.pct(Gl.DialCornerRadius),this)},e.prototype.value=function(t){return void 0===t?this._value:(this._value!==t&&(this._value&&this.arcGroup.node.removeChild(this._value),this._value=t,this._value&&this.arcGroup.node.appendChild(this._value),this.render()),this)},e.prototype.valueSize=function(t){return void 0===t?this._valueSize:(null!==t&&(t=Lo.fromAny(t)),(this._valueSize?this._valueSize.equals(t):this._valueSize===t)||(this._valueSize=t),this)},e.prototype.parentResize=function(){for(var t=this.parentView.node;;){var e=t.parentNode;if(!e)return;if(e instanceof HTMLElement){var i=e.offsetWidth,r=e.offsetHeight;return this.parentView.width(i).height(e.offsetHeight),this.width(i,e),void this.height(r,e)}t=e}},e.prototype.childSize=function(){var t=this._width.pxValue(),e=this._height.pxValue(),i=Math.min(t,e);if(i){var r=this._outerRadius.pxValue(i/2),o=this._innerRadius.pxValue(r),n=$o.translate(t/2-r,e/2-r);this.gaugeBox.setAttribute("transform",n.toAttributeString());var s=$o.translate(r,r);this.arcGroup.setAttribute("transform",s.toAttributeString()),this.face.innerRadius(o).outerRadius(r),this.dial.innerRadius(o).outerRadius(r),null===this._dialCornerRadius&&void 0===this._dialCornerRadius||this.dial.cornerRadius(this._dialCornerRadius.pxValue(r-o/2)),this._value&&this._valueSize&&(this._value.setAttribute("text-anchor","middle"),this._value.setAttribute("alignment-baseline","middle"),this._value.setAttribute("font-size",""+Math.ceil(this._valueSize.pxValue(o))))}},e.prototype.resize=function(){this.parentResize(),this.childSize()},e.prototype.render=function(t){if(this.face.node.setAttribute("fill",this._faceColor.toString()),this.dial.node.setAttribute("fill",this._dialColor.toString()),this._meter.new!==this._meter.old){var e=Math.min(Math.max(0,this._meter.new),1)||0;this.dial.deltaAngle(2*Math.PI*e,t)}},e.prototype.addObserver=function(t){this.observers.indexOf(t)<0&&this.observers.push(t)},e.prototype.removeObserver=function(t){var e=this.observers.indexOf(t);0<=e&&this.observers.splice(e,1)},e.create=function(t){return void 0===t&&(t="svg"),new e(Sa.create(t).className("flow").setProperty({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:"default"}))},e}(),Hl=function(i){function t(t){var e=i.call(this)||this;return e.gauge=t,e}return v(t,i),t.prototype.onFrame=function(t){for(var e in this)this[e]instanceof ps&&this[e].onFrame(t);this.update()},t.prototype.update=function(){this.gauge.render()},t}(us),jl=function(c){function t(t){var e=c.call(this,t.parentView.node)||this;return e.view=t,e.animator=new Hl(e.view),e}return v(t,c),t.prototype.gaugeValue=function(t){var e=this.view.value();if(void 0===t)return e;if("string"==typeof t?t=document.createTextNode(t):(t instanceof Sa||t instanceof lu)&&(t=t.node),t instanceof Text)if(e){for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(t),t=e}else{var i=Sa.create("text").className("value");i.append(t),t=i.node}if(e){var r=e.view;e!==t&&r&&this.removeChildView(r)}if(this.view.value(t),t){var o=t.view;e!==t&&o&&this.appendChildView(o)}return this.animator.animate(),this},t.prototype.didReview=function(t){c.prototype.didReview.call(this,t),this.animator.enabled(t)},t.prototype.didResize=function(){c.prototype.didResize.call(this),this.view.resize(),this.view.render()},t.prototype.didSetState=function(t,e){c.prototype.didSetState.call(this,t,e);var i=t.get("transition").cast(jn.Form),r=t.get("meter").numberValue();void 0!==r&&this.propertyKeyNumber(Ba,"meter",r,i);var o=t.get("gaugeWidth").cast(Lo.Form);o&&this.propertyKeyLength(qa,"width",o,i);var n=t.get("gaugeHeight").cast(Lo.Form);n&&this.propertyKeyLength(qa,"height",n,i);var s=t.get("innerRadius").cast(Lo.Form);s&&this.propertyKeyLength(qa,"innerRadius",s,i);var a=t.get("outerRadius").cast(Lo.Form);a&&this.propertyKeyLength(qa,"outerRadius",a,i);var u=t.get("faceColor").cast(qo.Form);u&&this.propertyKeyColor(Na,"faceColor",u,i);var h=t.get("dialColor").cast(qo.Form);h&&this.propertyKeyColor(Na,"dialColor",h,i);var l=t.get("dialCornerRadius").cast(Lo.Form);l&&this.propertyKeyLength(qa,"dialCornerRadius",l,i);var p=t.get("valueSize").cast(Lo.Form);p&&this.propertyKeyLength(qa,"valueSize",p,i)},t.create=function(){return new t(Nl.create())},t.applyTheme=function(t){var e=q.get("value").divide(q.get("total").or(W.One)),i=q.get("primaryHue").invoke(e).or(q.get("primaryColor")),r=q.get("contrast").invoke(F.of(i,W.valueOf(2))),o=F.empty().slot("meter","0").slot("faceColor",i).slot("dialColor",i).slot("dialCornerRadius","0").slot("valueColor",r);t.set("gauge",o)},t}(Sa);jl.applyTheme(jl.Theme);var Kl=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return v(t,n),Object.defineProperty(t.prototype,"tag",{get:function(){return"gauge"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=jl.create(),o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new Yl,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){if(e.key instanceof O&&"value"===e.key.value){var o=r.castView(e.toValue(),i,r)||e.toValue().stringValue();if(void 0!==o)return t.gaugeValue(o),b.Absent}return n.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:n.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(Da);ma.addGlobal(Kl.Form);var Yl=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return v(r,t),r.prototype.updateValue=function(t){void 0===t&&(t=this.stack());var e=r.ValueSelector.evaluate(t).toValue().numberValue(NaN);if(isFinite(e))for(var i=0;i<this._childModels.length;i+=1)this._childModels[i]._modelScope._record.set("value",e);return e},r.ValueSelector=q.get("value"),r.Params=Va.Params.concat([new qs("transition",q.get("transition").or(q.get("gauge").get("transition"))),new qs("meter",q.get("meter").or(q.get("gauge").get("meter"))),new qs("gaugeWidth",q.get("gaugeWidth").or(q.get("gauge").get("width"))),new qs("gaugeHeight",q.get("gaugeHeight").or(q.get("gauge").get("height"))),new qs("innerRadius",q.get("innerRadius").or(q.get("gauge").get("innerRadius"))),new qs("outerRadius",q.get("outerRadius").or(q.get("gauge").get("outerRadius"))),new qs("faceColor",q.get("faceColor").or(q.get("gauge").get("faceColor"))),new qs("dialColor",q.get("dialColor").or(q.get("gauge").get("dialColor"))),new qs("dialCornerRadius",q.get("dialCornerRadius").or(q.get("gauge").get("dialCornerRadius"))),new qs("valueSize",q.get("valueSize").or(q.get("gauge").get("valueSize")))]),r}(Va),Xl=function(){function e(t){this.parentView=t,this.node=t.node,this._width=Lo.zero(t.node),this._height=Lo.zero(t.node),this._padding=Lo.zero(t.node),this._borderRadius=Lo.zero(t.node),this._backgroundColor=null,this._ledColor=null,this._title=null,this._titleSize=null,this._titleColor=null,this._subtitle=null,this._subtitleSize=null,this._subtitleColor=null,this._value=null,this._valueSize=null,this._valueColor=null,this._label=null,this._labelSize=null,this._labelColor=null,this._notice=null,this._noticeSize=null,this._noticeColor=null,this._meter=0,this._aspectRatio=null,this._cylinderHeight=Lo.zero(t.node),this._cylinderColor=qo.transparent(),this._pistonColor=qo.transparent(),this.observers=[],this._gauge=null,this._chart=null,this.kpiBox=this.parentView.append("article").className("kpi-box").display("flex").flexDirection("column").flexGrow(1).marginLeft("auto").marginRight("auto"),this.header=this.kpiBox.append("header").className("header").position("relative").display("flex"),this.ledBox=this.header.append("div").className("led-box").position("absolute").top(0).left(0).height("100%").display("flex").justifyContent("center").alignItems("center"),this.led=this.ledBox.append("div").className("led").borderRadius("50%").width("100%").height("100%"),this.titleBox=this.header.append("div").className("title-box").display("flex").flexGrow(1).alignItems("center"),this.subtitleBox=this.header.append("div").className("subtitle-box").display("flex").flexShrink(1).alignItems("center"),this.body=this.kpiBox.append("div").className("body").display("flex").flexGrow(1).position("relative"),this.bodyWrap=this.body.append("div").position("absolute").width("100%").height("100%"),this.point=this.bodyWrap.append("div").className("point").display("flex").flexDirection("column").justifyContent("center").alignItems("center"),this.valueBox=this.point.append("div").className("value-box").lineHeight(1).textAlign("center"),this.belt=this.kpiBox.append("div").className("belt").display("flex").marginBottom(5),this.noticeSpan=this.belt.append("span").className("notice").display("block").lineHeight(1),this.footer=this.kpiBox.append("div").className("footer").display("flex").alignItems("flex-end"),this.cylinder=this.footer.append("div").className("cylinder").position("relative").width("100%").height("100%"),this.piston=this.cylinder.append("div").className("piston").width(0).height("100%")}return e.prototype.gauge=function(){return this._gauge},e.prototype.addGauge=function(t){for(var e=0;e<this.observers.length;e+=1){if((r=this.observers[e]).kpiWillAddGauge){var i=r.kpiWillAddGauge(t,this);if(i)t=i;else if(null===i)return}}this._gauge=t,this.gaugeBox=this.bodyWrap.append("div").className("gauge-box"),this.gaugeBox.node.appendChild(t.parentView.node),t.addObserver(this);for(e=0;e<this.observers.length;e+=1){var r;(r=this.observers[e]).kpiDidAddGauge&&r.kpiDidAddGauge(t,this)}},e.prototype.removeGauge=function(t){for(var e=0;e<this.observers.length;e+=1){(i=this.observers[e]).kpiWillRemoveGauge&&i.kpiWillRemoveGauge(t,this)}t.removeObserver(this),this.gaugeBox.node.remove(),this._gauge=null;for(e=0;e<this.observers.length;e+=1){var i;(i=this.observers[e]).kpiDidRemoveGauge&&i.kpiDidRemoveGauge(t,this)}},e.prototype.chart=function(){return this._chart},e.prototype.addChart=function(t){for(var e=0;e<this.observers.length;e+=1){if((r=this.observers[e]).kpiWillAddChart){var i=r.kpiWillAddChart(t,this);if(i)t=i;else if(null===i)return}}this._chart=t,this.chartBox=this.bodyWrap.append("div").className("gauge-box"),this.chartBox.node.appendChild(t.node);for(e=0;e<this.observers.length;e+=1){var r;(r=this.observers[e]).kpiDidAddChart&&r.kpiDidAddChart(t,this)}},e.prototype.removeChart=function(t){for(var e=0;e<this.observers.length;e+=1){(i=this.observers[e]).kpiWillRemoveChart&&i.kpiWillRemoveChart(t,this)}this.chartBox.node.remove(),this._chart=null;for(e=0;e<this.observers.length;e+=1){var i;(i=this.observers[e]).kpiDidRemoveChart&&i.kpiDidRemoveChart(t,this)}},e.prototype.width=function(t,e){return void 0===t?this._width:(this._width=null===t?Lo.zero(this.parentView.node):t instanceof Lo?t:Lo.fromAny(t,e),this)},e.prototype.height=function(t,e){return void 0===t?this._height:(this._height=null===t?Lo.zero(this.parentView.node):t instanceof Lo?t:Lo.fromAny(t,e),this)},e.prototype.padding=function(t){return void 0===t?this._padding:(t=Lo.fromAny(t,this.node),this._padding.equals(t)||(this._padding=t),this)},e.prototype.borderRadius=function(t){return void 0===t?this._borderRadius:(t=Lo.fromAny(t,this.node),this._borderRadius.equals(t)||(this._borderRadius=t),this)},e.prototype.backgroundColor=function(t){return void 0===t?this._backgroundColor:(null===t?null!==this._backgroundColor&&(this._backgroundColor=t):(t=qo.fromAny(t),null!==this._backgroundColor&&this._backgroundColor.equals(t)||(this._backgroundColor=t)),this)},e.prototype.ledColor=function(t){return void 0===t?this._ledColor:(null===t?this._ledColor=null:(t=qo.fromAny(t),null!==this._ledColor&&this._ledColor.equals(t)||(this._ledColor=t)),this)},e.prototype.title=function(t){return void 0===t?this._title:(this._title!==t&&(this._title&&this.titleBox.node.removeChild(this._title),this._title=t,this._title&&this.titleBox.node.appendChild(this._title),this.render()),this)},e.prototype.titleSize=function(t){return void 0===t?this._titleSize:(null!==t&&(t=Lo.fromAny(t)),(this._titleSize?this._titleSize.equals(t):this._titleSize===t)||(this._titleSize=t),this)},e.prototype.titleColor=function(t){return void 0===t?this._titleColor:(null!==t&&(t=qo.fromAny(t)),(this._titleColor?this._titleColor.equals(t):this._titleColor===t)||(this._titleColor=t),this)},e.prototype.subtitle=function(t){return void 0===t?this._subtitle:(this._subtitle!==t&&(this._subtitle&&this.subtitleBox.node.removeChild(this._subtitle),this._subtitle=t,this._subtitle&&this.subtitleBox.node.appendChild(this._subtitle),this.render()),this)},e.prototype.subtitleSize=function(t){return void 0===t?this._subtitleSize:(null!==t&&(t=Lo.fromAny(t)),(this._subtitleSize?this._subtitleSize.equals(t):this._subtitleSize===t)||(this._subtitleSize=t),this)},e.prototype.subtitleColor=function(t){return void 0===t?this._subtitleColor:(null!==t&&(t=qo.fromAny(t)),(this._subtitleColor?this._subtitleColor.equals(t):this._subtitleColor===t)||(this._subtitleColor=t),this)},e.prototype.value=function(t){return void 0===t?this._value:(this._value!==t&&(this._value&&this.valueBox.node.removeChild(this._value),this._value=t,this._value&&this.valueBox.node.appendChild(this._value),this.render()),this)},e.prototype.valueSize=function(t){return void 0===t?this._valueSize:(null!==t&&(t=Lo.fromAny(t)),(this._valueSize?this._valueSize.equals(t):this._valueSize===t)||(this._valueSize=t),this)},e.prototype.valueColor=function(t){return void 0===t?this._valueColor:(null!==t&&(t=qo.fromAny(t)),(this._valueColor?this._valueColor.equals(t):this._valueColor===t)||(this._valueColor=t),this)},e.prototype.label=function(t){return void 0===t?this._label:(this._label!==t&&(this._label&&this.labelbox.node.remove(),this._label=t,this._label&&(this.labelbox=this.point.append("div").className("label-box").lineHeight(1).textAlign("right").width("100%").paddingRight("30%"),this.labelbox.node.appendChild(this._label)),this.render()),this)},e.prototype.labelSize=function(t){return void 0===t?this._labelSize:(null!==t&&(t=Lo.fromAny(t)),(this._labelSize?this._labelSize.equals(t):this._labelSize===t)||(this._labelSize=t),this)},e.prototype.labelColor=function(t){return void 0===t?this._labelColor:(null!==t&&(t=qo.fromAny(t)),(this._labelColor?this._labelColor.equals(t):this._labelColor===t)||(this._labelColor=t),this)},e.prototype.notice=function(t){return void 0===t?this._notice:(this._notice!==t&&(this._notice&&this.noticeSpan.node.removeChild(this._notice),this._notice=t,this._notice&&this.noticeSpan.node.appendChild(this._notice),this.render()),this)},e.prototype.noticeSize=function(t){return void 0===t?this._noticeSize:(null!==t&&(t=Lo.fromAny(t)),(this._noticeSize?this._noticeSize.equals(t):this._noticeSize===t)||(this._noticeSize=t),this)},e.prototype.noticeColor=function(t){return void 0===t?this._noticeColor:(null!==t&&(t=qo.fromAny(t)),(this._noticeColor?this._noticeColor.equals(t):this._noticeColor===t)||(this._noticeColor=t),this)},e.prototype.meter=function(t){if(void 0===t)return this._meter;var e=this._meter;if(e!==t){this._meter=t;for(var i=0;i<this.observers.length;i+=1){var r=this.observers[i];r.kpiDidSetMeter&&r.kpiDidSetMeter(t,e,this)}}return this},e.prototype.cylinderHeight=function(t){return void 0===t?this._cylinderHeight:(t=Lo.fromAny(t),this._cylinderHeight.equals(t)||(this._cylinderHeight=t),this)},e.prototype.cylinderColor=function(t){return void 0===t?this._cylinderColor:(t=qo.fromAny(t),this._cylinderColor.equals(t)||(this._cylinderColor=t),this)},e.prototype.pistonColor=function(t){return void 0===t?this._pistonColor:(t=qo.fromAny(t),this._pistonColor.equals(t)||(this._pistonColor=t),this)},e.prototype.aspectRatio=function(t){if(void 0===t)return this._aspectRatio;var e=this._aspectRatio;return this._aspectRatio=t||null,e!==t&&this.resize(),this},e.prototype.parentResize=function(){for(var t=this.parentView.node;;){var e=t.parentNode;if(!e)return;if(e instanceof HTMLElement){var i=e.offsetWidth,r=e.offsetHeight;return this.parentView.width(i).height(e.offsetHeight),this.width(i,e),void this.height(r,e)}t=e}},e.prototype.childSize=function(){var t=this._width.pxValue(),e=this._height.pxValue();this._aspectRatio&&(e=t*this._aspectRatio),this.parentView.height(e),this.height(e)},e.prototype.resize=function(){this.parentResize(),this.childSize()},e.prototype.render=function(t){this.renderMeter(t),this.renderStyle(t)},e.prototype.renderStyle=function(t){this.parentView.borderRadius(this._borderRadius.pxValue());var e=this._cylinderHeight.pxValue(this._height.pxValue());if(e&&(this.footer.height(e,t),this.cylinder.backgroundColor(this._cylinderColor),this.piston.backgroundColor(this._pistonColor)),this._backgroundColor&&(this.header.margin(this._padding.pxValue()),this.belt.paddingLeft(this._padding.pxValue()),this.kpiBox.backgroundColor(this._backgroundColor)),this._ledColor){var i=this._titleSize?this._titleSize.pxValue():this.header.node.offsetHeight;this.led.width(i).height(i),this.led.backgroundColor(this._ledColor),this.titleBox.paddingLeft(i+5)}else this.titleBox.paddingLeft(0);if(this._title&&(this._title.style.color=this._titleColor?""+this._titleColor:"",this._title.style.fontSize=this._titleSize?""+this._titleSize:""),this._subtitle&&(this._subtitle.style.color=this._subtitleColor?""+this._subtitleColor:"",this._subtitle.style.fontSize=this._subtitleSize?""+this._subtitleSize:""),this._value&&(this._value.style.color=this._valueColor?""+this._valueColor:"",this._value.style.fontSize=this._valueSize?""+this._valueSize:""),this._label&&(this._label.style.color=this._labelColor?""+this._labelColor:"",this._label.style.fontSize=this._labelSize?""+this._labelSize:""),this._label||this.value||this.point.display("none"),this._notice?(this._notice.style.color=this._noticeColor?""+this._noticeColor:"",this._notice.style.fontSize=this._noticeSize?""+this._noticeSize:""):this.belt.display("none"),this._value&&this.chartBox&&this.gaugeBox?(this.point.height("33%"),this.chartBox.height("33%"),this.gaugeBox.height("33%")):this._value&&this.chartBox||this._value&&this.gaugeBox?(this.chartBox&&(this.point.height("70%"),this.chartBox.height("30%")),this.gaugeBox&&(this.point.height("30%"),this.gaugeBox.height("70%"))):(this._value&&this.point.height("100%"),this.chartBox&&this.chartBox.height("100%"),this.gaugeBox&&this.gaugeBox.height("100%")),this._gauge&&this._gauge.resize(),this._chart){var r=this.chartBox.node.offsetHeight,o=this.chartBox.node.offsetWidth;this._chart.node.setAttribute("height",""+r),this._chart.node.setAttribute("width",""+o),this._chart.height(r),this._chart.width(o),this._chart.update()}},e.prototype.renderMeter=function(t){var e=this._width.pxValue(),i=this._height.pxValue();if(Math.min(e,i)){this.kpiBox.width(e).height(i);var r=Math.min(Math.max(0,this._meter),1)||0;this.piston.width(100*r,t)}},e.prototype.gaugeDidSetMeter=function(t,e,i){for(var r=0;r<this.observers.length;r+=1){var o=this.observers[r];o.kpiGaugeDidSetMeter&&o.kpiGaugeDidSetMeter(t,e,i,this)}},e.prototype.addObserver=function(t){this.observers.indexOf(t)<0&&this.observers.push(t)},e.prototype.removeObserver=function(t){var e=this.observers.indexOf(t);0<=e&&this.observers.splice(e,1)},e.create=function(t){return void 0===t&&(t="div"),new e(Fa.create(t).className("kpi-card").setProperty({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:"default",overflow:"hidden"}))},e}(),Ql=function(r){function t(t,e){var i=r.call(this)||this;return i.kpi=t,i.childViews=e,i}return v(t,r),t.prototype.onFrame=function(t){for(var e in this)this[e]instanceof ps&&this[e].onFrame(t);this.update()},t.prototype.renderChildView=function(){for(var t=0;t<this.childViews.length;t+=1){var e=this.childViews[t];e instanceof jl?e.view.render():e instanceof Wl&&e.render()}},t.prototype.update=function(){this.kpi.render(),this.renderChildView()},t}(us),Zl=function(L){function t(t){var e=L.call(this,t.node)||this;return e.view=t,e.animator=new Ql(e.view,e._childViews),e.view.addObserver(e),e}return v(t,L),t.prototype.gauge=function(){for(var t=null,e=0;e<this._childViews.length;e+=1){var i=this._childViews[e];i instanceof jl&&(t=i)}return t},t.prototype.addGauge=function(t){this.appendChildView(t)},t.prototype.removeGauge=function(t){this.removeChildView(t)},t.prototype.chart=function(){for(var t=null,e=0;e<this._childViews.length;e+=1){var i=this._childViews[e];i instanceof Wl&&(t=i)}return t},t.prototype.addChart=function(t){this.appendChildView(t)},t.prototype.removeChart=function(t){this.removeChildView(t)},t.prototype.didInsertChildView=function(t){t instanceof jl?this.view.addGauge(t.view):t instanceof Wl&&this.view.addChart(t.chart),L.prototype.didInsertChildView.call(this,t)},t.prototype.didRemoveChildView=function(t){t instanceof jl?this.view.removeGauge(t.view):t instanceof Wl&&this.view.removeChart(t.chart),L.prototype.didRemoveChildView.call(this,t)},t.prototype.textElement=function(t,e){var i=this.view[t]();if(void 0===e)return i;if("string"==typeof e?e=document.createTextNode(e):(e instanceof Fa||e instanceof lu)&&(e=e.node),e instanceof Text)if(i){for(;i.firstChild;)i.removeChild(i.firstChild);i.appendChild(e),e=i}else{var r=Fa.create("span").className(t);r.append(e),e=r.node}if(i){var o=i.view;i!==e&&o&&this.removeChildView(o)}if(this.view[t](e),e){var n=e.view;i!==e&&n&&this.appendChildView(n)}return this.animator.animate(),this},t.prototype.didReview=function(t){L.prototype.didReview.call(this,t),this.animator.enabled(t)},t.prototype.didResize=function(){L.prototype.didResize.call(this),this.view.resize(),this.view.render()},t.prototype.didSetState=function(t,e){L.prototype.didSetState.call(this,t,e);var i=t.get("transition").cast(jn.Form),r=t.get("kpiWidth").cast(Lo.Form);r&&this.propertyKeyLength(qa,"width",r,i),t.get("kpiHeight").cast(Lo.Form)&&this.propertyKeyLength(qa,"height",r,i);var o=t.get("aspectRatio");if(o instanceof W)this.propertyKeyNumber(Ba,"aspectRatio",o.numberValue(),i);else{var n=o.stringValue();"string"==typeof n&&"square"===n&&this.propertyKeyNumber(Ba,"aspectRatio",1,i)}var s=t.get("kpiPadding").cast(Lo.Form);s&&this.propertyKeyLength(qa,"padding",s,i);var a=t.get("kpiBorderRadius").cast(Lo.Form);a&&this.propertyKeyLength(qa,"borderRadius",a,i);var u=t.get("backgroundColor").cast(qo.Form);u&&this.propertyKeyColor(Na,"backgroundColor",u,i);var h=t.get("ledColor").cast(qo.Form);h&&this.propertyKeyColor(Na,"ledColor",h,i);var l=t.get("titleSize").cast(Lo.Form);l&&this.propertyKeyLength(qa,"titleSize",l,i);var p=t.get("titleColor").cast(qo.Form);p&&this.propertyKeyColor(Na,"titleColor",p,i);var c=this.textElement("title");if(c){var d=t.get("titleWeight").numberValue();d&&(c.style.fontWeight=""+d)}var f=t.get("subtitleSize").cast(Lo.Form);f&&this.propertyKeyLength(qa,"subtitleSize",f,i);var y=t.get("subtitleColor").cast(qo.Form);y&&this.propertyKeyColor(Na,"subtitleColor",y,i);var m=this.textElement("subtitle");if(m){var v=t.get("subtitleWeight").numberValue();v&&(m.style.fontWeight=""+v)}var g=t.get("valueSize").cast(Lo.Form);g&&this.propertyKeyLength(qa,"valueSize",g,i);var b=t.get("valueColor").cast(qo.Form);b&&this.propertyKeyColor(Na,"valueColor",b,i);var w=this.textElement("value");if(w){var _=t.get("valueWeight").numberValue();_&&(w.style.fontWeight=""+_)}var x=t.get("labelSize").cast(Lo.Form);x&&this.propertyKeyLength(qa,"labelSize",x,i);var k=t.get("labelColor").cast(qo.Form);k&&this.propertyKeyColor(Na,"labelColor",k,i);var A=this.textElement("label");if(A){var E=t.get("labelWeight").numberValue();E&&(A.style.fontWeight=""+E)}var C=t.get("noticeSize").cast(Lo.Form);C&&this.propertyKeyLength(qa,"noticeSize",C,i);var S=t.get("noticeColor").cast(qo.Form);S&&this.propertyKeyColor(Na,"noticeColor",S,i);var V=this.textElement("notice");if(V){var D=t.get("noticeWeight").numberValue();D&&(V.style.fontWeight=""+D)}var M=t.get("meter").numberValue();void 0!==M&&this.propertyKeyNumber(Ba,"meter",M,i);var P=t.get("cylinderHeight").cast(Lo.Form);P&&this.propertyKeyLength(qa,"cylinderHeight",P,i);var R=t.get("cylinderColor").cast(qo.Form);R&&this.propertyKeyColor(Na,"cylinderColor",R,i);var T=t.get("pistonColor").cast(qo.Form);T&&this.propertyKeyColor(Na,"pistonColor",T,i)},t.prototype.kpiGaugeDidSetMeter=function(t,e,i,r){this.animator.animate()},t.prototype.addObserver=function(t){this.view.addObserver(t)},t.prototype.removeObserver=function(t){this.view.removeObserver(t)},t.create=function(){return new t(Xl.create())},t.applyTheme=function(t){var e=q.get("value").divide(q.get("total").or(W.One)),i=q.get("primaryHue").invoke(e).or(q.get("primaryColor")),r=q.get("contrast").invoke(F.of(i,W.valueOf(2))),o=F.empty().slot("titleSize","15px").slot("titleWeight","300").slot("subtitleSize","15px").slot("subtitleWeight","300").slot("labelSize","36px").slot("labelWeight","400").slot("labelSize","15px").slot("labelWeight","300").slot("noticeSize","15px").slot("noticeWeight","300").slot("meter","0").slot("cylinderHeight","5%").slot("cylinderColor",r).slot("pistonColor",i);t.set("kpi",o)},t}(Fa);Zl.applyTheme(Zl.Theme);var Jl=function(c){function t(){return null!==c&&c.apply(this,arguments)||this}return v(t,c),Object.defineProperty(t.prototype,"tag",{get:function(){return"kpi"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=Zl.create(),o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new $l,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){if(e.key instanceof O){var o=e.key.value;if("title"===o){var n=r.castView(e.toValue(),i,r)||e.toValue().stringValue();if(void 0!==n)return t.textElement("title",n),b.Absent}else if("subtitle"===o){var s=r.castView(e.toValue(),i,r)||e.toValue().stringValue();if(void 0!==s)return t.textElement("subtitle",s),b.Absent}else if("value"===o){var a=r.castView(e.toValue(),i,r)||e.toValue().stringValue();if(void 0!==a)return t.textElement("value",a),b.Absent}else if("label"===o){var u=r.castView(e.toValue(),i,r)||e.toValue().stringValue();if(void 0!==u)return t.textElement("label",u),b.Absent}else if("notice"===o){var h=r.castView(e.toValue(),i,r)||e.toValue().stringValue();if(void 0!==h)return t.textElement("notice",h),b.Absent}}var l=Kl.Form.castView(e.toValue(),i,r);if(l)return t.addGauge(l),l;var p=Bl.Form.castView(e.toValue(),i,r);return p?(t.addChart(p),p):c.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:c.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(za);ma.addGlobal(Jl.Form);var $l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Params=Ia.Params.concat([new qs("transition",q.get("transition").or(q.get("kpi").get("transition"))),new qs("meter",q.get("meter").or(q.get("kpi").get("meter"))),new qs("kpiWidth",q.get("kpiWidth").or(q.get("kpi").get("width"))),new qs("kpiHeight",q.get("kpiHeight").or(q.get("kpi").get("height"))),new qs("aspectRatio",q.get("aspectRatio").or(q.get("kpi").get("aspectRatio"))),new qs("kpiPadding",q.get("kpiPadding").or(q.get("kpi").get("padding"))),new qs("kpiBorderRadius",q.get("kpiBorderRadius").or(q.get("kpi").get("borderRadius"))),new qs("backgroundColor",q.get("backgroundColor").or(q.get("kpi").get("backgroundColor"))),new qs("ledColor",q.get("ledColor").or(q.get("kpi").get("ledColor"))),new qs("titleSize",q.get("titleSize").or(q.get("kpi").get("titleSize"))),new qs("titleColor",q.get("titleColor").or(q.get("kpi").get("titleColor"))),new qs("titleWeight",q.get("titleWeight").or(q.get("kpi").get("titleWeight"))),new qs("subtitleSize",q.get("subtitleSize").or(q.get("kpi").get("subtitleSize"))),new qs("subtitleColor",q.get("subtitleColor").or(q.get("kpi").get("subtitleColor"))),new qs("subtitleWeight",q.get("subtitleWeight").or(q.get("kpi").get("subtitleWeight"))),new qs("valueSize",q.get("valueSize").or(q.get("kpi").get("valueSize"))),new qs("valueColor",q.get("valueColor").or(q.get("kpi").get("valueColor"))),new qs("valueWeight",q.get("valueWeight").or(q.get("kpi").get("valueWeight"))),new qs("labelSize",q.get("labelSize").or(q.get("kpi").get("labelSize"))),new qs("labelColor",q.get("labelColor").or(q.get("kpi").get("labelColor"))),new qs("labelWeight",q.get("labelWeight").or(q.get("kpi").get("labelWeight"))),new qs("noticeSize",q.get("noticeSize").or(q.get("kpi").get("noticeSize"))),new qs("noticeColor",q.get("noticeColor").or(q.get("kpi").get("noticeColor"))),new qs("noticeWeight",q.get("noticeWeight").or(q.get("kpi").get("noticeWeight"))),new qs("cylinderHeight",q.get("cylinderHeight").or(q.get("kpi").get("cylinderHeight"))),new qs("cylinderColor",q.get("cylinderColor").or(q.get("kpi").get("cylinderColor"))),new qs("pistonColor",q.get("pistonColor").or(q.get("kpi").get("pistonColor")))]),e}(Ia),tp=function(e){function t(t){return e.call(this,t)||this}return v(t,e),t}(Fa),ep=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e}(Ia),ip=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e}(za),rp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e}(ga),op=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return v(r,t),r.prototype.addLayer=function(t){this.appendChildView(t)},r.prototype.removeLayer=function(t){this.appendChildView(t)},r.prototype.addGeometry=function(t){this.appendChildView(t)},r.prototype.removeGeometry=function(t){this.appendChildView(t)},r.prototype.collectFeatures=function(t){for(var e=0;e<this._childViews.length;e+=1){var i=this._childViews[e];i instanceof r?i.collectFeatures(t):i instanceof rp&&t.push(i.toGeoJson())}},r.prototype.toGeoJson=function(){var t=[];return this.collectFeatures(t),{type:"FeatureCollection",features:t}},r}(ga),np=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e}(Gs),sp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e}(ma),ap=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e}(Gs),up=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e}(ma),hp={LngLatForm:new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),Object.defineProperty(e.prototype,"unit",{get:function(){},enumerable:!0,configurable:!0}),e.prototype.mold=function(t){return t?F.empty(2).slot("lng",t.lng).slot("lat",t.lat):w.Absent},e.prototype.cast=function(t){var e=t.get("lng").numberValue(),i=t.get("lat").numberValue();if(void 0!==e&&void 0!==i)return new l.LngLat(e,i)},e}(_e))},lp=function(l){function e(t){var e=l.call(this,t)||this;return e.display("flex").visibility("hidden").position("absolute").placement(["top","bottom","right","left"]).borderRadius(3),e}return v(e,l),e.prototype.setMap=function(t,e){this._map&&this._map.off("render",this.replace),this._map=t,this._position=e,this._map.on("render",this.replace),this.replace()},e.prototype.replace=function(){if(this._map){var t=this._map.project(this._position),e=this._map.getContainer(),i=e.getBoundingClientRect(),r=i.left-e.offsetLeft,o=i.top-e.offsetTop,n=this.node.getBoundingClientRect(),s=n.left-this.node.offsetLeft,a=n.top-this.node.offsetTop,u=Math.round(t.x-5+r-s),h=Math.round(t.y-5+o-a);u===this.view.sourceLeft().pxValue()&&h===this.view.sourceTop().pxValue()||(this.view.sourceLeft(u),this.view.sourceTop(h),this.view.sourceWidth(10),this.view.sourceHeight(10),this.animator.update())}else l.prototype.replace.call(this)},e.prototype.popoverDidHide=function(t){l.prototype.popoverDidHide.call(this,t),this._map&&this._map.off("render",this.replace)},e.prototype.didSetState=function(t,e){l.prototype.didSetState.call(this,t,e);var i=t.get("popoverWidth").cast(Lo.Form);i&&(this.width(i),this.requireResize());var r=t.get("popoverHeight").cast(Lo.Form);r&&(this.height(r),this.requireResize()),e.isDefined()||(this.visibility(null),this.render())},e.create=function(t){if(t instanceof e)return t;if(t instanceof _a)throw new TypeError(""+t);if(void 0===t||"string"==typeof t)return new e(ms.create(t));if(t.view instanceof e)return t.view;if(t.view)throw new TypeError(""+t.view);if(t instanceof HTMLElement)return new e(new ms(t));throw new TypeError(""+t)},e}(Ka),pp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Params=Ya.Params.concat([new qs("popoverWidth",q.get("popoverWidth").or(q.get("popover").get("width"))),new qs("popoverHeight",q.get("popoverHeight").or(q.get("popover").get("height")))]),e}(Ya),cp=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return v(t,n),Object.defineProperty(t.prototype,"tag",{get:function(){return"mapboxPopover"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=lp.create(),o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new pp,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){if(e.key instanceof O&&"body"===e.key.value){var o=r.castView(e.toValue(),i,r);if(o)return t.append(o),o}return n.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:n.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(za);ma.addGlobal(cp.Form);var dp=function(e){function t(){var t=e.call(this)||this;return t._featureId=C.generateId(),t}return v(t,e),Object.defineProperty(t.prototype,"center",{get:function(){},enumerable:!0,configurable:!0}),t.prototype.setMap=function(t){this._map=t},t.prototype.requestRedraw=function(){0==(this._flags&ga.REQUEST_REDRAW)&&(this._flags|=ga.REQUEST_REDRAW,this._parentView&&this._parentView.requireRedraw())},t.prototype.onMapMouseEnter=function(t,e){if(this._hoverPopoverTemplate){var i=this.appView;if(i&&(this._hoverPopover=cp.Form.castView(this._hoverPopoverTemplate,this.stack(),ma.Global),this._hoverPopover)){var r=this.center||t.lngLat;this._hoverPopover.setMap(e,r),this._hoverPopover.addObserver(this),this.appendChildView(this._hoverPopover),i.showPopover(this._hoverPopover,{exclusive:!1})}}},t.prototype.onMapMouseLeave=function(t,e){this._hoverPopover&&this._hoverPopover.hide()},t.prototype.onMapClick=function(t,e){var i=t.originalEvent;if(i.stopPropagation(),this._clickPopover)this._clickPopover.hide();else if(this._clickPopoverTemplate){var r=this.appView,o=this.center||t.lngLat;r&&(this._clickPopover=cp.Form.castView(this._clickPopoverTemplate,this.stack(),ma.Global),this._clickPopover?(this._hoverPopover&&this._hoverPopover.hide(),this._clickPopover.setMap(e,o),this._clickPopover.addObserver(this),this.appendChildView(this._clickPopover),r.showPopover(this._clickPopover,{exclusive:!i.shiftKey})):this._hoverPopover&&(this._clickPopover=this._hoverPopover,this._hoverPopover=void 0)),void 0!==this._clickFlyToZoom&&e.flyTo({center:[o.lng,o.lat],zoom:this._clickFlyToZoom})}},t.prototype.popoverDidHide=function(t){this._hoverPopover&&this._hoverPopover.view===t&&(this._hoverPopover=void 0),this._clickPopover&&this._clickPopover.view===t&&(this._clickPopover=void 0)},t}(rp),fp=function(r){function o(){var t=r.call(this)||this;return t.onMapSourceData=t.onMapSourceData.bind(t),t}return v(o,r),o.prototype.getGeometry=function(t){for(var e,i=0;void 0===e&&i<this._childViews.length;i+=1){var r=this._childViews[i];if(r instanceof o)e=r.getGeometry(t);else if(r instanceof dp&&r._featureId===t){e=r;break}}return e},o.prototype.setMap=function(t){this._map=t,void 0!==this._layerType&&(this._sourceId=C.generateId(),this._layerId=C.generateId(),t.addSource(this._sourceId,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),t.addLayer({id:this._layerId,type:this._layerType,source:this._sourceId}),this.updateLayerStyle(this._state,t),t.on("sourcedata",this.onMapSourceData));for(var e=0;e<this._childViews.length;e+=1)this.initChildView(this._childViews[e],t)},o.prototype.initChildView=function(t,e){t instanceof o?t.setMap(e):t instanceof dp&&t.setMap(e)},o.prototype.didInsertChildView=function(t){var e=this._map;e&&this.initChildView(t,e),r.prototype.didInsertChildView.call(this,t)},o.prototype.setZoomRange=function(t,e){this._map.setLayerZoomRange(this._layerId,t,e)},o.prototype.setPaintProperty=function(t,e){this._map.setPaintProperty(this._layerId,t,e)},o.prototype.updatePaintProperty=function(t,e){var i;if(e instanceof W)i=e.numberValue();else{var r=ws.Form.cast(e);i=void 0!==r?r.toString():{type:"identity",property:e.stringValue()}}void 0!==i&&this.setPaintProperty(t,i)},o.prototype.updateLayerStyle=function(t,e){var i=t.get("zoomRange").toValue();if(i.isDefined()){var r=i.getItem(0).numberValue(),o=i.getItem(1).numberValue();void 0!==r&&void 0!==o&&this.setZoomRange(r,o)}var n=t.get("fillColor");n.isDefined()&&this.updatePaintProperty("fill-color",n);var s=t.get("fillOpacity");s.isDefined()&&this.updatePaintProperty("fill-opacity",s);var a=t.get("circleColor");a.isDefined()&&this.updatePaintProperty("circle-color",a);var u=t.get("circleOpacity");u.isDefined()&&this.updatePaintProperty("circle-opacity",u);var h=t.get("circleRadius");h.isDefined()&&this.updatePaintProperty("circle-radius",h)},o.prototype.requestRedraw=function(){0==(this._flags&ga.REQUEST_REDRAW)&&(this._flags|=ga.REQUEST_REDRAW,this._parentView&&this._parentView.requireRedraw())},o.prototype.didSetState=function(t,e){r.prototype.didSetState.call(this,t,e);var i=this._map;i&&void 0!==this._layerId&&this.updateLayerStyle(t,i),this.requireRedraw()},o.prototype.didRedraw=function(){if(r.prototype.didRedraw.call(this),0!=(this._flags&o.SourceLoaded)){var t=this._map.getSource(this._sourceId),e=this.toGeoJson();t.setData(e)}},o.prototype.onMapSourceData=function(){var t=this._map;t.isSourceLoaded(this._sourceId)&&(t.off("sourcedata",this.onMapSourceData),this._flags|=o.SourceLoaded,this.requireRedraw())},o.prototype.onFeatureClick=function(t,e){if(t.properties&&void 0!==t.properties.id){var i=this.getGeometry(t.properties.id);i&&i.onMapClick(e,this._map)}},o.SourceLoaded=65536,o}(op),yp=function(o){function i(t){var e=o.call(this,t)||this;return e._hoverGeometry={},e.position("relative").visibility("hidden").flexGrow(1),e.onClick=e.onClick.bind(e),e.onMapLoad=e.onMapLoad.bind(e),e.onMapZoom=e.onMapZoom.bind(e),e.onMapClick=e.onMapClick.bind(e),e.onMapMouseMove=e.onMapMouseMove.bind(e),e.node.addEventListener("click",e.onClick),e}return v(i,o),Object.defineProperty(i.prototype,"layerIds",{get:function(){for(var t=[],e=0;e<this._childViews.length;e+=1){var i=this._childViews[e];i instanceof fp&&void 0!==i._layerId&&t.push(i._layerId)}return t},enumerable:!0,configurable:!0}),i.prototype.getLayer=function(t){for(var e=0;e<this._childViews.length;e+=1){var i=this._childViews[e];if(i instanceof fp&&i._layerId===t)return i}},i.prototype.addLayer=function(t){this.appendChildView(t)},i.prototype.removeLayer=function(t){this.removeChildView(t)},i.prototype.getGeometry=function(t,e){var i=this.getLayer(e);if(i)return i.getGeometry(t)},i.prototype.initMap=function(t){var e=this._map;return e||(t.container=this.node,this._map=e=new l.Map(t),e.on("load",this.onMapLoad),e.on("zoom",this.onMapZoom),e.on("click",this.onMapClick),e.on("mousemove",this.onMapMouseMove)),e},i.prototype.initChildView=function(t,e){t instanceof fp&&t.setMap(e)},i.prototype.didInsertChildView=function(t){0!=(this._flags&i.MapLoaded)&&this.initChildView(t,this._map),o.prototype.didInsertChildView.call(this,t)},i.prototype.didResize=function(){o.prototype.didResize.call(this),0!=(this._flags&i.MapLoaded)&&this._map.resize()},i.prototype.didSetState=function(t,e){o.prototype.didSetState.call(this,t,e);var i=t.get("accessToken").stringValue();if(void 0!==i&&i!==l.accessToken){Object.getOwnPropertyDescriptor(l,"accessToken").set(i);var r={};r.style=t.get("style").stringValue(),r.center=t.get("center").cast(hp.LngLatForm),r.pitch=t.get("pitch").numberValue(),r.zoom=t.get("zoom").numberValue(),void 0!==r.style&&this.initMap(r)}},i.prototype.onMapLoad=function(){var t=this._map;t.off("load",this.onMapLoad),t.resize(),this._flags&=~i.MapLoaded,this.visibility(null);for(var e=0;e<this._childViews.length;e+=1)this.initChildView(this._childViews[e],t)},i.prototype.onMapZoom=function(){var t=this._map,e=this._model,i=e.get("zoom").numberValue(),r=Math.round(t.getZoom());if(i!==r){var o=e.withSlot("zoom",r);this.setModel(o)}},i.prototype.onClick=function(t){t.stopPropagation()},i.prototype.onMapClick=function(t){var e=this._map.queryRenderedFeatures(t.point,{layers:this.layerIds});if(e.length)for(var i=0;i<e.length;i+=1){var r=e[i],o=this.getLayer(r.layer.id);o&&o.onFeatureClick(r,t)}else{var n=this.appView;n&&n.onPassthroughClick(t.originalEvent)}},i.prototype.onMapMouseMove=function(t){for(var e={},i=this._map.queryRenderedFeatures(t.point,{layers:this.layerIds}),r=0;r<i.length;r+=1){var o=i[r];if(o.properties&&void 0!==o.properties.id){var n=o.properties.id,s=o.layer.id;(a=this.getGeometry(n,s))&&(this._hoverGeometry[n]||a.onMapMouseEnter(t,this._map),e[n]=a)}}for(var n in this._hoverGeometry){var a;(a=this._hoverGeometry[n])&&!e[n]&&a.onMapMouseLeave(t,this._map)}this._hoverGeometry=e,this._map.getCanvas().style.cursor=e.length?"pointer":""},i.create=function(){return new i(document.createElement("div")).className("map mapbox")},i.applyTheme=function(t){var e=F.empty();t.set("mapbox",e)},i.MapLoaded=65536,i}(tp);yp.applyTheme(yp.Theme);var mp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.willRemodel=function(t,e){if(this._state.get("zoom").numberValue()!==t.get("zoom").numberValue())for(var i=0;i<this._childModels.length;i+=1)this._childModels[i].requireRestate()},e.Params=ep.Params.concat([new qs("accessToken",q.get("accessToken")),new qs("style",q.get("style")),new qs("center",q.get("center")),new qs("pitch",q.get("pitch")),new qs("zoom",q.get("zoom"))]),e}(ep),vp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Params=np.Params.concat([new qs("zoomRange",q.get("zoomRange")),new qs("fillColor",q.get("fillColor")),new qs("fillOpacity",q.get("fillOpacity")),new qs("circleColor",q.get("circleColor")),new qs("circleOpacity",q.get("circleOpacity")),new qs("circleRadius",q.get("circleRadius"))]),e}(np),gp=function(u){function e(){return null!==u&&u.apply(this,arguments)||this}return v(e,u),e.addGlobal=function(t){e.Global=e.Global.withUiForm(t)},e.removeGlobal=function(t){e.Global=e.Global.withoutUiForm(t)},e.prototype.materializeViewParam=function(t,e,i,r){if(e.key instanceof O){var o=e.key.value;if("hover"===o){var n=e.toValue();t._hoverPopoverTemplate=n.get("popover")}else if("click"===o){var s=e.toValue();t._clickPopoverTemplate=s.get("popover");var a=s.get("flyTo");a.isDefined()&&(t._clickFlyToZoom=a.get("zoom").numberValue())}}return u.prototype.materializeViewParam.call(this,t,e,i,r)},e.Global=new va([]),e}(up),bp=function(s){function a(){return null!==s&&s.apply(this,arguments)||this}return v(a,s),Object.defineProperty(a.prototype,"tag",{get:function(){return"mapboxLayer"},enumerable:!0,configurable:!0}),a.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=new fp,o=this.materializeView(r,t,e,i);return r.setModel(o),r}},a.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new vp,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},a.prototype.materializeViewParam=function(t,e,i,r){if(e.key instanceof O){"type"===e.key.value&&(t._layerType=e.toValue().evaluate(i).toValue().stringValue(t._layerType))}else{var o=a.Form.castView(e.toValue(),i,r);if(o)return t.addLayer(o),o;var n=gp.Global.castView(e.toValue(),i,r);if(void 0!==n)return t.addGeometry(n),n}return s.prototype.materializeViewParam.call(this,t,e,i,r)},a.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:s.prototype.materializeModelParam.call(this,t,e,i,r)},a.Form=new a,a}(sp);ma.addGlobal(bp.Form);var wp=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return v(t,n),Object.defineProperty(t.prototype,"tag",{get:function(){return"mapboxMap"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=yp.create(),o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new mp,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){var o=bp.Form.castView(e.toValue(),i,r);return o?(t.addLayer(o),o):n.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:n.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(ip);ma.addGlobal(wp.Form);var _p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e}(ap),xp=function(s){function t(){var t=s.call(this)||this;return t._feature={type:"Feature",geometry:{type:"Point",coordinates:[]},properties:{id:t._featureId}},t}return v(t,s),Object.defineProperty(t.prototype,"center",{get:function(){var t=this._feature.geometry.coordinates;if(2===t.length)return new l.LngLat(t[0],t[1])},enumerable:!0,configurable:!0}),t.prototype.coordinates=function(t){return void 0===t?this._feature.geometry.coordinates:(this._feature.geometry.coordinates=t,this)},t.prototype.properties=function(t){if(void 0===t)return this._feature.properties;if(this._feature.properties&&t)for(var e in t){var i=t[e];i&&(this._feature.properties[e]=i)}else this._feature.properties=t;return this},t.prototype.toGeoJson=function(){return this._feature},t.prototype.didSetState=function(t,e){s.prototype.didSetState.call(this,t,e);var r,o,i=t.get("coordinates");i.isDefined()&&(i.forEach(function(t,e){var i=t.key.stringValue();void 0!==i?"lng"===i?r=t.toValue().numberValue(r):"lat"===i&&(o=t.toValue().numberValue(o)):t instanceof w&&(0===e?r=t.numberValue(r):1===e&&(o=t.numberValue(o)))}),void 0!==r&&void 0!==o&&this.coordinates([r,o]));var n=t.get("properties");n.isDefined()&&this.properties(n.toAny()),this.requireRedraw()},t}(dp),kp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Params=_p.Params.concat([new qs("coordinates",q.get("coordinates")),new qs("properties",q.get("properties"))]),e}(_p),Ap=function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return v(t,o),Object.defineProperty(t.prototype,"tag",{get:function(){return"mapboxPoint"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=new xp,o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new kp,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){return o.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:o.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(gp);ma.addGlobal(Ap.Form),gp.addGlobal(Ap.Form);var Ep=function(o){function t(){var t=o.call(this)||this;return t._feature={type:"Feature",geometry:{type:"Polygon",coordinates:[[]]},properties:{id:t._featureId}},t}return v(t,o),Object.defineProperty(t.prototype,"center",{get:function(){for(var t=this._feature.geometry.coordinates,e=0,i=0,r=0,o=0,n=t.length;o<n;o+=1)for(var s=t[o],a=0,u=s.length;a<u;a+=1){var h=s[a];2===h.length&&(e+=h[0],i+=h[1],r+=1)}if(0<r)return new l.LngLat(e/r,i/r)},enumerable:!0,configurable:!0}),t.prototype.coordinates=function(t){return void 0===t?this._feature.geometry.coordinates:(this._feature.geometry.coordinates=t,this)},t.prototype.properties=function(t){if(void 0===t)return this._feature.properties;if(this._feature.properties&&t)for(var e in t){var i=t[e];i&&(this._feature.properties[e]=i)}else this._feature.properties=t;return this._feature.properties=this._feature.properties,this},t.prototype.toGeoJson=function(){return this._feature},t.prototype.didSetState=function(t,e){o.prototype.didSetState.call(this,t,e);var i=t.get("coordinates");if(i.isDefined()){var n=[];i.forEach(function(t){var r,o;t.forEach(function(t,e){var i=t.key.stringValue();void 0!==i?"lng"===i?r=t.toValue().numberValue(r):"lat"===i&&(o=t.toValue().numberValue(o)):t instanceof w&&(0===e?r=t.numberValue(r):1===e&&(o=t.numberValue(o)))}),void 0!==r&&void 0!==o&&n.push([r,o])}),this.coordinates([n])}var r=t.get("properties");r.isDefined()&&this.properties(r.toAny()),this.requireRedraw()},t}(dp),Cp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Params=_p.Params.concat([new qs("coordinates",q.get("coordinates")),new qs("properties",q.get("properties"))]),e}(_p),Sp=function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return v(t,o),Object.defineProperty(t.prototype,"tag",{get:function(){return"mapboxPolygon"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=new Ep,o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new Cp,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){return o.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:o.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(gp);ma.addGlobal(Sp.Form),gp.addGlobal(Sp.Form);var Vp=Math.PI,Dp=2*Vp,Mp=Vp/2,Pp=1e-12,Rp=function(){function t(t){this.node=t,this._value=NaN,this._total=NaN,this._width=Lo.zero(),this._height=Lo.zero(),this._arc=new $u,this._minAngle=Ao.zero(),this._innerRadius=Lo.zero(),this._outerRadius=Lo.zero(),this._arcColor=qo.black(),this._tickAlign=.5,this._tickRadius=Lo.zero(),this._tickLength=Lo.zero(),this._tickWidth=Lo.px(1),this._tickPadding=Lo.px(3),this._tickColor=qo.black(),this._label=null,this._labelRadius=Lo.zero(),this._labelSize=null,this._labelColor=null,this._legend=null,this._legendSize=null,this._legendColor=null,this._events=null,this.dirty=!0,this.observers=[],this.arcPath=document.createElementNS("http://www.w3.org/2000/svg","path"),this.arcPath.setAttribute("class","arc"),this.node.appendChild(this.arcPath),this.tickPath=document.createElementNS("http://www.w3.org/2000/svg","path"),this.tickPath.setAttribute("class","tick"),this.tickPath.setAttribute("fill","none"),this.node.appendChild(this.tickPath)}return t.prototype.value=function(t){if(void 0===t)return this._value;var e=this._value;if(e!==t){this._value=t,this.dirty=!0;for(var i=0;i<this.observers.length;i+=1){var r=this.observers[i];r.wedgeDidSetValue&&r.wedgeDidSetValue(t,e,this)}}return this},t.prototype.total=function(t){return void 0===t?this._total:(this._total!==t&&(this._total=t,this.dirty=!0),this)},t.prototype.width=function(t){return void 0===t?this._width:(t=Lo.fromAny(t,this.node),this._width.equals(t)||(this._width=t,this.dirty=!0),this)},t.prototype.height=function(t){return void 0===t?this._height:(t=Lo.fromAny(t,this.node),this._height.equals(t)||(this._height=t,this.dirty=!0),this)},t.prototype.arc=function(t){return void 0===t?this._arc:(this._arc!==t&&(this._arc=t,this.dirty=!0),this)},t.prototype.arcColor=function(t){return void 0===t?this._arcColor:(t=qo.fromAny(t),this._arcColor.equals(t)||(this._arcColor=t,this.dirty=!0),this)},t.prototype.innerRadius=function(t){return void 0===t?this._innerRadius:(t=Lo.fromAny(t),this._innerRadius.equals(t)||(this._innerRadius=t,this.dirty=!0),this)},t.prototype.outerRadius=function(t){return void 0===t?this._outerRadius:(t=Lo.fromAny(t),this._outerRadius.equals(t)||(this._outerRadius=t,this.dirty=!0),this)},t.prototype.startAngle=function(t){return void 0===t?this._arc.startAngle():(t=Ao.fromAny(t),this._arc.startAngle().equals(t)||(this._arc.startAngle(t),this.dirty=!0),this)},t.prototype.deltaAngle=function(t){return void 0===t?this._arc.deltaAngle():(t=Ao.fromAny(t),this._arc.deltaAngle().equals(t)||(this._arc.deltaAngle(t),this.dirty=!0),this)},t.prototype.minAngle=function(t){return void 0===t?this._minAngle:(t=Ao.fromAny(t),this._minAngle.equals(t)||(this._minAngle=t,this.dirty=!0),this)},t.prototype.padAngle=function(t){return void 0===t?this._arc.padAngle():(t=Ao.fromAny(t),this._arc.padAngle().equals(t)||(this._arc.padAngle(t),this.dirty=!0),this)},t.prototype.padRadius=function(t){return void 0===t?this._arc.padRadius():(this._arc.padRadius()!==t&&(this._arc.padRadius(t),this.dirty=!0),this)},t.prototype.cornerRadius=function(t){return void 0===t?this._arc.cornerRadius():(this._arc.cornerRadius()!==t&&(this._arc.cornerRadius(t),this.dirty=!0),this)},t.prototype.tickAlign=function(t){return void 0===t?this._tickAlign:(this._tickAlign!==t&&(this._tickAlign=t,this.dirty=!0),this)},t.prototype.tickRadius=function(t){return void 0===t?this._tickRadius:(t=Lo.fromAny(t),this._tickRadius.equals(t)||(this._tickRadius=t,this.dirty=!0),this)},t.prototype.tickLength=function(t){return void 0===t?this._tickLength:(t=Lo.fromAny(t),this._tickLength.equals(t)||(this._tickLength=t,this.dirty=!0),this)},t.prototype.tickWidth=function(t){return void 0===t?this._tickWidth:(t=Lo.fromAny(t),this._tickWidth!==t&&(this._tickWidth=t,this.dirty=!0),this)},t.prototype.tickPadding=function(t){return void 0===t?this._tickPadding:(t=Lo.fromAny(t),this._tickPadding!==t&&(this._tickPadding=t,this.dirty=!0),this)},t.prototype.tickColor=function(t){return void 0===t?this._tickColor:(t=qo.fromAny(t),this._tickColor.equals(t)||(this._tickColor=t,this.dirty=!0),this)},t.prototype.label=function(t){return void 0===t?this._label:(this._label!==t?(this._label&&this.node.removeChild(this._label),this._label=t,this._label&&this.node.appendChild(this._label),this.dirty=!0,this.render()):this.dirty=!0,this)},t.prototype.labelRadius=function(t){return void 0===t?this._labelRadius:(t=Lo.fromAny(t),this._labelRadius.equals(t)||(this._labelRadius=t,this.dirty=!0),this)},t.prototype.labelSize=function(t){return void 0===t?this._labelSize:(null!==t&&(t=Lo.fromAny(t)),(this._labelSize?this._labelSize.equals(t):this._labelSize===t)||(this._labelSize=t,this.dirty=!0),this)},t.prototype.labelColor=function(t){return void 0===t?this._labelColor:(null!==t&&(t=qo.fromAny(t)),(this._labelColor?this._labelColor.equals(t):this._labelColor===t)||(this._labelColor=t,this.dirty=!0),this)},t.prototype.legend=function(t){return void 0===t?this._legend:(this._legend!==t?(this._legend&&this.node.removeChild(this._legend),this._legend=t,this._legend&&this.node.appendChild(this._legend),this.dirty=!0,this.render()):this.dirty=!0,this)},t.prototype.legendSize=function(t){return void 0===t?this._legendSize:(null!==t&&(t=Lo.fromAny(t)),(this._legendSize?this._legendSize.equals(t):this._legendSize===t)||(this._legendSize=t,this.dirty=!0),this)},t.prototype.legendColor=function(t){return void 0===t?this._legendColor:(null!==t&&(t=qo.fromAny(t)),(this._legendColor?this._legendColor.equals(t):this._legendColor===t)||(this._legendColor=t,this.dirty=!0),this)},t.prototype.render=function(){this.dirty&&(this.dirty=!1,this.renderArc(),this.renderTick())},t.prototype.events=function(t){return void 0===t?this._events:(this._events=t,this)},t.prototype.renderArc=function(){var t=this._arc.deltaAngle().radValue(),e=Math.max(Pp,this._minAngle.radValue()),i=this._label;if(e<t){var r=this._width.pxValue(),o=this._height.pxValue(),n=Math.min(r,o),s=this._innerRadius.pxValue(n),a=this._outerRadius.pxValue(n);if(this._arc.innerRadius(s).outerRadius(a),this.arcPath.setAttribute("d",this._arc.draw()),this.arcPath.setAttribute("fill",this._arcColor.toString()),i){var u=this._arc.startAngle().radValue()-Mp+t/2,h=s+this._labelRadius.pxValue(a-s),l=h*Math.cos(u),p=h*Math.sin(u);if(i.removeAttribute("visibility"),i instanceof SVGGElement){var c=$o.translate(l,p);i.setAttribute("transform",c.toAttributeString())}else i instanceof SVGTextElement&&(i.setAttribute("x",""+l),i.setAttribute("y",""+p),i.setAttribute("text-anchor","middle"),i.setAttribute("dominant-baseline","central"),this._labelSize&&i.setAttribute("font-size",""+Math.ceil(this._labelSize.pxValue(n))));this._labelColor&&i.setAttribute("fill",this._labelColor.toString())}}else this.arcPath.removeAttribute("d"),this.arcPath.removeAttribute("fill"),i&&i.setAttribute("visibility","hidden")},t.prototype.renderTick=function(){var t=Math.min(this._arc.deltaAngle().radValue(),Dp),e=Math.max(Pp,this._minAngle.radValue()),i=this._legend;if(e<t&&i){var r=this._width.pxValue(),o=this._height.pxValue(),n=Math.min(r,o),s=this._arc.startAngle().radValue()-Mp+t*this._tickAlign,a=this._arc.outerRadius(),u=this._tickRadius.pxValue(n),h=this._tickLength.pxValue(r),l=new Yu,p=a*Math.cos(s+Pp),c=a*Math.sin(s+Pp),d=u*Math.cos(s+Pp),f=u*Math.sin(s+Pp),y=0;if(l.moveTo(p,c),l.lineTo(d,f),h&&(0<=d?(l.lineTo(h,f),y=h-d):d<0&&(l.lineTo(-h,f),y=h+d)),this.tickPath.setAttribute("d",l.toString()),this.tickPath.setAttribute("stroke",this._tickColor.toString()),this.tickPath.setAttribute("stroke-width",""+this._tickWidth.pxValue(n)),i instanceof SVGGElement){var m=$o.translate(d,f);i.setAttribute("transform",m.toAttributeString()),i.setAttribute("width",""+y)}else if(i instanceof SVGTextElement){var v=void 0,g=void 0;0<=d?(v=y,g="end"):(v=-y,g="start"),i.removeAttribute("visibility"),i.setAttribute("x",""+d),i.setAttribute("y",""+f),i.setAttribute("dx",""+v),i.setAttribute("dy",""+-this._tickPadding.pxValue(n)),i.setAttribute("text-anchor",g),this._legendSize&&i.setAttribute("font-size",""+Math.ceil(this._legendSize.pxValue(n)))}this._legendColor&&i.setAttribute("fill",this._legendColor.toString())}else this.tickPath.removeAttribute("d"),this.tickPath.removeAttribute("stroke"),this.tickPath.removeAttribute("stroke-width"),i&&i.setAttribute("visibility","hidden")},t.prototype.addObserver=function(t){this.observers.indexOf(t)<0&&this.observers.push(t)},t.prototype.removeObserver=function(t){var e=this.observers.indexOf(t);0<=e&&this.observers.splice(e,1)},t.create=function(){return new t(document.createElementNS("http://www.w3.org/2000/svg","g"))},t}(),Tp=function(u){function t(){return null!==u&&u.apply(this,arguments)||this}return v(t,u),Object.defineProperty(t.prototype,"tag",{get:function(){return"wedge"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=Ip.create(),o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new Lp,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(e,t,i,r){if(t.key instanceof O){var o=t.key.value;if("label"===o){var n=r.castView(t.toValue(),i,r)||t.toValue().stringValue();if(void 0!==n)return e.textElement("label",n),b.Absent}else if("legend"===o){var s=r.castView(t.toValue(),i,r)||t.toValue().stringValue();if(void 0!==s)return e.textElement("legend",s),b.Absent}else if("events"===o){var a=t.toValue();e.eventNode=e.view.arcPath,a.forEach(function(t){t instanceof R&&e.appendEventHandlers(t.key.toString(),t.value)})}}return u.prototype.materializeViewParam.call(this,e,t,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:u.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(Da);ma.addGlobal(Tp.Form);var Lp=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return v(r,t),r.prototype.updateValue=function(t){void 0===t&&(t=this.stack());var e=r.ValueSelector.evaluate(t).toValue().numberValue(NaN);if(isFinite(e))for(var i=0;i<this._childModels.length;i+=1)this._childModels[i]._modelScope._record.set("value",e);return e},r.ValueSelector=q.get("value"),r.EventsSelector=q.get("events"),r.Params=Va.Params.concat([new qs("transition",q.get("transition").or(q.get("pie").get("transition")),jn.Form),new qs("value",r.ValueSelector,w),new qs("innerRadius",q.get("innerRadius").or(q.get("pie").get("innerRadius")),Lo.Form),new qs("outerRadius",q.get("outerRadius").or(q.get("pie").get("outerRadius")),Lo.Form),new qs("startAngle",q.get("startAngle"),Ao.Form),new qs("deltaAngle",q.get("deltaAngle"),Ao.Form),new qs("minAngle",q.get("minAngle").or(q.get("pie").get("minAngle")),Ao.Form),new qs("padAngle",q.get("padAngle").or(q.get("pie").get("padAngle")),Ao.Form),new qs("padRadius",q.get("padRadius").or(q.get("pie").get("padRadius")),w),new qs("cornerRadius",q.get("cornerRadius").or(q.get("pie").get("cornerRadius")),Lo.Form),new qs("arcColor",q.get("arcColor").or(q.get("pie").get("arcColor")),qo.Form),new qs("tickAlign",q.get("tickAlign").or(q.get("pie").get("tickAlign")),w),new qs("tickRadius",q.get("tickRadius").or(q.get("pie").get("tickRadius")),Lo.Form),new qs("tickLength",q.get("tickLength").or(q.get("pie").get("tickLength")),Lo.Form),new qs("tickWidth",q.get("tickWidth").or(q.get("pie").get("tickWidth")),Lo.Form),new qs("tickPadding",q.get("tickPadding").or(q.get("pie").get("tickPadding")),Lo.Form),new qs("tickColor",q.get("tickColor").or(q.get("pie").get("tickColor")),qo.Form),new qs("labelRadius",q.get("labelRadius").or(q.get("pie").get("labelRadius")),Lo.Form),new qs("labelSize",q.get("labelSize").or(q.get("pie").get("labelSize")),Lo.Form),new qs("labelColor",q.get("labelColor").or(q.get("pie").get("labelColor")),qo.Form),new qs("labelWeight",q.get("labelWeight").or(q.get("pie").get("labelWeight")),w),new qs("legendSize",q.get("legendSize").or(q.get("pie").get("legendSize")),Lo.Form),new qs("legendColor",q.get("legendColor").or(q.get("pie").get("legendColor")),qo.Form),new qs("legendWeight",q.get("legendWeight").or(q.get("pie").get("legendWeight")),w),new qs("events",q.get("events").or(q.get("pie").get("events")),L)]),r}(Va),Fp=function(i){function t(t){var e=i.call(this)||this;return e.wedge=t,e}return v(t,i),t.prototype.onFrame=function(t){for(var e in this)this[e]instanceof ps&&this[e].onFrame(t);this.update()},t.prototype.update=function(){this.wedge.render()},t}(us),Ip=function(p){function t(t){var e=p.call(this,t.node)||this;return e.view=t,e.animator=new Fp(e.view),e._eventsPopover={},e}return v(t,p),t.prototype.events=function(t){return void 0===t?this.view.events():(this.view.events(t),this)},t.prototype.total=function(t){return void 0===t?this.view.total():(this.view.total(t),this)},t.prototype.padRadius=function(t,e){null!=t&&(t=+t);var i=this.propertyKey(Ba,"padRadius",t,e);return"string"==typeof i&&(i=+i),i},t.prototype.textElement=function(t,e){var i=this.view[t]();if(void 0===e)return i;if("string"==typeof e?e=document.createTextNode(e):(e instanceof Sa||e instanceof lu)&&(e=e.node),e instanceof Text)if(i){for(;i.firstChild;)i.removeChild(i.firstChild);i.appendChild(e),e=i}else{var r=Sa.create("text").className(t);r.append(e),e=r.node}if(i){var o=i.view;i!==e&&o&&this.removeChildView(o)}if(this.view[t](e),e){var n=e.view;i!==e&&n&&this.appendChildView(n)}return this.animator.animate(),this},t.prototype.render=function(){this.animator.update()},t.prototype.didReview=function(t){p.prototype.didReview.call(this,t),this.animator.enabled(t)},t.prototype.didSetState=function(t,e){p.prototype.didSetState.call(this,t,e);for(var i=t.get("transition").cast(jn.Form),r=this.view.label(),o=this.view.legend(),n=0,s=Lp.Params;n<s.length;n++){var a=s[n],u=a.getName(),h=a.getType(),l=null;(l=h===w?t.get(u).numberValue():h===L?t:t.get(u).cast(h))&&(h===w&&("padRadius"===u?this.padRadius(l,i):"labelWeight"===u?r&&r.setAttribute("font-weight",""+l):"legendWeight"===u?o&&o.setAttribute("font-weight",""+l):this.propertyKeyNumber(Ba,u,l,i)),h===Lo.Form&&this.propertyKeyLength(qa,u,l,i),h===Ao.Form&&this.propertyKeyAngle(Ga,u,l,i),h===qo.Form&&this.propertyKeyColor(Na,u,l,i))}},t.create=function(){return new t(Rp.create())},t}(Sa),zp=function(){function i(t){this.node=t,this._wedges=[],this._total=NaN,this._limit=0,this._originAngle=Ao.zero(),this._width=Lo.zero(t),this._height=Lo.zero(t),this._title=null,this._titleSize=null,this._titleColor=null,this.dirty=!0,this.observers=[],this.wedgesGroup=document.createElementNS("http://www.w3.org/2000/svg","g"),this.wedgesGroup.setAttribute("class","wedges"),this.node.appendChild(this.wedgesGroup)}return i.prototype.wedges=function(){return this._wedges.slice(0)},i.prototype.addWedge=function(t){if(this._wedges.indexOf(t)<0){for(var e=0;e<this.observers.length;e+=1){if((r=this.observers[e]).pieWillAddWedge){var i=r.pieWillAddWedge(t,this);if(i)t=i;else if(null===i)return}}this._wedges.push(t),this.wedgesGroup.appendChild(t.node),t.addObserver(this),this.dirty=!0;for(e=0;e<this.observers.length;e+=1){var r;(r=this.observers[e]).pieDidAddWedge&&r.pieDidAddWedge(t,this)}}},i.prototype.removeWedge=function(t){var e=this._wedges.indexOf(t);if(0<=e){for(var i=0;i<this.observers.length;i+=1){(o=this.observers[i]).pieWillRemoveWedge&&o.pieWillRemoveWedge(t,this)}t.removeObserver(this),this.wedgesGroup.removeChild(t.node),this._wedges.splice(e,1),this.dirty=!0;for(var r=0;r<this.observers.length;r+=1){var o;(o=this.observers[r]).pieDidRemoveWedge&&o.pieDidRemoveWedge(t,this)}}},i.prototype.total=function(){return this._total},i.prototype.limit=function(t){return void 0===t?this._limit:(this._limit!==t&&(this._limit=t,this._total=t,this.dirty=!0),this)},i.prototype.originAngle=function(t){return void 0===t?this._originAngle:(t=Ao.fromAny(t),this._originAngle.equals(t)||(this._originAngle=t,this.dirty=!0),this)},i.prototype.width=function(t){return void 0===t?this._width:(t=Lo.fromAny(t,this.node),this._width.equals(t)||(this._width=t,this.dirty=!0),this)},i.prototype.height=function(t){return void 0===t?this._height:(t=Lo.fromAny(t,this.node),this._height.equals(t)||(this._height=t,this.dirty=!0),this)},i.prototype.title=function(t){return void 0===t?this._title:(this._title!==t?(this._title&&this.node.removeChild(this._title),this._title=t,this._title&&this.node.appendChild(this._title),this.dirty=!0,this.render()):this.dirty=!0,this)},i.prototype.titleSize=function(t){return void 0===t?this._titleSize:(null!==t&&(t=Lo.fromAny(t)),(this._titleSize?this._titleSize.equals(t):this._titleSize===t)||(this._titleSize=t,this.dirty=!0),this)},i.prototype.titleColor=function(t){return void 0===t?this._titleColor:(null!==t&&(t=qo.fromAny(t)),(this._titleColor?this._titleColor.equals(t):this._titleColor===t)||(this._titleColor=t,this.dirty=!0),this)},i.prototype.update=function(){this.dirty&&(this.dirty=!1,this.updateTitle(),this.updateWedges())},i.prototype.updateTotal=function(){for(var t=0,e=0;e<this._wedges.length;e+=1){var i=this._wedges[e].value();if(!isFinite(i)){t=NaN;break}t+=i}var r=this._total;if(r!==t){this._total=t;for(e=0;e<this.observers.length;e+=1){var o=this.observers[e];o.pieDidSetTotal&&o.pieDidSetTotal(t,r,this)}if(isFinite(t))for(e=0;e<this._wedges.length;e+=1)this._wedges[e].total(t)}return t},i.prototype.updateTitle=function(){var t=this._title;if(t){var e=this._width.pxValue(),i=this._height.pxValue(),r=e/2,o=i/2;if(t instanceof SVGGElement){var n=$o.translate(r,o);t.setAttribute("transform",n.toAttributeString())}else if(t instanceof SVGTextElement&&(t.removeAttribute("visibility"),t.setAttribute("x",""+r),t.setAttribute("y",""+o),t.setAttribute("text-anchor","middle"),t.setAttribute("alignment-baseline","middle"),this._titleSize)){var s=Math.min(e,i);t.setAttribute("font-size",""+Math.ceil(this._titleSize.pxValue(s)))}this._titleColor&&t.setAttribute("fill",this._titleColor.toString())}},i.prototype.updateWedges=function(){var t=$o.translate(this._width.pxValue()/2,this._height.pxValue()/2);this.wedgesGroup.setAttribute("transform",t.toAttributeString());for(var e=Math.max(this.updateTotal(),this._limit),i=this._originAngle,r=0;r<this._wedges.length;r+=1){var o=this._wedges[r];if(isFinite(e)){var n=2*Math.PI*o.value()/(e||1);o.startAngle(i).deltaAngle(Ao.rad(n)),i=Ao.rad(i.radValue()+n)}this.updateWedge(this._wedges[r])}},i.prototype.updateWedge=function(t){t.width(this._width).height(this._height)},i.prototype.render=function(){this.renderTitle(),this.renderWedges()},i.prototype.renderTitle=function(){},i.prototype.renderWedges=function(){this.updateWedges();for(var t=0;t<this._wedges.length;t+=1)this.renderWedge(this._wedges[t])},i.prototype.renderWedge=function(t){t.render()},i.prototype.wedgeDidSetValue=function(t,e,i){for(var r=0;r<this.observers.length;r+=1){var o=this.observers[r];o.pieWedgeDidSetValue&&o.pieWedgeDidSetValue(t,e,i,this)}},i.prototype.addObserver=function(t){this.observers.indexOf(t)<0&&this.observers.push(t)},i.prototype.removeObserver=function(t){var e=this.observers.indexOf(t);0<=e&&this.observers.splice(e,1)},i.create=function(t){void 0===t&&(t="svg");var e=document.createElementNS("http://www.w3.org/2000/svg",t);return e.setAttribute("class","pie"),e.style.setProperty("flex-grow","1"),e.style.setProperty("flex-basis","0"),e.style.setProperty("-webkit-user-select","none"),e.style.setProperty("-moz-user-select","none"),e.style.setProperty("-ms-user-select","none"),e.style.setProperty("user-select","none"),e.style.setProperty("cursor","default"),new i(e)},i}(),Up=function(r){function t(t,e){var i=r.call(this)||this;return i.pie=t,i.childViews=e,i.originAngle=void 0,i.width=void 0,i.height=void 0,i.titleSize=void 0,i.titleColor=void 0,i}return v(t,r),t.prototype.onFrame=function(t){this.originAngle&&this.originAngle.onFrame(t),this.width&&this.width.onFrame(t),this.height&&this.height.onFrame(t),this.titleSize&&this.titleSize.onFrame(t),this.titleColor&&this.titleColor.onFrame(t),this.update()},t.prototype.renderWedges=function(){for(var t=0;t<this.childViews.length;t+=1){var e=this.childViews[t];e instanceof Ip&&e.render()}},t.prototype.update=function(){this.pie.updateTitle(),this.pie.updateWedges(),this.renderWedges()},t}(us),Op=function(r){function o(t,e,i){return r.call(this,t,e,i,as.REQUIRES_RESIZE)||this}return v(o,r),o.prototype.update=function(t){this.parent.pie.width(t),this.updateTarget(this.parent.pie.node)},o.get=function(t){return t.view.width()},o.set=function(t,e){if(null===e)t.animator.width=void 0,t.view.node.removeAttribute("width");else{t.view.width(e);var i=t.view.node.getAttribute("width"),r=""+e.pxValue();i!==r&&(t.view.node.setAttribute("width",r),t.requireResize())}},o.animator=function(t,e,i){return void 0===e||t.animator.width||(t.animator.width=new o(t.animator,e,i)),t.animator.width},o}(ps),Wp=function(r){function o(t,e,i){return r.call(this,t,e,i,as.REQUIRES_RESIZE)||this}return v(o,r),o.prototype.update=function(t){this.parent.pie.height(t),this.updateTarget(this.parent.pie.node)},o.get=function(t){return t.view.height()},o.set=function(t,e){if(null===e)t.animator.height=void 0,t.view.node.removeAttribute("height");else{t.view.height(e);var i=t.view.node.getAttribute("height"),r=""+e.pxValue();i!==r&&(t.view.node.setAttribute("height",r),t.requireResize())}},o.animator=function(t,e,i){return void 0===e||t.animator.height||(t.animator.height=new o(t.animator,e,i)),t.animator.height},o}(ps),Bp=function(p){function e(t){var e=p.call(this,t.node)||this;return e.view=t,e.animator=new Up(e.view,e._childViews),e.view.addObserver(e),e}return v(e,p),e.prototype.wedges=function(){for(var t=[],e=0;e<this._childViews.length;e+=1){var i=this._childViews[e];i instanceof Ip&&t.push(i)}return t},e.prototype.addWedge=function(t){this.appendChildView(t)},e.prototype.removeWedge=function(t){this.removeChildView(t)},e.prototype.didInsertChildView=function(t){t instanceof Ip&&this.view.addWedge(t.view),p.prototype.didInsertChildView.call(this,t)},e.prototype.didRemoveChildView=function(t){t instanceof Ip&&this.view.removeWedge(t.view),p.prototype.didRemoveChildView.call(this,t)},e.prototype.total=function(){return this.view.total()},e.prototype.limit=function(t){return void 0===t?this.view.limit():(this.view.limit(t),this)},e.prototype.width=function(t,e){return this.propertyLength(Op,t,e)},e.prototype.height=function(t,e){return this.propertyLength(Wp,t,e)},e.prototype.changeAllChildNumber=function(t,e,i){for(var r=0;r<this._childViews.length;r+=1){var o=this._childViews[r];o instanceof Ip&&o.propertyKeyNumber(Ba,t,e,i)}return this},e.prototype.changeAllChildLength=function(t,e,i){for(var r=0;r<this._childViews.length;r+=1){var o=this._childViews[r];o instanceof Ip&&o.propertyKeyLength(qa,t,e,i)}return this},e.prototype.changeAllChildAngle=function(t,e,i){for(var r=0;r<this._childViews.length;r+=1){var o=this._childViews[r];o instanceof Ip&&o.propertyKeyAngle(Ga,t,e,i)}return this},e.prototype.changeAllChildColor=function(t,e,i){e=qo.fromAny(e);for(var r=0;r<this._childViews.length;r+=1){var o=this._childViews[r];o instanceof Ip&&o.propertyKeyColor(Na,t,e,i)}return this},e.prototype.innerRadius=function(t,e){return this.changeAllChildLength("innerRadius",t,e)},e.prototype.outerRadius=function(t,e){return this.changeAllChildLength("outerRadius",t,e)},e.prototype.padAngle=function(t,e){return this.changeAllChildAngle("outerRadius",t,e)},e.prototype.padRadius=function(t,e){return this.changeAllChildNumber("padRadius",t,e)},e.prototype.cornerRadius=function(t,e){return this.changeAllChildNumber("cornerRadius",t,e)},e.prototype.arcColor=function(t,e){return this.changeAllChildColor("arcColor",t,e)},e.prototype.tickRadius=function(t,e){return this.changeAllChildLength("tickRadius",t,e)},e.prototype.tickLength=function(t,e){return this.changeAllChildLength("tickLength",t,e)},e.prototype.tickWidth=function(t,e){return this.changeAllChildLength("tickWidth",t,e)},e.prototype.tickPadding=function(t,e){return this.changeAllChildLength("tickPadding",t,e)},e.prototype.tickColor=function(t,e){return this.changeAllChildColor("tickColor",t,e)},e.prototype.labelRadius=function(t,e){return this.changeAllChildLength("labelRadius",t,e)},e.prototype.labelSize=function(t,e){return this.changeAllChildLength("labelSize",t,e)},e.prototype.labelColor=function(t,e){return this.changeAllChildColor("labelColor",t,e)},e.prototype.legendSize=function(t,e){return this.changeAllChildLength("legendSize",t,e)},e.prototype.legendColor=function(t,e){return this.changeAllChildColor("legendColor",t,e)},e.prototype.title=function(t){var e=this.view.title();if(void 0===t)return e;if("string"==typeof t?t=document.createTextNode(t):(t instanceof Sa||t instanceof lu)&&(t=t.node),t instanceof Text)if(e){for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(t),t=e}else{var i=Sa.create("text").className("title");i.append(t),t=i.node}if(e){var r=e.view;e!==t&&r&&this.removeChildView(r)}if(this.view.title(t),t){var o=t.view;e!==t&&o&&this.appendChildView(o)}return this.animator.animate(),this},e.prototype.render=function(){this.animator.update()},e.prototype.autosize=function(){for(var t=this.node;;){var e=t.parentNode;if(!e)return;if(e instanceof HTMLElement)return void this.width(e.offsetWidth).height(e.offsetHeight);t=e}},e.prototype.didResize=function(){p.prototype.didResize.call(this),this.autosize(),this.render()},e.prototype.didReview=function(t){p.prototype.didReview.call(this,t),this.animator.enabled(t)},e.prototype.didSetState=function(t,e){p.prototype.didSetState.call(this,t,e);var i=t.get("transition").cast(jn.Form),r=t.get("limit").numberValue();void 0!==r&&this.limit(r);var o=t.get("originAngle").cast(Ao.Form);o&&this.propertyKeyAngle(Ga,"originAngle",o,i);var n=t.get("pieWidth").cast(Lo.Form);n&&this.width(n);var s=t.get("pieHeight").cast(Lo.Form);s&&this.height(s);var a=t.get("titleSize").cast(Lo.Form);a&&this.propertyKeyLength(qa,"titleSize",a,i);var u=t.get("titleColor").cast(qo.Form);u&&this.propertyKeyColor(Na,"titleColor",u,i);var h=this.title();if(h){var l=t.get("titleWeight").numberValue();l&&h.setAttribute("font-weight",""+l)}},e.prototype.pieWedgeDidSetValue=function(t,e,i,r){this.view.updateTotal(),this.animator.animate()},e.prototype.addObserver=function(t){this.view.addObserver(t)},e.prototype.removeObserver=function(t){this.view.removeObserver(t)},e.create=function(t){if(t instanceof e)return t;if(t instanceof _a)throw new TypeError(""+t);if(void 0===t||"string"==typeof t)return new e(zp.create(t));if(t.view instanceof e)return t.view;if(t.view)throw new TypeError(""+t.view);if(t instanceof SVGElement)return new e(new zp(t));throw new TypeError(""+t)},e.applyTheme=function(t){var e=q.get("value").divide(q.get("total").or(W.One)),i=q.get("primaryHue").invoke(e).or(q.get("primaryColor")),r=q.get("contrast").invoke(F.of(i,W.valueOf(2))),o=F.empty().slot("innerRadius","3%").slot("outerRadius","25%").slot("arcColor",i).slot("tickRadius","30%").slot("tickLength","50%").slot("tickColor",i).slot("labelRadius","50%").slot("padAngle","2deg").slot("minAngle","2deg").slot("labelSize","13px").slot("labelColor",r).slot("labelWeight",500).slot("legendSize","13px").slot("legendColor",i).slot("legendWeight",300).slot("titleSize","15px").slot("titleColor",q.get("textColor")).slot("titleWeight",300);t.set("pie",o)},e}(Sa);Bp.applyTheme(Bp.Theme);var qp=function(s){function t(){return null!==s&&s.apply(this,arguments)||this}return v(t,s),Object.defineProperty(t.prototype,"tag",{get:function(){return"pie"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=Bp.create(),o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new Gp,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){if(e.key instanceof O&&"title"===e.key.value){var o=r.castView(e.toValue(),i,r)||e.toValue().stringValue();if(void 0!==o)return t.title(o),b.Absent}var n=Tp.Form.castView(e.toValue(),i,r);return n?(t.addWedge(n),n):s.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:s.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(Da);ma.addGlobal(qp.Form);var Gp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.willRestate=function(){t.prototype.willRestate.call(this),this.updateTotal()},e.prototype.updateTotal=function(){for(var t=0,e=0;e<this._childModels.length;e+=1){var i=this._childModels[e];if(i instanceof Lp){var r=i.updateValue();if(!isFinite(r)){t=NaN;break}t+=r}}return isFinite(t)?this._modelScope._record.set("total",t):this._modelScope._record.delete("total"),t},e.Params=Va.Params.concat([new qs("transition",q.get("transition").or(q.get("pie").get("transition"))),new qs("value",q.get("value")),new qs("total",q.get("total")),new qs("limit",q.get("limit")),new qs("originAngle",q.get("originAngle").or(q.get("pie").get("originAngle"))),new qs("pieWidth",q.get("pieWidth").or(q.get("pie").get("width"))),new qs("pieHeight",q.get("pieHeight").or(q.get("pie").get("height"))),new qs("titleSize",q.get("titleSize").or(q.get("pie").get("titleSize"))),new qs("titleColor",q.get("titleColor").or(q.get("pie").get("titleColor"))),new qs("titleWeight",q.get("titleWeight").or(q.get("pie").get("titleWeight")))]),e}(Va),Np=function(s){function t(t){var e=s.call(this,t)||this;return e.display("flex").position("relative").flexDirection("column").flexGrow(1).flexBasis(0).width("100%").height("100%"),e._contentView=e.append("div").display("flex").position("relative").flexGrow(1).flexBasis(0),e._bodyView=null,e}return v(t,s),t.prototype.contentView=function(){return this._contentView},t.prototype.bodyView=function(t){return void 0===t?this._bodyView:(this._bodyView!==t&&(this._bodyView&&this._bodyView.remove(),this._bodyView=t,this._bodyView&&this._contentView.append(this._bodyView)),this)},t.prototype.didSetState=function(t,e){s.prototype.didSetState.call(this,t,e);var i=t.get("marginTop").cast(Lo.Form);i&&this._contentView.marginTop(i);var r=t.get("marginRight").cast(Lo.Form);r&&this._contentView.marginRight(r);var o=t.get("marginBottom").cast(Lo.Form);o&&this._contentView.marginBottom(o);var n=t.get("marginLeft").cast(Lo.Form);n&&this._contentView.marginLeft(n)},t.create=function(){return new t(document.createElement("div")).className("placard")},t.applyTheme=function(t){var e=F.empty().slot("marginTop","8px").slot("marginRight","8px").slot("marginBottom","8px").slot("marginLeft","8px").slot("titleSize","12px").slot("titleColor",q.get("textColor")).slot("subtitleSize","10px").slot("subtitleColor",q.get("textColor"));t.set("placard",e)},t}(Fa);Np.applyTheme(Np.Theme);var Hp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Params=Ia.Params.concat([new qs("transition",q.get("transition").or(q.get("placard").get("transition"))),new qs("marginTop",q.get("marginTop").or(q.get("placard").get("marginTop"))),new qs("marginRight",q.get("marginRight").or(q.get("placard").get("marginRight"))),new qs("marginBottom",q.get("marginBottom").or(q.get("placard").get("marginBottom"))),new qs("marginLeft",q.get("marginLeft").or(q.get("placard").get("marginLeft")))]),e}(Ia),jp=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return v(t,n),Object.defineProperty(t.prototype,"tag",{get:function(){return"placard"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=Np.create(),o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new Hp,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){if(e.key instanceof O&&"body"===e.key.value){var o=r.castView(e.toValue(),i,r);if(o)return t.bodyView(o),t.bodyView()}return n.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:n.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(za);ma.addGlobal(jp.Form);var Kp=function(o){function t(t){var e=o.call(this,t)||this;return e._proportion="any",e._placement="any",e._pieceMargin=0,e._pieceWidth=0,e._pieceHeight=0,e._reflowTransition=void 0,e}return v(t,o),t.prototype.proportion=function(t){return void 0===t?this._proportion:(this._proportion!==t&&(this._proportion=t,this._parentView&&this._parentView.requireResize()),this)},t.prototype.placement=function(t){return void 0===t?this._placement:(this._placement!==t&&(this._placement=t,this._parentView&&this._parentView.requireResize()),this)},t.prototype.pieceMargin=function(t,e){return void 0===t?this._pieceMargin:(this._pieceMargin=t,this)},t.prototype.pieceWidth=function(t,e){return void 0===t?this._pieceWidth:(this._pieceWidth=t,this)},t.prototype.pieceHeight=function(t,e){return void 0===t?this._pieceHeight:(this._pieceHeight=t,this)},t.prototype.reflowTransition=function(t){return void 0===t?this._reflowTransition||null:(this._reflowTransition=t||void 0,this)},t.prototype.didSetState=function(t,e){o.prototype.didSetState.call(this,t,e);var i=t.get("proportion").stringValue();void 0!==i&&this.proportion(i);var r=t.get("placement").stringValue();void 0!==r&&this.placement(r)},t}(Fa),Yp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Params=Ia.Params.concat([new qs("proportion",q.get("proportion")),new qs("placement",q.get("placement"))]),e}(Ia),Xp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.addGlobal=function(t){e.Global=e.Global.withUiForm(t)},e.removeGlobal=function(t){e.Global=e.Global.withoutUiForm(t)},e.Global=new va([]),e}(za),Qp=function(d){function t(t){var e=d.call(this,t)||this;return e.display("flex").flexDirection("column").flexGrow(1).borderRadius(8).backgroundColor(qo.white()),e._headerView=e.append("div").className("header").display("flex").justifyContent("space-between").alignItems("baseline").flexShrink(0),e._titleView=null,e._subtitleView=null,e._contentView=e.append("div").className("body").display("flex").position("relative").flexGrow(1),e._bodyView=null,e.onClick=e.onClick.bind(e),e.node.addEventListener("click",e.onClick),e}return v(t,d),t.prototype.headerView=function(){return this._headerView},t.prototype.titleView=function(t){var e=this._titleView;if(void 0===t)return e;if("string"==typeof t?t=document.createTextNode(t):(t instanceof Fa||t instanceof lu)&&(t=t.node),t instanceof Text)if(e)e.removeAll(),e.append(t),t=e;else{var i=Fa.create("text").className("title");i.append(t),t=i.node}return t instanceof HTMLElement&&(t=Fa.create(t)),e!==t&&e&&this._headerView.remove(e),e!==(this._titleView=t)&&t&&this._headerView.insertBefore(t,this._subtitleView),this},t.prototype.subtitleView=function(t){var e=this._subtitleView;if(void 0===t)return e;if("string"==typeof t?t=document.createTextNode(t):(t instanceof Fa||t instanceof lu)&&(t=t.node),t instanceof Text)if(e)e.removeAll(),e.append(t),t=e;else{var i=Fa.create("text").className("subtitle");i.append(t),t=i.node}return t instanceof HTMLElement&&(t=Fa.create(t)),e!==t&&e&&this._headerView.remove(e),e!==(this._subtitleView=t)&&t&&this._headerView.append(t),this},t.prototype.contentView=function(){return this._contentView},t.prototype.bodyView=function(t){return void 0===t?this._bodyView:(this._bodyView!==t&&(this._bodyView&&this._bodyView.remove(),this._bodyView=t,this._bodyView&&this._contentView.append(this._bodyView)),this)},t.prototype.didSetState=function(t,e){d.prototype.didSetState.call(this,t,e);var i=t.get("marginTop").cast(Lo.Form);i&&(this.headerView().marginTop(i),this.contentView().marginTop(i));var r=t.get("marginRight").cast(Lo.Form);r&&(this.headerView().marginRight(r),this.contentView().marginRight(r));var o=t.get("marginBottom").cast(Lo.Form);o&&this.contentView().marginBottom(o);var n=t.get("marginLeft").cast(Lo.Form);n&&(this.headerView().marginLeft(n),this.contentView().marginLeft(n));var s=t.get("backgroundColor").cast(qo.Form);s&&this.backgroundColor(s);var a=this.titleView();if(a){var u=t.get("titleSize").cast(Lo.Form);u&&a.fontSize(u);var h=t.get("titleColor").cast(qo.Form);h&&a.color(h)}var l=this.subtitleView();if(l){var p=t.get("subtitleSize").cast(Lo.Form);p&&l.fontSize(p);var c=t.get("subtitleColor").cast(qo.Form);c&&l.color(c)}},t.prototype.onClick=function(t){},t.create=function(){return new t(document.createElement("div")).className("piece card")},t}(Kp),Zp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Params=Yp.Params.concat([new qs("marginTop",q.get("marginTop").or(q.get("quilt").get("card").get("marginTop"))),new qs("marginRight",q.get("marginRight").or(q.get("quilt").get("card").get("marginRight"))),new qs("marginBottom",q.get("marginBottom").or(q.get("quilt").get("card").get("marginBottom"))),new qs("marginLeft",q.get("marginLeft").or(q.get("quilt").get("card").get("marginLeft"))),new qs("backgroundColor",q.get("backgroundColor").or(q.get("quilt").get("card").get("backgroundColor"))),new qs("titleSize",q.get("titleSize").or(q.get("quilt").get("card").get("titleSize"))),new qs("titleColor",q.get("titleColor").or(q.get("quilt").get("card").get("titleColor"))),new qs("subtitleSize",q.get("subtitleSize").or(q.get("quilt").get("card").get("subtitleSize"))),new qs("subtitleColor",q.get("subtitleColor").or(q.get("quilt").get("card").get("subtitleColor")))]),e}(Yp),Jp=function(u){function t(){return null!==u&&u.apply(this,arguments)||this}return v(t,u),Object.defineProperty(t.prototype,"tag",{get:function(){return"card"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=Qp.create(),o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new Zp,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){if(e.key instanceof O){var o=e.key.value;if("title"===o){var n=r.castView(e.toValue(),i,r);if(void 0===n&&(n=e.toValue().stringValue()),void 0!==n)return t.titleView(n),t.titleView()}else if("subtitle"===o){var s=r.castView(e.toValue(),i,r);if(void 0===s&&(s=e.toValue().stringValue()),void 0!==s)return t.subtitleView(s),t.subtitleView()}else if("body"===o){var a=r.castView(e.toValue(),i,r);if(a)return t.bodyView(a),t.bodyView()}}return u.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:u.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(Xp);ma.addGlobal(Jp.Form),Xp.addGlobal(Jp.Form);var $p=function(i){function t(t){var e=i.call(this,t)||this;return e._blockMargin=0,e._blockWidth=0,e._blockHeight=0,e._reflowTransition=void 0,e}return v(t,i),t.prototype.blockMargin=function(t,e){return void 0===t?this._blockMargin:(this._blockMargin=t,this)},t.prototype.blockWidth=function(t,e){return void 0===t?this._blockWidth:(this._blockWidth=t,this)},t.prototype.blockHeight=function(t,e){return void 0===t?this._blockHeight:(this._blockHeight=t,this)},t.prototype.reflowTransition=function(t){return void 0===t?this._reflowTransition||null:(this._reflowTransition=t||void 0,this)},t.prototype.pieces=function(){for(var t=[],e=0;e<this._childViews.length;e+=1){var i=this._childViews[e];i instanceof Kp&&t.push(i)}return t},t.prototype.addPiece=function(t){this.append(t)},t.prototype.removePiece=function(t){this.remove(t)},t.prototype.willResize=function(){i.prototype.willResize.call(this),this.reflow()},t.prototype.reflow=function(){for(var t,e,i,r,o,n,s,a,u,h=this.pieces(),l=0;l<h.length;){var p=(c=h[l]).placement();t||r||o||"top"!==p?e||n||s||"middle"!==p?i||a||u||"bottom"!==p?r||t||(n||s)&&(a||!u)||"top-left"!==p?o||t||(n||s)&&(a||!u)||"top-right"!==p?n||e||(r||o)&&(a||u)||"middle-left"!==p?s||e||(r||o)&&(a||u)||"middle-right"!==p?a||i||(n||s)&&(r||o)||"bottom-left"!==p?u||i||(n||s)&&(r||o)||"bottom-right"!==p?l+=1:(u=c,h.splice(l,1)):(a=c,h.splice(l,1)):(s=c,h.splice(l,1)):(n=c,h.splice(l,1)):(o=c,h.splice(l,1)):(r=c,h.splice(l,1)):(i=c,h.splice(l,1)):(e=c,h.splice(l,1)):(t=c,h.splice(l,1))}for(l=0;l<h.length;){"square"===(c=h[l]).proportion()?!r&&o?(r=c,h.splice(l,1)):!o&&r?(o=c,h.splice(l,1)):!n&&s?(n=c,h.splice(l,1)):!s&&n?(s=c,h.splice(l,1)):!a&&u?(a=c,h.splice(l,1)):!u&&a?(u=c,h.splice(l,1)):r||t?a||i?n||e?l+=1:(n=c,h.splice(l,1)):(a=c,h.splice(l,1)):(r=c,h.splice(l,1)):l+=1}for(;h.length;){var c=h.shift();t||r||o?i||a||u?e||n||s||(e=c):i=c:t=c}var d=this._reflowTransition;(r||o)&&(n||s)?this.layout221(r,o,n,s,i,d):(r||o)&&(a||u)?this.layout212(r,o,e,a,u,d):(n||s)&&(a||u)?this.layout122(t,n,s,a,u,d):(r||o)&&e&&i?this.layout211(r,o,e,i,d):t&&(n||s)&&i?this.layout121(t,n,s,i,d):t&&e&&(a||u)?this.layout112(t,e,a,u,d):r||o?this.layout21(r,o,i||e,d):a||u?this.layout12(t||e,a,u,d):n||s?this.layout121(t,n,s,i,d):t&&e&&i?this.layout111(t,e,i,d):t&&(e||i)||i?this.layout11(t,e||i,d):e&&i?this.layout11(e,i,d):(t||e||i)&&this.layout1(t||e||i,d)},t.prototype.layout1=function(t,e){t&&t.position("absolute").left(0).top(0).width(this._blockWidth,e).height(this._blockHeight,e).pieceMargin(this._blockMargin,e).pieceWidth(this._blockWidth,e).pieceHeight(this._blockHeight,e).reflowTransition(e||null)},t.prototype.layout11=function(t,e,i){var r=Math.round((this._blockHeight-this._blockMargin)/2);t&&t.position("absolute").left(0,i).top(0,i).width(this._blockWidth,i).height(r,i).pieceMargin(this._blockMargin,i).pieceWidth(this._blockWidth,i).pieceHeight(r,i).reflowTransition(i||null),e&&e.position("absolute").left(0,i).top(this._blockHeight-r,i).width(this._blockWidth,i).height(r,i).pieceMargin(this._blockMargin,i).pieceWidth(this._blockWidth,i).pieceHeight(r,i).reflowTransition(i||null)},t.prototype.layout111=function(t,e,i,r){var o=Math.round((this._blockHeight-2*this._blockMargin)/3);t&&t.position("absolute").left(0,r).top(0,r).width(this._blockWidth,r).height(o,r).pieceMargin(this._blockMargin,r).pieceWidth(this._blockWidth,r).pieceHeight(o,r).reflowTransition(r||null),e&&e.position("absolute").left(0,r).top(o+this._blockMargin,r).width(this._blockWidth,r).height(o,r).pieceMargin(this._blockMargin,r).pieceWidth(this._blockWidth,r).pieceHeight(o,r).reflowTransition(r||null),i&&i.position("absolute").left(0,r).top(this._blockHeight-o,r).width(this._blockWidth,r).height(o,r).pieceMargin(this._blockMargin,r).pieceWidth(this._blockWidth,r).pieceHeight(o,r).reflowTransition(r||null)},t.prototype.layout12=function(t,e,i,r){var o=Math.round((this._blockWidth-this._blockMargin)/2);t&&t.position("absolute").left(0,r).top(0,r).width(this._blockWidth,r).height(this._blockHeight-o-this._blockMargin,r).pieceMargin(this._blockMargin,r).pieceWidth(this._blockWidth,r).pieceHeight(this._blockHeight-o-this._blockMargin,r).reflowTransition(r||null),e&&e.position("absolute").left(0,r).top(this._blockHeight-o,r).width(o,r).height(o,r).pieceMargin(this._blockMargin,r).pieceWidth(o,r).pieceHeight(o,r).reflowTransition(r||null),i&&i.position("absolute").left(this._blockWidth-o,r).top(this._blockHeight-o,r).width(o,r).height(o,r).pieceMargin(this._blockMargin,r).pieceWidth(o,r).pieceHeight(o,r).reflowTransition(r||null)},t.prototype.layout21=function(t,e,i,r){var o=Math.round((this._blockWidth-this._blockMargin)/2);t&&t.position("absolute").left(0,r).top(0,r).width(o,r).height(o,r).pieceMargin(this._blockMargin,r).pieceWidth(o,r).pieceHeight(o,r).reflowTransition(r||null),e&&e.position("absolute").left(this._blockWidth-o,r).top(0,r).width(o,r).height(o,r).pieceMargin(this._blockMargin,r).pieceWidth(o,r).pieceHeight(o,r).reflowTransition(r||null),i&&i.position("absolute").left(0,r).top(o+this._blockMargin,r).width(this._blockWidth,r).height(this._blockHeight-(o+this._blockMargin),r).pieceMargin(this._blockMargin,r).pieceWidth(this._blockWidth,r).pieceHeight(this._blockHeight-(o+this._blockMargin),r).reflowTransition(r||null)},t.prototype.layout112=function(t,e,i,r,o){var n=Math.round((this._blockWidth-this._blockMargin)/2),s=Math.round((this._blockHeight-n-2*this._blockMargin)/2);t&&t.position("absolute").left(0,o).top(0,o).width(this._blockWidth,o).height(s,o).pieceMargin(this._blockMargin,o).pieceWidth(this._blockWidth,o).pieceHeight(s,o).reflowTransition(o||null),e&&e.position("absolute").left(0,o).top(s+this._blockMargin,o).width(this._blockWidth,o).height(s,o).pieceMargin(this._blockMargin,o).pieceWidth(this._blockWidth,o).pieceHeight(s,o).reflowTransition(o||null),i&&i.position("absolute").left(0,o).top(this._blockHeight-n,o).width(n,o).height(n,o).pieceMargin(this._blockMargin,o).pieceWidth(n,o).pieceHeight(n,o).reflowTransition(o||null),r&&r.position("absolute").left(this._blockWidth-n,o).top(this._blockHeight-n,o).width(n,o).height(n,o).pieceMargin(this._blockMargin,o).pieceWidth(n,o).pieceHeight(n,o).reflowTransition(o||null)},t.prototype.layout121=function(t,e,i,r,o){var n=Math.round((this._blockWidth-this._blockMargin)/2),s=Math.round((this._blockHeight-n-2*this._blockMargin)/2);t&&t.position("absolute").left(0,o).top(0,o).width(this._blockWidth,o).height(s,o).pieceMargin(this._blockMargin,o).pieceWidth(this._blockWidth,o).pieceHeight(s,o).reflowTransition(o||null),e&&e.position("absolute").left(0,o).top(s+this._blockMargin,o).width(n,o).height(n,o).pieceMargin(this._blockMargin,o).pieceWidth(n,o).pieceHeight(n,o).reflowTransition(o||null),i&&i.position("absolute").left(this._blockWidth-n,o).top(s+this._blockMargin,o).width(n,o).height(n,o).pieceMargin(this._blockMargin,o).pieceWidth(n,o).pieceHeight(n,o).reflowTransition(o||null),r&&r.position("absolute").left(0,o).top(this._blockHeight-s,o).width(this._blockWidth,o).height(s,o).pieceMargin(this._blockMargin,o).pieceWidth(this._blockWidth,o).pieceHeight(s,o).reflowTransition(o||null)},t.prototype.layout211=function(t,e,i,r,o){var n=Math.round((this._blockWidth-this._blockMargin)/2),s=Math.round((this._blockHeight-n-2*this._blockMargin)/2);t&&t.position("absolute").left(0,o).top(0,o).width(n,o).height(n,o).pieceMargin(this._blockMargin,o).pieceWidth(n,o).pieceHeight(n,o).reflowTransition(o||null),e&&e.position("absolute").left(this._blockWidth-n,o).top(0,o).width(n,o).height(n,o).pieceMargin(this._blockMargin,o).pieceWidth(n,o).pieceHeight(n,o).reflowTransition(o||null),i&&i.position("absolute").left(0,o).top(n+this._blockMargin,o).width(this._blockWidth,o).height(s,o).pieceMargin(this._blockMargin,o).pieceWidth(this._blockWidth,o).pieceHeight(s,o).reflowTransition(o||null),r&&r.position("absolute").left(0,o).top(this._blockHeight-s,o).width(this._blockWidth,o).height(s,o).pieceMargin(this._blockMargin,o).pieceWidth(this._blockWidth,o).pieceHeight(s,o).reflowTransition(o||null)},t.prototype.layout122=function(t,e,i,r,o,n){var s=Math.round((this._blockWidth-this._blockMargin)/2),a=Math.round(this._blockHeight-2*s-2*this._blockMargin);t&&t.position("absolute").left(0,n).top(0,n).width(this._blockWidth,n).height(a,n).pieceMargin(this._blockMargin,n).pieceWidth(this._blockWidth,n).pieceHeight(a,n).reflowTransition(n||null),e&&e.position("absolute").left(0,n).top(a+this._blockMargin,n).width(s,n).height(s,n).pieceMargin(this._blockMargin,n).pieceWidth(s,n).pieceHeight(s,n).reflowTransition(n||null),i&&i.position("absolute").left(this._blockWidth-s,n).top(a+this._blockMargin,n).width(s,n).height(s,n).pieceMargin(this._blockMargin,n).pieceWidth(s,n).pieceHeight(s,n).reflowTransition(n||null),r&&r.position("absolute").left(0,n).top(this._blockHeight-s,n).width(s,n).height(s,n).pieceMargin(this._blockMargin,n).pieceWidth(s,n).pieceHeight(s,n).reflowTransition(n||null),o&&o.position("absolute").left(this._blockWidth-s,n).top(this._blockHeight-s,n).width(s,n).height(s,n).pieceMargin(this._blockMargin,n).pieceWidth(s,n).pieceHeight(s,n).reflowTransition(n||null)},t.prototype.layout212=function(t,e,i,r,o,n){var s=Math.round((this._blockWidth-this._blockMargin)/2),a=Math.round(this._blockHeight-2*s-2*this._blockMargin);t&&t.position("absolute").left(0,n).top(0,n).width(s,n).height(s,n).pieceMargin(this._blockMargin,n).pieceWidth(s,n).pieceHeight(s,n).reflowTransition(n||null),e&&e.position("absolute").left(this._blockWidth-s,n).top(0,n).width(s,n).height(s,n).pieceMargin(this._blockMargin,n).pieceWidth(s,n).pieceHeight(s,n).reflowTransition(n||null),i&&i.position("absolute").left(0,n).top(s+this._blockMargin,n).width(this._blockWidth,n).height(a,n).pieceMargin(this._blockMargin,n).pieceWidth(this._blockWidth,n).pieceHeight(a,n).reflowTransition(n||null),r&&r.position("absolute").left(0,n).top(this._blockHeight-s,n).width(s,n).height(s,n).pieceMargin(this._blockMargin,n).pieceWidth(s,n).pieceHeight(s,n).reflowTransition(n||null),o&&o.position("absolute").left(this._blockWidth-s,n).top(this._blockHeight-s,n).width(s,n).height(s,n).pieceMargin(this._blockMargin,n).pieceWidth(s,n).pieceHeight(s,n).reflowTransition(n||null)},t.prototype.layout221=function(t,e,i,r,o,n){var s=Math.round((this._blockWidth-this._blockMargin)/2),a=Math.round(this._blockHeight-2*s-2*this._blockMargin);t&&t.position("absolute").left(0,n).top(0,n).width(s,n).height(s,n).pieceMargin(this._blockMargin,n).pieceWidth(s,n).pieceHeight(s,n).reflowTransition(n||null),e&&e.position("absolute").left(this._blockWidth-s,n).top(0,n).width(s,n).height(s,n).pieceMargin(this._blockMargin,n).pieceWidth(s,n).pieceHeight(s,n).reflowTransition(n||null),i&&i.position("absolute").left(0,n).top(s+this._blockMargin,n).width(s,n).height(s,n).pieceMargin(this._blockMargin,n).pieceWidth(s,n).pieceHeight(s,n).reflowTransition(n||null),r&&r.position("absolute").left(this._blockWidth-s,n).top(s+this._blockMargin,n).width(s,n).height(s,n).pieceMargin(this._blockMargin,n).pieceWidth(s,n).pieceHeight(s,n).reflowTransition(n||null),o&&o.position("absolute").left(0,n).top(this._blockHeight-a,n).width(this._blockWidth,n).height(a,n).pieceMargin(this._blockMargin,n).pieceWidth(this._blockWidth,n).pieceHeight(a,n).reflowTransition(n||null)},t.create=function(){return new t(document.createElement("div")).className("block")},t}(Fa),tc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e}(Ia),ec=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return v(t,n),Object.defineProperty(t.prototype,"tag",{get:function(){return"block"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=$p.create(),o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new tc,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){var o=Xp.Global.castView(e.toValue(),i,r);return o?(t.addPiece(o),o):n.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:n.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(za);ma.addGlobal(ec.Form);var ic=function(a){function t(t){var e=a.call(this,t)||this;return e._blockMarginScale=gn.linear(320,540,8,16),e._blockAspectRatio=Math.sqrt(2),e._minBlockWidth=480,e._maxColCount=4,e._reflowTransition=new jn(250,br.quadOut),e._transitionEnd=0,e._blockMargin=NaN,e._blockWidth=NaN,e._blockHeight=NaN,e._colCount=NaN,e.flexGrow(1),e}return v(t,a),t.prototype.blockMarginScale=function(t){return void 0===t?this._blockMarginScale:(this._blockMarginScale!==t&&(this._blockMarginScale=t,this.requireResize()),this)},t.prototype.blockAspectRatio=function(t){return void 0===t?this._blockAspectRatio:(this._blockAspectRatio!==t&&(this._blockAspectRatio=t,this.requireResize()),this)},t.prototype.minBlockWidth=function(t){return void 0===t?this._minBlockWidth:(this._minBlockWidth!==t&&(this._minBlockWidth=t,this.requireResize()),this)},t.prototype.maxColCount=function(t){return void 0===t?this._maxColCount:(this._maxColCount!==t&&(this._maxColCount=t,this.requireResize()),this)},t.prototype.reflowTransition=function(t){return void 0===t?this._reflowTransition||null:(this._reflowTransition=t||void 0,this)},t.prototype.blocks=function(){for(var t=[],e=0;e<this._childViews.length;e+=1){var i=this._childViews[e];i instanceof $p&&t.push(i)}return t},t.prototype.addBlock=function(t){this.append(t)},t.prototype.removeBlock=function(t){this.remove(t)},t.prototype.willResize=function(){a.prototype.willResize.call(this),this.reflow()},t.prototype.reflow=function(){for(var t=this.node.offsetWidth,e=Math.round(this._blockMarginScale.clampScale(t)),i=NaN,r=1;;){var o=i;if(!((i=Math.round((t-e*(r+1))/r))>=this._minBlockWidth&&r<this._maxColCount)){1<r&&(i=o,r-=1);break}r+=1}if(isFinite(e)&&isFinite(i)){var n=Math.round(i*this._blockAspectRatio),s=void 0;if(this._reflowTransition){var a=Date.now();this._colCount!==r&&(this._transitionEnd=a+(this._reflowTransition.duration()||0)),a<this._transitionEnd&&(s=this._reflowTransition.duration(this._transitionEnd-a))}this._blockMargin=e,this._blockWidth=i,this._blockHeight=n,this._colCount=r;for(var u=e,h=e,l=0;l<this._childViews.length;){var p=this._childViews[l];p instanceof $p&&(p.position("absolute").left(u,s).top(h,s).width(i,s).height(n,s).blockMargin(e,s).blockWidth(i).blockHeight(n).reflowTransition(s||null),(l+=1)%r!=0?u+=i+e:h+=n+(u=e))}l%r!=0&&(h+=n+e),this.height(h)}},t.prototype.didSetState=function(t,e){a.prototype.didSetState.call(this,t,e);var i=t.get("blockAspectRatio").numberValue();void 0!==i&&this.blockAspectRatio(i);var r=t.get("blockMarginScale").cast(bn.Form);r&&this.blockMarginScale(r);var o=t.get("minBlockWidth").numberValue();void 0!==o&&this.minBlockWidth(o);var n=t.get("maxColCount").numberValue();void 0!==n&&this.minBlockWidth(n);var s=t.get("reflowTransition").cast(jn.Form);s&&this.reflowTransition(s)},t.create=function(){return new t(document.createElement("div")).className("quilt")},t.applyTheme=function(t){var e=F.empty().slot("marginTop","4px").slot("marginRight","8px").slot("marginBottom","8px").slot("marginLeft","4px").slot("titleSize","12px").slot("titleColor",q.get("textColor")).slot("subtitleSize","10px").slot("subtitleColor",q.get("textColor")),i=F.empty().slot("card",e);t.set("quilt",i)},t}(Fa);ic.applyTheme(ic.Theme);var rc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Params=Ia.Params.concat([new qs("blockMarginScale",q.get("blockMarginScale").or(q.get("quilt").get("blockMarginScale"))),new qs("blockAspectRatio",q.get("blockAspectRatio").or(q.get("quilt").get("blockAspectRatio"))),new qs("minBlockWidth",q.get("minBlockWidth").or(q.get("quilt").get("minBlockWidth"))),new qs("maxColCount",q.get("maxColCount").or(q.get("quilt").get("maxColCount"))),new qs("reflowTransition",q.get("reflowTransition").or(q.get("quilt").get("reflowTransition")))]),e}(Ia),oc=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return v(t,n),Object.defineProperty(t.prototype,"tag",{get:function(){return"quilt"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=ic.create(),o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new rc,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){var o=ec.Form.castView(e.toValue(),i,r);return o?(t.addBlock(o),o):n.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:n.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(za);ma.addGlobal(oc.Form);var nc=function(a){function t(t){var e=a.call(this,t)||this;return e.display("flex").position("relative").flexDirection("column").flexGrow(1).flexBasis(0).width("100%").height("100%"),e._contentView=e.append("div").display("flex").position("relative").flexGrow(1).flexBasis(0),e._bodyView=null,e}return v(t,a),t.prototype.bodyView=function(t){return void 0===t?this._bodyView:(this._bodyView!==t&&(this._bodyView&&this._bodyView.remove(),this._bodyView=t,this._bodyView&&this._contentView.append(this._bodyView)),this)},t.prototype.didSetState=function(t,e){a.prototype.didSetState.call(this,t,e);var i=t.get("backgroundColor").cast(qo.Form);i&&this.backgroundColor(i);var r=t.get("paddingTop").cast(Lo.Form);r&&this.paddingTop(r);var o=t.get("paddingRight").cast(Lo.Form);o&&this.paddingRight(o);var n=t.get("paddingBottom").cast(Lo.Form);n&&this.paddingBottom(n);var s=t.get("paddingLeft").cast(Lo.Form);s&&this.paddingLeft(s)},t.create=function(){return new t(document.createElement("div")).className("tile")},t.applyTheme=function(t){var e=F.empty().slot("paddingTop","8px").slot("paddingRight","8px").slot("paddingBottom","8px").slot("paddingLeft","8px");t.set("tile",e)},t}(Fa);nc.applyTheme(nc.Theme);var sc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Params=Ia.Params.concat([new qs("backgroundColor",q.get("backgroundColor").or(q.get("tile").get("backgroundColor"))),new qs("paddingTop",q.get("paddingTop").or(q.get("tile").get("paddingTop"))),new qs("paddingRight",q.get("paddingRight").or(q.get("tile").get("paddingRight"))),new qs("paddingBottom",q.get("paddingBottom").or(q.get("tile").get("paddingBottom"))),new qs("paddingLeft",q.get("paddingLeft").or(q.get("tile").get("paddingLeft")))]),e}(Ia),ac=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return v(t,n),Object.defineProperty(t.prototype,"tag",{get:function(){return"tile"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=nc.create(),o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new sc,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){if(e.key instanceof O&&"body"===e.key.value){var o=r.castView(e.toValue(),i,r);if(o)return t.bodyView(o),t.bodyView()}return n.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:n.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(za);ma.addGlobal(ac.Form);var uc=function(n){function t(t){var e=n.call(this,t)||this;return e._itemSize=Lo.px(32),e._itemSpacing=Lo.zero(),e.display("flex").justifyContent("flex-start").alignItems("center").position("relative"),e}return v(t,n),t.prototype.itemSize=function(t){return void 0===t?this._itemSize:(t=Lo.fromAny(t),this._itemSize.equals(t)||(this._itemSize=t,this.requireResize()),this)},t.prototype.itemSpacing=function(t){return void 0===t?this._itemSpacing:(t=Lo.fromAny(t),this._itemSpacing.equals(t)||(this._itemSpacing=t,this.requireResize()),this)},t.prototype.didSetState=function(t,e){n.prototype.didSetState.call(this,t,e);var i=t.get("toolbarHeight").cast(Lo.Form);i&&this.height(i);var r=t.get("itemSize").cast(Lo.Form);r&&this.itemSize(r);var o=t.get("itemSpacing").cast(Lo.Form);o&&this.itemSpacing(o)},t.prototype.didResize=function(){n.prototype.didResize.call(this);var t=this._itemSpacing.pxValue();this.paddingLeft(t/2).paddingRight(t/2);for(var e=0;e<this._childViews.length;e+=1){var i=this._childViews[e];i instanceof Fa&&i.flexGrow(0).width(this._itemSize).height(this._itemSize).marginLeft(t/2).marginRight(t/2)}},t.create=function(){return new t(document.createElement("div")).className("toolbar")},t.applyTheme=function(t){var e=F.empty().slot("height","64px").slot("itemSize","32px").slot("itemSpacing","16px");t.set("toolbar",e)},t}(Fa);uc.applyTheme(uc.Theme);var hc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Params=Ia.Params.concat([new qs("toolbarHeight",q.get("toolbarHeight").or(q.get("toolbar").get("height"))),new qs("itemSize",q.get("itemSize").or(q.get("toolbar").get("itemSize"))),new qs("itemSpacing",q.get("itemSpacing").or(q.get("toolbar").get("itemSpacing")))]),e}(Ia),lc=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return v(t,n),Object.defineProperty(t.prototype,"tag",{get:function(){return"toolbar"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=uc.create(),o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new hc,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){var o=r.castView(e.toValue(),i,r);return o instanceof _a&&t.append(o),n.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:n.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(za);ma.addGlobal(lc.Form);var pc=function(l){function t(t){var e=l.call(this,t)||this;return e._spacing=Lo.zero(),e._desiredWidth=Lo.zero(),e._minVisibleWidth=Lo.zero(),e.display("none").position("relative"),e}return v(t,l),t.prototype.spacing=function(t){return void 0===t?this._spacing:(t=Lo.fromAny(t),this._spacing.equals(t)||(this._spacing=t,this.requireResize()),this)},t.prototype.desiredWidth=function(t){return void 0===t?this._desiredWidth:(t=Lo.fromAny(t),this._desiredWidth.equals(t)||(this._desiredWidth=t,this.requireResize()),this)},t.prototype.minVisibleWidth=function(t){return void 0===t?this._minVisibleWidth:(t=Lo.fromAny(t),this._minVisibleWidth.equals(t)||(this._minVisibleWidth=t,this.requireResize()),this)},t.prototype.didSetState=function(t,e){l.prototype.didSetState.call(this,t,e);var i=t.get("spacing").cast(Lo.Form);i&&this.spacing(i);var r=t.get("desiredWidth").cast(Lo.Form);r&&this.desiredWidth(r);var o=t.get("minVisibleWidth").cast(Lo.Form);o&&this.minVisibleWidth(o)},t.prototype.willResize=function(){l.prototype.willResize.call(this);var t=this._childViews.length;if(0<t){var e=this.node.parentNode,i=e instanceof HTMLElement?e.offsetWidth:0,r=e instanceof HTMLElement?e.offsetHeight:0,o=this._desiredWidth.pxValue(i),n=this._spacing.pxValue(o),s=Math.max(0,o-2*n);if(r<s*t+n*(t+1)&&(o=(s=Math.max(0,(r-n*(t+1))/t))+2*n),this._minVisibleWidth.pxValue(i)<=o){this.display("block").width(o).flexBasis(null);for(var a=t-1,u=0;u<t;u+=1){var h=this._childViews[u];h instanceof Fa&&(h.position("absolute").left(n).right(n).bottom(a*s+(a+1)*n).width(s).height(s).boxSizing("border-box"),a-=1)}}else this.display("none")}},t.create=function(){return new t(document.createElement("div")).className("totem")},t}(Fa),cc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.Params=Ia.Params.concat([new qs("spacing",q.get("spacing").or(q.get("totem").get("spacing"))),new qs("desiredWidth",q.get("desiredWidth").or(q.get("totem").get("desiredWidth"))),new qs("minVisibleWidth",q.get("minVisibleWidth").or(q.get("totem").get("minVisibleWidth")))]),e}(Ia),dc=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return v(t,n),Object.defineProperty(t.prototype,"tag",{get:function(){return"totem"},enumerable:!0,configurable:!0}),t.prototype.castView=function(t,e,i){if(t.tag===this.tag){var r=pc.create(),o=this.materializeView(r,t,e,i);return r.setModel(o),r}},t.prototype.castModel=function(t,e,i){if(t.tag===this.tag){var r=new cc,o=this.materializeModel(r,t,e,i);return r.setData(o),r}},t.prototype.materializeViewParam=function(t,e,i,r){var o=r.castView(e.toValue(),i,r);return o instanceof _a?(t.append(o),o):n.prototype.materializeViewParam.call(this,t,e,i,r)},t.prototype.materializeModelParam=function(t,e,i,r){return e instanceof P&&e.key.value===this.tag?b.Absent:n.prototype.materializeModelParam.call(this,t,e,i,r)},t.Form=new t,t}(za);ma.addGlobal(dc.Form),"undefined"!=typeof document&&document.addEventListener("DOMContentLoaded",function(t){ma.Global.materializeScripts()}),"function"==typeof importScripts&&new hu,t.Murmur3=p,t.Random=C,t.equal=S,t.compare=V,t.Cursor=s,t.Input=y,t.StringInput=m,t.StringOutput=g,t.Iteratee=_,t.EvalStack=D,t.Item=b,t.Field=M,t.Attr=P,t.Slot=R,t.Value=w,t.Record=F,t.RecordMap=L,t.RecordMapView=I,t.Data=A,t.Text=O,t.Num=W,t.Bool=z,t.DynamicValue=B,t.Func=J,t.Extant=U,t.Absent=Bt,t.Form=_e,t.FormCursor=Ve,t.FormPairCursor=De,t.Recon=ri,t.RecordScope=ni,t.BTree=si,t.BTreePage=ai,t.STree=pi,t.STreePage=ci,t.HashGenCacheMap=qt,t.Uri=ee,t.UriScheme=ie,t.UriAuthority=re,t.UriUser=oe,t.UriHost=ne,t.UriPort=le,t.UriPath=pe,t.UriPathBuilder=ye,t.UriQuery=me,t.UriQueryBuilder=be,t.UriFragment=we,t.UriParser=Nt,t.UriCache=gi,t.Selector=q,t.IdentitySelector=G,t.LiteralSelector=N,t.GetSelector=H,t.GetAttrSelector=j,t.GetItemSelector=K,t.KeysSelector=Y,t.ChildrenSelector=X,t.DescendantsSelector=Q,t.FilterSelector=Z,t.Expr=mt,t.InfixExpr=vt,t.PrefixExpr=gt,t.CondExpr=bt,t.LorExpr=wt,t.LandExpr=_t,t.BorExpr=xt,t.BxorExpr=kt,t.BandExpr=At,t.LtExpr=Et,t.LeExpr=Ct,t.EqExpr=St,t.NeExpr=Vt,t.GeExpr=Dt,t.GtExpr=Mt,t.AddExpr=Pt,t.SubExpr=Rt,t.MulExpr=Tt,t.DivExpr=Lt,t.ModExpr=Ft,t.LnotExpr=It,t.BnotExpr=zt,t.NegExpr=Ut,t.PosExpr=Ot,t.InvokeExpr=Wt,t.client=ar,t.isOnline=ur,t.keepOnline=hr,t.downlink=lr,t.downlinkList=pr,t.downlinkMap=cr,t.downlinkValue=dr,t.hostRef=fr,t.nodeRef=yr,t.laneRef=mr,t.authenticate=vr,t.command=gr,t.Envelope=bi,t.EventMessage=ki,t.CommandMessage=Ai,t.LinkRequest=Ei,t.LinkedResponse=Ci,t.SyncRequest=Si,t.SyncedResponse=Vi,t.UnlinkRequest=Di,t.UnlinkedResponse=Mi,t.AuthRequest=Pi,t.AuthedResponse=Ri,t.DeauthRequest=Ti,t.DeauthedResponse=Li,t.RemoteHost=Fi,t.Downlink=zi,t.EventDownlink=Wi,t.ListDownlink=qi,t.ListDownlinkRecord=Gi,t.MapDownlink=Hi,t.MapDownlinkRecord=ji,t.ValueDownlink=Yi,t.ValueDownlinkRecord=Xi,t.HostRef=Zi,t.NodeRef=Ji,t.LaneRef=$i,t.DownlinkScope=tr,t.Client=sr,t.CustomEvent=yu,t.ResizeObserver=Xn,t.DurationFormat=mu,t.HMSDurationFormat=bu,t.NumberFormat=wu,t.SINumberFormat=xu,t.Angle=Ao,t.DegAngle=Eo,t.GradAngle=Co,t.RadAngle=So,t.TurnAngle=Vo,t.AngleParser=Do,t.Length=Lo,t.PxLength=Fo,t.EmLength=Io,t.RemLength=zo,t.PctLength=Uo,t.UnitlessLength=Oo,t.LengthParser=Wo,t.Color=qo,t.Rgb=Go,t.Hsl=No,t.ColorParser=Zo,t.BoxShadow=vs,t.BoxShadowParser=gs,t.Ease=br,t.Transform=$o,t.IdentityTransform=tn,t.TranslateTransform=on,t.ScaleTransform=nn,t.RotateTransform=sn,t.SkewTransform=an,t.MatrixTransform=un,t.TransformList=hn,t.TransformParser=yn,t.TransformListParser=mn,t.Interpolator=kn,t.NumberInterpolator=En,t.DateInterpolator=Cn,t.AngleInterpolator=Sn,t.LengthInterpolator=Vn,t.ColorInterpolator=Dn,t.RgbInterpolator=Mn,t.HslInterpolator=Pn,t.TransformInterpolator=Rn,t.TranslateTransformInterpolator=Tn,t.ScaleTransformInterpolator=Ln,t.RotateTransformInterpolator=Fn,t.SkewTransformInterpolator=In,t.MatrixTransformInterpolator=zn,t.TransformListInterpolator=Un,t.TransformPathInterpolator=On,t.InterpolatorInterpolator=Nn,t.ScaleInterpolator=Wn,t.LinearScaleInterpolator=Bn,t.TimeScaleInterpolator=qn,t.ReconInterpolator=ku,t.Scale=gn,t.ContinuousScale=bn,t.LinearScale=wn,t.TimeScale=_n,t.Transition=jn,t.toAttributeString=ns,t.toStyleString=ss,t.Animator=as,t.FrameAnimator=us,t.ChildAnimator=hs,t.TweenAnimator=ls,t.ChildFrameAnimator=ps,t.TweenFrameAnimator=cs,t.AttributeAnimator=ds,t.StyleAnimator=fs,t.TextAnimator=ys,t.NumberAnimator=Ba,t.LengthAnimator=qa,t.ColorAnimator=Na,t.AngleAnimator=Ga,t.KinematicEvent=Lu,t.Kinematic=zu,t.PointerKinematic=Uu,t.TouchKinematic=Ou,t.MouseKinematic=Wu,t.KinematicScaleEvent=Bu,t.KinematicScale=qu,t.KinematicScaleHorizontal=Gu,t.KinematicScaleVertical=Nu,t.Path=Yu,t.Arc=$u,t.ModelParam=qs,t.Model=Gs,t.ArcView=hh,t.ShadowBoxView=eu,t.AppView=uu,t.AppModel=hu,t.ElemView=Aa,t.ElemModel=Ea,t.ElemForm=Ca,t.HtmlView=Fa,t.HtmlModel=Ia,t.HtmlForm=za,t.HtmlElementForm=Ua,t.LayoutEditor=La,t.LayoutDataHandler=Ta,t.LayoutRenderView=Ra,t.NodeView=_a,t.NodeModel=xa,t.NodeForm=ka,t.PopoverController=Ka,t.PopoverModel=Ya,t.PopoverView=ms,t.EventsPopoverForm=Qa,t.EventsPopoverModel=$a,t.EventsPopoverController=Xa,t.SvgView=Sa,t.SvgModel=Va,t.SvgForm=Da,t.TextView=lu,t.TextModel=pu,t.TextForm=fu,t.DateTimeLocale=_r,t.DateTime=ro,t.DateTimeFormat=Ar,t.TimeInterval=uo,t.UnitTimeInterval=lo,t.TimeZone=xr,t.UiValue=ws,t.UiFunc=Rs,t.UiEnvelope=Ts,t.UiTreeEnvelope=Ls,t.UiViewEnvelope=Fs,t.UiAppendEnvelope=Is,t.UiPrependEnvelope=zs,t.UiInsertEnvelope=Us,t.UiRemoveEnvelope=Os,t.UiStateEnvelope=Ws,t.UiModelEnvelope=Bs,t.UiForm=ma,t.PolyUiForm=va,t.View=ga,t.ViewController=ba,t.ViewForm=wa,t.AuthenticatedView=lh,t.AuthenticatedModel=ph,t.AuthenticatedForm=dh,t.AccountPopoverView=fh,t.AccountPopoverModel=yh,t.AccountPopoverForm=mh,t.AccountButtonView=vh,t.AccountButtonModel=gh,t.AccountButtonForm=bh,t.BoardView=wh,t.BoardModel=_h,t.BoardForm=xh,t.ChartView=Il,t.ChartController=Wl,t.ChartForm=Bl,t.ChartModel=ql,t.Axis=Eh,t.TopAxis=Ch,t.RightAxis=Sh,t.BottomAxis=Vh,t.LeftAxis=Dh,t.AxisView=al,t.AxisForm=ul,t.AxisModel=hl,t.TickGenerator=Nh,t.NumberTickGenerator=Hh,t.TimeTickGenerator=jh,t.PlotPointController=yl,t.PlotPointForm=ml,t.PlotPointModel=vl,t.PlotView=gl,t.PlotController=ll,t.PlotForm=bl,t.PlotModel=wl,t.AreaPlotView=_l,t.AreaPlotController=kl,t.AreaPlotForm=Al,t.AreaPlotModel=El,t.CirclePlotView=Cl,t.CirclePlotController=Vl,t.CirclePlotForm=Dl,t.CirclePlotModel=Ml,t.LinePlotView=Pl,t.LinePlotController=Tl,t.LinePlotForm=Ll,t.LinePlotModel=Fl,t.PlotPopoverForm=cl,t.PlotPopoverModel=dl,t.PlotPopoverController=pl,t.GaugeView=Nl,t.GaugeController=jl,t.GaugeForm=Kl,t.GaugeModel=Yl,t.KpiView=Xl,t.KpiController=Zl,t.KpiForm=Jl,t.KpiModel=$l,t.MapView=tp,t.MapModel=ep,t.MapForm=ip,t.LayerView=op,t.LayerModel=np,t.LayerForm=sp,t.GeometryView=rp,t.GeometryModel=ap,t.GeometryForm=up,t.Mapbox=hp,t.MapboxMapView=yp,t.MapboxMapModel=mp,t.MapboxMapForm=wp,t.MapboxLayerView=fp,t.MapboxLayerModel=vp,t.MapboxLayerForm=bp,t.MapboxGeometryView=dp,t.MapboxGeometryModel=_p,t.MapboxGeometryForm=gp,t.MapboxPointView=xp,t.MapboxPointModel=kp,t.MapboxPointForm=Ap,t.MapboxPolygonView=Ep,t.MapboxPolygonModel=Cp,t.MapboxPolygonForm=Sp,t.MapboxPopoverView=lp,t.MapboxPopoverModel=pp,t.MapboxPopoverForm=cp,t.WedgeView=Rp,t.WedgeController=Ip,t.WedgeForm=Tp,t.WedgeModel=Lp,t.PieView=zp,t.PieController=Bp,t.PieForm=qp,t.PieModel=Gp,t.PlacardView=Np,t.PlacardModel=Hp,t.PlacardForm=jp,t.PieceView=Kp,t.PieceModel=Yp,t.PieceForm=Xp,t.PieceCardView=Qp,t.PieceCardModel=Zp,t.PieceCardForm=Jp,t.BlockView=$p,t.BlockModel=tc,t.BlockForm=ec,t.QuiltView=ic,t.QuiltModel=rc,t.QuiltForm=oc,t.TileView=nc,t.TileModel=sc,t.TileForm=ac,t.ToolbarView=uc,t.ToolbarModel=hc,t.ToolbarForm=lc,t.TotemView=pc,t.TotemModel=cc,t.TotemForm=dc,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=swim-app.min.js.map